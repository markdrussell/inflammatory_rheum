--------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Mark\OneDrive\PhD Project\OpenSAFELY NEIAA\inflammatory_rheum/logs/cleaning_dataset.log
  log type:  text
 opened on:  23 May 2025, 08:36:40

. 
. di "$projectdir"
C:\Users\Mark\OneDrive\PhD Project\OpenSAFELY NEIAA\inflammatory_rheum

. di "$logdir"
C:\Users\Mark\OneDrive\PhD Project\OpenSAFELY NEIAA\inflammatory_rheum/logs

. 
. import delimited "$projectdir/output/dataset.csv", clear
(encoding automatically selected: ISO-8859-1)
(93 vars, 3,474 obs)

. 
. **Set Ado file path
. adopath + "$projectdir/analysis/extra_ados"
  [1]  (BASE)      "C:\Program Files\Stata18\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata18\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "C:\Users\Mark\ado\personal/"
  [5]  (PLUS)      "C:\Users\Mark\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "C:\Users\Mark\OneDrive\PhD Project\OpenSAFELY NEIAA\inflammatory_rheum/analysis/extra_ados"

. 
. **Set index dates ===========================================================*/
. global start_date = "01/04/2016" //for outpatient analyses, data may only be available from April 2019

. global end_date = "31/03/2025"

. global base_year = year(date("$start_date", "DMY"))

. global end_year = year(date("$end_date", "DMY"))

. global max_year = $end_year - $base_year

. 
. **Conversion for dates====================================================*
. 
. ***Variables ending in _date that are string
. ds *_date, has(type string)
eia_code_d~e  copd_befor~e  frac_befor~e  solid_ca_a~e  rf_date       r~eappt_date  metho~j_date  rtt_cl_sta~e
ra_code_date  cva_before~e  dem_before~e  haem_ca_af~e  bmi_date      rheum~e_date  sulfasalaz~e  rtt_cl_ref~e
psa_code_d~e  lung_ca_be~e  chd_after_~e  ckd_after_~e  r~_appt_date  ~erheum_date  hydroxychl~e  rtt_cl_end~e
anksp_code~e  solid_ca_b~e  dm_after_d~e  depr_after~e  rheum~f_date  l~ecode_date  lef_last_d~e  rtt_op_sta~e
undiff_cod~e  haem_ca_be~e  ild_after_~e  osteop_aft~e  rheum~y_date  ~frheum_date  mtx_oral_l~e  rtt_op_ref~e
chd_before~e  ckd_before~e  copd_after~e  frac_after~e  rheum~2_date  l~fcode_date  mtx_inj_la~e  rtt_op_end~e
dm_before_~e  depr_befor~e  cva_after_~e  dem_after_~e  rheum~3_date  leflunomid~e  ssz_last_d~e
ild_before~e  osteop_bef~e  lung_ca_af~e  creatinin~te  rheum~4_date  metho~l_date  hcq_last_d~e

. local string_dates `r(varlist)'

. foreach var of local string_dates {
  2.     gen `var'_num = date(`var', "YMD")
  3.     format `var'_num %td
  4.     order `var'_num, after(`var')
  5.     drop `var'
  6.     rename `var'_num `var'
  7. }
(588 missing values generated)
(3,098 missing values generated)
(3,229 missing values generated)
(3,413 missing values generated)
(3,044 missing values generated)
(3,259 missing values generated)
(3,108 missing values generated)
(3,400 missing values generated)
(3,092 missing values generated)
(3,022 missing values generated)
(700 missing values generated)
(2,410 missing values generated)
(2,988 missing values generated)
(3,324 missing values generated)
(3,421 missing values generated)
(3,471 missing values generated)
(3,059 missing values generated)
(2,915 missing values generated)
(3,240 missing values generated)
(3,083 missing values generated)
(3,364 missing values generated)
(2,997 missing values generated)
(2,911 missing values generated)
(399 missing values generated)
(2,264 missing values generated)
(2,816 missing values generated)
(3,281 missing values generated)
(3,398 missing values generated)
(3,470 missing values generated)
(2,937 missing values generated)
(3,457 missing values generated)
(3,460 missing values generated)
(3,473 missing values generated)
(2,303 missing values generated)
(2,303 missing values generated)
(1,366 missing values generated)
(1,691 missing values generated)
(1,166 missing values generated)
(706 missing values generated)
(3,465 missing values generated)
(3,444 missing values generated)
(2,819 missing values generated)
(1,508 missing values generated)
(3,471 missing values generated)
(3,463 missing values generated)
(2,002 missing values generated)
(911 missing values generated)
(609 missing values generated)
(1,733 missing values generated)
(1,283 missing values generated)
(2,002 missing values generated)
(911 missing values generated)
(609 missing values generated)
(1,733 missing values generated)
(1,283 missing values generated)
(1,382 missing values generated)
(1,382 missing values generated)
(1,382 missing values generated)
(1,350 missing values generated)
(1,350 missing values generated)
(1,350 missing values generated)

. 
. ***Variables ending in _date that are numeric
. foreach var of varlist *_date {
  2.     capture confirm string variable `var'
  3.     if _rc != 0 {
  4.         format `var' %td
  5.     }
  6. }

. 
. ***Create binary indicator for each
. ds *_date
eia_code_d~e  copd_befor~e  frac_befor~e  solid_ca_a~e  rf_date       r~eappt_date  metho~j_date  rtt_cl_sta~e
ra_code_date  cva_before~e  dem_before~e  haem_ca_af~e  bmi_date      rheum~e_date  sulfasalaz~e  rtt_cl_ref~e
psa_code_d~e  lung_ca_be~e  chd_after_~e  ckd_after_~e  r~_appt_date  ~erheum_date  hydroxychl~e  rtt_cl_end~e
anksp_code~e  solid_ca_b~e  dm_after_d~e  depr_after~e  rheum~f_date  l~ecode_date  lef_last_d~e  rtt_op_sta~e
undiff_cod~e  haem_ca_be~e  ild_after_~e  osteop_aft~e  rheum~y_date  ~frheum_date  mtx_oral_l~e  rtt_op_ref~e
chd_before~e  ckd_before~e  copd_after~e  frac_after~e  rheum~2_date  l~fcode_date  mtx_inj_la~e  rtt_op_end~e
dm_before_~e  depr_befor~e  cva_after_~e  dem_after_~e  rheum~3_date  leflunomid~e  ssz_last_d~e
ild_before~e  osteop_bef~e  lung_ca_af~e  creatinin~te  rheum~4_date  metho~l_date  hcq_last_d~e

. local dates `r(varlist)'

. foreach var of local dates {
  2.         local newvar =  substr("`var'", 1, length("`var'") - 5)
  3.         gen `newvar' = (`var'!=. )
  4.         order `newvar', after(`var')
  5. }

. 
. /*
> **Will also need to amend conversion for biologic dates ====================================================*
> ***Some dates are given with month/year only, so adding day 15 to enable them to be processed as dates
> ***Would do this by labelling as _date_hcd then doing similar to above/below, but adding 15 days first
> 
> foreach var of varlist   abatacept_date                                         ///
>                                                  adalimumab_date                                        ///     
>                                                  baricitinib_date                                       ///
>                                                  certolizumab_date                                      ///
>                                                  etanercept_date                                        ///
>                                                  golimumab_date                                         ///
>                                                  guselkumab_date                                        ///     
>                                                  infliximab_date                                        ///
>                                                  ixekizumab_date                                        ///
>                                                  methotrexate_hcd_date                          ///
>                                                  rituximab_date                                         ///
>                                                  sarilumab_date                                         ///
>                                                  secukinumab_date                                       ///     
>                                                  tocilizumab_date                                       ///
>                                                  tofacitinib_date                                       ///
>                                                  upadacitinib_date                                      ///
>                                                  ustekinumab_date                                       ///
>                                                  {
>                                                         
>                 capture confirm string variable `var'
>                 if _rc!=0 {
>                         assert `var'==.
>                         rename `var' `var'_date
>                 }
>         
>                 else {
>                                 replace `var' = `var' + "-15"
>                                 rename `var' `var'_dstr
>                                 replace `var'_dstr = " " if `var'_dstr == "-15"
>                                 gen `var'_date = date(`var'_dstr, "YMD") 
>                                 order `var'_date, after(`var'_dstr)
>                                 drop `var'_dstr
>                 }
>         
>         format `var'_date %td
> }
> */
.                                          
. **Create and label variables ===========================================================*/
. 
. ***Age variables
. *Create categorised age
. drop if age<18 & age !=.
(0 observations deleted)

. drop if age>109 & age !=.
(0 observations deleted)

. drop if age==.
(0 observations deleted)

. lab var age "Age at diagnosis"

. 
. recode age 18/39.9999 = 1 /// 
>            40/49.9999 = 2 ///
>                    50/59.9999 = 3 ///
>                60/69.9999 = 4 ///
>                    70/79.9999 = 5 ///
>                    80/max = 6, gen(agegroup) 
(3,474 differences between age and agegroup)

. 
. label define agegroup   1 "18-39" ///
>                                                 2 "40-49" ///
>                                                 3 "50-59" ///
>                                                 4 "60-69" ///
>                                                 5 "70-79" ///
>                                                 6 "80+"

.                                                 
. label values agegroup agegroup

. lab var agegroup "Age group"

. tab agegroup, missing

  Age group |      Freq.     Percent        Cum.
------------+-----------------------------------
      18-39 |      1,490       42.89       42.89
      40-49 |        497       14.31       57.20
      50-59 |        475       13.67       70.87
      60-69 |        355       10.22       81.09
      70-79 |        272        7.83       88.92
        80+ |        385       11.08      100.00
------------+-----------------------------------
      Total |      3,474      100.00

. order agegroup, after(age)

. 
. ***Sex
. gen male = 1 if sex == "male"
(1,745 missing values generated)

. replace male = 0 if sex == "female"
(1,745 real changes made)

. lab var male "Male"

. lab define male 0 "No" 1 "Yes", modify

. lab val male male

. tab male, missing

       Male |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,745       50.23       50.23
        Yes |      1,729       49.77      100.00
------------+-----------------------------------
      Total |      3,474      100.00

. order male, after(sex)

. 
. ***Ethnicity
. gen ethnicity_n = 1 if ethnicity == "White"
(3,136 missing values generated)

. replace ethnicity_n = 2 if ethnicity == "Asian or Asian British"
(252 real changes made)

. replace ethnicity_n = 3 if ethnicity == "Black or Black British"
(255 real changes made)

. replace ethnicity_n = 4 if ethnicity == "Mixed"
(157 real changes made)

. replace ethnicity_n = 5 if ethnicity == "Chinese or Other Ethnic Groups"
(381 real changes made)

. replace ethnicity_n = 6 if ethnicity == "Unknown"
(2,091 real changes made)

. 
. 
. label define ethnicity_n        1 "White"                                               ///
>                                                         2 "Asian or Asian British"              ///
>                                                         3 "Black or Black British"      ///
>                                                         4 "Mixed"                                               //
> /
>                                                         5 "Chinese or Other Ethnic Groups" ///
>                                                         6 "Not known", modify

.                                                         
. label values ethnicity_n ethnicity_n

. lab var ethnicity_n "Ethnicity"

. tab ethnicity_n, missing

                     Ethnicity |      Freq.     Percent        Cum.
-------------------------------+-----------------------------------
                         White |        338        9.73        9.73
        Asian or Asian British |        252        7.25       16.98
        Black or Black British |        255        7.34       24.32
                         Mixed |        157        4.52       28.84
Chinese or Other Ethnic Groups |        381       10.97       39.81
                     Not known |      2,091       60.19      100.00
-------------------------------+-----------------------------------
                         Total |      3,474      100.00

. drop ethnicity

. rename ethnicity_n ethnicity 

. 
. ***Practice regions
. encode region, gen(nuts_region)

. tab region, missing

                  region |      Freq.     Percent        Cum.
-------------------------+-----------------------------------
                    East |        386       11.11       11.11
           East Midlands |        367       10.56       21.68
                  London |        364       10.48       32.15
              North East |        389       11.20       43.35
              North West |        383       11.02       54.38
              South East |        387       11.14       65.52
              South West |        398       11.46       76.97
           West Midlands |        392       11.28       88.26
Yorkshire and The Humber |        408       11.74      100.00
-------------------------+-----------------------------------
                   Total |      3,474      100.00

. replace region="Not known" if region==""
(0 real changes made)

. gen region_nospace=region

. replace region_nospace="SouthWest" if region=="South West"
(398 real changes made)

. replace region_nospace="EastMidlands" if region=="East Midlands"
(367 real changes made)

. replace region_nospace="East" if region=="East"
(0 real changes made)

. replace region_nospace="London" if region=="London"
(0 real changes made)

. replace region_nospace="NorthEast" if region=="North East"
(389 real changes made)

. replace region_nospace="NorthWest" if region=="North West"
(383 real changes made)

. replace region_nospace="SouthEast" if region=="South East"
(387 real changes made)

. replace region_nospace="WestMidlands" if region=="West Midlands"
(392 real changes made)

. replace region_nospace="YorkshireandTheHumber" if region=="Yorkshire and The Humber"
(408 real changes made)

. 
. ***IMD
. gen imd = 1 if imd_quintile == "1 (most deprived)"
(2,819 missing values generated)

. replace imd = 2 if imd_quintile == "2"
(688 real changes made)

. replace imd = 3 if imd_quintile == "3"
(610 real changes made)

. replace imd = 4 if imd_quintile == "4"
(655 real changes made)

. replace imd = 5 if imd_quintile == "5 (least deprived)"
(656 real changes made)

. replace imd = .u if imd_quintile == "Unknown"
(210 real changes made, 210 to missing)

. lab var imd "Index of multiple deprivation"

. lab define imd 1 "1 (most deprived)" ///
>                            2 "2" ///
>                            3 "3" ///
>                            4 "4" ///
>                            5 "5 (least deprived)" ///
>                            .u "Not known"

. lab val imd imd                    

. tab imd, missing

 Index of multiple |
       deprivation |      Freq.     Percent        Cum.
-------------------+-----------------------------------
 1 (most deprived) |        655       18.85       18.85
                 2 |        688       19.80       38.66
                 3 |        610       17.56       56.22
                 4 |        655       18.85       75.07
5 (least deprived) |        656       18.88       93.96
         Not known |        210        6.04      100.00
-------------------+-----------------------------------
             Total |      3,474      100.00

. drop imd_quintile

. 
. ***Body Mass Index
. *Recode strange values 
. replace bmi_value = . if bmi_value == 0 
(0 real changes made)

. replace bmi_value = . if !inrange(bmi_value, 10, 80)
(0 real changes made)

. 
. *Restrict to within 10 years of EIA diagnosis date and aged>16 
. gen bmi_time = (eia_code_date - bmi_date)/365.25
(3,473 missing values generated)

. gen bmi_age = age - bmi_time
(3,473 missing values generated)

. replace bmi_value = . if bmi_age < 16 
(0 real changes made)

. replace bmi_value = . if bmi_time > 10 & bmi_time != . 
(0 real changes made)

. 
. *Set to missing if no date, and vice versa 
. replace bmi_value = . if bmi_date == . 
(0 real changes made)

. replace bmi_date = . if bmi_value == . 
(0 real changes made)

. replace bmi_time = . if bmi_value == . 
(0 real changes made)

. replace bmi_age = . if bmi_value == . 
(0 real changes made)

. 
. *Create BMI categories
. gen     bmicat = .
(3,474 missing values generated)

. recode  bmicat . = 1 if bmi_value < 18.5
(0 changes made to bmicat)

. recode  bmicat . = 2 if bmi_value < 25
(1 changes made to bmicat)

. recode  bmicat . = 3 if bmi_value < 30
(0 changes made to bmicat)

. recode  bmicat . = 4 if bmi_value < 35
(0 changes made to bmicat)

. recode  bmicat . = 5 if bmi_value < 40
(0 changes made to bmicat)

. recode  bmicat . = 6 if bmi_value < .
(0 changes made to bmicat)

. replace bmicat = .u if bmi_value >= .
(3,473 real changes made, 3,473 to missing)

. 
. label define bmicat 1 "Underweight (<18.5)"     ///
>                                         2 "Normal (18.5-24.9)"          ///
>                                         3 "Overweight (25-29.9)"        ///
>                                         4 "Obese I (30-34.9)"           ///
>                                         5 "Obese II (35-39.9)"          ///
>                                         6 "Obese III (40+)"                     ///
>                                         .u "Not known"

.                                         
. label values bmicat bmicat

. lab var bmicat "BMI"

. tab bmicat, missing

                 BMI |      Freq.     Percent        Cum.
---------------------+-----------------------------------
  Normal (18.5-24.9) |          1        0.03        0.03
           Not known |      3,473       99.97      100.00
---------------------+-----------------------------------
               Total |      3,474      100.00

. order bmicat, after (bmi_value)

. drop bmi_age bmi_time

. 
. *Create less granular categorisation
. recode bmicat 1/3 .u = 1 4 = 2 5 = 3 6 = 4, gen(obese4cat)
(3,474 differences between bmicat and obese4cat)

. 
. label define obese4cat  1 "No record of obesity"        ///
>                                                 2 "Obese I (30-34.9)"           ///
>                                                 3 "Obese II (35-39.9)"          ///
>                                                 4 "Obese III (40+)"             

. 
. label values obese4cat obese4cat

. order obese4cat, after(bmicat)

. 
. ***Smoking 
. label define smoke 1 "Never" 2 "Former" 3 "Current" .u "Not known"

. 
. gen     smoke = 1  if smoking_status == "N"
(3,434 missing values generated)

. replace smoke = 2  if smoking_status == "E"
(1,342 real changes made)

. replace smoke = 3  if smoking_status == "S"
(2,086 real changes made)

. replace smoke = .u if smoking_status == "M"
(6 real changes made, 6 to missing)

. replace smoke = .u if smoking_status == "" 
(0 real changes made)

. 
. label values smoke smoke

. lab var smoke "Smoking status"

. drop smoking_status

. tab smoke, missing

    Smoking |
     status |      Freq.     Percent        Cum.
------------+-----------------------------------
      Never |         40        1.15        1.15
     Former |      1,342       38.63       39.78
    Current |      2,086       60.05       99.83
  Not known |          6        0.17      100.00
------------+-----------------------------------
      Total |      3,474      100.00

. 
. *Create non-missing 3-category variable for current smoking (assumes missing smoking is never smoking)
. recode smoke .u = 1, gen(smoke_nomiss)
(6 differences between smoke and smoke_nomiss)

. order smoke_nomiss, after(smoke)

. label values smoke_nomiss smoke

. 
. **Clinical comorbidities
. ***Nb. not using creatinine of HBA1c values for now, just codes
. foreach disease in ckd dm ild copd cva lung_ca solid_ca haem_ca depr osteop frac dem chd {
  2.         label define `disease'_before 0 "No" 1 "Yes"
  3.         label values `disease'_before `disease'_before
  4.         tab `disease'_before, missing
  5.         label define `disease'_after 0 "No" 1 "Yes"
  6.         label values `disease'_after `disease'_after
  7.         tab `disease'_after, missing
  8.         gen `disease'_new = 1 if (`disease'_after == 1 & `disease'_before == 0)
  9.         recode `disease'_new .=0
 10.         label define `disease'_new 0 "No" 1 "Yes"
 11.         label values `disease'_new `disease'_new
 12.         tab `disease'_new, missing
 13.         order `disease'_new, after(`disease'_after)
 14. }

 ckd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,988       86.01       86.01
        Yes |        486       13.99      100.00
------------+-----------------------------------
      Total |      3,474      100.00

  ckd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,816       81.06       81.06
        Yes |        658       18.94      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(2,895 missing values generated)
(2,895 changes made to ckd_new)

    ckd_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,895       83.33       83.33
        Yes |        579       16.67      100.00
------------+-----------------------------------
      Total |      3,474      100.00

  dm_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,259       93.81       93.81
        Yes |        215        6.19      100.00
------------+-----------------------------------
      Total |      3,474      100.00

   dm_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,240       93.26       93.26
        Yes |        234        6.74      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(3,251 missing values generated)
(3,251 changes made to dm_new)

     dm_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,251       93.58       93.58
        Yes |        223        6.42      100.00
------------+-----------------------------------
      Total |      3,474      100.00

 ild_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,108       89.46       89.46
        Yes |        366       10.54      100.00
------------+-----------------------------------
      Total |      3,474      100.00

  ild_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,083       88.74       88.74
        Yes |        391       11.26      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(3,110 missing values generated)
(3,110 changes made to ild_new)

    ild_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,110       89.52       89.52
        Yes |        364       10.48      100.00
------------+-----------------------------------
      Total |      3,474      100.00

copd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,400       97.87       97.87
        Yes |         74        2.13      100.00
------------+-----------------------------------
      Total |      3,474      100.00

 copd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,364       96.83       96.83
        Yes |        110        3.17      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(3,365 missing values generated)
(3,365 changes made to copd_new)

   copd_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,365       96.86       96.86
        Yes |        109        3.14      100.00
------------+-----------------------------------
      Total |      3,474      100.00

 cva_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,092       89.00       89.00
        Yes |        382       11.00      100.00
------------+-----------------------------------
      Total |      3,474      100.00

  cva_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,997       86.27       86.27
        Yes |        477       13.73      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(3,038 missing values generated)
(3,038 changes made to cva_new)

    cva_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,038       87.45       87.45
        Yes |        436       12.55      100.00
------------+-----------------------------------
      Total |      3,474      100.00

lung_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,022       86.99       86.99
        Yes |        452       13.01      100.00
------------+-----------------------------------
      Total |      3,474      100.00

lung_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,911       83.79       83.79
        Yes |        563       16.21      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(2,965 missing values generated)
(2,965 changes made to lung_ca_new)

lung_ca_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,965       85.35       85.35
        Yes |        509       14.65      100.00
------------+-----------------------------------
      Total |      3,474      100.00

solid_ca_be |
       fore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        700       20.15       20.15
        Yes |      2,774       79.85      100.00
------------+-----------------------------------
      Total |      3,474      100.00

solid_ca_af |
        ter |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        399       11.49       11.49
        Yes |      3,075       88.51      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(2,846 missing values generated)
(2,846 changes made to solid_ca_new)

solid_ca_ne |
          w |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,846       81.92       81.92
        Yes |        628       18.08      100.00
------------+-----------------------------------
      Total |      3,474      100.00

haem_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,410       69.37       69.37
        Yes |      1,064       30.63      100.00
------------+-----------------------------------
      Total |      3,474      100.00

haem_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,264       65.17       65.17
        Yes |      1,210       34.83      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(2,576 missing values generated)
(2,576 changes made to haem_ca_new)

haem_ca_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,576       74.15       74.15
        Yes |        898       25.85      100.00
------------+-----------------------------------
      Total |      3,474      100.00

depr_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,324       95.68       95.68
        Yes |        150        4.32      100.00
------------+-----------------------------------
      Total |      3,474      100.00

 depr_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,281       94.44       94.44
        Yes |        193        5.56      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(3,291 missing values generated)
(3,291 changes made to depr_new)

   depr_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,291       94.73       94.73
        Yes |        183        5.27      100.00
------------+-----------------------------------
      Total |      3,474      100.00

osteop_befo |
         re |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,421       98.47       98.47
        Yes |         53        1.53      100.00
------------+-----------------------------------
      Total |      3,474      100.00

osteop_afte |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,398       97.81       97.81
        Yes |         76        2.19      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(3,399 missing values generated)
(3,399 changes made to osteop_new)

 osteop_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,399       97.84       97.84
        Yes |         75        2.16      100.00
------------+-----------------------------------
      Total |      3,474      100.00

frac_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,471       99.91       99.91
        Yes |          3        0.09      100.00
------------+-----------------------------------
      Total |      3,474      100.00

 frac_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,470       99.88       99.88
        Yes |          4        0.12      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(3,470 missing values generated)
(3,470 changes made to frac_new)

   frac_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,470       99.88       99.88
        Yes |          4        0.12      100.00
------------+-----------------------------------
      Total |      3,474      100.00

 dem_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,059       88.05       88.05
        Yes |        415       11.95      100.00
------------+-----------------------------------
      Total |      3,474      100.00

  dem_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,937       84.54       84.54
        Yes |        537       15.46      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(2,996 missing values generated)
(2,996 changes made to dem_new)

    dem_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,996       86.24       86.24
        Yes |        478       13.76      100.00
------------+-----------------------------------
      Total |      3,474      100.00

 chd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,044       87.62       87.62
        Yes |        430       12.38      100.00
------------+-----------------------------------
      Total |      3,474      100.00

  chd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,915       83.91       83.91
        Yes |        559       16.09      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(2,970 missing values generated)
(2,970 changes made to chd_new)

    chd_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,970       85.49       85.49
        Yes |        504       14.51      100.00
------------+-----------------------------------
      Total |      3,474      100.00

. 
. lab var ckd_before "Chronic kidney disease"

. lab var ckd_after "Chronic kidney disease"

. lab var ckd_new "Chronic kidney disease"

. lab var dm_before "Type 2 diabetes mellitus"

. lab var dm_after "Type 2 diabetes mellitus"

. lab var dm_new "Type 2 diabetes mellitus"

. lab var ild_before "Interstitial lung disease"

. lab var ild_after "Interstitial lung disease"

. lab var ild_new "Interstitial lung disease"

. lab var copd_before "COPD"

. lab var copd_after "COPD"

. lab var copd_new "COPD"

. lab var lung_ca_before "Lung cancer"

. lab var lung_ca_after "Lung cancer"

. lab var lung_ca_new "Lung cancer"

. lab var solid_ca_before "Solid organ cancer"

. lab var solid_ca_after "Solid organ cancer"

. lab var solid_ca_new "Solid organ cancer"

. lab var haem_ca_before "Haematological cancer"

. lab var haem_ca_after "Haematological cancer"

. lab var haem_ca_new "Haematological cancer"

. lab var depr_before "Depression"

. lab var depr_after "Depression"

. lab var depr_new "Depression"

. lab var osteop_before "Osteoporosis"

. lab var osteop_after "Osteoporosis"

. lab var osteop_new "Osteoporosis"

. lab var frac_before "Fragility fracture"

. lab var frac_after "Fragility fracture"

. lab var frac_new "Fragility fracture"

. lab var dem_before "Dementia"

. lab var dem_after "Dementia"

. lab var dem_new "Dementia"

. lab var chd_before "Coronary heart disease"

. lab var chd_after "Coronary heart disease"

. lab var chd_new "Coronary heart disease"

. 
. lab var rheum_appt "Rheumatology appointment"

. lab define rheum_appt 0 "No" 1 "Yes", modify

. lab val rheum_appt rheum_appt

. 
. **All patients should have diagnostic code=============================================================*/
. tab eia_code, missing

   eia_code |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      3,474      100.00      100.00
------------+-----------------------------------
      Total |      3,474      100.00

. keep if eia_code==1
(0 observations deleted)

. 
. **Check first rheum appt date was before diagnostic code date==================================*/
. 
. tab rheum_appt, missing //proportion of patients with an rheum outpatient date (with first attendance option selec
> ted) in the 12 months before EIA code appeared in GP record; data only April 2019 onwards

Rheumatolog |
          y |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,303       66.29       66.29
        Yes |      1,171       33.71      100.00
------------+-----------------------------------
      Total |      3,474      100.00

. tab rheum_appt if rheum_appt_date>eia_code_date & rheum_appt_date!=. //confirm proportion who had first rheum appt
>  (i.e. not missing) after EIA code

Rheumatolog |
          y |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |        182      100.00      100.00
------------+-----------------------------------
      Total |        182      100.00

. tab rheum_appt if rheum_appt_date>(eia_code_date + 30) & rheum_appt_date!=. //confirm proportion who had first rhe
> um appt 30 days after EIA code 

Rheumatolog |
          y |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |         97      100.00      100.00
------------+-----------------------------------
      Total |         97      100.00

. tab rheum_appt if rheum_appt_date>(eia_code_date + 60) & rheum_appt_date!=. //confirm proportion who had first rhe
> um appt 60 days after EIA code - should be none
no observations

. replace rheum_appt=0 if rheum_appt_date>(eia_code_date + 60) & rheum_appt_date!=. //replace as missing if first ap
> pt >60 days after EIA code - should be none
(0 real changes made)

. replace rheum_appt_date=. if rheum_appt_date>(eia_code_date + 60) & rheum_appt_date!=. //replace as missing if fir
> st appt >60 days after EIA code - should be none
(0 real changes made)

. 
. **As above - for differently specified rheumatology appointments
. replace rheum_appt_any=0 if rheum_appt_any_date>(eia_code_date + 60) & rheum_appt_any_date!=. //replace as missing
>  those appts >60 days after EIA code
(0 real changes made)

. replace rheum_appt_any_date=. if rheum_appt_any_date>(eia_code_date + 60) & rheum_appt_any_date!=. //replace as mi
> ssing those appts >60 days after EIA code
(0 real changes made)

. replace rheum_appt2=0 if rheum_appt2_date>(eia_code_date + 60) & rheum_appt2_date!=. //replace as missing those ap
> pts >60 days after EIA code
(0 real changes made)

. replace rheum_appt2_date=. if rheum_appt2_date>(eia_code_date + 60) & rheum_appt2_date!=. //replace as missing tho
> se appts >60 days after EIA code_yea
(0 real changes made)

. replace rheum_appt3=0 if rheum_appt3_date>(eia_code_date + 60) & rheum_appt3_date!=. //replace as missing those ap
> pts >60 days after EIA code
(0 real changes made)

. replace rheum_appt3_date=. if rheum_appt3_date>(eia_code_date + 60) & rheum_appt3_date!=. //replace as missing tho
> se appts >60 days after EIA code
(0 real changes made)

. replace rheum_appt4=0 if rheum_appt4_date>(eia_code_date + 60) & rheum_appt4_date!=. //replace as missing those ap
> pts >60 days after EIA code - THIS IS AN IMPORTANT ONE TO CHECK
(460 real changes made)

. replace rheum_appt4_date=. if rheum_appt4_date>(eia_code_date + 60) & rheum_appt4_date!=. //replace as missing tho
> se appts >60 days after EIA code
(460 real changes made, 460 to missing)

. 
. *Check if first csDMARD/biologic was after rheum appt date=====================================================*/
. **csDMARDs (not including high cost MTX; wouldn't be shared care)
. gen csdmard=1 if hydroxychloroquine==1 | leflunomide==1 | methotrexate_oral==1 | methotrexate_inj==1 | sulfasalazi
> ne==1
(228 missing values generated)

. recode csdmard .=0 
(228 changes made to csdmard)

. tab csdmard, missing

    csdmard |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        228        6.56        6.56
          1 |      3,246       93.44      100.00
------------+-----------------------------------
      Total |      3,474      100.00

. 
. **Date of first csDMARD script (not including high cost MTX prescriptions)
. gen csdmard_date=min(hydroxychloroquine_date, leflunomide_date, methotrexate_oral_date, methotrexate_inj_date, sul
> fasalazine_date)
(228 missing values generated)

. format %td csdmard_date

. 
. **Generate combined methotrexate (primary care only)
. gen mtx = 1 if methotrexate_oral==1 | methotrexate_inj==1
(363 missing values generated)

. recode mtx .=0
(363 changes made to mtx)

. lab var mtx "Methotrexate"

. gen mtx_date = min(methotrexate_oral_date, methotrexate_inj_date) if mtx == 1
(363 missing values generated)

. format %td mtx_date

. 
. **Exclude if first csdmard was more than 60 days before first rheum appt
. tab csdmard if rheum_appt_date!=. & csdmard_date!=. & csdmard_date<rheum_appt_date

    csdmard |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        949      100.00      100.00
------------+-----------------------------------
      Total |        949      100.00

. tab csdmard if rheum_appt_date!=. & csdmard_date!=. & (csdmard_date + 60)<rheum_appt_date 

    csdmard |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        921      100.00      100.00
------------+-----------------------------------
      Total |        921      100.00

. gen pre_ra_csdmard_time = (rheum_appt_date - csdmard_date) if rheum_appt_date!=. & csdmard_date!=. & csdmard_date<
> rheum_appt_date
(2,525 missing values generated)

. tabstat pre_ra_csdmard_time, stats (n mean p50 p25 p75) // how long before were csdmards prescribed

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
pre_ra_csd~e |       949  695.8335       600       320       956
----------------------------------------------------------------

. tab mtx if rheum_appt_date!=. & mtx_date!=. & (mtx_date + 60)<rheum_appt_date 

Methotrexat |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        799      100.00      100.00
------------+-----------------------------------
      Total |        799      100.00

. tab hydroxychloroquine if rheum_appt_date!=. & hydroxychloroquine_date!=. & (hydroxychloroquine_date + 60)<rheum_a
> ppt_date 

hydroxychlo |
    roquine |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        382      100.00      100.00
------------+-----------------------------------
      Total |        382      100.00

. tab sulfasalazine if rheum_appt_date!=. & sulfasalazine_date!=. & (sulfasalazine_date + 60)<rheum_appt_date 

sulfasalazi |
         ne |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        285      100.00      100.00
------------+-----------------------------------
      Total |        285      100.00

. tab leflunomide if rheum_appt_date!=. & leflunomide_date!=. & (leflunomide_date + 60)<rheum_appt_date 

leflunomide |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        221      100.00      100.00
------------+-----------------------------------
      Total |        221      100.00

. drop if rheum_appt_date!=. & csdmard_date!=. & (csdmard_date + 60)<rheum_appt_date //drop if first csDMARD more th
> an 60 days before first attendance at a rheum appt 
(921 observations deleted)

. tab csdmard if rheum_appt_date==. & rheum_appt_any_date!=. & csdmard_date!=. & (csdmard_date + 60)<rheum_appt_any_
> date

    csdmard |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        681      100.00      100.00
------------+-----------------------------------
      Total |        681      100.00

. drop if rheum_appt_date==. & rheum_appt_any_date!=. & csdmard_date!=. & (csdmard_date + 60)<rheum_appt_any_date //
> drop if first csDMARD more than 60 days before first captured rheum appt that did not have first attendance tag
(681 observations deleted)

. 
. /*
> **csDMARDs (including high cost MTX)
> gen csdmard_hcd=1 if hydroxychloroquine==1 | leflunomide==1 | methotrexate==1 | methotrexate_hcd==1 | sulfasalazin
> e==1
> recode csdmard_hcd .=0 
> tab csdmard_hcd, missing
> 
> **Date of first csDMARD script (including high cost MTX prescriptions)
> gen csdmard_hcd_date=min(hydroxychloroquine_date, leflunomide_date, methotrexate_date, methotrexate_hcd_date, sulf
> asalazine_date)
> format %td csdmard_hcd_date
> 
> **Biologic use
> gen biologic=1 if abatacept==1 | adalimumab==1 | baricitinib==1 | certolizumab==1 | etanercept==1 | golimumab==1 |
>  guselkumab==1 | infliximab==1 | ixekizumab==1 | rituximab==1 | sarilumab==1 | secukinumab==1 | tocilizumab==1 | t
> ofacitinib==1 | upadacitinib==1 | ustekinumab==1 
> recode biologic .=0
> tab biologic, missing
> 
> **Date of first biologic script
> gen biologic_date=min(abatacept_date, adalimumab_date, baricitinib_date, certolizumab_date, etanercept_date, golim
> umab_date, guselkumab_date, infliximab_date, ixekizumab_date, rituximab_date, sarilumab_date, secukinumab_date, to
> cilizumab_date, tofacitinib_date, upadacitinib_date, ustekinumab_date)
> format %td biologic_date
> 
> tab biologic if rheum_appt_date!=. & biologic_date!=. & biologic_date<rheum_appt_date 
> tab biologic if rheum_appt_date!=. & biologic_date!=. & (biologic_date + 60)<rheum_appt_date 
> drop if rheum_appt_date!=. & biologic_date!=. & (biologic_date + 60)<rheum_appt_date //drop if first biologic more
>  than 60 days before first rheum_appt_date
> tab biologic if rheum_appt_date==. & rheum_appt_any_date!=. & biologic_date!=. & (biologic_date + 60)<rheum_appt_a
> ny_date
> drop if rheum_appt_date==. & rheum_appt_any_date!=. & biologic_date!=. & (biologic_date + 60)<rheum_appt_any_date 
> //drop if first biologic more than 60 days before first captured rheum appt that did not have first attendance tag
> */
. 
. *Generate diagnosis date===============================================================*/
. 
. **Use diagnostic code date (in GP record) as diagnosis date
. gen diagnosis_date=eia_code_date

. format diagnosis_date %td

. 
. *Refine diagnostic window=============================================================*/
. 
. **Keep patients with diagnosis date after start date and before end date - should be none dropped
. keep if diagnosis_date>=date("$start_date", "DMY") & diagnosis_date!=. 
(0 observations deleted)

. tab eia_code, missing

   eia_code |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      1,872      100.00      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. keep if diagnosis_date<=date("$end_date", "DMY") & diagnosis_date!=. 
(0 observations deleted)

. tab eia_code, missing

   eia_code |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      1,872      100.00      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. *Include only most recent EIA sub-diagnosis=============================================*/
. replace ra_code =0 if psa_code_date > ra_code_date & psa_code_date !=.
(16 real changes made)

. replace ra_code =0 if anksp_code_date > ra_code_date & anksp_code_date !=.
(13 real changes made)

. replace ra_code =0 if undiff_code_date > ra_code_date & undiff_code_date !=.
(3 real changes made)

. replace psa_code =0 if ra_code_date >= psa_code_date & ra_code_date !=.
(15 real changes made)

. replace psa_code =0 if anksp_code_date > psa_code_date & anksp_code_date !=.
(0 real changes made)

. replace psa_code =0 if undiff_code_date > psa_code_date & undiff_code_date !=.
(0 real changes made)

. replace anksp_code =0 if psa_code_date >= anksp_code_date & psa_code_date !=.
(1 real change made)

. replace anksp_code =0 if ra_code_date >= anksp_code_date & ra_code_date !=.
(7 real changes made)

. replace anksp_code =0 if undiff_code_date > anksp_code_date & undiff_code_date !=.
(0 real changes made)

. replace undiff_code =0 if ra_code_date >= undiff_code_date & ra_code_date !=.
(2 real changes made)

. replace undiff_code =0 if psa_code_date >= undiff_code_date & psa_code_date !=.
(1 real change made)

. replace undiff_code =0 if anksp_code_date >= undiff_code_date & anksp_code_date !=.
(0 real changes made)

. gen eia_diagnosis=1 if ra_code==1
(346 missing values generated)

. replace eia_diagnosis=2 if psa_code==1
(192 real changes made)

. replace eia_diagnosis=3 if anksp_code==1
(129 real changes made)

. replace eia_diagnosis=4 if undiff_code==1
(25 real changes made)

. lab define eia_diagnosis 1 "RA" 2 "PsA" 3 "AxSpA" 4 "Undiff IA", modify

. lab val eia_diagnosis eia_diagnosis

. tab eia_diagnosis, missing

eia_diagnos |
         is |      Freq.     Percent        Cum.
------------+-----------------------------------
         RA |      1,526       81.52       81.52
        PsA |        192       10.26       91.77
      AxSpA |        129        6.89       98.66
  Undiff IA |         25        1.34      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. drop if eia_diagnosis==. //should be none
(0 observations deleted)

. 
. decode eia_diagnosis, gen(eia_diag)

. replace eia_diag="Undiff_IA" if eia_diagnosis==4
(25 real changes made)

. 
. *Split into time windows=========================================*/
. 
. **Month/Year of GP diagnostic code
. gen year_diag=year(eia_code_date)

. format year_diag %ty

. gen month_diag=month(eia_code_date)

. gen mo_year_diagn=ym(year_diag, month_diag)

. format mo_year_diagn %tmMon-CCYY

. generate str16 mo_year_diagn_s = strofreal(mo_year_diagn,"%tmCCYY!mNN")

. lab var mo_year_diagn "Month/Year of Diagnosis"

. lab var mo_year_diagn_s "Month/Year of Diagnosis"

. 
. **Month/Year of rheum appt
. gen year_appt=year(rheum_appt_date) if rheum_appt_date!=.
(1,622 missing values generated)

. format year_appt %ty

. gen month_appt=month(rheum_appt_date) if rheum_appt_date!=. 
(1,622 missing values generated)

. gen mo_year_appt=ym(year_appt, month_appt)
(1,622 missing values generated)

. format mo_year_appt %tmMon-CCYY

. generate str16 mo_year_appt_s = strofreal(mo_year_appt,"%tmCCYY!mNN")

. 
. **Separate into 3-month time windows (for diagnosis date)
. gen diagnosis_3m = qofd(diagnosis_date)

. format diagnosis_3m %tq

. lab var diagnosis_3m "Time period for diagnosis"

. tab diagnosis_3m, missing

Time period |
        for |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
     2016q2 |          9        0.48        0.48
     2016q3 |          4        0.21        0.69
     2016q4 |         11        0.59        1.28
     2017q1 |          5        0.27        1.55
     2017q2 |         18        0.96        2.51
     2017q3 |         10        0.53        3.04
     2017q4 |          9        0.48        3.53
     2018q1 |          9        0.48        4.01
     2018q2 |          8        0.43        4.43
     2018q3 |         13        0.69        5.13
     2018q4 |          8        0.43        5.56
     2019q1 |         10        0.53        6.09
     2019q2 |         18        0.96        7.05
     2019q3 |         14        0.75        7.80
     2019q4 |         14        0.75        8.55
     2020q1 |          9        0.48        9.03
     2020q2 |         16        0.85        9.88
     2020q3 |         14        0.75       10.63
     2020q4 |         28        1.50       12.13
     2021q1 |         19        1.01       13.14
     2021q2 |         26        1.39       14.53
     2021q3 |         34        1.82       16.35
     2021q4 |         27        1.44       17.79
     2022q1 |         38        2.03       19.82
     2022q2 |         50        2.67       22.49
     2022q3 |         55        2.94       25.43
     2022q4 |         79        4.22       29.65
     2023q1 |         95        5.07       34.72
     2023q2 |        101        5.40       40.12
     2023q3 |        130        6.94       47.06
     2023q4 |        132        7.05       54.11
     2024q1 |        167        8.92       63.03
     2024q2 |        160        8.55       71.58
     2024q3 |        170        9.08       80.66
     2024q4 |        176        9.40       90.06
     2025q1 |        186        9.94      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. bys eia_diagnosis: tab diagnosis_3m, missing

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = RA

Time period |
        for |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
     2016q2 |          6        0.39        0.39
     2016q3 |          4        0.26        0.66
     2016q4 |         10        0.66        1.31
     2017q1 |          4        0.26        1.57
     2017q2 |         15        0.98        2.56
     2017q3 |          7        0.46        3.01
     2017q4 |          7        0.46        3.47
     2018q1 |          8        0.52        4.00
     2018q2 |          7        0.46        4.46
     2018q3 |         13        0.85        5.31
     2018q4 |          6        0.39        5.70
     2019q1 |          9        0.59        6.29
     2019q2 |         15        0.98        7.27
     2019q3 |         10        0.66        7.93
     2019q4 |         11        0.72        8.65
     2020q1 |          6        0.39        9.04
     2020q2 |         10        0.66        9.70
     2020q3 |         11        0.72       10.42
     2020q4 |         24        1.57       11.99
     2021q1 |         13        0.85       12.84
     2021q2 |         20        1.31       14.15
     2021q3 |         28        1.83       15.99
     2021q4 |         20        1.31       17.30
     2022q1 |         29        1.90       19.20
     2022q2 |         37        2.42       21.63
     2022q3 |         46        3.01       24.64
     2022q4 |         63        4.13       28.77
     2023q1 |         78        5.11       33.88
     2023q2 |         85        5.57       39.45
     2023q3 |        107        7.01       46.46
     2023q4 |        116        7.60       54.06
     2024q1 |        128        8.39       62.45
     2024q2 |        132        8.65       71.10
     2024q3 |        142        9.31       80.41
     2024q4 |        147        9.63       90.04
     2025q1 |        152        9.96      100.00
------------+-----------------------------------
      Total |      1,526      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = PsA

Time period |
        for |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
     2016q2 |          1        0.52        0.52
     2016q4 |          1        0.52        1.04
     2017q1 |          1        0.52        1.56
     2017q2 |          3        1.56        3.12
     2017q3 |          1        0.52        3.65
     2017q4 |          2        1.04        4.69
     2018q1 |          1        0.52        5.21
     2018q4 |          1        0.52        5.73
     2019q2 |          3        1.56        7.29
     2019q3 |          2        1.04        8.33
     2020q1 |          2        1.04        9.37
     2020q2 |          4        2.08       11.46
     2020q3 |          2        1.04       12.50
     2020q4 |          3        1.56       14.06
     2021q1 |          2        1.04       15.10
     2021q2 |          2        1.04       16.15
     2021q3 |          3        1.56       17.71
     2021q4 |          5        2.60       20.31
     2022q1 |          5        2.60       22.92
     2022q2 |          9        4.69       27.60
     2022q3 |          6        3.12       30.73
     2022q4 |          8        4.17       34.90
     2023q1 |          6        3.12       38.02
     2023q2 |          5        2.60       40.62
     2023q3 |         14        7.29       47.92
     2023q4 |         11        5.73       53.65
     2024q1 |         20       10.42       64.06
     2024q2 |         18        9.38       73.44
     2024q3 |         16        8.33       81.77
     2024q4 |         18        9.38       91.15
     2025q1 |         17        8.85      100.00
------------+-----------------------------------
      Total |        192      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = AxSpA

Time period |
        for |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
     2016q2 |          1        0.78        0.78
     2017q3 |          1        0.78        1.55
     2018q4 |          1        0.78        2.33
     2019q3 |          2        1.55        3.88
     2019q4 |          2        1.55        5.43
     2020q1 |          1        0.78        6.20
     2020q2 |          2        1.55        7.75
     2020q3 |          1        0.78        8.53
     2020q4 |          1        0.78        9.30
     2021q1 |          3        2.33       11.63
     2021q2 |          3        2.33       13.95
     2021q3 |          2        1.55       15.50
     2021q4 |          2        1.55       17.05
     2022q1 |          4        3.10       20.16
     2022q2 |          4        3.10       23.26
     2022q3 |          3        2.33       25.58
     2022q4 |          8        6.20       31.78
     2023q1 |          8        6.20       37.98
     2023q2 |         11        8.53       46.51
     2023q3 |          5        3.88       50.39
     2023q4 |          5        3.88       54.26
     2024q1 |         18       13.95       68.22
     2024q2 |          9        6.98       75.19
     2024q3 |          9        6.98       82.17
     2024q4 |          9        6.98       89.15
     2025q1 |         14       10.85      100.00
------------+-----------------------------------
      Total |        129      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = Undiff IA

Time period |
        for |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
     2016q2 |          1        4.00        4.00
     2017q3 |          1        4.00        8.00
     2018q2 |          1        4.00       12.00
     2019q1 |          1        4.00       16.00
     2019q4 |          1        4.00       20.00
     2021q1 |          1        4.00       24.00
     2021q2 |          1        4.00       28.00
     2021q3 |          1        4.00       32.00
     2023q1 |          3       12.00       44.00
     2023q3 |          4       16.00       60.00
     2024q1 |          1        4.00       64.00
     2024q2 |          1        4.00       68.00
     2024q3 |          3       12.00       80.00
     2024q4 |          2        8.00       88.00
     2025q1 |          3       12.00      100.00
------------+-----------------------------------
      Total |         25      100.00


. 
. **Separate into 12-month time windows (for diagnosis date)
. gen diagnosis_year = (floor((diagnosis_date - date("$start_date", "DMY")) / 365.25) + 1) if inrange(diagnosis_date
> , date("$start_date", "DMY"), date("$end_date", "DMY"))

. lab var diagnosis_year "Year of diagnosis"

. forvalues i = 1/$max_year {
  2.     local start = $base_year + `i' - 1
  3.     local end = `start' + 1
  4.     label define diagnosis_year_lbl `i' "Apr `start'–Mar `end'", add
  5. }

. lab val diagnosis_year diagnosis_year_lbl

. tab diagnosis_year, missing

Year of diagnosis |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |         29        1.55        1.55
Apr 2017–Mar 2018 |         46        2.46        4.01
Apr 2018–Mar 2019 |         40        2.14        6.14
Apr 2019–Mar 2020 |         54        2.88        9.03
Apr 2020–Mar 2021 |         78        4.17       13.19
Apr 2021–Mar 2022 |        124        6.62       19.82
Apr 2022–Mar 2023 |        279       14.90       34.72
Apr 2023–Mar 2024 |        530       28.31       63.03
Apr 2024–Mar 2025 |        692       36.97      100.00
------------------+-----------------------------------
            Total |      1,872      100.00

. bys eia_diagnosis: tab diagnosis_year, missing

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = RA

Year of diagnosis |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |         24        1.57        1.57
Apr 2017–Mar 2018 |         37        2.42        4.00
Apr 2018–Mar 2019 |         36        2.36        6.36
Apr 2019–Mar 2020 |         41        2.69        9.04
Apr 2020–Mar 2021 |         59        3.87       12.91
Apr 2021–Mar 2022 |         96        6.29       19.20
Apr 2022–Mar 2023 |        224       14.68       33.88
Apr 2023–Mar 2024 |        436       28.57       62.45
Apr 2024–Mar 2025 |        573       37.55      100.00
------------------+-----------------------------------
            Total |      1,526      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = PsA

Year of diagnosis |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |          3        1.56        1.56
Apr 2017–Mar 2018 |          7        3.65        5.21
Apr 2018–Mar 2019 |          1        0.52        5.73
Apr 2019–Mar 2020 |          7        3.65        9.38
Apr 2020–Mar 2021 |         11        5.73       15.10
Apr 2021–Mar 2022 |         15        7.81       22.92
Apr 2022–Mar 2023 |         29       15.10       38.02
Apr 2023–Mar 2024 |         50       26.04       64.06
Apr 2024–Mar 2025 |         69       35.94      100.00
------------------+-----------------------------------
            Total |        192      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = AxSpA

Year of diagnosis |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |          1        0.78        0.78
Apr 2017–Mar 2018 |          1        0.78        1.55
Apr 2018–Mar 2019 |          1        0.78        2.33
Apr 2019–Mar 2020 |          5        3.88        6.20
Apr 2020–Mar 2021 |          7        5.43       11.63
Apr 2021–Mar 2022 |         11        8.53       20.16
Apr 2022–Mar 2023 |         23       17.83       37.98
Apr 2023–Mar 2024 |         39       30.23       68.22
Apr 2024–Mar 2025 |         41       31.78      100.00
------------------+-----------------------------------
            Total |        129      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = Undiff IA

Year of diagnosis |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |          1        4.00        4.00
Apr 2017–Mar 2018 |          1        4.00        8.00
Apr 2018–Mar 2019 |          2        8.00       16.00
Apr 2019–Mar 2020 |          1        4.00       20.00
Apr 2020–Mar 2021 |          1        4.00       24.00
Apr 2021–Mar 2022 |          2        8.00       32.00
Apr 2022–Mar 2023 |          3       12.00       44.00
Apr 2023–Mar 2024 |          5       20.00       64.00
Apr 2024–Mar 2025 |          9       36.00      100.00
------------------+-----------------------------------
            Total |         25      100.00


. 
. **Separate into 3-month time windows (for appt date)
. gen appt_3m = qofd(rheum_appt_date)
(1,622 missing values generated)

. format appt_3m %tq

. lab var appt_3m "Time period for appointment"

. tab appt_3m, missing

Time period |
        for |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
     2015q2 |          1        0.05        0.05
     2015q3 |          2        0.11        0.16
     2015q4 |          1        0.05        0.21
     2016q1 |          2        0.11        0.32
     2016q2 |          1        0.05        0.37
     2016q3 |          2        0.11        0.48
     2016q4 |          3        0.16        0.64
     2017q2 |          1        0.05        0.69
     2017q3 |          2        0.11        0.80
     2017q4 |          2        0.11        0.91
     2018q3 |          3        0.16        1.07
     2018q4 |          3        0.16        1.23
     2019q3 |          2        0.11        1.34
     2019q4 |          2        0.11        1.44
     2020q2 |          1        0.05        1.50
     2020q3 |          1        0.05        1.55
     2020q4 |          1        0.05        1.60
     2021q1 |          1        0.05        1.66
     2021q2 |          3        0.16        1.82
     2021q3 |          2        0.11        1.92
     2021q4 |          1        0.05        1.98
     2022q1 |          4        0.21        2.19
     2022q2 |          5        0.27        2.46
     2022q3 |          8        0.43        2.88
     2022q4 |         11        0.59        3.47
     2023q1 |         18        0.96        4.43
     2023q2 |          9        0.48        4.91
     2023q3 |         19        1.01        5.93
     2023q4 |         27        1.44        7.37
     2024q1 |         41        2.19        9.56
     2024q2 |         33        1.76       11.32
     2024q3 |         17        0.91       12.23
     2024q4 |         15        0.80       13.03
     2025q1 |          6        0.32       13.35
          . |      1,622       86.65      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. bys eia_diagnosis: tab appt_3m, missing

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = RA

Time period |
        for |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
     2015q3 |          1        0.07        0.07
     2015q4 |          1        0.07        0.13
     2016q1 |          2        0.13        0.26
     2016q2 |          1        0.07        0.33
     2016q3 |          2        0.13        0.46
     2016q4 |          2        0.13        0.59
     2017q2 |          1        0.07        0.66
     2017q3 |          2        0.13        0.79
     2017q4 |          2        0.13        0.92
     2018q3 |          3        0.20        1.11
     2018q4 |          3        0.20        1.31
     2019q3 |          1        0.07        1.38
     2019q4 |          2        0.13        1.51
     2020q2 |          1        0.07        1.57
     2020q3 |          1        0.07        1.64
     2020q4 |          1        0.07        1.70
     2021q1 |          1        0.07        1.77
     2021q2 |          3        0.20        1.97
     2021q3 |          2        0.13        2.10
     2021q4 |          1        0.07        2.16
     2022q1 |          4        0.26        2.42
     2022q2 |          5        0.33        2.75
     2022q3 |          8        0.52        3.28
     2022q4 |         11        0.72        4.00
     2023q1 |         16        1.05        5.05
     2023q2 |          5        0.33        5.37
     2023q3 |         12        0.79        6.16
     2023q4 |         18        1.18        7.34
     2024q1 |         32        2.10        9.44
     2024q2 |         27        1.77       11.21
     2024q3 |         15        0.98       12.19
     2024q4 |         13        0.85       13.04
     2025q1 |          6        0.39       13.43
          . |      1,321       86.57      100.00
------------+-----------------------------------
      Total |      1,526      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = PsA

Time period |
        for |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
     2015q3 |          1        0.52        0.52
     2023q1 |          1        0.52        1.04
     2023q2 |          1        0.52        1.56
     2023q3 |          4        2.08        3.65
     2023q4 |          3        1.56        5.21
     2024q1 |          2        1.04        6.25
     2024q2 |          5        2.60        8.85
     2024q4 |          1        0.52        9.38
          . |        174       90.62      100.00
------------+-----------------------------------
      Total |        192      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = AxSpA

Time period |
        for |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
     2019q3 |          1        0.78        0.78
     2023q2 |          3        2.33        3.10
     2023q3 |          3        2.33        5.43
     2023q4 |          6        4.65       10.08
     2024q1 |          7        5.43       15.50
     2024q2 |          1        0.78       16.28
     2024q3 |          1        0.78       17.05
     2024q4 |          1        0.78       17.83
          . |        106       82.17      100.00
------------+-----------------------------------
      Total |        129      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = Undiff IA

Time period |
        for |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
     2015q2 |          1        4.00        4.00
     2016q4 |          1        4.00        8.00
     2023q1 |          1        4.00       12.00
     2024q3 |          1        4.00       16.00
          . |         21       84.00      100.00
------------+-----------------------------------
      Total |         25      100.00


. 
. **Separate into 12-month time windows (for appt date)
. gen appt_year = (floor((rheum_appt_date - date("$start_date", "DMY")) / 365.25) + 1) if inrange(rheum_appt_date, d
> ate("$start_date", "DMY"), date("$end_date", "DMY"))
(1,628 missing values generated)

. lab var appt_year "Year of appointment"

. forvalues i = 1/$max_year {
  2.     local start = $base_year + `i' - 1
  3.     local end = `start' + 1
  4.     label define appt_year_lbl `i' "Apr `start'–Mar `end'", add
  5. }

. lab val appt_year appt_year_lbl

. tab appt_year, missing

          Year of |
      appointment |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |          6        0.32        0.32
Apr 2017–Mar 2018 |          5        0.27        0.59
Apr 2018–Mar 2019 |          6        0.32        0.91
Apr 2019–Mar 2020 |          4        0.21        1.12
Apr 2020–Mar 2021 |          4        0.21        1.34
Apr 2021–Mar 2022 |         10        0.53        1.87
Apr 2022–Mar 2023 |         43        2.30        4.17
Apr 2023–Mar 2024 |         95        5.07        9.24
Apr 2024–Mar 2025 |         71        3.79       13.03
                . |      1,628       86.97      100.00
------------------+-----------------------------------
            Total |      1,872      100.00

. bys eia_diagnosis: tab appt_year, missing

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = RA

          Year of |
      appointment |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |          5        0.33        0.33
Apr 2017–Mar 2018 |          5        0.33        0.66
Apr 2018–Mar 2019 |          6        0.39        1.05
Apr 2019–Mar 2020 |          3        0.20        1.25
Apr 2020–Mar 2021 |          4        0.26        1.51
Apr 2021–Mar 2022 |         10        0.66        2.16
Apr 2022–Mar 2023 |         40        2.62        4.78
Apr 2023–Mar 2024 |         67        4.39        9.17
Apr 2024–Mar 2025 |         61        4.00       13.17
                . |      1,325       86.83      100.00
------------------+-----------------------------------
            Total |      1,526      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = PsA

          Year of |
      appointment |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2022–Mar 2023 |          1        0.52        0.52
Apr 2023–Mar 2024 |         10        5.21        5.73
Apr 2024–Mar 2025 |          6        3.12        8.85
                . |        175       91.15      100.00
------------------+-----------------------------------
            Total |        192      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = AxSpA

          Year of |
      appointment |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2019–Mar 2020 |          1        0.78        0.78
Apr 2022–Mar 2023 |          1        0.78        1.55
Apr 2023–Mar 2024 |         18       13.95       15.50
Apr 2024–Mar 2025 |          3        2.33       17.83
                . |        106       82.17      100.00
------------------+-----------------------------------
            Total |        129      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = Undiff IA

          Year of |
      appointment |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |          1        4.00        4.00
Apr 2022–Mar 2023 |          1        4.00        8.00
Apr 2024–Mar 2025 |          1        4.00       12.00
                . |         22       88.00      100.00
------------------+-----------------------------------
            Total |         25      100.00


. 
. *Define Rheumatology appointments ======================================*/
. 
. **Rheumatology appt definitions 
. tab rheum_appt, missing //proportion of patients with an rheum outpatient date (with first attendance option selec
> ted) in the 12 months before and 60 days after EIA code appeared in GP record; data only April 2019 onwards

Rheumatolog |
          y |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,622       86.65       86.65
        Yes |        250       13.35      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab mo_year_diagn rheum_appt, missing //proportion of patients with an rheum outpatient date (with first attendanc
> e option selected) in the 12 months before and 60 days after EIA code appeared in GP record; data only April 2019 
> onwards

Month/Year |     Rheumatology
        of |      appointment
 Diagnosis |        No        Yes |     Total
-----------+----------------------+----------
  Apr-2016 |         0          2 |         2 
  May-2016 |         1          1 |         2 
  Jun-2016 |         4          1 |         5 
  Jul-2016 |         1          0 |         1 
  Aug-2016 |         1          0 |         1 
  Sep-2016 |         2          0 |         2 
  Oct-2016 |         3          0 |         3 
  Nov-2016 |         1          1 |         2 
  Dec-2016 |         6          0 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         3          0 |         3 
  Apr-2017 |         7          1 |         8 
  May-2017 |         4          2 |         6 
  Jun-2017 |         3          1 |         4 
  Jul-2017 |         4          0 |         4 
  Aug-2017 |         2          1 |         3 
  Sep-2017 |         2          1 |         3 
  Oct-2017 |         3          0 |         3 
  Nov-2017 |         2          1 |         3 
  Dec-2017 |         3          0 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         3          2 |         5 
  Mar-2018 |         3          0 |         3 
  Apr-2018 |         3          0 |         3 
  May-2018 |         1          0 |         1 
  Jun-2018 |         4          0 |         4 
  Jul-2018 |         5          0 |         5 
  Aug-2018 |         2          1 |         3 
  Sep-2018 |         3          2 |         5 
  Oct-2018 |         3          0 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         1          0 |         1 
  Jan-2019 |         3          0 |         3 
  Feb-2019 |         3          0 |         3 
  Mar-2019 |         4          0 |         4 
  Apr-2019 |         3          2 |         5 
  May-2019 |         7          0 |         7 
  Jun-2019 |         5          1 |         6 
  Jul-2019 |         4          0 |         4 
  Aug-2019 |         3          1 |         4 
  Sep-2019 |         5          1 |         6 
  Oct-2019 |         6          0 |         6 
  Nov-2019 |         4          0 |         4 
  Dec-2019 |         4          0 |         4 
  Jan-2020 |         1          0 |         1 
  Feb-2020 |         3          0 |         3 
  Mar-2020 |         5          0 |         5 
  Apr-2020 |         5          0 |         5 
  May-2020 |         6          0 |         6 
  Jun-2020 |         5          0 |         5 
  Jul-2020 |         5          1 |         6 
  Aug-2020 |         2          0 |         2 
  Sep-2020 |         6          0 |         6 
  Oct-2020 |         8          1 |         9 
  Nov-2020 |         8          1 |         9 
  Dec-2020 |         9          1 |        10 
  Jan-2021 |         7          0 |         7 
  Feb-2021 |         8          0 |         8 
  Mar-2021 |         4          0 |         4 
  Apr-2021 |        10          0 |        10 
  May-2021 |        11          0 |        11 
  Jun-2021 |         5          0 |         5 
  Jul-2021 |        13          1 |        14 
  Aug-2021 |         9          2 |        11 
  Sep-2021 |         8          1 |         9 
  Oct-2021 |        13          0 |        13 
  Nov-2021 |         9          0 |         9 
  Dec-2021 |         5          0 |         5 
  Jan-2022 |         8          0 |         8 
  Feb-2022 |        13          0 |        13 
  Mar-2022 |        16          1 |        17 
  Apr-2022 |        14          2 |        16 
  May-2022 |        20          1 |        21 
  Jun-2022 |        13          0 |        13 
  Jul-2022 |        18          1 |        19 
  Aug-2022 |        15          1 |        16 
  Sep-2022 |        18          2 |        20 
  Oct-2022 |        26          3 |        29 
  Nov-2022 |        27          1 |        28 
  Dec-2022 |        20          2 |        22 
  Jan-2023 |        24          1 |        25 
  Feb-2023 |        32          5 |        37 
  Mar-2023 |        30          3 |        33 
  Apr-2023 |        27          1 |        28 
  May-2023 |        32          4 |        36 
  Jun-2023 |        32          5 |        37 
  Jul-2023 |        40          3 |        43 
  Aug-2023 |        38          7 |        45 
  Sep-2023 |        38          4 |        42 
  Oct-2023 |        38          7 |        45 
  Nov-2023 |        39          2 |        41 
  Dec-2023 |        42          4 |        46 
  Jan-2024 |        58          8 |        66 
  Feb-2024 |        39         11 |        50 
  Mar-2024 |        44          7 |        51 
  Apr-2024 |        47         10 |        57 
  May-2024 |        52          7 |        59 
  Jun-2024 |        38          6 |        44 
  Jul-2024 |        54          9 |        63 
  Aug-2024 |        44         12 |        56 
  Sep-2024 |        40         11 |        51 
  Oct-2024 |        58          6 |        64 
  Nov-2024 |        46          8 |        54 
  Dec-2024 |        44         14 |        58 
  Jan-2025 |        46         17 |        63 
  Feb-2025 |        42         16 |        58 
  Mar-2025 |        50         15 |        65 
-----------+----------------------+----------
     Total |     1,622        250 |     1,872 

. tab rheum_appt_any, missing //proportion of patients with a rheum outpatient date (without first attendance option
>  selected) in the 12 months before and 60 days after EIA code appeared in GP record; data only April 2019 onwards

rheum_appt_ |
        any |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,366       72.97       72.97
          1 |        506       27.03      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab rheum_appt2, missing //proportion of patients with a rheum outpatient date (without first attendance option se
> lected) in the 6 months before and 60 days after  EIA code appeared in GP record; data only April 2019 onwards

rheum_appt2 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,476       78.85       78.85
          1 |        396       21.15      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab rheum_appt3, missing //proportion of patients with a rheum outpatient date (without first attendance option se
> lected) in the 2 years before and 60 days after EIA code appeared in GP record; data only April 2019 onwards

rheum_appt3 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,166       62.29       62.29
          1 |        706       37.71      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab rheum_appt4, missing //proportion of patients with a rheum outpatient date (without first attendance option se
> lected) in the 2 years before and 1 year after EIA code appeared in GP record; data only April 2019 onwards

rheum_appt4 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,166       62.29       62.29
          1 |        706       37.71      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. ***Check number of rheumatology appts in the year before EIA code
. tabstat rheum_appt_count, stat (n mean sd p50 p25 p75)

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |      1872  .4679487  1.001356         0         0        .5
--------------------------------------------------------------------------

. bys diagnosis_year: tabstat rheum_appt_count, stat (n mean sd p50 p25 p75)

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2016–Mar 2017

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        29  .7586207  1.272095         0         0         1
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2017–Mar 2018

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        46  .5869565  1.086812         0         0         1
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2018–Mar 2019

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        40      .375  .8066232         0         0         0
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2019–Mar 2020

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        54  .1666667  .6369147         0         0         0
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2020–Mar 2021

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        78  .1666667  .5201565         0         0         0
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2021–Mar 2022

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |       124  .1774194  .5709554         0         0         0
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2022–Mar 2023

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |       279  .1505376  .4475248         0         0         0
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2023–Mar 2024

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |       530   .345283  .6981114         0         0         0
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2024–Mar 2025

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |       692  .7846821  1.331418         0         0         1
--------------------------------------------------------------------------

. bys appt_year: tabstat rheum_appt_count, stat (n mean sd p50 p25 p75)

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2016–Mar 2017

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |         6  2.333333  1.505545         2         1         4
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2017–Mar 2018

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |         5         2  1.224745         2         1         2
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2018–Mar 2019

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |         6       1.5  1.048809       1.5         1         2
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2019–Mar 2020

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |         4         2  1.825742         2        .5       3.5
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2020–Mar 2021

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |         4      1.25        .5         1         1       1.5
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2021–Mar 2022

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        10       1.5  1.080123         1         1         1
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2022–Mar 2023

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        43  1.534884  .9089197         1         1         2
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2023–Mar 2024

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        95  2.052632   1.04544         2         1         3
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2024–Mar 2025

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        71  2.704225  1.792001         2         1         4
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = .

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |      1628  .2223587  .6405217         0         0         0
--------------------------------------------------------------------------

. 
. ***Check medium used for rheumatology appointment
. tab rheum_appt_medium, missing

rheum_appt_ |
     medium |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         32        1.71        1.71
          2 |         34        1.82        3.53
          3 |         29        1.55        5.07
          4 |         20        1.07        6.14
          5 |         29        1.55        7.69
          9 |         11        0.59        8.28
         10 |         28        1.50        9.78
         11 |         30        1.60       11.38
         98 |         37        1.98       13.35
          . |      1,622       86.65      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. gen rheum_appt_medium_clean = rheum_appt_medium if rheum_appt_medium >0 & rheum_appt_medium<100
(1,622 missing values generated)

. recode rheum_appt_medium_clean 3=2 //recode telemedicine=telephone
(29 changes made to rheum_appt_medium_clean)

. replace rheum_appt_medium_clean=10 if rheum_appt_medium_clean>2 & rheum_appt_medium_clean!=.
(127 real changes made)

. recode rheum_appt_medium_clean .=.u
(1,622 changes made to rheum_appt_medium_clean)

. lab define rheum_appt_medium_clean 1 "Face-to-face" 2 "Telephone" 10 "Other" .u "Missing", modify

. lab val rheum_appt_medium_clean rheum_appt_medium_clean

. lab var rheum_appt_medium_clean "Rheumatology consultation medium"

. tab rheum_appt_medium_clean 

Rheumatology |
consultation |
      medium |      Freq.     Percent        Cum.
-------------+-----------------------------------
Face-to-face |         32       12.80       12.80
   Telephone |         63       25.20       38.00
       Other |        155       62.00      100.00
-------------+-----------------------------------
       Total |        250      100.00

. 
. *Gen rheum appt variable with 6m/12m+ until study end date
. gen rheum_appt_12m=rheum_appt if rheum_appt_date<=(date("$end_date", "DMY")-365) 
(1,693 missing values generated)

. recode rheum_appt_12m .=0
(1,693 changes made to rheum_appt_12m)

. lab var rheum_appt_12m "Rheumatology appt 12m+"

. lab define rheum_appt_12m 0 "No" 1 "Yes", modify

. lab val rheum_appt_12m rheum_appt_12m

. 
. gen rheum_appt_6m=rheum_appt if rheum_appt_date<=(date("$end_date", "DMY")-180) 
(1,642 missing values generated)

. recode rheum_appt_6m .=0
(1,642 changes made to rheum_appt_6m)

. lab var rheum_appt_6m "Rheumatology appt 6m+"

. lab define rheum_appt_6m 0 "No" 1 "Yes", modify

. lab val rheum_appt_6m rheum_appt_6m

. 
. **Define Rheumatology referrals ======================================*/
. 
. ***From HES OPA (referral_request_received_date)
. tab rheum_appt_ref, missing

rheum_appt_ |
        ref |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,622       86.65       86.65
          1 |        250       13.35      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. codebook rheum_appt_ref_date

--------------------------------------------------------------------------------------------------------------------
rheum_appt_ref_date                                                                                      (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [19095,23883]                 Units: 1
       Or equivalently: [12apr2012,22may2025]         Units: days
         Unique values: 231                       Missing .: 1,622/1,872

                  Mean: 23240.8 = 18aug2023(+ 19 hours)
             Std. dev.: 848.525
           Percentiles:       10%        25%        50%        75%        90%
                          22016.5      23192      23553      23749      23840
                        11apr2020  01jul2023  26jun2024  08jan2025  09apr2025

. tab mo_year_diagn rheum_appt_ref, missing

Month/Year |
        of |    rheum_appt_ref
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         0          2 |         2 
  May-2016 |         1          1 |         2 
  Jun-2016 |         4          1 |         5 
  Jul-2016 |         1          0 |         1 
  Aug-2016 |         1          0 |         1 
  Sep-2016 |         2          0 |         2 
  Oct-2016 |         3          0 |         3 
  Nov-2016 |         1          1 |         2 
  Dec-2016 |         6          0 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         3          0 |         3 
  Apr-2017 |         7          1 |         8 
  May-2017 |         4          2 |         6 
  Jun-2017 |         3          1 |         4 
  Jul-2017 |         4          0 |         4 
  Aug-2017 |         2          1 |         3 
  Sep-2017 |         2          1 |         3 
  Oct-2017 |         3          0 |         3 
  Nov-2017 |         2          1 |         3 
  Dec-2017 |         3          0 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         3          2 |         5 
  Mar-2018 |         3          0 |         3 
  Apr-2018 |         3          0 |         3 
  May-2018 |         1          0 |         1 
  Jun-2018 |         4          0 |         4 
  Jul-2018 |         5          0 |         5 
  Aug-2018 |         2          1 |         3 
  Sep-2018 |         3          2 |         5 
  Oct-2018 |         3          0 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         1          0 |         1 
  Jan-2019 |         3          0 |         3 
  Feb-2019 |         3          0 |         3 
  Mar-2019 |         4          0 |         4 
  Apr-2019 |         3          2 |         5 
  May-2019 |         7          0 |         7 
  Jun-2019 |         5          1 |         6 
  Jul-2019 |         4          0 |         4 
  Aug-2019 |         3          1 |         4 
  Sep-2019 |         5          1 |         6 
  Oct-2019 |         6          0 |         6 
  Nov-2019 |         4          0 |         4 
  Dec-2019 |         4          0 |         4 
  Jan-2020 |         1          0 |         1 
  Feb-2020 |         3          0 |         3 
  Mar-2020 |         5          0 |         5 
  Apr-2020 |         5          0 |         5 
  May-2020 |         6          0 |         6 
  Jun-2020 |         5          0 |         5 
  Jul-2020 |         5          1 |         6 
  Aug-2020 |         2          0 |         2 
  Sep-2020 |         6          0 |         6 
  Oct-2020 |         8          1 |         9 
  Nov-2020 |         8          1 |         9 
  Dec-2020 |         9          1 |        10 
  Jan-2021 |         7          0 |         7 
  Feb-2021 |         8          0 |         8 
  Mar-2021 |         4          0 |         4 
  Apr-2021 |        10          0 |        10 
  May-2021 |        11          0 |        11 
  Jun-2021 |         5          0 |         5 
  Jul-2021 |        13          1 |        14 
  Aug-2021 |         9          2 |        11 
  Sep-2021 |         8          1 |         9 
  Oct-2021 |        13          0 |        13 
  Nov-2021 |         9          0 |         9 
  Dec-2021 |         5          0 |         5 
  Jan-2022 |         8          0 |         8 
  Feb-2022 |        13          0 |        13 
  Mar-2022 |        16          1 |        17 
  Apr-2022 |        14          2 |        16 
  May-2022 |        20          1 |        21 
  Jun-2022 |        13          0 |        13 
  Jul-2022 |        18          1 |        19 
  Aug-2022 |        15          1 |        16 
  Sep-2022 |        18          2 |        20 
  Oct-2022 |        26          3 |        29 
  Nov-2022 |        27          1 |        28 
  Dec-2022 |        20          2 |        22 
  Jan-2023 |        24          1 |        25 
  Feb-2023 |        32          5 |        37 
  Mar-2023 |        30          3 |        33 
  Apr-2023 |        27          1 |        28 
  May-2023 |        32          4 |        36 
  Jun-2023 |        32          5 |        37 
  Jul-2023 |        40          3 |        43 
  Aug-2023 |        38          7 |        45 
  Sep-2023 |        38          4 |        42 
  Oct-2023 |        38          7 |        45 
  Nov-2023 |        39          2 |        41 
  Dec-2023 |        42          4 |        46 
  Jan-2024 |        58          8 |        66 
  Feb-2024 |        39         11 |        50 
  Mar-2024 |        44          7 |        51 
  Apr-2024 |        47         10 |        57 
  May-2024 |        52          7 |        59 
  Jun-2024 |        38          6 |        44 
  Jul-2024 |        54          9 |        63 
  Aug-2024 |        44         12 |        56 
  Sep-2024 |        40         11 |        51 
  Oct-2024 |        58          6 |        64 
  Nov-2024 |        46          8 |        54 
  Dec-2024 |        44         14 |        58 
  Jan-2025 |        46         17 |        63 
  Feb-2025 |        42         16 |        58 
  Mar-2025 |        50         15 |        65 
-----------+----------------------+----------
     Total |     1,622        250 |     1,872 

. tab mo_year_diagn rheum_appt_ref if rheum_appt!=., missing

Month/Year |
        of |    rheum_appt_ref
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         0          2 |         2 
  May-2016 |         1          1 |         2 
  Jun-2016 |         4          1 |         5 
  Jul-2016 |         1          0 |         1 
  Aug-2016 |         1          0 |         1 
  Sep-2016 |         2          0 |         2 
  Oct-2016 |         3          0 |         3 
  Nov-2016 |         1          1 |         2 
  Dec-2016 |         6          0 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         3          0 |         3 
  Apr-2017 |         7          1 |         8 
  May-2017 |         4          2 |         6 
  Jun-2017 |         3          1 |         4 
  Jul-2017 |         4          0 |         4 
  Aug-2017 |         2          1 |         3 
  Sep-2017 |         2          1 |         3 
  Oct-2017 |         3          0 |         3 
  Nov-2017 |         2          1 |         3 
  Dec-2017 |         3          0 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         3          2 |         5 
  Mar-2018 |         3          0 |         3 
  Apr-2018 |         3          0 |         3 
  May-2018 |         1          0 |         1 
  Jun-2018 |         4          0 |         4 
  Jul-2018 |         5          0 |         5 
  Aug-2018 |         2          1 |         3 
  Sep-2018 |         3          2 |         5 
  Oct-2018 |         3          0 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         1          0 |         1 
  Jan-2019 |         3          0 |         3 
  Feb-2019 |         3          0 |         3 
  Mar-2019 |         4          0 |         4 
  Apr-2019 |         3          2 |         5 
  May-2019 |         7          0 |         7 
  Jun-2019 |         5          1 |         6 
  Jul-2019 |         4          0 |         4 
  Aug-2019 |         3          1 |         4 
  Sep-2019 |         5          1 |         6 
  Oct-2019 |         6          0 |         6 
  Nov-2019 |         4          0 |         4 
  Dec-2019 |         4          0 |         4 
  Jan-2020 |         1          0 |         1 
  Feb-2020 |         3          0 |         3 
  Mar-2020 |         5          0 |         5 
  Apr-2020 |         5          0 |         5 
  May-2020 |         6          0 |         6 
  Jun-2020 |         5          0 |         5 
  Jul-2020 |         5          1 |         6 
  Aug-2020 |         2          0 |         2 
  Sep-2020 |         6          0 |         6 
  Oct-2020 |         8          1 |         9 
  Nov-2020 |         8          1 |         9 
  Dec-2020 |         9          1 |        10 
  Jan-2021 |         7          0 |         7 
  Feb-2021 |         8          0 |         8 
  Mar-2021 |         4          0 |         4 
  Apr-2021 |        10          0 |        10 
  May-2021 |        11          0 |        11 
  Jun-2021 |         5          0 |         5 
  Jul-2021 |        13          1 |        14 
  Aug-2021 |         9          2 |        11 
  Sep-2021 |         8          1 |         9 
  Oct-2021 |        13          0 |        13 
  Nov-2021 |         9          0 |         9 
  Dec-2021 |         5          0 |         5 
  Jan-2022 |         8          0 |         8 
  Feb-2022 |        13          0 |        13 
  Mar-2022 |        16          1 |        17 
  Apr-2022 |        14          2 |        16 
  May-2022 |        20          1 |        21 
  Jun-2022 |        13          0 |        13 
  Jul-2022 |        18          1 |        19 
  Aug-2022 |        15          1 |        16 
  Sep-2022 |        18          2 |        20 
  Oct-2022 |        26          3 |        29 
  Nov-2022 |        27          1 |        28 
  Dec-2022 |        20          2 |        22 
  Jan-2023 |        24          1 |        25 
  Feb-2023 |        32          5 |        37 
  Mar-2023 |        30          3 |        33 
  Apr-2023 |        27          1 |        28 
  May-2023 |        32          4 |        36 
  Jun-2023 |        32          5 |        37 
  Jul-2023 |        40          3 |        43 
  Aug-2023 |        38          7 |        45 
  Sep-2023 |        38          4 |        42 
  Oct-2023 |        38          7 |        45 
  Nov-2023 |        39          2 |        41 
  Dec-2023 |        42          4 |        46 
  Jan-2024 |        58          8 |        66 
  Feb-2024 |        39         11 |        50 
  Mar-2024 |        44          7 |        51 
  Apr-2024 |        47         10 |        57 
  May-2024 |        52          7 |        59 
  Jun-2024 |        38          6 |        44 
  Jul-2024 |        54          9 |        63 
  Aug-2024 |        44         12 |        56 
  Sep-2024 |        40         11 |        51 
  Oct-2024 |        58          6 |        64 
  Nov-2024 |        46          8 |        54 
  Dec-2024 |        44         14 |        58 
  Jan-2025 |        46         17 |        63 
  Feb-2025 |        42         16 |        58 
  Mar-2025 |        50         15 |        65 
-----------+----------------------+----------
     Total |     1,622        250 |     1,872 

. 
. ***From RTT clock-stop data (only available for those with clock-stop date between May 2021 and May 2022)
. tab rtt_cl_ref, missing

 rtt_cl_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        911       48.66       48.66
          1 |        961       51.34      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. codebook rtt_cl_ref_date

--------------------------------------------------------------------------------------------------------------------
rtt_cl_ref_date                                                                                          (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [19939,23883]                 Units: 1
       Or equivalently: [04aug2014,22may2025]         Units: days
         Unique values: 651                       Missing .: 911/1,872

                  Mean: 23241.7 = 19aug2023(+ 17 hours)
             Std. dev.: 801.336
           Percentiles:       10%        25%        50%        75%        90%
                            21995      23101      23563      23763      23840
                        21mar2020  01apr2023  06jul2024  22jan2025  09apr2025

. tab rtt_cl_ref if rheum_appt!=0 & rtt_cl_ref_date<=rheum_appt_date, missing 

 rtt_cl_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         53      100.00      100.00
------------+-----------------------------------
      Total |         53      100.00

. tab mo_year_diagn rtt_cl_ref, missing

Month/Year |
        of |      rtt_cl_ref
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         2          0 |         2 
  May-2016 |         0          2 |         2 
  Jun-2016 |         3          2 |         5 
  Jul-2016 |         0          1 |         1 
  Aug-2016 |         0          1 |         1 
  Sep-2016 |         1          1 |         2 
  Oct-2016 |         2          1 |         3 
  Nov-2016 |         0          2 |         2 
  Dec-2016 |         2          4 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         1          2 |         3 
  Apr-2017 |         5          3 |         8 
  May-2017 |         4          2 |         6 
  Jun-2017 |         0          4 |         4 
  Jul-2017 |         1          3 |         4 
  Aug-2017 |         0          3 |         3 
  Sep-2017 |         2          1 |         3 
  Oct-2017 |         1          2 |         3 
  Nov-2017 |         0          3 |         3 
  Dec-2017 |         0          3 |         3 
  Jan-2018 |         0          1 |         1 
  Feb-2018 |         3          2 |         5 
  Mar-2018 |         1          2 |         3 
  Apr-2018 |         1          2 |         3 
  May-2018 |         0          1 |         1 
  Jun-2018 |         4          0 |         4 
  Jul-2018 |         2          3 |         5 
  Aug-2018 |         1          2 |         3 
  Sep-2018 |         0          5 |         5 
  Oct-2018 |         1          2 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         1          0 |         1 
  Jan-2019 |         1          2 |         3 
  Feb-2019 |         2          1 |         3 
  Mar-2019 |         4          0 |         4 
  Apr-2019 |         2          3 |         5 
  May-2019 |         6          1 |         7 
  Jun-2019 |         3          3 |         6 
  Jul-2019 |         2          2 |         4 
  Aug-2019 |         2          2 |         4 
  Sep-2019 |         3          3 |         6 
  Oct-2019 |         4          2 |         6 
  Nov-2019 |         2          2 |         4 
  Dec-2019 |         2          2 |         4 
  Jan-2020 |         1          0 |         1 
  Feb-2020 |         2          1 |         3 
  Mar-2020 |         3          2 |         5 
  Apr-2020 |         5          0 |         5 
  May-2020 |         4          2 |         6 
  Jun-2020 |         3          2 |         5 
  Jul-2020 |         4          2 |         6 
  Aug-2020 |         1          1 |         2 
  Sep-2020 |         2          4 |         6 
  Oct-2020 |         6          3 |         9 
  Nov-2020 |         6          3 |         9 
  Dec-2020 |         9          1 |        10 
  Jan-2021 |         5          2 |         7 
  Feb-2021 |         4          4 |         8 
  Mar-2021 |         4          0 |         4 
  Apr-2021 |         8          2 |        10 
  May-2021 |         8          3 |        11 
  Jun-2021 |         4          1 |         5 
  Jul-2021 |        10          4 |        14 
  Aug-2021 |         8          3 |        11 
  Sep-2021 |         7          2 |         9 
  Oct-2021 |         9          4 |        13 
  Nov-2021 |         8          1 |         9 
  Dec-2021 |         5          0 |         5 
  Jan-2022 |         8          0 |         8 
  Feb-2022 |        11          2 |        13 
  Mar-2022 |        12          5 |        17 
  Apr-2022 |        12          4 |        16 
  May-2022 |        14          7 |        21 
  Jun-2022 |        11          2 |        13 
  Jul-2022 |        15          4 |        19 
  Aug-2022 |        12          4 |        16 
  Sep-2022 |        16          4 |        20 
  Oct-2022 |        23          6 |        29 
  Nov-2022 |        23          5 |        28 
  Dec-2022 |        14          8 |        22 
  Jan-2023 |        19          6 |        25 
  Feb-2023 |        26         11 |        37 
  Mar-2023 |        22         11 |        33 
  Apr-2023 |        21          7 |        28 
  May-2023 |        25         11 |        36 
  Jun-2023 |        24         13 |        37 
  Jul-2023 |        28         15 |        43 
  Aug-2023 |        29         16 |        45 
  Sep-2023 |        24         18 |        42 
  Oct-2023 |        20         25 |        45 
  Nov-2023 |        17         24 |        41 
  Dec-2023 |        26         20 |        46 
  Jan-2024 |        40         26 |        66 
  Feb-2024 |        22         28 |        50 
  Mar-2024 |        14         37 |        51 
  Apr-2024 |        25         32 |        57 
  May-2024 |        24         35 |        59 
  Jun-2024 |        15         29 |        44 
  Jul-2024 |        24         39 |        63 
  Aug-2024 |        13         43 |        56 
  Sep-2024 |        17         34 |        51 
  Oct-2024 |        10         54 |        64 
  Nov-2024 |         9         45 |        54 
  Dec-2024 |        13         45 |        58 
  Jan-2025 |        10         53 |        63 
  Feb-2025 |        11         47 |        58 
  Mar-2025 |        12         53 |        65 
-----------+----------------------+----------
     Total |       911        961 |     1,872 

. tab mo_year_diagn rtt_cl_ref if rheum_appt!=., missing

Month/Year |
        of |      rtt_cl_ref
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         2          0 |         2 
  May-2016 |         0          2 |         2 
  Jun-2016 |         3          2 |         5 
  Jul-2016 |         0          1 |         1 
  Aug-2016 |         0          1 |         1 
  Sep-2016 |         1          1 |         2 
  Oct-2016 |         2          1 |         3 
  Nov-2016 |         0          2 |         2 
  Dec-2016 |         2          4 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         1          2 |         3 
  Apr-2017 |         5          3 |         8 
  May-2017 |         4          2 |         6 
  Jun-2017 |         0          4 |         4 
  Jul-2017 |         1          3 |         4 
  Aug-2017 |         0          3 |         3 
  Sep-2017 |         2          1 |         3 
  Oct-2017 |         1          2 |         3 
  Nov-2017 |         0          3 |         3 
  Dec-2017 |         0          3 |         3 
  Jan-2018 |         0          1 |         1 
  Feb-2018 |         3          2 |         5 
  Mar-2018 |         1          2 |         3 
  Apr-2018 |         1          2 |         3 
  May-2018 |         0          1 |         1 
  Jun-2018 |         4          0 |         4 
  Jul-2018 |         2          3 |         5 
  Aug-2018 |         1          2 |         3 
  Sep-2018 |         0          5 |         5 
  Oct-2018 |         1          2 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         1          0 |         1 
  Jan-2019 |         1          2 |         3 
  Feb-2019 |         2          1 |         3 
  Mar-2019 |         4          0 |         4 
  Apr-2019 |         2          3 |         5 
  May-2019 |         6          1 |         7 
  Jun-2019 |         3          3 |         6 
  Jul-2019 |         2          2 |         4 
  Aug-2019 |         2          2 |         4 
  Sep-2019 |         3          3 |         6 
  Oct-2019 |         4          2 |         6 
  Nov-2019 |         2          2 |         4 
  Dec-2019 |         2          2 |         4 
  Jan-2020 |         1          0 |         1 
  Feb-2020 |         2          1 |         3 
  Mar-2020 |         3          2 |         5 
  Apr-2020 |         5          0 |         5 
  May-2020 |         4          2 |         6 
  Jun-2020 |         3          2 |         5 
  Jul-2020 |         4          2 |         6 
  Aug-2020 |         1          1 |         2 
  Sep-2020 |         2          4 |         6 
  Oct-2020 |         6          3 |         9 
  Nov-2020 |         6          3 |         9 
  Dec-2020 |         9          1 |        10 
  Jan-2021 |         5          2 |         7 
  Feb-2021 |         4          4 |         8 
  Mar-2021 |         4          0 |         4 
  Apr-2021 |         8          2 |        10 
  May-2021 |         8          3 |        11 
  Jun-2021 |         4          1 |         5 
  Jul-2021 |        10          4 |        14 
  Aug-2021 |         8          3 |        11 
  Sep-2021 |         7          2 |         9 
  Oct-2021 |         9          4 |        13 
  Nov-2021 |         8          1 |         9 
  Dec-2021 |         5          0 |         5 
  Jan-2022 |         8          0 |         8 
  Feb-2022 |        11          2 |        13 
  Mar-2022 |        12          5 |        17 
  Apr-2022 |        12          4 |        16 
  May-2022 |        14          7 |        21 
  Jun-2022 |        11          2 |        13 
  Jul-2022 |        15          4 |        19 
  Aug-2022 |        12          4 |        16 
  Sep-2022 |        16          4 |        20 
  Oct-2022 |        23          6 |        29 
  Nov-2022 |        23          5 |        28 
  Dec-2022 |        14          8 |        22 
  Jan-2023 |        19          6 |        25 
  Feb-2023 |        26         11 |        37 
  Mar-2023 |        22         11 |        33 
  Apr-2023 |        21          7 |        28 
  May-2023 |        25         11 |        36 
  Jun-2023 |        24         13 |        37 
  Jul-2023 |        28         15 |        43 
  Aug-2023 |        29         16 |        45 
  Sep-2023 |        24         18 |        42 
  Oct-2023 |        20         25 |        45 
  Nov-2023 |        17         24 |        41 
  Dec-2023 |        26         20 |        46 
  Jan-2024 |        40         26 |        66 
  Feb-2024 |        22         28 |        50 
  Mar-2024 |        14         37 |        51 
  Apr-2024 |        25         32 |        57 
  May-2024 |        24         35 |        59 
  Jun-2024 |        15         29 |        44 
  Jul-2024 |        24         39 |        63 
  Aug-2024 |        13         43 |        56 
  Sep-2024 |        17         34 |        51 
  Oct-2024 |        10         54 |        64 
  Nov-2024 |         9         45 |        54 
  Dec-2024 |        13         45 |        58 
  Jan-2025 |        10         53 |        63 
  Feb-2025 |        11         47 |        58 
  Mar-2025 |        12         53 |        65 
-----------+----------------------+----------
     Total |       911        961 |     1,872 

. tab rtt_cl_start, missing //check how this differs

rtt_cl_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        911       48.66       48.66
          1 |        961       51.34      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. codebook rtt_cl_start_date

--------------------------------------------------------------------------------------------------------------------
rtt_cl_start_date                                                                                        (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [20290,23858]                 Units: 1
       Or equivalently: [21jul2015,27apr2025]         Units: days
         Unique values: 676                       Missing .: 911/1,872

                  Mean:   23074 = 05mar2023(+ 1 hour)
             Std. dev.: 734.364
           Percentiles:       10%        25%        50%        75%        90%
                            21945      23021      23333      23501      23634
                        31jan2020  11jan2023  19nov2023  05may2024  15sep2024

. tab rtt_cl_start if rheum_appt!=0 & rtt_cl_start_date<=rheum_appt_date, missing 

rtt_cl_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         79      100.00      100.00
------------+-----------------------------------
      Total |         79      100.00

. 
. ***From RTT open pathway data (only available as a snapshot of those with open RTT pathways as of May 2022)
. tab rtt_op_ref, missing

 rtt_op_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        894       47.76       47.76
          1 |        978       52.24      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. codebook rtt_op_ref_date

--------------------------------------------------------------------------------------------------------------------
rtt_op_ref_date                                                                                          (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [19181,23883]                 Units: 1
       Or equivalently: [07jul2012,22may2025]         Units: days
         Unique values: 660                       Missing .: 894/1,872

                  Mean: 23286.9 = 03oct2023(+ 21 hours)
             Std. dev.:  756.25
           Percentiles:       10%        25%        50%        75%        90%
                            22247      23183    23559.5      23757      23844
                        28nov2020  22jun2023  02jul2024  16jan2025  13apr2025

. tab rtt_op_ref if rheum_appt!=0 & rtt_op_ref_date<=rheum_appt_date, missing 

 rtt_op_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         51      100.00      100.00
------------+-----------------------------------
      Total |         51      100.00

. tab mo_year_diagn rtt_op_ref, missing

Month/Year |
        of |      rtt_op_ref
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         0          2 |         2 
  May-2016 |         0          2 |         2 
  Jun-2016 |         4          1 |         5 
  Jul-2016 |         1          0 |         1 
  Aug-2016 |         1          0 |         1 
  Sep-2016 |         2          0 |         2 
  Oct-2016 |         1          2 |         3 
  Nov-2016 |         0          2 |         2 
  Dec-2016 |         5          1 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         1          2 |         3 
  Apr-2017 |         2          6 |         8 
  May-2017 |         4          2 |         6 
  Jun-2017 |         3          1 |         4 
  Jul-2017 |         2          2 |         4 
  Aug-2017 |         0          3 |         3 
  Sep-2017 |         1          2 |         3 
  Oct-2017 |         2          1 |         3 
  Nov-2017 |         1          2 |         3 
  Dec-2017 |         1          2 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         3          2 |         5 
  Mar-2018 |         1          2 |         3 
  Apr-2018 |         2          1 |         3 
  May-2018 |         1          0 |         1 
  Jun-2018 |         3          1 |         4 
  Jul-2018 |         1          4 |         5 
  Aug-2018 |         2          1 |         3 
  Sep-2018 |         2          3 |         5 
  Oct-2018 |         1          2 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         0          1 |         1 
  Jan-2019 |         3          0 |         3 
  Feb-2019 |         3          0 |         3 
  Mar-2019 |         2          2 |         4 
  Apr-2019 |         3          2 |         5 
  May-2019 |         6          1 |         7 
  Jun-2019 |         2          4 |         6 
  Jul-2019 |         3          1 |         4 
  Aug-2019 |         3          1 |         4 
  Sep-2019 |         3          3 |         6 
  Oct-2019 |         2          4 |         6 
  Nov-2019 |         2          2 |         4 
  Dec-2019 |         4          0 |         4 
  Jan-2020 |         0          1 |         1 
  Feb-2020 |         3          0 |         3 
  Mar-2020 |         3          2 |         5 
  Apr-2020 |         3          2 |         5 
  May-2020 |         5          1 |         6 
  Jun-2020 |         3          2 |         5 
  Jul-2020 |         4          2 |         6 
  Aug-2020 |         2          0 |         2 
  Sep-2020 |         5          1 |         6 
  Oct-2020 |         7          2 |         9 
  Nov-2020 |         6          3 |         9 
  Dec-2020 |         8          2 |        10 
  Jan-2021 |         6          1 |         7 
  Feb-2021 |         5          3 |         8 
  Mar-2021 |         3          1 |         4 
  Apr-2021 |         6          4 |        10 
  May-2021 |         5          6 |        11 
  Jun-2021 |         5          0 |         5 
  Jul-2021 |        11          3 |        14 
  Aug-2021 |         6          5 |        11 
  Sep-2021 |         7          2 |         9 
  Oct-2021 |        10          3 |        13 
  Nov-2021 |         7          2 |         9 
  Dec-2021 |         4          1 |         5 
  Jan-2022 |         5          3 |         8 
  Feb-2022 |        11          2 |        13 
  Mar-2022 |        14          3 |        17 
  Apr-2022 |        13          3 |        16 
  May-2022 |        18          3 |        21 
  Jun-2022 |        11          2 |        13 
  Jul-2022 |        15          4 |        19 
  Aug-2022 |        14          2 |        16 
  Sep-2022 |        17          3 |        20 
  Oct-2022 |        22          7 |        29 
  Nov-2022 |        22          6 |        28 
  Dec-2022 |        14          8 |        22 
  Jan-2023 |        18          7 |        25 
  Feb-2023 |        25         12 |        37 
  Mar-2023 |        21         12 |        33 
  Apr-2023 |        17         11 |        28 
  May-2023 |        22         14 |        36 
  Jun-2023 |        18         19 |        37 
  Jul-2023 |        25         18 |        43 
  Aug-2023 |        26         19 |        45 
  Sep-2023 |        26         16 |        42 
  Oct-2023 |        25         20 |        45 
  Nov-2023 |        17         24 |        41 
  Dec-2023 |        22         24 |        46 
  Jan-2024 |        28         38 |        66 
  Feb-2024 |        20         30 |        50 
  Mar-2024 |        23         28 |        51 
  Apr-2024 |        21         36 |        57 
  May-2024 |        12         47 |        59 
  Jun-2024 |        14         30 |        44 
  Jul-2024 |        15         48 |        63 
  Aug-2024 |        22         34 |        56 
  Sep-2024 |        18         33 |        51 
  Oct-2024 |        14         50 |        64 
  Nov-2024 |        11         43 |        54 
  Dec-2024 |        19         39 |        58 
  Jan-2025 |         7         56 |        63 
  Feb-2025 |        10         48 |        58 
  Mar-2025 |        11         54 |        65 
-----------+----------------------+----------
     Total |       894        978 |     1,872 

. tab mo_year_diagn rtt_op_ref if rheum_appt!=., missing

Month/Year |
        of |      rtt_op_ref
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         0          2 |         2 
  May-2016 |         0          2 |         2 
  Jun-2016 |         4          1 |         5 
  Jul-2016 |         1          0 |         1 
  Aug-2016 |         1          0 |         1 
  Sep-2016 |         2          0 |         2 
  Oct-2016 |         1          2 |         3 
  Nov-2016 |         0          2 |         2 
  Dec-2016 |         5          1 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         1          2 |         3 
  Apr-2017 |         2          6 |         8 
  May-2017 |         4          2 |         6 
  Jun-2017 |         3          1 |         4 
  Jul-2017 |         2          2 |         4 
  Aug-2017 |         0          3 |         3 
  Sep-2017 |         1          2 |         3 
  Oct-2017 |         2          1 |         3 
  Nov-2017 |         1          2 |         3 
  Dec-2017 |         1          2 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         3          2 |         5 
  Mar-2018 |         1          2 |         3 
  Apr-2018 |         2          1 |         3 
  May-2018 |         1          0 |         1 
  Jun-2018 |         3          1 |         4 
  Jul-2018 |         1          4 |         5 
  Aug-2018 |         2          1 |         3 
  Sep-2018 |         2          3 |         5 
  Oct-2018 |         1          2 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         0          1 |         1 
  Jan-2019 |         3          0 |         3 
  Feb-2019 |         3          0 |         3 
  Mar-2019 |         2          2 |         4 
  Apr-2019 |         3          2 |         5 
  May-2019 |         6          1 |         7 
  Jun-2019 |         2          4 |         6 
  Jul-2019 |         3          1 |         4 
  Aug-2019 |         3          1 |         4 
  Sep-2019 |         3          3 |         6 
  Oct-2019 |         2          4 |         6 
  Nov-2019 |         2          2 |         4 
  Dec-2019 |         4          0 |         4 
  Jan-2020 |         0          1 |         1 
  Feb-2020 |         3          0 |         3 
  Mar-2020 |         3          2 |         5 
  Apr-2020 |         3          2 |         5 
  May-2020 |         5          1 |         6 
  Jun-2020 |         3          2 |         5 
  Jul-2020 |         4          2 |         6 
  Aug-2020 |         2          0 |         2 
  Sep-2020 |         5          1 |         6 
  Oct-2020 |         7          2 |         9 
  Nov-2020 |         6          3 |         9 
  Dec-2020 |         8          2 |        10 
  Jan-2021 |         6          1 |         7 
  Feb-2021 |         5          3 |         8 
  Mar-2021 |         3          1 |         4 
  Apr-2021 |         6          4 |        10 
  May-2021 |         5          6 |        11 
  Jun-2021 |         5          0 |         5 
  Jul-2021 |        11          3 |        14 
  Aug-2021 |         6          5 |        11 
  Sep-2021 |         7          2 |         9 
  Oct-2021 |        10          3 |        13 
  Nov-2021 |         7          2 |         9 
  Dec-2021 |         4          1 |         5 
  Jan-2022 |         5          3 |         8 
  Feb-2022 |        11          2 |        13 
  Mar-2022 |        14          3 |        17 
  Apr-2022 |        13          3 |        16 
  May-2022 |        18          3 |        21 
  Jun-2022 |        11          2 |        13 
  Jul-2022 |        15          4 |        19 
  Aug-2022 |        14          2 |        16 
  Sep-2022 |        17          3 |        20 
  Oct-2022 |        22          7 |        29 
  Nov-2022 |        22          6 |        28 
  Dec-2022 |        14          8 |        22 
  Jan-2023 |        18          7 |        25 
  Feb-2023 |        25         12 |        37 
  Mar-2023 |        21         12 |        33 
  Apr-2023 |        17         11 |        28 
  May-2023 |        22         14 |        36 
  Jun-2023 |        18         19 |        37 
  Jul-2023 |        25         18 |        43 
  Aug-2023 |        26         19 |        45 
  Sep-2023 |        26         16 |        42 
  Oct-2023 |        25         20 |        45 
  Nov-2023 |        17         24 |        41 
  Dec-2023 |        22         24 |        46 
  Jan-2024 |        28         38 |        66 
  Feb-2024 |        20         30 |        50 
  Mar-2024 |        23         28 |        51 
  Apr-2024 |        21         36 |        57 
  May-2024 |        12         47 |        59 
  Jun-2024 |        14         30 |        44 
  Jul-2024 |        15         48 |        63 
  Aug-2024 |        22         34 |        56 
  Sep-2024 |        18         33 |        51 
  Oct-2024 |        14         50 |        64 
  Nov-2024 |        11         43 |        54 
  Dec-2024 |        19         39 |        58 
  Jan-2025 |         7         56 |        63 
  Feb-2025 |        10         48 |        58 
  Mar-2025 |        11         54 |        65 
-----------+----------------------+----------
     Total |       894        978 |     1,872 

. tab rtt_op_start, missing //check how this differs

rtt_op_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        894       47.76       47.76
          1 |        978       52.24      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. codebook rtt_op_start_date

--------------------------------------------------------------------------------------------------------------------
rtt_op_start_date                                                                                        (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [20223,23866]                 Units: 1
       Or equivalently: [15may2015,05may2025]         Units: days
         Unique values: 664                       Missing .: 894/1,872

                  Mean: 23106.3 = 06apr2023(+ 8 hours)
             Std. dev.: 684.857
           Percentiles:       10%        25%        50%        75%        90%
                            22203      23051    23318.5      23499      23629
                        15oct2020  10feb2023  04nov2023  03may2024  10sep2024

. tab rtt_op_start if rheum_appt!=0 & rtt_op_start_date<=rheum_appt_date, missing 

rtt_op_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         71      100.00      100.00
------------+-----------------------------------
      Total |         71      100.00

. 
. ***Combination of RTT clock-stop and open pathway
. gen rtt_ref_date = rtt_cl_ref_date
(911 missing values generated)

. replace rtt_ref_date = rtt_op_ref_date if rtt_cl_ref_date==. & rtt_op_ref_date!=. //need to think how to handle du
> plicate pathways
(365 real changes made)

. format %td rtt_ref_date

. gen rtt_ref =1 if rtt_ref_date!=.
(546 missing values generated)

. recode rtt_ref .=0
(546 changes made to rtt_ref)

. tab rtt_ref, missing

    rtt_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        546       29.17       29.17
          1 |      1,326       70.83      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab mo_year_diagn rtt_ref, missing

Month/Year |
        of |        rtt_ref
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         0          2 |         2 
  May-2016 |         0          2 |         2 
  Jun-2016 |         3          2 |         5 
  Jul-2016 |         0          1 |         1 
  Aug-2016 |         0          1 |         1 
  Sep-2016 |         1          1 |         2 
  Oct-2016 |         1          2 |         3 
  Nov-2016 |         0          2 |         2 
  Dec-2016 |         2          4 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         1          2 |         3 
  Apr-2017 |         2          6 |         8 
  May-2017 |         3          3 |         6 
  Jun-2017 |         0          4 |         4 
  Jul-2017 |         0          4 |         4 
  Aug-2017 |         0          3 |         3 
  Sep-2017 |         1          2 |         3 
  Oct-2017 |         1          2 |         3 
  Nov-2017 |         0          3 |         3 
  Dec-2017 |         0          3 |         3 
  Jan-2018 |         0          1 |         1 
  Feb-2018 |         2          3 |         5 
  Mar-2018 |         1          2 |         3 
  Apr-2018 |         1          2 |         3 
  May-2018 |         0          1 |         1 
  Jun-2018 |         3          1 |         4 
  Jul-2018 |         0          5 |         5 
  Aug-2018 |         1          2 |         3 
  Sep-2018 |         0          5 |         5 
  Oct-2018 |         0          3 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         0          1 |         1 
  Jan-2019 |         1          2 |         3 
  Feb-2019 |         2          1 |         3 
  Mar-2019 |         2          2 |         4 
  Apr-2019 |         2          3 |         5 
  May-2019 |         5          2 |         7 
  Jun-2019 |         1          5 |         6 
  Jul-2019 |         1          3 |         4 
  Aug-2019 |         2          2 |         4 
  Sep-2019 |         2          4 |         6 
  Oct-2019 |         1          5 |         6 
  Nov-2019 |         2          2 |         4 
  Dec-2019 |         2          2 |         4 
  Jan-2020 |         0          1 |         1 
  Feb-2020 |         2          1 |         3 
  Mar-2020 |         2          3 |         5 
  Apr-2020 |         3          2 |         5 
  May-2020 |         4          2 |         6 
  Jun-2020 |         3          2 |         5 
  Jul-2020 |         4          2 |         6 
  Aug-2020 |         1          1 |         2 
  Sep-2020 |         2          4 |         6 
  Oct-2020 |         5          4 |         9 
  Nov-2020 |         4          5 |         9 
  Dec-2020 |         7          3 |        10 
  Jan-2021 |         5          2 |         7 
  Feb-2021 |         4          4 |         8 
  Mar-2021 |         3          1 |         4 
  Apr-2021 |         6          4 |        10 
  May-2021 |         5          6 |        11 
  Jun-2021 |         4          1 |         5 
  Jul-2021 |         9          5 |        14 
  Aug-2021 |         6          5 |        11 
  Sep-2021 |         7          2 |         9 
  Oct-2021 |         9          4 |        13 
  Nov-2021 |         6          3 |         9 
  Dec-2021 |         4          1 |         5 
  Jan-2022 |         5          3 |         8 
  Feb-2022 |         9          4 |        13 
  Mar-2022 |        11          6 |        17 
  Apr-2022 |        10          6 |        16 
  May-2022 |        14          7 |        21 
  Jun-2022 |         9          4 |        13 
  Jul-2022 |        12          7 |        19 
  Aug-2022 |        11          5 |        16 
  Sep-2022 |        14          6 |        20 
  Oct-2022 |        18         11 |        29 
  Nov-2022 |        19          9 |        28 
  Dec-2022 |         9         13 |        22 
  Jan-2023 |        14         11 |        25 
  Feb-2023 |        19         18 |        37 
  Mar-2023 |        13         20 |        33 
  Apr-2023 |        16         12 |        28 
  May-2023 |        14         22 |        36 
  Jun-2023 |        11         26 |        37 
  Jul-2023 |        18         25 |        43 
  Aug-2023 |        17         28 |        45 
  Sep-2023 |        17         25 |        42 
  Oct-2023 |        10         35 |        45 
  Nov-2023 |         9         32 |        41 
  Dec-2023 |        16         30 |        46 
  Jan-2024 |        20         46 |        66 
  Feb-2024 |         8         42 |        50 
  Mar-2024 |         5         46 |        51 
  Apr-2024 |         7         50 |        57 
  May-2024 |         7         52 |        59 
  Jun-2024 |         4         40 |        44 
  Jul-2024 |         6         57 |        63 
  Aug-2024 |         6         50 |        56 
  Sep-2024 |         4         47 |        51 
  Oct-2024 |         2         62 |        64 
  Nov-2024 |         2         52 |        54 
  Dec-2024 |         4         54 |        58 
  Jan-2025 |         0         63 |        63 
  Feb-2025 |         1         57 |        58 
  Mar-2025 |         1         64 |        65 
-----------+----------------------+----------
     Total |       546      1,326 |     1,872 

. tab mo_year_diagn rtt_ref if rheum_appt!=0 & rtt_ref_date<=rheum_appt_date, missing 

Month/Year |
        of |  rtt_ref
 Diagnosis |         1 |     Total
-----------+-----------+----------
  Apr-2017 |         1 |         1 
  May-2017 |         1 |         1 
  Jun-2017 |         1 |         1 
  Aug-2017 |         1 |         1 
  Sep-2017 |         1 |         1 
  Nov-2017 |         1 |         1 
  Feb-2018 |         1 |         1 
  Sep-2018 |         1 |         1 
  Nov-2018 |         1 |         1 
  Nov-2020 |         1 |         1 
  Aug-2021 |         1 |         1 
  May-2023 |         1 |         1 
  Jun-2023 |         1 |         1 
  Oct-2023 |         1 |         1 
  Jan-2024 |         3 |         3 
  Feb-2024 |         2 |         2 
  Apr-2024 |         1 |         1 
  May-2024 |         3 |         3 
  Jul-2024 |         4 |         4 
  Aug-2024 |         2 |         2 
  Sep-2024 |         4 |         4 
  Oct-2024 |         5 |         5 
  Nov-2024 |         1 |         1 
  Dec-2024 |         4 |         4 
  Jan-2025 |         8 |         8 
  Feb-2025 |         8 |         8 
  Mar-2025 |         8 |         8 
-----------+-----------+----------
     Total |        67 |        67 

. 
. ***From clinical events (Nb. low capture of coded rheumatology referrals in clinical events at present)
. tab rheum_ref_gp_preappt, missing //last rheum referral in the 2 years before rheumatology outpatient (requires rh
> eum appt to have been present)

rheum_ref_g |
  p_preappt |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,871       99.95       99.95
          1 |          1        0.05      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab rheum_ref_gp_preappt if rheum_appt!=0 & rheum_ref_gp_preappt_date<=rheum_appt_date, missing  //last rheum refe
> rral in the 2 years before rheumatology outpatient, assuming ref date before rheum appt date (should be accounted 
> for by Python code)

rheum_ref_g |
  p_preappt |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1      100.00      100.00
------------+-----------------------------------
      Total |          1      100.00

. tab rheum_ref_gp_precode, missing //last rheum referral in the 2 years before IA code 

rheum_ref_g |
  p_precode |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,861       99.41       99.41
          1 |         11        0.59      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. gen referral_rheum_comb_date = rheum_ref_gp_preappt_date if rheum_ref_gp_preappt_date!=.
(1,871 missing values generated)

. replace referral_rheum_comb_date = rheum_ref_gp_precode_date if rheum_ref_gp_preappt_date==. & rheum_ref_gp_precod
> e_date!=. //combination of the two above
(10 real changes made)

. format %td referral_rheum_comb_date

. 
. ***From GP appointments (proxy)
. tab last_gp_refrheum, missing //proportion with last GP appointment in 2 years before rheum referral (pre-rheum ap
> pt); requires there to have been a rheum referral before a rheum appt

last_gp_ref |
      rheum |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,872      100.00      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. gen last_gp_prerheum_12m=last_gp_prerheum if rheum_appt_date!=. & rheum_appt_date<=(date("$end_date", "DMY")-365)
(1,693 missing values generated)

. recode last_gp_prerheum_12m .=0
(1,693 changes made to last_gp_prerheum_12m)

. lab var last_gp_prerheum_12m "GP and rheum appt 12m+"

. lab define last_gp_prerheum_12m 0 "No" 1 "Yes", modify

. lab val last_gp_prerheum_12m last_gp_prerheum_12m

. 
. gen last_gp_prerheum_6m=last_gp_prerheum if rheum_appt_date!=. & rheum_appt_date<=(date("$end_date", "DMY")-180)
(1,642 missing values generated)

. recode last_gp_prerheum_6m .=0
(1,642 changes made to last_gp_prerheum_6m)

. lab var last_gp_prerheum_6m "GP and rheum appt 6m+"

. lab define last_gp_prerheum_6m 0 "No" 1 "Yes", modify

. lab val last_gp_prerheum_6m last_gp_prerheum_6m

. 
. tab last_gp_refcode, missing //last GP appointment before rheum ref (pre-EIA code ref); requires there to have bee
> n a rheum referral before an EIA code (i.e. rheum appt could have been missing)

last_gp_ref |
       code |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,870       99.89       99.89
          1 |          2        0.11      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab last_gp_prerheum, missing //last GP appointment before rheum appt; requires there to have been a rheum appt be
> fore and EIA code

last_gp_pre |
      rheum |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,759       93.96       93.96
          1 |        113        6.04      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab last_gp_precode, missing //last GP appointment before EIA code

last_gp_pre |
       code |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        977       52.19       52.19
          1 |        895       47.81      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. ****All appts in the correct order (using clinical events referrals)
. gen all_appts=1 if last_gp_refrheum==1 & rheum_ref_gp_preappt==1 & rheum_appt==1 & (last_gp_refrheum_date<=rheum_r
> ef_gp_preappt_date) & (rheum_ref_gp_preappt_date<=rheum_appt_date)
(1,872 missing values generated)

. recode all_appts .=0
(1,872 changes made to all_appts)

. tab all_appts, missing //proportion who had a last gp appt, then rheum ref, then rheum appt

  all_appts |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,872      100.00      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. **Define who qualifies in terms of appointments and referrals ===============================*/
. 
. **AMEND THE BELOW ONCE REFERRAL DATE KNOWN
. 
. **Proportion of patients with at least 6 or 12 months of GP registration after diagnostic code
. rename has_6m_follow_up has_6m_follow_up_s 

. gen has_6m_follow_up=1 if has_6m_follow_up_s=="T"
(1,643 missing values generated)

. recode has_6m_follow_up .=0
(1,643 changes made to has_6m_follow_up)

. drop has_6m_follow_up_s

. tab has_6m_follow_up

has_6m_foll |
      ow_up |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,643       87.77       87.77
          1 |        229       12.23      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. rename has_12m_follow_up has_12m_follow_up_s 

. gen has_12m_follow_up=1 if has_12m_follow_up_s=="T"
(1,693 missing values generated)

. recode has_12m_follow_up .=0
(1,693 changes made to has_12m_follow_up)

. drop has_12m_follow_up_s

. tab has_12m_follow_up 

has_12m_fol |
     low_up |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,693       90.44       90.44
          1 |        179        9.56      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab mo_year_diagn has_6m_follow_up

Month/Year |
        of |   has_6m_follow_up
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         0          2 |         2 
  May-2016 |         1          1 |         2 
  Jun-2016 |         4          1 |         5 
  Jul-2016 |         1          0 |         1 
  Aug-2016 |         1          0 |         1 
  Sep-2016 |         2          0 |         2 
  Oct-2016 |         3          0 |         3 
  Nov-2016 |         1          1 |         2 
  Dec-2016 |         6          0 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         3          0 |         3 
  Apr-2017 |         7          1 |         8 
  May-2017 |         4          2 |         6 
  Jun-2017 |         3          1 |         4 
  Jul-2017 |         4          0 |         4 
  Aug-2017 |         2          1 |         3 
  Sep-2017 |         2          1 |         3 
  Oct-2017 |         3          0 |         3 
  Nov-2017 |         2          1 |         3 
  Dec-2017 |         3          0 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         3          2 |         5 
  Mar-2018 |         3          0 |         3 
  Apr-2018 |         3          0 |         3 
  May-2018 |         1          0 |         1 
  Jun-2018 |         4          0 |         4 
  Jul-2018 |         5          0 |         5 
  Aug-2018 |         2          1 |         3 
  Sep-2018 |         3          2 |         5 
  Oct-2018 |         3          0 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         1          0 |         1 
  Jan-2019 |         3          0 |         3 
  Feb-2019 |         3          0 |         3 
  Mar-2019 |         4          0 |         4 
  Apr-2019 |         3          2 |         5 
  May-2019 |         7          0 |         7 
  Jun-2019 |         5          1 |         6 
  Jul-2019 |         4          0 |         4 
  Aug-2019 |         3          1 |         4 
  Sep-2019 |         5          1 |         6 
  Oct-2019 |         6          0 |         6 
  Nov-2019 |         4          0 |         4 
  Dec-2019 |         4          0 |         4 
  Jan-2020 |         1          0 |         1 
  Feb-2020 |         3          0 |         3 
  Mar-2020 |         5          0 |         5 
  Apr-2020 |         5          0 |         5 
  May-2020 |         6          0 |         6 
  Jun-2020 |         5          0 |         5 
  Jul-2020 |         5          1 |         6 
  Aug-2020 |         2          0 |         2 
  Sep-2020 |         6          0 |         6 
  Oct-2020 |         8          1 |         9 
  Nov-2020 |         8          1 |         9 
  Dec-2020 |         9          1 |        10 
  Jan-2021 |         7          0 |         7 
  Feb-2021 |         8          0 |         8 
  Mar-2021 |         4          0 |         4 
  Apr-2021 |        10          0 |        10 
  May-2021 |        11          0 |        11 
  Jun-2021 |         5          0 |         5 
  Jul-2021 |        13          1 |        14 
  Aug-2021 |         9          2 |        11 
  Sep-2021 |         8          1 |         9 
  Oct-2021 |        13          0 |        13 
  Nov-2021 |         9          0 |         9 
  Dec-2021 |         5          0 |         5 
  Jan-2022 |         8          0 |         8 
  Feb-2022 |        13          0 |        13 
  Mar-2022 |        16          1 |        17 
  Apr-2022 |        14          2 |        16 
  May-2022 |        20          1 |        21 
  Jun-2022 |        13          0 |        13 
  Jul-2022 |        18          1 |        19 
  Aug-2022 |        15          1 |        16 
  Sep-2022 |        18          2 |        20 
  Oct-2022 |        26          3 |        29 
  Nov-2022 |        27          1 |        28 
  Dec-2022 |        20          2 |        22 
  Jan-2023 |        24          1 |        25 
  Feb-2023 |        32          5 |        37 
  Mar-2023 |        30          3 |        33 
  Apr-2023 |        27          1 |        28 
  May-2023 |        32          4 |        36 
  Jun-2023 |        32          5 |        37 
  Jul-2023 |        40          3 |        43 
  Aug-2023 |        38          7 |        45 
  Sep-2023 |        38          4 |        42 
  Oct-2023 |        38          7 |        45 
  Nov-2023 |        39          2 |        41 
  Dec-2023 |        42          4 |        46 
  Jan-2024 |        58          8 |        66 
  Feb-2024 |        39         11 |        50 
  Mar-2024 |        44          7 |        51 
  Apr-2024 |        47         10 |        57 
  May-2024 |        52          7 |        59 
  Jun-2024 |        38          6 |        44 
  Jul-2024 |        54          9 |        63 
  Aug-2024 |        45         11 |        56 
  Sep-2024 |        42          9 |        51 
  Oct-2024 |        60          4 |        64 
  Nov-2024 |        48          6 |        54 
  Dec-2024 |        46         12 |        58 
  Jan-2025 |        51         12 |        63 
  Feb-2025 |        46         12 |        58 
  Mar-2025 |        53         12 |        65 
-----------+----------------------+----------
     Total |     1,643        229 |     1,872 

. tab mo_year_diagn has_12m_follow_up

Month/Year |
        of |   has_12m_follow_up
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         0          2 |         2 
  May-2016 |         1          1 |         2 
  Jun-2016 |         4          1 |         5 
  Jul-2016 |         1          0 |         1 
  Aug-2016 |         1          0 |         1 
  Sep-2016 |         2          0 |         2 
  Oct-2016 |         3          0 |         3 
  Nov-2016 |         1          1 |         2 
  Dec-2016 |         6          0 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         3          0 |         3 
  Apr-2017 |         7          1 |         8 
  May-2017 |         4          2 |         6 
  Jun-2017 |         3          1 |         4 
  Jul-2017 |         4          0 |         4 
  Aug-2017 |         2          1 |         3 
  Sep-2017 |         2          1 |         3 
  Oct-2017 |         3          0 |         3 
  Nov-2017 |         2          1 |         3 
  Dec-2017 |         3          0 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         3          2 |         5 
  Mar-2018 |         3          0 |         3 
  Apr-2018 |         3          0 |         3 
  May-2018 |         1          0 |         1 
  Jun-2018 |         4          0 |         4 
  Jul-2018 |         5          0 |         5 
  Aug-2018 |         2          1 |         3 
  Sep-2018 |         3          2 |         5 
  Oct-2018 |         3          0 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         1          0 |         1 
  Jan-2019 |         3          0 |         3 
  Feb-2019 |         3          0 |         3 
  Mar-2019 |         4          0 |         4 
  Apr-2019 |         3          2 |         5 
  May-2019 |         7          0 |         7 
  Jun-2019 |         5          1 |         6 
  Jul-2019 |         4          0 |         4 
  Aug-2019 |         3          1 |         4 
  Sep-2019 |         5          1 |         6 
  Oct-2019 |         6          0 |         6 
  Nov-2019 |         4          0 |         4 
  Dec-2019 |         4          0 |         4 
  Jan-2020 |         1          0 |         1 
  Feb-2020 |         3          0 |         3 
  Mar-2020 |         5          0 |         5 
  Apr-2020 |         5          0 |         5 
  May-2020 |         6          0 |         6 
  Jun-2020 |         5          0 |         5 
  Jul-2020 |         5          1 |         6 
  Aug-2020 |         2          0 |         2 
  Sep-2020 |         6          0 |         6 
  Oct-2020 |         8          1 |         9 
  Nov-2020 |         8          1 |         9 
  Dec-2020 |         9          1 |        10 
  Jan-2021 |         7          0 |         7 
  Feb-2021 |         8          0 |         8 
  Mar-2021 |         4          0 |         4 
  Apr-2021 |        10          0 |        10 
  May-2021 |        11          0 |        11 
  Jun-2021 |         5          0 |         5 
  Jul-2021 |        13          1 |        14 
  Aug-2021 |         9          2 |        11 
  Sep-2021 |         8          1 |         9 
  Oct-2021 |        13          0 |        13 
  Nov-2021 |         9          0 |         9 
  Dec-2021 |         5          0 |         5 
  Jan-2022 |         8          0 |         8 
  Feb-2022 |        13          0 |        13 
  Mar-2022 |        16          1 |        17 
  Apr-2022 |        14          2 |        16 
  May-2022 |        20          1 |        21 
  Jun-2022 |        13          0 |        13 
  Jul-2022 |        18          1 |        19 
  Aug-2022 |        15          1 |        16 
  Sep-2022 |        18          2 |        20 
  Oct-2022 |        26          3 |        29 
  Nov-2022 |        27          1 |        28 
  Dec-2022 |        20          2 |        22 
  Jan-2023 |        24          1 |        25 
  Feb-2023 |        32          5 |        37 
  Mar-2023 |        30          3 |        33 
  Apr-2023 |        27          1 |        28 
  May-2023 |        32          4 |        36 
  Jun-2023 |        32          5 |        37 
  Jul-2023 |        40          3 |        43 
  Aug-2023 |        38          7 |        45 
  Sep-2023 |        38          4 |        42 
  Oct-2023 |        38          7 |        45 
  Nov-2023 |        39          2 |        41 
  Dec-2023 |        42          4 |        46 
  Jan-2024 |        58          8 |        66 
  Feb-2024 |        39         11 |        50 
  Mar-2024 |        45          6 |        51 
  Apr-2024 |        50          7 |        57 
  May-2024 |        53          6 |        59 
  Jun-2024 |        38          6 |        44 
  Jul-2024 |        58          5 |        63 
  Aug-2024 |        46         10 |        56 
  Sep-2024 |        46          5 |        51 
  Oct-2024 |        62          2 |        64 
  Nov-2024 |        51          3 |        54 
  Dec-2024 |        53          5 |        58 
  Jan-2025 |        56          7 |        63 
  Feb-2025 |        56          2 |        58 
  Mar-2025 |        62          3 |        65 
-----------+----------------------+----------
     Total |     1,693        179 |     1,872 

. 
. *For appt and csDMARD analyses, all patients must have 1) rheum appt 2) GP appt before rheum appt 3) 12m follow-up
>  after rheum appt 4) 12m of registration after diagnostic code
. gen has_6m_post_appt=1 if rheum_appt_date!=. & rheum_appt_date<=(date("$end_date", "DMY")-180) & has_6m_follow_up=
> =1 & last_gp_prerheum==1
(1,774 missing values generated)

. recode has_6m_post_appt .=0
(1,774 changes made to has_6m_post_appt)

. lab var has_6m_post_appt "GP/rheum/registration 6m+"

. lab define has_6m_post_appt 0 "No" 1 "Yes", modify

. lab val has_6m_post_appt has_6m_post_appt

. tab has_6m_post_appt

GP/rheum/re |
 gistration |
        6m+ |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,774       94.76       94.76
        Yes |         98        5.24      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. gen has_12m_post_appt=1 if rheum_appt_date!=. & rheum_appt_date<=(date("$end_date", "DMY")-365) & has_12m_follow_u
> p==1 & last_gp_prerheum==1
(1,803 missing values generated)

. recode has_12m_post_appt .=0
(1,803 changes made to has_12m_post_appt)

. lab var has_12m_post_appt "GP/rheum/registration 12m+"

. lab define has_12m_post_appt 0 "No" 1 "Yes", modify

. lab val has_12m_post_appt has_12m_post_appt

. tab has_12m_post_appt

GP/rheum/re |
 gistration |
       12m+ |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,803       96.31       96.31
        Yes |         69        3.69      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. *Time to rheum referral =============================================*/
. 
. **AMEND THE BELOW ONCE REFERRAL DATE KNOWN
. 
. **Time from last GP appt to rheum ref before rheum appt (i.e. if appts are present and in correct time order)
. gen time_gp_rheum_ref_appt = (rheum_ref_gp_preappt_date - last_gp_refrheum_date) if rheum_ref_gp_preappt_date!=. &
>  last_gp_refrheum_date!=. & rheum_appt_date!=. & (rheum_ref_gp_preappt_date>=last_gp_refrheum_date) & (rheum_ref_g
> p_preappt_date<=rheum_appt_date)
(1,872 missing values generated)

. tabstat time_gp_rheum_ref_appt, stats (n mean p50 p25 p75) //all patients (should be same number as all_appts)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_gp_rh~t |         0         .         .         .         .
----------------------------------------------------------------

. 
. gen gp_ref_cat=1 if time_gp_rheum_ref_appt<=3 & time_gp_rheum_ref_appt!=. 
(1,872 missing values generated)

. replace gp_ref_cat=2 if time_gp_rheum_ref_appt>3 & time_gp_rheum_ref_appt<=7 & time_gp_rheum_ref_appt!=. & gp_ref_
> cat==.
(0 real changes made)

. replace gp_ref_cat=3 if time_gp_rheum_ref_appt>7 & time_gp_rheum_ref_appt!=. & gp_ref_cat==.
(0 real changes made)

. lab define gp_ref_cat 1 "Within 3 days" 2 "Between 3-7 days" 3 "More than 7 days", modify

. lab val gp_ref_cat gp_ref_cat

. lab var gp_ref_cat "Time to GP referral"

. tab gp_ref_cat, missing

      Time to GP |
        referral |      Freq.     Percent        Cum.
-----------------+-----------------------------------
               . |      1,872      100.00      100.00
-----------------+-----------------------------------
           Total |      1,872      100.00

. 
. gen gp_ref_3d=1 if time_gp_rheum_ref_appt<=3 & time_gp_rheum_ref_appt!=. 
(1,872 missing values generated)

. replace gp_ref_3d=2 if time_gp_rheum_ref_appt>3 & time_gp_rheum_ref_appt!=.
(0 real changes made)

. lab define gp_ref_3d 1 "Within 3 days" 2 "More than 3 days", modify

. lab val gp_ref_3d gp_ref_3d

. lab var gp_ref_3d "Time to GP referral"

. tab gp_ref_3d, missing

      Time to GP |
        referral |      Freq.     Percent        Cum.
-----------------+-----------------------------------
               . |      1,872      100.00      100.00
-----------------+-----------------------------------
           Total |      1,872      100.00

. 
. **Time from last GP to rheum ref before eia code (sensitivity analysis; includes those with no rheum appt)
. gen time_gp_rheum_ref_code = (rheum_ref_gp_precode_date - last_gp_refcode_date) if rheum_ref_gp_precode_date!=. & 
> last_gp_refcode_date!=. & rheum_ref_gp_precode_date>=last_gp_refcode_date & rheum_ref_gp_precode_date<=eia_code_da
> te
(1,870 missing values generated)

. tabstat time_gp_rheum_ref_code, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_gp_rh~e |         2       225       225       206       244
----------------------------------------------------------------

. 
. **Time from last GP to rheum ref (combined - sensitivity analysis; includes those with no rheum appt)
. gen time_gp_rheum_ref_comb = time_gp_rheum_ref_appt 
(1,872 missing values generated)

. replace time_gp_rheum_ref_comb = time_gp_rheum_ref_code if time_gp_rheum_ref_appt==. & time_gp_rheum_ref_code!=.
(2 real changes made)

. tabstat time_gp_rheum_ref_comb, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_gp_rh~b |         2       225       225       206       244
----------------------------------------------------------------

. 
. *Time to rheum appointment=============================================*/
. 
. **AMEND THE BELOW ONCE REFERRAL DATE KNOWN
. 
. **Time from last GP pre-rheum appt to first rheum appt (proxy for referral to appt delay)
. gen time_gp_rheum_appt = (rheum_appt_date - last_gp_prerheum_date) if rheum_appt_date!=. & last_gp_prerheum_date!=
> . & (rheum_appt_date>=last_gp_prerheum_date)
(1,759 missing values generated)

. tabstat time_gp_rheum_appt, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_~m_appt |       113  198.2212       111        52       298
----------------------------------------------------------------

. 
. **Time from rheum ref to rheum appt (i.e. if appts are present and in correct order)
. gen time_ref_rheum_appt = (rheum_appt_date - rheum_ref_gp_preappt_date) if rheum_appt_date!=. & rheum_ref_gp_preap
> pt_date!=. & (rheum_ref_gp_preappt_date<=rheum_appt_date)
(1,871 missing values generated)

. tabstat time_ref_rheum_appt, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_ref_r~t |         1        45        45        45        45
----------------------------------------------------------------

. 
. **Time from rheum appt received date to rheum appt (i.e. if appts are present and in correct order)
. gen time_hes_rheum_appt = (rheum_appt_date - rheum_appt_ref_date) if rheum_appt_date!=. & rheum_appt_ref_date!=. &
>  (rheum_appt_ref_date<=rheum_appt_date)
(1,799 missing values generated)

. tabstat time_hes_rheum_appt, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_hes_r~t |        73  321.6164       185        91       442
----------------------------------------------------------------

. 
. **Time from RTT combined ref date to rheum appt (i.e. if appts are present and in correct order)
. gen time_rtt_rheum_appt = (rheum_appt_date - rtt_ref_date) if rheum_appt_date!=. & rtt_ref_date!=. & (rtt_ref_date
> <=rheum_appt_date)
(1,805 missing values generated)

. tabstat time_rtt_rheum_appt, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_rtt_r~t |        67  326.3433       207        75       426
----------------------------------------------------------------

. 
. **Time from RTT closed ref date to rheum appt (i.e. if appts are present and in correct order)
. gen time_rtt_cl_rheum_appt = (rheum_appt_date - rtt_cl_ref_date) if rheum_appt_date!=. & rtt_cl_ref_date!=. & (rtt
> _cl_ref_date<=rheum_appt_date)
(1,819 missing values generated)

. tabstat time_rtt_cl_rheum_appt, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_rtt_c~t |        53  324.8868       238        76       461
----------------------------------------------------------------

. 
. **Time from RTT open ref date to rheum appt (i.e. if appts are present and in correct order)
. gen time_rtt_op_rheum_appt = (rheum_appt_date - rtt_op_ref_date) if rheum_appt_date!=. & rtt_op_ref_date!=. & (rtt
> _op_ref_date<=rheum_appt_date)
(1,821 missing values generated)

. tabstat time_rtt_op_rheum_appt, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_rtt_o~t |        51  357.0392       246        91       488
----------------------------------------------------------------

. 
. gen gp_appt_cat=1 if time_gp_rheum_appt<=21 & time_gp_rheum_appt!=. 
(1,858 missing values generated)

. replace gp_appt_cat=2 if time_gp_rheum_appt>21 & time_gp_rheum_appt<=42 & time_gp_rheum_appt!=. & gp_appt_cat==.
(10 real changes made)

. replace gp_appt_cat=3 if time_gp_rheum_appt>42 & time_gp_rheum_appt!=. & gp_appt_cat==.
(89 real changes made)

. lab define gp_appt_cat 1 "Within 3 weeks" 2 "Between 3-6 weeks" 3 "More than 6 weeks", modify

. lab val gp_appt_cat gp_appt_cat

. lab var gp_appt_cat "Time to rheumatology assessment, overall"

. tab gp_appt_cat, missing

          Time to |
     rheumatology |
      assessment, |
          overall |      Freq.     Percent        Cum.
------------------+-----------------------------------
   Within 3 weeks |         14        0.75        0.75
Between 3-6 weeks |         10        0.53        1.28
More than 6 weeks |         89        4.75        6.04
                . |      1,759       93.96      100.00
------------------+-----------------------------------
            Total |      1,872      100.00

. 
. forvalues i = 1/$max_year {
  2.     local start = $base_year + `i' - 1
  3.     local end = `start' + 1
  4.         gen gp_appt_cat_`start'=gp_appt_cat if appt_year==`i'
  5.     lab define gp_appt_cat_`start' 1 "Within 3 weeks" 2 "Between 3-6 weeks" 3 "More than 6 weeks", modify
  6.         lab val gp_appt_cat_`start' gp_appt_cat_`start'
  7.         lab var gp_appt_cat_`start' "Time to rheumatology assessment, Apr `start'-Mar `end'"
  8.         tab gp_appt_cat_`start', missing
  9. }
(1,868 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2016-Mar 2017 |      Freq.     Percent        Cum.
------------------+-----------------------------------
   Within 3 weeks |          1        0.05        0.05
More than 6 weeks |          3        0.16        0.21
                . |      1,868       99.79      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,868 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2017-Mar 2018 |      Freq.     Percent        Cum.
------------------+-----------------------------------
   Within 3 weeks |          1        0.05        0.05
More than 6 weeks |          3        0.16        0.21
                . |      1,868       99.79      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,867 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2018-Mar 2019 |      Freq.     Percent        Cum.
------------------+-----------------------------------
   Within 3 weeks |          1        0.05        0.05
More than 6 weeks |          4        0.21        0.27
                . |      1,867       99.73      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,871 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2019-Mar 2020 |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 6 weeks |          1        0.05        0.05
                . |      1,871       99.95      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,871 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2020-Mar 2021 |      Freq.     Percent        Cum.
------------------+-----------------------------------
Between 3-6 weeks |          1        0.05        0.05
                . |      1,871       99.95      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,870 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2021-Mar 2022 |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 6 weeks |          2        0.11        0.11
                . |      1,870       99.89      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,865 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2022-Mar 2023 |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 6 weeks |          7        0.37        0.37
                . |      1,865       99.63      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,829 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2023-Mar 2024 |      Freq.     Percent        Cum.
------------------+-----------------------------------
   Within 3 weeks |          6        0.32        0.32
Between 3-6 weeks |          1        0.05        0.37
More than 6 weeks |         36        1.92        2.30
                . |      1,829       97.70      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,828 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2024-Mar 2025 |      Freq.     Percent        Cum.
------------------+-----------------------------------
   Within 3 weeks |          5        0.27        0.27
Between 3-6 weeks |          8        0.43        0.69
More than 6 weeks |         31        1.66        2.35
                . |      1,828       97.65      100.00
------------------+-----------------------------------
            Total |      1,872      100.00

. 
. gen gp_appt_3w=1 if time_gp_rheum_appt<=21 & time_gp_rheum_appt!=. 
(1,858 missing values generated)

. replace gp_appt_3w=2 if time_gp_rheum_appt>21 & time_gp_rheum_appt!=.
(99 real changes made)

. lab define gp_appt_3w 1 "Within 3 weeks" 2 "More than 3 weeks", modify

. lab val gp_appt_3w gp_appt_3w

. lab var gp_appt_3w "Time to rheumatology assessment, overall"

. tab gp_appt_3w, missing

          Time to |
     rheumatology |
      assessment, |
          overall |      Freq.     Percent        Cum.
------------------+-----------------------------------
   Within 3 weeks |         14        0.75        0.75
More than 3 weeks |         99        5.29        6.04
                . |      1,759       93.96      100.00
------------------+-----------------------------------
            Total |      1,872      100.00

. 
. **AMEND THE BELOW ONCE REFERRAL DATE KNOWN
. 
. gen ref_appt_cat=1 if time_ref_rheum_appt<=21 & time_ref_rheum_appt!=. 
(1,872 missing values generated)

. replace ref_appt_cat=2 if time_ref_rheum_appt>21 & time_ref_rheum_appt<=42 & time_ref_rheum_appt!=. & ref_appt_cat
> ==.
(0 real changes made)

. replace ref_appt_cat=3 if time_ref_rheum_appt>42 & time_ref_rheum_appt!=. & ref_appt_cat==.
(1 real change made)

. lab define ref_appt_cat 1 "Within 3 weeks" 2 "Between 3-6 weeks" 3 "More than 6 weeks", modify

. lab val ref_appt_cat ref_appt_cat

. lab var ref_appt_cat "Time to rheumatology assessment"

. tab ref_appt_cat, missing

          Time to |
     rheumatology |
       assessment |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 6 weeks |          1        0.05        0.05
                . |      1,871       99.95      100.00
------------------+-----------------------------------
            Total |      1,872      100.00

. 
. forvalues i = 1/$max_year {
  2.     local start = $base_year + `i' - 1
  3.     local end = `start' + 1
  4.         gen ref_appt_cat_`start'=ref_appt_cat if appt_year==`i'
  5.     lab define ref_appt_cat_`start' 1 "Within 3 weeks" 2 "Between 3-6 weeks" 3 "More than 6 weeks", modify
  6.         lab val ref_appt_cat_`start' ref_appt_cat_`start'
  7.         lab var ref_appt_cat_`start' "Time to rheumatology assessment, Apr `start'-Mar `end'"
  8.         tab ref_appt_cat_`start', missing
  9. }
(1,872 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2016-Mar 2017 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |      1,872      100.00      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,872 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2017-Mar 2018 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |      1,872      100.00      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,872 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2018-Mar 2019 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |      1,872      100.00      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,872 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2019-Mar 2020 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |      1,872      100.00      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,872 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2020-Mar 2021 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |      1,872      100.00      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,872 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2021-Mar 2022 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |      1,872      100.00      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,872 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2022-Mar 2023 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |      1,872      100.00      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,872 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2023-Mar 2024 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |      1,872      100.00      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,871 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2024-Mar 2025 |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 6 weeks |          1        0.05        0.05
                . |      1,871       99.95      100.00
------------------+-----------------------------------
            Total |      1,872      100.00

. 
. gen ref_appt_3w=1 if time_ref_rheum_appt<=21 & time_ref_rheum_appt!=. 
(1,872 missing values generated)

. replace ref_appt_3w=2 if time_ref_rheum_appt>21 & time_ref_rheum_appt!=.
(1 real change made)

. lab define ref_appt_3w 1 "Within 3 weeks" 2 "More than 3 weeks", modify

. lab val ref_appt_3w ref_appt_3w

. lab var ref_appt_3w "Time to rheumatology assessment"

. tab ref_appt_3w, missing

          Time to |
     rheumatology |
       assessment |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 3 weeks |          1        0.05        0.05
                . |      1,871       99.95      100.00
------------------+-----------------------------------
            Total |      1,872      100.00

. 
. *Time to EIA code==================================================*/
. 
. **Time from last GP pre-code to EIA code (sensitivity analysis; includes those with no rheum ref and/or no rheum a
> ppt)
. gen time_gp_eia_code = (eia_code_date - last_gp_precode_date) if eia_code_date!=. & last_gp_precode_date!=. & eia_
> code_date>=last_gp_precode_date
(977 missing values generated)

. tabstat time_gp_eia_code, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_gp_ei~e |       895   178.933       117        47       262
----------------------------------------------------------------

. 
. **Time from last GP to EIA diagnosis (combined - sensitivity analysis; includes those with no rheum appt)
. gen time_gp_eia_diag = time_gp_rheum_appt
(1,759 missing values generated)

. replace time_gp_eia_diag = time_gp_eia_code if time_gp_rheum_appt==. & time_gp_eia_code!=.
(787 real changes made)

. tabstat time_gp_eia_diag, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_gp_ei~g |       900  181.3911       116        48     266.5
----------------------------------------------------------------

. 
. **Time from rheum ref to EIA code (sensitivity analysis; includes those with no rheum appt)
. gen time_ref_rheum_eia = (eia_code_date - rheum_ref_gp_precode_date) if eia_code_date!=. & rheum_ref_gp_precode_da
> te!=. & rheum_ref_gp_precode_date<=eia_code_date  
(1,861 missing values generated)

. tabstat time_ref_rheum_eia, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_ref_r~a |        11  241.4545       225        84       411
----------------------------------------------------------------

. 
. **Time from rheum ref to EIA diagnosis (combined - sensitivity analysis; includes those with no rheum appt)
. gen time_ref_rheum_eia_comb = time_ref_rheum_appt
(1,871 missing values generated)

. replace time_ref_rheum_eia_comb = time_ref_rheum_eia if time_ref_rheum_appt==. & time_ref_rheum_eia!=.
(10 real changes made)

. tabstat time_ref_rheum_eia_comb, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_ref_r~b |        11  245.4545       225        84       411
----------------------------------------------------------------

. 
. **Time from rheum appt to EIA code
. gen time_rheum_eia_code = (eia_code_date - rheum_appt_date) if eia_code_date!=. & rheum_appt_date!=. 
(1,622 missing values generated)

. tabstat time_rheum_eia_code, stats (n mean p50 p25 p75) 

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_rheum~e |       250   177.468     182.5        80       295
----------------------------------------------------------------

. gen time_rheum2_eia_code = (eia_code_date - rheum_appt2_date) if eia_code_date!=. & rheum_appt2_date!=. 
(1,476 missing values generated)

. tabstat time_rheum2_eia_code, stats (n mean p50 p25 p75) 

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
t~2_eia_code |       396  78.18182        88      22.5       136
----------------------------------------------------------------

. gen time_rheum3_eia_code = (eia_code_date - rheum_appt3_date) if eia_code_date!=. & rheum_appt3_date!=. 
(1,166 missing values generated)

. tabstat time_rheum3_eia_code, stats (n mean p50 p25 p75) 

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
t~3_eia_code |       706  367.6076     381.5       213       544
----------------------------------------------------------------

. 
. *Time from rheum appt to first csDMARD prescriptions in primary care record=======================================
> ===============================*/
. 
. **Time to first csDMARD script not including high cost MTX prescriptions; prescription must be within 6 months of 
> first rheum appt for all csDMARDs below ==================*/
. gen time_to_csdmard=(csdmard_date-rheum_appt_date) if csdmard==1 & rheum_appt_date!=. & (csdmard_date<=(rheum_appt
> _date+180))
(1,772 missing values generated)

. tabstat time_to_csdmard, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_to_cs~d |       100     53.07      53.5        -6       112
----------------------------------------------------------------

. 
. **All generate time to first csDMARD script not including high cost MTX prescriptions; with no time restriction ==
> ================*/
. gen time_to_csdmard_unr=(csdmard_date-rheum_appt_date) if csdmard==1 & rheum_appt_date!=.
(1,697 missing values generated)

. tabstat time_to_csdmard_unr, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_to_cs~r |       175    195.44       140        37       279
----------------------------------------------------------------

. 
. /*
> **Time to first csDMARD script for RA patients (including high cost MTX prescriptions)
> gen time_to_csdmard_hcd=(csdmard_hcd_date-rheum_appt_date) if csdmard_hcd==1 & rheum_appt_date!=. & (csdmard_hcd_d
> ate<=rheum_appt_date+180)
> tabstat time_to_csdmard_hcd if ra_code==1, stats (n mean p50 p25 p75) 
> */
. 
. **csDMARD time categories (not including high cost MTX prescriptions)
. gen csdmard_time=1 if time_to_csdmard<=90 & time_to_csdmard!=. 
(1,806 missing values generated)

. replace csdmard_time=2 if time_to_csdmard>90 & time_to_csdmard<=180 & time_to_csdmard!=.
(34 real changes made)

. replace csdmard_time=3 if time_to_csdmard>180 | time_to_csdmard==.
(1,772 real changes made)

. lab define csdmard_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify

. lab val csdmard_time csdmard_time

. lab var csdmard_time "csDMARD in primary care, overall" 

. tab csdmard_time, missing

       csDMARD in primary care, |
                        overall |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |         66        3.53        3.53
                     3-6 months |         34        1.82        5.34
No prescription within 6 months |      1,772       94.66      100.00
--------------------------------+-----------------------------------
                          Total |      1,872      100.00

. tab csdmard_time if has_6m_follow_up==1, missing

       csDMARD in primary care, |
                        overall |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |         61       26.64       26.64
                     3-6 months |         32       13.97       40.61
No prescription within 6 months |        136       59.39      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00

. tab csdmard_time if ra_code==1 & has_6m_follow_up==1, missing 

       csDMARD in primary care, |
                        overall |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |         47       25.27       25.27
                     3-6 months |         26       13.98       39.25
No prescription within 6 months |        113       60.75      100.00
--------------------------------+-----------------------------------
                          Total |        186      100.00

. tab csdmard_time if psa_code==1 & has_6m_follow_up==1, missing

       csDMARD in primary care, |
                        overall |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          5       29.41       29.41
                     3-6 months |          5       29.41       58.82
No prescription within 6 months |          7       41.18      100.00
--------------------------------+-----------------------------------
                          Total |         17      100.00

. tab csdmard_time if anksp_code==1 & has_6m_follow_up==1, missing

       csDMARD in primary care, |
                        overall |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          8       36.36       36.36
No prescription within 6 months |         14       63.64      100.00
--------------------------------+-----------------------------------
                          Total |         22      100.00

. tab csdmard_time if undiff_code==1 & has_6m_follow_up==1, missing

       csDMARD in primary care, |
                        overall |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          1       25.00       25.00
                     3-6 months |          1       25.00       50.00
No prescription within 6 months |          2       50.00      100.00
--------------------------------+-----------------------------------
                          Total |          4      100.00

. 
. forvalues i = 1/$max_year {
  2.     local start = $base_year + `i' - 1
  3.     local end = `start' + 1
  4.         gen csdmard_time_`start'=csdmard_time if appt_year==`i'
  5.         recode csdmard_time_`start' .=4
  6.     lab define csdmard_time_`start' 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months" 4 "O
> utside `start'/`end'", modify
  7.         lab val csdmard_time_`start' csdmard_time_`start'
  8.         lab var csdmard_time_`start' "csDMARD in primary care, Apr `start'-Mar `end'"
  9.         tab csdmard_time_`start' if has_6m_follow_up==1, missing
 10. }
(1,866 missing values generated)
(1,866 changes made to csdmard_time_2016)

   csDMARD in primary care, Apr |
                  2016-Mar 2017 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          2        0.87        0.87
                     3-6 months |          3        1.31        2.18
No prescription within 6 months |          1        0.44        2.62
              Outside 2016/2017 |        223       97.38      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00
(1,867 missing values generated)
(1,867 changes made to csdmard_time_2017)

   csDMARD in primary care, Apr |
                  2017-Mar 2018 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          2        0.87        0.87
No prescription within 6 months |          3        1.31        2.18
              Outside 2017/2018 |        224       97.82      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00
(1,866 missing values generated)
(1,866 changes made to csdmard_time_2018)

   csDMARD in primary care, Apr |
                  2018-Mar 2019 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          1        0.44        0.44
No prescription within 6 months |          5        2.18        2.62
              Outside 2018/2019 |        223       97.38      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00
(1,868 missing values generated)
(1,868 changes made to csdmard_time_2019)

   csDMARD in primary care, Apr |
                  2019-Mar 2020 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
No prescription within 6 months |          4        1.75        1.75
              Outside 2019/2020 |        225       98.25      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00
(1,868 missing values generated)
(1,868 changes made to csdmard_time_2020)

   csDMARD in primary care, Apr |
                  2020-Mar 2021 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                     3-6 months |          1        0.44        0.44
No prescription within 6 months |          3        1.31        1.75
              Outside 2020/2021 |        225       98.25      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00
(1,862 missing values generated)
(1,862 changes made to csdmard_time_2021)

   csDMARD in primary care, Apr |
                  2021-Mar 2022 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                     3-6 months |          3        1.31        1.31
No prescription within 6 months |          7        3.06        4.37
              Outside 2021/2022 |        219       95.63      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00
(1,829 missing values generated)
(1,829 changes made to csdmard_time_2022)

   csDMARD in primary care, Apr |
                  2022-Mar 2023 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          7        3.06        3.06
                     3-6 months |          8        3.49        6.55
No prescription within 6 months |         28       12.23       18.78
              Outside 2022/2023 |        186       81.22      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00
(1,777 missing values generated)
(1,777 changes made to csdmard_time_2023)

   csDMARD in primary care, Apr |
                  2023-Mar 2024 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |         28       12.23       12.23
                     3-6 months |         10        4.37       16.59
No prescription within 6 months |         57       24.89       41.48
              Outside 2023/2024 |        134       58.52      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00
(1,801 missing values generated)
(1,801 changes made to csdmard_time_2024)

   csDMARD in primary care, Apr |
                  2024-Mar 2025 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |         16        6.99        6.99
                     3-6 months |          7        3.06       10.04
No prescription within 6 months |         27       11.79       21.83
              Outside 2024/2025 |        179       78.17      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00

. 
. **csDMARD time categories - binary 6 months
. gen csdmard_6m=1 if time_to_csdmard<=180 & time_to_csdmard!=. 
(1,772 missing values generated)

. replace csdmard_6m=0 if time_to_csdmard>180 | time_to_csdmard==.
(1,772 real changes made)

. lab define csdmard_6m 1 "Yes" 0 "No", modify

. lab val csdmard_6m csdmard_6m

. lab var csdmard_6m "csDMARD in primary care within 6 months" 

. tab csdmard_6m, missing 

 csDMARD in |
    primary |
care within |
   6 months |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,772       94.66       94.66
        Yes |        100        5.34      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. /*
> **csDMARD time categories (including high cost MTX prescriptions)
> gen csdmard_hcd_time=1 if time_to_csdmard_hcd<=90 & time_to_csdmard_hcd!=. 
> replace csdmard_hcd_time=2 if time_to_csdmard_hcd>90 & time_to_csdmard_hcd<=180 & time_to_csdmard_hcd!=.
> replace csdmard_hcd_time=3 if time_to_csdmard_hcd>180 | time_to_csdmard_hcd==.
> lab define csdmard_hcd_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify
> lab val csdmard_hcd_time csdmard_hcd_time
> lab var csdmard_hcd_time "csDMARD in primary care" 
> tab csdmard_hcd_time if ra_code==1, missing 
> tab csdmard_hcd_time if psa_code==1, missing
> tab csdmard_hcd_time if anksp_code==1, missing 
> tab csdmard_hcd_time if undiff_code==1, missing
> */
. 
. **What was first csDMARD in GP record (not including high cost MTX prescriptions) - with time restriction - may ne
> ed to remove leflunomide (for OpenSAFELY report) due to small counts at more granular time periods
. gen first_csD=""
(1,872 missing values generated)

. foreach var of varlist hydroxychloroquine_date mtx_date sulfasalazine_date leflunomide_date {
  2.         replace first_csD="`var'" if csdmard_date==`var' & csdmard_date!=. & (`var'<=(rheum_appt_date+180)) & t
> ime_to_csdmard!=.
  3.         }
variable first_csD was str1 now str23
(14 real changes made)
(70 real changes made)
(7 real changes made)
(9 real changes made)

. gen first_csDMARD = substr(first_csD, 1, length(first_csD) - 5) if first_csD!="" 
(1,772 missing values generated)

. drop first_csD

. replace first_csDMARD="Methotrexate" if first_csDMARD=="mtx"
(70 real changes made)

. replace first_csDMARD="Sulfasalazine" if first_csDMARD=="sulfasalazine"
(7 real changes made)

. replace first_csDMARD="Hydroxychloroquine" if first_csDMARD=="hydroxychloroquine" 
(14 real changes made)

. replace first_csDMARD="Leflunomide" if first_csDMARD=="leflunomide" 
(9 real changes made)

. tab first_csDMARD if ra_code==1 //for RA patients

     first_csDMARD |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |         12       15.19       15.19
       Leflunomide |          8       10.13       25.32
      Methotrexate |         53       67.09       92.41
     Sulfasalazine |          6        7.59      100.00
-------------------+-----------------------------------
             Total |         79      100.00

. tab first_csDMARD if psa_code==1 //for PsA patients

     first_csDMARD |      Freq.     Percent        Cum.
-------------------+-----------------------------------
       Leflunomide |          1        9.09        9.09
      Methotrexate |         10       90.91      100.00
-------------------+-----------------------------------
             Total |         11      100.00

. tab first_csDMARD if anksp_code==1 //for axSpA patients

     first_csDMARD |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |          1       12.50       12.50
      Methotrexate |          7       87.50      100.00
-------------------+-----------------------------------
             Total |          8      100.00

. tab first_csDMARD if undiff_code==1 //for Undiff IA patients

     first_csDMARD |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |          1       50.00       50.00
     Sulfasalazine |          1       50.00      100.00
-------------------+-----------------------------------
             Total |          2      100.00

. 
. **What was first csDMARD in GP record (not including high cost MTX prescriptions) - without time restriction
. gen first_csD_unr=""
(1,872 missing values generated)

. foreach var of varlist hydroxychloroquine_date mtx_date sulfasalazine_date leflunomide_date {
  2.         replace first_csD_unr="`var'" if csdmard_date==`var' & csdmard_date!=.
  3.         }
variable first_csD_unr was str1 now str23
(274 real changes made)
(1,065 real changes made)
(166 real changes made)
(140 real changes made)

. gen first_csDMARD_unr = substr(first_csD_unr, 1, length(first_csD_unr) - 5) if first_csD_unr!="" 
(228 missing values generated)

. drop first_csD_unr

. replace first_csDMARD_unr="Methotrexate" if first_csDMARD_unr=="mtx"
(1,064 real changes made)

. replace first_csDMARD_unr="Sulfasalazine" if first_csDMARD_unr=="sulfasalazine"
(166 real changes made)

. replace first_csDMARD_unr="Hydroxychloroquine" if first_csDMARD_unr=="hydroxychloroquine" 
(274 real changes made)

. replace first_csDMARD_unr="Leflunomide" if first_csDMARD_unr=="leflunomide" 
(140 real changes made)

. tab first_csDMARD_unr if ra_code==1 //for RA patients

 first_csDMARD_unr |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |        218       16.38       16.38
       Leflunomide |        110        8.26       24.64
      Methotrexate |        863       64.84       89.48
     Sulfasalazine |        140       10.52      100.00
-------------------+-----------------------------------
             Total |      1,331      100.00

. tab first_csDMARD_unr if psa_code==1 //for PsA patients

 first_csDMARD_unr |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |         29       16.96       16.96
       Leflunomide |         13        7.60       24.56
      Methotrexate |        114       66.67       91.23
     Sulfasalazine |         15        8.77      100.00
-------------------+-----------------------------------
             Total |        171      100.00

. tab first_csDMARD_unr if anksp_code==1 //for axSpA patients

 first_csDMARD_unr |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |         22       18.80       18.80
       Leflunomide |         15       12.82       31.62
      Methotrexate |         72       61.54       93.16
     Sulfasalazine |          8        6.84      100.00
-------------------+-----------------------------------
             Total |        117      100.00

. tab first_csDMARD_unr if undiff_code==1 //for Undiff IA patients

 first_csDMARD_unr |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |          5       20.00       20.00
       Leflunomide |          2        8.00       28.00
      Methotrexate |         15       60.00       88.00
     Sulfasalazine |          3       12.00      100.00
-------------------+-----------------------------------
             Total |         25      100.00

. 
. /*
> **What was first csDMARD in GP record (including high cost MTX prescriptions)
> gen first_csD_hcd=""
> foreach var of varlist hydroxychloroquine_date methotrexate_date methotrexate_hcd_date sulfasalazine_date leflunom
> ide_date {
>         replace first_csD_hcd="`var'" if csdmard_hcd_date==`var' & csdmard_hcd_date!=. & (csdmard_hcd_date<=rheum_
> appt_date+180) & time_to_csdmard_hcd!=.
>         }
> gen first_csDMARD_hcd = substr(first_csD_hcd, 1, length(first_csD_hcd) - 5) if first_csD_hcd!=""
> drop first_csD_hcd
> tab first_csDMARD_hcd if ra_code==1 //for RA patients
> tab first_csDMARD_hcd if psa_code==1 //for PsA patients
> tab first_csDMARD_hcd if anksp_code==1 //for axSpA patients
> tab first_csDMARD_hcd if undiff_code==1 //for Undiff IA patients
> */
.  
. /*
> **Methotrexate use (including high cost MTX prescriptions)
> gen mtx_hcd=1 if methotrexate==1 | methotrexate_inj==1 | methotrexate_hcd==1
> recode mtx_hcd .=0 
> */
. 
. /*
> **Date of first methotrexate script (including high cost MTX prescriptions)
> gen mtx_hcd_date=min(methotrexate_date, methotrexate_inj_date, methotrexate_hcd_date)
> format %td mtx_hcd_date
> */
. 
. **Methotrexate use (not including high cost MTX prescriptions); Nb. this is just a check; need time-to-MTX instead
>  (below)
. tab mtx if ra_code==1 //for RA patients

Methotrexat |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        273       17.89       17.89
          1 |      1,253       82.11      100.00
------------+-----------------------------------
      Total |      1,526      100.00

. tab mtx if ra_code==1 & (mtx_date<=rheum_appt_date+180) //with 6-month limit

Methotrexat |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        190       13.74       13.74
          1 |      1,193       86.26      100.00
------------+-----------------------------------
      Total |      1,383      100.00

. tab mtx if ra_code==1 & (mtx_date<=rheum_appt_date+365) //with 12-month limit

Methotrexat |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        190       13.38       13.38
          1 |      1,230       86.62      100.00
------------+-----------------------------------
      Total |      1,420      100.00

. tab mtx if psa_code==1 //for PsA patients

Methotrexat |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         31       16.15       16.15
          1 |        161       83.85      100.00
------------+-----------------------------------
      Total |        192      100.00

. tab mtx if psa_code==1 & (mtx_date<=rheum_appt_date+180) //with 6-month limit

Methotrexat |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         25       13.59       13.59
          1 |        159       86.41      100.00
------------+-----------------------------------
      Total |        184      100.00

. tab mtx if psa_code==1 & (mtx_date<=rheum_appt_date+365) //with 12-month limit

Methotrexat |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         25       13.44       13.44
          1 |        161       86.56      100.00
------------+-----------------------------------
      Total |        186      100.00

. tab mtx if undiff_code==1 //for undiff IA patients

Methotrexat |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         25      100.00      100.00
------------+-----------------------------------
      Total |         25      100.00

. tab mtx if undiff_code==1 & (mtx_date<=rheum_appt_date+180) //with 6-month limit

Methotrexat |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         23      100.00      100.00
------------+-----------------------------------
      Total |         23      100.00

. tab mtx if undiff_code==1 & (mtx_date<=rheum_appt_date+365) //with 12-month limit

Methotrexat |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         24      100.00      100.00
------------+-----------------------------------
      Total |         24      100.00

. 
. /*
> **Methotrexate use (including high cost MTX prescriptions)
> tab mtx_hcd if ra_code==1 //for RA patients
> tab mtx_hcd if ra_code==1 & (mtx_hcd_date<=rheum_appt_date+180) //with 6-month limit
> tab mtx_hcd if ra_code==1 & (mtx_hcd_date<=rheum_appt_date+365) //with 12-month limit
> tab mtx_hcd if psa_code==1 //for PsA patients
> tab mtx_hcd if psa_code==1 & (mtx_hcd_date<=rheum_appt_date+180) //with 6-month limit
> tab mtx_hcd if psa_code==1 & (mtx_hcd_date<=rheum_appt_date+365) //with 12-month limit
> tab mtx_hcd if undiff_code==1 //for undiff IA patients
> tab mtx_hcd if undiff_code==1 & (mtx_hcd_date<=rheum_appt_date+180) //with 6-month limit
> tab mtx_hcd if undiff_code==1 & (mtx_hcd_date<=rheum_appt_date+365) //with 12-month limit
> */
. 
. **Check if medication issued >once
. gen mtx_shared=1 if mtx==1 & (methotrexate_oral_count>1 | methotrexate_inj_count>1)
(677 missing values generated)

. recode mtx_shared .=0
(677 changes made to mtx_shared)

. tab mtx_shared

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        677       36.16       36.16
          1 |      1,195       63.84      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. **Methotrexate use (shared care)
. tab mtx_shared if ra_code==1 //for RA patients; Nb. this is just a check; need time-to-MTX instead (below)

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        548       35.91       35.91
          1 |        978       64.09      100.00
------------+-----------------------------------
      Total |      1,526      100.00

. tab mtx_shared if ra_code==1 & (mtx_date<=rheum_appt_date+180) //with 6-month limit

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        438       31.67       31.67
          1 |        945       68.33      100.00
------------+-----------------------------------
      Total |      1,383      100.00

. tab mtx_shared if psa_code==1 //for PsA patients

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         75       39.06       39.06
          1 |        117       60.94      100.00
------------+-----------------------------------
      Total |        192      100.00

. tab mtx_shared if psa_code==1 & (mtx_date<=rheum_appt_date+180) //with 6-month limit

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         69       37.50       37.50
          1 |        115       62.50      100.00
------------+-----------------------------------
      Total |        184      100.00

. tab mtx_shared if undiff_code==1 //for undiff IA patients

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         10       40.00       40.00
          1 |         15       60.00      100.00
------------+-----------------------------------
      Total |         25      100.00

. tab mtx_shared if undiff_code==1 & (mtx_date<=rheum_appt_date+180) //with 6-month limit

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |          8       34.78       34.78
          1 |         15       65.22      100.00
------------+-----------------------------------
      Total |         23      100.00

. 
. **Check medication issue number
. gen mtx_issue=0 if mtx==1 & (methotrexate_oral_count==0 | methotrexate_inj_count==0)
(1,388 missing values generated)

. replace mtx_issue=1 if mtx==1 & (methotrexate_oral_count==1 | methotrexate_inj_count==1)
(711 real changes made)

. replace mtx_issue=2 if mtx==1 & (methotrexate_oral_count>1 | methotrexate_inj_count>1)
(1,195 real changes made)

. tab mtx_issue

  mtx_issue |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        355       22.90       22.90
          2 |      1,195       77.10      100.00
------------+-----------------------------------
      Total |      1,550      100.00

. 
. **Time to first methotrexate script for RA patients (not including high cost MTX prescriptions) - with time restri
> ction
. gen time_to_mtx=(mtx_date-rheum_appt_date) if mtx==1 & rheum_appt_date!=. & (mtx_date<=rheum_appt_date+180)
(1,790 missing values generated)

. tabstat time_to_mtx if ra_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_mtx |        62  57.16129      64.5       -17       115
----------------------------------------------------------------

. 
. /*
> **Time to first methotrexate script for RA patients (including high cost MTX prescriptions)
> gen time_to_mtx_hcd=(mtx_hcd_date-rheum_appt_date) if mtx_hcd==1 & rheum_appt_date!=. & (mtx_hcd_date<=rheum_appt_
> date+180)
> tabstat time_to_mtx_hcd if ra_code==1, stats (n mean p50 p25 p75)
> */
. 
. **Time to first methotrexate script for PsA patients (not including high cost MTX prescriptions)
. tabstat time_to_mtx if psa_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_mtx |        10      65.3        79        -1       132
----------------------------------------------------------------

. 
. /*
> **Time to first methotrexate script for PsA patients (including high cost MTX prescriptions)
> tabstat time_to_mtx_hcd if psa_code==1, stats (n mean p50 p25 p75)
> */
. 
. **Time to first methotrexate script for Undiff IA patients (not including high cost MTX prescriptions)
. tabstat time_to_mtx if undiff_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_mtx |         2     104.5     104.5        38       171
----------------------------------------------------------------

. 
. **Methotrexate time categories (not including high-cost MTX) - those with prescription date after 6 months (i.e. m
> issing) are still counted
. gen mtx_time=1 if time_to_mtx<=90 & time_to_mtx!=. 
(1,820 missing values generated)

. replace mtx_time=2 if time_to_mtx>90 & time_to_mtx<=180 & time_to_mtx!=.
(30 real changes made)

. replace mtx_time=3 if time_to_mtx>180 | time_to_mtx==.
(1,790 real changes made)

. lab define mtx_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify

. lab val mtx_time mtx_time

. lab var mtx_time "Methotrexate in primary care" 

. tab mtx_time if ra_code==1, missing 

   Methotrexate in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |         38        2.49        2.49
                     3-6 months |         24        1.57        4.06
No prescription within 6 months |      1,464       95.94      100.00
--------------------------------+-----------------------------------
                          Total |      1,526      100.00

. tab mtx_time if psa_code==1, missing

   Methotrexate in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          6        3.12        3.12
                     3-6 months |          4        2.08        5.21
No prescription within 6 months |        182       94.79      100.00
--------------------------------+-----------------------------------
                          Total |        192      100.00

. tab mtx_time if undiff_code==1, missing 

   Methotrexate in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          1        4.00        4.00
                     3-6 months |          1        4.00        8.00
No prescription within 6 months |         23       92.00      100.00
--------------------------------+-----------------------------------
                          Total |         25      100.00

. 
. /*
> **Methotrexate time categories for RA patients (including high-cost MTX)
> gen mtx_hcd_time=1 if time_to_mtx_hcd<=90 & time_to_mtx_hcd!=. 
> replace mtx_hcd_time=2 if time_to_mtx_hcd>90 & time_to_mtx_hcd<=180 & time_to_mtx_hcd!=.
> replace mtx_hcd_time=3 if time_to_mtx_hcd>180 | time_to_mtx_hcd==.
> lab define mtx_hcd_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify
> lab val mtx_hcd_time mtx_hcd_time
> lab var mtx_hcd_time "Methotrexate in primary care" 
> tab mtx_hcd_time if ra_code==1, missing 
> tab mtx_hcd_time if psa_code==1, missing
> tab mtx_hcd_time if undiff_code==1, missing 
> */
. 
. **Sulfasalazine use
. gen ssz=1 if sulfasalazine==1
(1,080 missing values generated)

. recode ssz .=0 
(1,080 changes made to ssz)

. 
. **Time to first sulfasalazine script for RA patients
. gen time_to_ssz=(sulfasalazine_date-rheum_appt_date) if sulfasalazine_date!=. & rheum_appt_date!=. & (sulfasalazin
> e_date<=rheum_appt_date+180)
(1,857 missing values generated)

. tabstat time_to_ssz if ra_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_ssz |        13  89.76923       128         1       134
----------------------------------------------------------------

. tabstat time_to_ssz if psa_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_ssz |         0         .         .         .         .
----------------------------------------------------------------

. 
. **Sulfasalazine time categories  
. gen ssz_time=1 if time_to_ssz<=90 & time_to_ssz!=. 
(1,867 missing values generated)

. replace ssz_time=2 if time_to_ssz>90 & time_to_ssz<=180 & time_to_ssz!=.
(10 real changes made)

. replace ssz_time=3 if time_to_ssz>180 | time_to_ssz==.
(1,857 real changes made)

. lab define ssz_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify

. lab val ssz_time ssz_time

. lab var ssz_time "Sulfasalazine in primary care" 

. tab ssz_time if ra_code==1, missing 

  Sulfasalazine in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          4        0.26        0.26
                     3-6 months |          9        0.59        0.85
No prescription within 6 months |      1,513       99.15      100.00
--------------------------------+-----------------------------------
                          Total |      1,526      100.00

. tab ssz_time if psa_code==1, missing

  Sulfasalazine in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
No prescription within 6 months |        192      100.00      100.00
--------------------------------+-----------------------------------
                          Total |        192      100.00

. tab ssz_time if undiff_code==1, missing 

  Sulfasalazine in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          1        4.00        4.00
No prescription within 6 months |         24       96.00      100.00
--------------------------------+-----------------------------------
                          Total |         25      100.00

. 
. **Check if medication issued >once
. gen ssz_shared=1 if ssz==1 & sulfasalazine_count>1
(1,588 missing values generated)

. recode ssz_shared .=0
(1,588 changes made to ssz_shared)

. tab ssz_shared

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,588       84.83       84.83
          1 |        284       15.17      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. **sulfasalazine use (shared care)
. tab ssz_shared if ra_code==1 

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,292       84.67       84.67
          1 |        234       15.33      100.00
------------+-----------------------------------
      Total |      1,526      100.00

. tab ssz_shared if ra_code==1 & (sulfasalazine_date<=rheum_appt_date+180)

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,106       82.91       82.91
          1 |        228       17.09      100.00
------------+-----------------------------------
      Total |      1,334      100.00

. tab ssz_shared if psa_code==1 

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        167       86.98       86.98
          1 |         25       13.02      100.00
------------+-----------------------------------
      Total |        192      100.00

. tab ssz_shared if psa_code==1 & (sulfasalazine_date<=rheum_appt_date+180) 

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        149       85.63       85.63
          1 |         25       14.37      100.00
------------+-----------------------------------
      Total |        174      100.00

. tab ssz_shared if undiff_code==1

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         24       96.00       96.00
          1 |          1        4.00      100.00
------------+-----------------------------------
      Total |         25      100.00

. tab ssz_shared if undiff_code==1 & (sulfasalazine_date<=rheum_appt_date+180)

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         21       95.45       95.45
          1 |          1        4.55      100.00
------------+-----------------------------------
      Total |         22      100.00

. 
. **Check medication issue number
. gen ssz_issue=0 if ssz==1 & sulfasalazine_count==0 
(1,872 missing values generated)

. replace ssz_issue=1 if ssz==1 & sulfasalazine_count==1 
(508 real changes made)

. replace ssz_issue=2 if ssz==1 & sulfasalazine_count>1
(284 real changes made)

. tab ssz_issue

  ssz_issue |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        508       64.14       64.14
          2 |        284       35.86      100.00
------------+-----------------------------------
      Total |        792      100.00

. 
. **Hydroxychloroquine use
. gen hcq=1 if hydroxychloroquine==1
(838 missing values generated)

. recode hcq .=0 
(838 changes made to hcq)

. 
. **Time to first hydroxychloroquine script for RA patients
. gen time_to_hcq=(hydroxychloroquine_date-rheum_appt_date) if hydroxychloroquine_date!=. & rheum_appt_date!=. & (hy
> droxychloroquine_date<=rheum_appt_date+180)
(1,854 missing values generated)

. tabstat time_to_hcq if ra_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_hcq |        16        54      55.5         4       111
----------------------------------------------------------------

. tabstat time_to_hcq if psa_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_hcq |         0         .         .         .         .
----------------------------------------------------------------

. 
. **Hydroxychloroquine time categories  
. gen hcq_time=1 if time_to_hcq<=90 & time_to_hcq!=. 
(1,860 missing values generated)

. replace hcq_time=2 if time_to_hcq>90 & time_to_hcq<=180 & time_to_hcq!=.
(6 real changes made)

. replace hcq_time=3 if time_to_hcq>180 | time_to_hcq==.
(1,854 real changes made)

. lab define hcq_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify

. lab val hcq_time hcq_time

. lab var hcq_time "Hydroxychloroquine in primary care" 

. tab hcq_time if ra_code==1, missing 

  Hydroxychloroquine in primary |
                           care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |         11        0.72        0.72
                     3-6 months |          5        0.33        1.05
No prescription within 6 months |      1,510       98.95      100.00
--------------------------------+-----------------------------------
                          Total |      1,526      100.00

. tab hcq_time if psa_code==1, missing

  Hydroxychloroquine in primary |
                           care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
No prescription within 6 months |        192      100.00      100.00
--------------------------------+-----------------------------------
                          Total |        192      100.00

. tab hcq_time if undiff_code==1, missing 

  Hydroxychloroquine in primary |
                           care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                     3-6 months |          1        4.00        4.00
No prescription within 6 months |         24       96.00      100.00
--------------------------------+-----------------------------------
                          Total |         25      100.00

. 
. **Check if medication issued >once
. gen hcq_shared=1 if hcq==1 & hydroxychloroquine_count>1
(1,360 missing values generated)

. recode hcq_shared .=0
(1,360 changes made to hcq_shared)

. tab hcq_shared

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,360       72.65       72.65
          1 |        512       27.35      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. **hydroxychloroquine use (shared care)
. tab hcq_shared if ra_code==1 

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,106       72.48       72.48
          1 |        420       27.52      100.00
------------+-----------------------------------
      Total |      1,526      100.00

. tab hcq_shared if ra_code==1 & (hydroxychloroquine_date<=rheum_appt_date+180)

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        935       69.93       69.93
          1 |        402       30.07      100.00
------------+-----------------------------------
      Total |      1,337      100.00

. tab hcq_shared if psa_code==1 

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        147       76.56       76.56
          1 |         45       23.44      100.00
------------+-----------------------------------
      Total |        192      100.00

. tab hcq_shared if psa_code==1 & (hydroxychloroquine_date<=rheum_appt_date+180) 

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        130       74.71       74.71
          1 |         44       25.29      100.00
------------+-----------------------------------
      Total |        174      100.00

. tab hcq_shared if undiff_code==1

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         16       64.00       64.00
          1 |          9       36.00      100.00
------------+-----------------------------------
      Total |         25      100.00

. tab hcq_shared if undiff_code==1 & (hydroxychloroquine_date<=rheum_appt_date+180)

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         14       63.64       63.64
          1 |          8       36.36      100.00
------------+-----------------------------------
      Total |         22      100.00

. 
. **Check medication issue number
. gen hcq_issue=0 if hcq==1 & hydroxychloroquine_count==0 
(1,872 missing values generated)

. replace hcq_issue=1 if hcq==1 & hydroxychloroquine_count==1 
(522 real changes made)

. replace hcq_issue=2 if hcq==1 & hydroxychloroquine_count>1
(512 real changes made)

. tab hcq_issue

  hcq_issue |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        522       50.48       50.48
          2 |        512       49.52      100.00
------------+-----------------------------------
      Total |      1,034      100.00

. 
. **Leflunomide use
. gen lef=1 if leflunomide==1
(1,211 missing values generated)

. recode lef .=0 
(1,211 changes made to lef)

. 
. **Time to first leflunomide script for RA patients
. gen time_to_lef=(leflunomide_date-rheum_appt_date) if leflunomide_date!=. & rheum_appt_date!=. & (leflunomide_date
> <=rheum_appt_date+180)
(1,856 missing values generated)

. tabstat time_to_lef if ra_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_lef |        14  95.85714       135        19       154
----------------------------------------------------------------

. tabstat time_to_lef if psa_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_lef |         2      70.5      70.5        26       115
----------------------------------------------------------------

. 
. **Leflunomide time categories  
. gen lef_time=1 if time_to_lef<=90 & time_to_lef!=. 
(1,865 missing values generated)

. replace lef_time=2 if time_to_lef>90 & time_to_lef<=180 & time_to_lef!=.
(9 real changes made)

. replace lef_time=3 if time_to_lef>180 | time_to_lef==.
(1,856 real changes made)

. lab define lef_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify

. lab val lef_time lef_time

. lab var lef_time "Leflunomide in primary care" 

. tab lef_time if ra_code==1, missing 

    Leflunomide in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          6        0.39        0.39
                     3-6 months |          8        0.52        0.92
No prescription within 6 months |      1,512       99.08      100.00
--------------------------------+-----------------------------------
                          Total |      1,526      100.00

. tab lef_time if psa_code==1, missing

    Leflunomide in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          1        0.52        0.52
                     3-6 months |          1        0.52        1.04
No prescription within 6 months |        190       98.96      100.00
--------------------------------+-----------------------------------
                          Total |        192      100.00

. tab lef_time if undiff_code==1, missing 

    Leflunomide in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
No prescription within 6 months |         25      100.00      100.00
--------------------------------+-----------------------------------
                          Total |         25      100.00

. 
. **Check if medication issued >once
. gen lef_shared=1 if lef==1 & leflunomide_count>1
(1,678 missing values generated)

. recode lef_shared .=0
(1,678 changes made to lef_shared)

. tab lef_shared

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,678       89.64       89.64
          1 |        194       10.36      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. **leflunomide use (shared care)
. tab lef_shared if ra_code==1 

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,362       89.25       89.25
          1 |        164       10.75      100.00
------------+-----------------------------------
      Total |      1,526      100.00

. tab lef_shared if ra_code==1 & (leflunomide_date<=rheum_appt_date+180)

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,177       88.16       88.16
          1 |        158       11.84      100.00
------------+-----------------------------------
      Total |      1,335      100.00

. tab lef_shared if psa_code==1 

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        176       91.67       91.67
          1 |         16        8.33      100.00
------------+-----------------------------------
      Total |        192      100.00

. tab lef_shared if psa_code==1 & (leflunomide_date<=rheum_appt_date+180) 

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        160       90.91       90.91
          1 |         16        9.09      100.00
------------+-----------------------------------
      Total |        176      100.00

. tab lef_shared if undiff_code==1

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         23       92.00       92.00
          1 |          2        8.00      100.00
------------+-----------------------------------
      Total |         25      100.00

. tab lef_shared if undiff_code==1 & (leflunomide_date<=rheum_appt_date+180)

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         19       90.48       90.48
          1 |          2        9.52      100.00
------------+-----------------------------------
      Total |         21      100.00

. 
. **Check medication issue number
. gen lef_issue=0 if lef==1 & leflunomide_count==0 
(1,872 missing values generated)

. replace lef_issue=1 if lef==1 & leflunomide_count==1 
(467 real changes made)

. replace lef_issue=2 if lef==1 & leflunomide_count>1
(194 real changes made)

. tab lef_issue

  lef_issue |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        467       70.65       70.65
          2 |        194       29.35      100.00
------------+-----------------------------------
      Total |        661      100.00

. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. gen csdmard_shared=1 if lef_shared==1 | mtx_shared==1 | hcq_shared==1 | ssz_shared==1 
(598 missing values generated)

. recode csdmard_shared .=0
(598 changes made to csdmard_shared)

. tab csdmard_shared

csdmard_sha |
        red |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        598       31.94       31.94
          1 |      1,274       68.06      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab csdmard //for comparison

    csdmard |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        228       12.18       12.18
          1 |      1,644       87.82      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. gen csdmard_num_6m =.
(1,872 missing values generated)

. replace csdmard_num_6m = 0 if (mtx_6m + ssz_6m + hcq_6m + lef_6m ==0)
mtx_6m not found
r(111);

end of do-file

r(111);

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. import delimited "$projectdir/output/dataset.csv", clear
(encoding automatically selected: ISO-8859-1)
(93 vars, 3,474 obs)

. 
. **Set Ado file path
. adopath + "$projectdir/analysis/extra_ados"
  [1]  (BASE)      "C:\Program Files\Stata18\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata18\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "C:\Users\Mark\ado\personal/"
  [5]  (PLUS)      "C:\Users\Mark\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "C:\Users\Mark\OneDrive\PhD Project\OpenSAFELY NEIAA\inflammatory_rheum/analysis/extra_ados"

. 
. **Set index dates ===========================================================*/
. global start_date = "01/04/2016" //for outpatient analyses, data may only be available from April 2019

. global end_date = "31/03/2025"

. global base_year = year(date("$start_date", "DMY"))

. global end_year = year(date("$end_date", "DMY"))

. global max_year = $end_year - $base_year

. 
. **Conversion for dates====================================================*
. 
. ***Variables ending in _date that are string
. ds *_date, has(type string)
eia_code_d~e  copd_befor~e  frac_befor~e  solid_ca_a~e  rf_date       r~eappt_date  metho~j_date  rtt_cl_sta~e
ra_code_date  cva_before~e  dem_before~e  haem_ca_af~e  bmi_date      rheum~e_date  sulfasalaz~e  rtt_cl_ref~e
psa_code_d~e  lung_ca_be~e  chd_after_~e  ckd_after_~e  r~_appt_date  ~erheum_date  hydroxychl~e  rtt_cl_end~e
anksp_code~e  solid_ca_b~e  dm_after_d~e  depr_after~e  rheum~f_date  l~ecode_date  lef_last_d~e  rtt_op_sta~e
undiff_cod~e  haem_ca_be~e  ild_after_~e  osteop_aft~e  rheum~y_date  ~frheum_date  mtx_oral_l~e  rtt_op_ref~e
chd_before~e  ckd_before~e  copd_after~e  frac_after~e  rheum~2_date  l~fcode_date  mtx_inj_la~e  rtt_op_end~e
dm_before_~e  depr_befor~e  cva_after_~e  dem_after_~e  rheum~3_date  leflunomid~e  ssz_last_d~e
ild_before~e  osteop_bef~e  lung_ca_af~e  creatinin~te  rheum~4_date  metho~l_date  hcq_last_d~e

. local string_dates `r(varlist)'

. foreach var of local string_dates {
  2.     gen `var'_num = date(`var', "YMD")
  3.     format `var'_num %td
  4.     order `var'_num, after(`var')
  5.     drop `var'
  6.     rename `var'_num `var'
  7. }
(588 missing values generated)
(3,098 missing values generated)
(3,229 missing values generated)
(3,413 missing values generated)
(3,044 missing values generated)
(3,259 missing values generated)
(3,108 missing values generated)
(3,400 missing values generated)
(3,092 missing values generated)
(3,022 missing values generated)
(700 missing values generated)
(2,410 missing values generated)
(2,988 missing values generated)
(3,324 missing values generated)
(3,421 missing values generated)
(3,471 missing values generated)
(3,059 missing values generated)
(2,915 missing values generated)
(3,240 missing values generated)
(3,083 missing values generated)
(3,364 missing values generated)
(2,997 missing values generated)
(2,911 missing values generated)
(399 missing values generated)
(2,264 missing values generated)
(2,816 missing values generated)
(3,281 missing values generated)
(3,398 missing values generated)
(3,470 missing values generated)
(2,937 missing values generated)
(3,457 missing values generated)
(3,460 missing values generated)
(3,473 missing values generated)
(2,303 missing values generated)
(2,303 missing values generated)
(1,366 missing values generated)
(1,691 missing values generated)
(1,166 missing values generated)
(706 missing values generated)
(3,465 missing values generated)
(3,444 missing values generated)
(2,819 missing values generated)
(1,508 missing values generated)
(3,471 missing values generated)
(3,463 missing values generated)
(2,002 missing values generated)
(911 missing values generated)
(609 missing values generated)
(1,733 missing values generated)
(1,283 missing values generated)
(2,002 missing values generated)
(911 missing values generated)
(609 missing values generated)
(1,733 missing values generated)
(1,283 missing values generated)
(1,382 missing values generated)
(1,382 missing values generated)
(1,382 missing values generated)
(1,350 missing values generated)
(1,350 missing values generated)
(1,350 missing values generated)

. 
. ***Variables ending in _date that are numeric
. foreach var of varlist *_date {
  2.     capture confirm string variable `var'
  3.     if _rc != 0 {
  4.         format `var' %td
  5.     }
  6. }

. 
. ***Create binary indicator for each
. ds *_date
eia_code_d~e  copd_befor~e  frac_befor~e  solid_ca_a~e  rf_date       r~eappt_date  metho~j_date  rtt_cl_sta~e
ra_code_date  cva_before~e  dem_before~e  haem_ca_af~e  bmi_date      rheum~e_date  sulfasalaz~e  rtt_cl_ref~e
psa_code_d~e  lung_ca_be~e  chd_after_~e  ckd_after_~e  r~_appt_date  ~erheum_date  hydroxychl~e  rtt_cl_end~e
anksp_code~e  solid_ca_b~e  dm_after_d~e  depr_after~e  rheum~f_date  l~ecode_date  lef_last_d~e  rtt_op_sta~e
undiff_cod~e  haem_ca_be~e  ild_after_~e  osteop_aft~e  rheum~y_date  ~frheum_date  mtx_oral_l~e  rtt_op_ref~e
chd_before~e  ckd_before~e  copd_after~e  frac_after~e  rheum~2_date  l~fcode_date  mtx_inj_la~e  rtt_op_end~e
dm_before_~e  depr_befor~e  cva_after_~e  dem_after_~e  rheum~3_date  leflunomid~e  ssz_last_d~e
ild_before~e  osteop_bef~e  lung_ca_af~e  creatinin~te  rheum~4_date  metho~l_date  hcq_last_d~e

. local dates `r(varlist)'

. foreach var of local dates {
  2.         local newvar =  substr("`var'", 1, length("`var'") - 5)
  3.         gen `newvar' = (`var'!=. )
  4.         order `newvar', after(`var')
  5. }

. 
. /*
> **Will also need to amend conversion for biologic dates ====================================================*
> ***Some dates are given with month/year only, so adding day 15 to enable them to be processed as dates
> ***Would do this by labelling as _date_hcd then doing similar to above/below, but adding 15 days first
> 
> foreach var of varlist   abatacept_date                                         ///
>                                                  adalimumab_date                                        ///     
>                                                  baricitinib_date                                       ///
>                                                  certolizumab_date                                      ///
>                                                  etanercept_date                                        ///
>                                                  golimumab_date                                         ///
>                                                  guselkumab_date                                        ///     
>                                                  infliximab_date                                        ///
>                                                  ixekizumab_date                                        ///
>                                                  methotrexate_hcd_date                          ///
>                                                  rituximab_date                                         ///
>                                                  sarilumab_date                                         ///
>                                                  secukinumab_date                                       ///     
>                                                  tocilizumab_date                                       ///
>                                                  tofacitinib_date                                       ///
>                                                  upadacitinib_date                                      ///
>                                                  ustekinumab_date                                       ///
>                                                  {
>                                                         
>                 capture confirm string variable `var'
>                 if _rc!=0 {
>                         assert `var'==.
>                         rename `var' `var'_date
>                 }
>         
>                 else {
>                                 replace `var' = `var' + "-15"
>                                 rename `var' `var'_dstr
>                                 replace `var'_dstr = " " if `var'_dstr == "-15"
>                                 gen `var'_date = date(`var'_dstr, "YMD") 
>                                 order `var'_date, after(`var'_dstr)
>                                 drop `var'_dstr
>                 }
>         
>         format `var'_date %td
> }
> */
.                                          
. **Create and label variables ===========================================================*/
. 
. ***Age variables
. *Create categorised age
. drop if age<18 & age !=.
(0 observations deleted)

. drop if age>109 & age !=.
(0 observations deleted)

. drop if age==.
(0 observations deleted)

. lab var age "Age at diagnosis"

. 
. recode age 18/39.9999 = 1 /// 
>            40/49.9999 = 2 ///
>                    50/59.9999 = 3 ///
>                60/69.9999 = 4 ///
>                    70/79.9999 = 5 ///
>                    80/max = 6, gen(agegroup) 
(3,474 differences between age and agegroup)

. 
. label define agegroup   1 "18-39" ///
>                                                 2 "40-49" ///
>                                                 3 "50-59" ///
>                                                 4 "60-69" ///
>                                                 5 "70-79" ///
>                                                 6 "80+"

.                                                 
. label values agegroup agegroup

. lab var agegroup "Age group"

. tab agegroup, missing

  Age group |      Freq.     Percent        Cum.
------------+-----------------------------------
      18-39 |      1,490       42.89       42.89
      40-49 |        497       14.31       57.20
      50-59 |        475       13.67       70.87
      60-69 |        355       10.22       81.09
      70-79 |        272        7.83       88.92
        80+ |        385       11.08      100.00
------------+-----------------------------------
      Total |      3,474      100.00

. order agegroup, after(age)

. 
. ***Sex
. gen male = 1 if sex == "male"
(1,745 missing values generated)

. replace male = 0 if sex == "female"
(1,745 real changes made)

. lab var male "Male"

. lab define male 0 "No" 1 "Yes", modify

. lab val male male

. tab male, missing

       Male |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,745       50.23       50.23
        Yes |      1,729       49.77      100.00
------------+-----------------------------------
      Total |      3,474      100.00

. order male, after(sex)

. 
. ***Ethnicity
. gen ethnicity_n = 1 if ethnicity == "White"
(3,136 missing values generated)

. replace ethnicity_n = 2 if ethnicity == "Asian or Asian British"
(252 real changes made)

. replace ethnicity_n = 3 if ethnicity == "Black or Black British"
(255 real changes made)

. replace ethnicity_n = 4 if ethnicity == "Mixed"
(157 real changes made)

. replace ethnicity_n = 5 if ethnicity == "Chinese or Other Ethnic Groups"
(381 real changes made)

. replace ethnicity_n = 6 if ethnicity == "Unknown"
(2,091 real changes made)

. 
. 
. label define ethnicity_n        1 "White"                                               ///
>                                                         2 "Asian or Asian British"              ///
>                                                         3 "Black or Black British"      ///
>                                                         4 "Mixed"                                               //
> /
>                                                         5 "Chinese or Other Ethnic Groups" ///
>                                                         6 "Not known", modify

.                                                         
. label values ethnicity_n ethnicity_n

. lab var ethnicity_n "Ethnicity"

. tab ethnicity_n, missing

                     Ethnicity |      Freq.     Percent        Cum.
-------------------------------+-----------------------------------
                         White |        338        9.73        9.73
        Asian or Asian British |        252        7.25       16.98
        Black or Black British |        255        7.34       24.32
                         Mixed |        157        4.52       28.84
Chinese or Other Ethnic Groups |        381       10.97       39.81
                     Not known |      2,091       60.19      100.00
-------------------------------+-----------------------------------
                         Total |      3,474      100.00

. drop ethnicity

. rename ethnicity_n ethnicity 

. 
. ***Practice regions
. encode region, gen(nuts_region)

. tab region, missing

                  region |      Freq.     Percent        Cum.
-------------------------+-----------------------------------
                    East |        386       11.11       11.11
           East Midlands |        367       10.56       21.68
                  London |        364       10.48       32.15
              North East |        389       11.20       43.35
              North West |        383       11.02       54.38
              South East |        387       11.14       65.52
              South West |        398       11.46       76.97
           West Midlands |        392       11.28       88.26
Yorkshire and The Humber |        408       11.74      100.00
-------------------------+-----------------------------------
                   Total |      3,474      100.00

. replace region="Not known" if region==""
(0 real changes made)

. gen region_nospace=region

. replace region_nospace="SouthWest" if region=="South West"
(398 real changes made)

. replace region_nospace="EastMidlands" if region=="East Midlands"
(367 real changes made)

. replace region_nospace="East" if region=="East"
(0 real changes made)

. replace region_nospace="London" if region=="London"
(0 real changes made)

. replace region_nospace="NorthEast" if region=="North East"
(389 real changes made)

. replace region_nospace="NorthWest" if region=="North West"
(383 real changes made)

. replace region_nospace="SouthEast" if region=="South East"
(387 real changes made)

. replace region_nospace="WestMidlands" if region=="West Midlands"
(392 real changes made)

. replace region_nospace="YorkshireandTheHumber" if region=="Yorkshire and The Humber"
(408 real changes made)

. 
. ***IMD
. gen imd = 1 if imd_quintile == "1 (most deprived)"
(2,819 missing values generated)

. replace imd = 2 if imd_quintile == "2"
(688 real changes made)

. replace imd = 3 if imd_quintile == "3"
(610 real changes made)

. replace imd = 4 if imd_quintile == "4"
(655 real changes made)

. replace imd = 5 if imd_quintile == "5 (least deprived)"
(656 real changes made)

. replace imd = .u if imd_quintile == "Unknown"
(210 real changes made, 210 to missing)

. lab var imd "Index of multiple deprivation"

. lab define imd 1 "1 (most deprived)" ///
>                            2 "2" ///
>                            3 "3" ///
>                            4 "4" ///
>                            5 "5 (least deprived)" ///
>                            .u "Not known"

. lab val imd imd                    

. tab imd, missing

 Index of multiple |
       deprivation |      Freq.     Percent        Cum.
-------------------+-----------------------------------
 1 (most deprived) |        655       18.85       18.85
                 2 |        688       19.80       38.66
                 3 |        610       17.56       56.22
                 4 |        655       18.85       75.07
5 (least deprived) |        656       18.88       93.96
         Not known |        210        6.04      100.00
-------------------+-----------------------------------
             Total |      3,474      100.00

. drop imd_quintile

. 
. ***Body Mass Index
. *Recode strange values 
. replace bmi_value = . if bmi_value == 0 
(0 real changes made)

. replace bmi_value = . if !inrange(bmi_value, 10, 80)
(0 real changes made)

. 
. *Restrict to within 10 years of EIA diagnosis date and aged>16 
. gen bmi_time = (eia_code_date - bmi_date)/365.25
(3,473 missing values generated)

. gen bmi_age = age - bmi_time
(3,473 missing values generated)

. replace bmi_value = . if bmi_age < 16 
(0 real changes made)

. replace bmi_value = . if bmi_time > 10 & bmi_time != . 
(0 real changes made)

. 
. *Set to missing if no date, and vice versa 
. replace bmi_value = . if bmi_date == . 
(0 real changes made)

. replace bmi_date = . if bmi_value == . 
(0 real changes made)

. replace bmi_time = . if bmi_value == . 
(0 real changes made)

. replace bmi_age = . if bmi_value == . 
(0 real changes made)

. 
. *Create BMI categories
. gen     bmicat = .
(3,474 missing values generated)

. recode  bmicat . = 1 if bmi_value < 18.5
(0 changes made to bmicat)

. recode  bmicat . = 2 if bmi_value < 25
(1 changes made to bmicat)

. recode  bmicat . = 3 if bmi_value < 30
(0 changes made to bmicat)

. recode  bmicat . = 4 if bmi_value < 35
(0 changes made to bmicat)

. recode  bmicat . = 5 if bmi_value < 40
(0 changes made to bmicat)

. recode  bmicat . = 6 if bmi_value < .
(0 changes made to bmicat)

. replace bmicat = .u if bmi_value >= .
(3,473 real changes made, 3,473 to missing)

. 
. label define bmicat 1 "Underweight (<18.5)"     ///
>                                         2 "Normal (18.5-24.9)"          ///
>                                         3 "Overweight (25-29.9)"        ///
>                                         4 "Obese I (30-34.9)"           ///
>                                         5 "Obese II (35-39.9)"          ///
>                                         6 "Obese III (40+)"                     ///
>                                         .u "Not known"

.                                         
. label values bmicat bmicat

. lab var bmicat "BMI"

. tab bmicat, missing

                 BMI |      Freq.     Percent        Cum.
---------------------+-----------------------------------
  Normal (18.5-24.9) |          1        0.03        0.03
           Not known |      3,473       99.97      100.00
---------------------+-----------------------------------
               Total |      3,474      100.00

. order bmicat, after (bmi_value)

. drop bmi_age bmi_time

. 
. *Create less granular categorisation
. recode bmicat 1/3 .u = 1 4 = 2 5 = 3 6 = 4, gen(obese4cat)
(3,474 differences between bmicat and obese4cat)

. 
. label define obese4cat  1 "No record of obesity"        ///
>                                                 2 "Obese I (30-34.9)"           ///
>                                                 3 "Obese II (35-39.9)"          ///
>                                                 4 "Obese III (40+)"             

. 
. label values obese4cat obese4cat

. order obese4cat, after(bmicat)

. 
. ***Smoking 
. label define smoke 1 "Never" 2 "Former" 3 "Current" .u "Not known"

. 
. gen     smoke = 1  if smoking_status == "N"
(3,434 missing values generated)

. replace smoke = 2  if smoking_status == "E"
(1,342 real changes made)

. replace smoke = 3  if smoking_status == "S"
(2,086 real changes made)

. replace smoke = .u if smoking_status == "M"
(6 real changes made, 6 to missing)

. replace smoke = .u if smoking_status == "" 
(0 real changes made)

. 
. label values smoke smoke

. lab var smoke "Smoking status"

. drop smoking_status

. tab smoke, missing

    Smoking |
     status |      Freq.     Percent        Cum.
------------+-----------------------------------
      Never |         40        1.15        1.15
     Former |      1,342       38.63       39.78
    Current |      2,086       60.05       99.83
  Not known |          6        0.17      100.00
------------+-----------------------------------
      Total |      3,474      100.00

. 
. *Create non-missing 3-category variable for current smoking (assumes missing smoking is never smoking)
. recode smoke .u = 1, gen(smoke_nomiss)
(6 differences between smoke and smoke_nomiss)

. order smoke_nomiss, after(smoke)

. label values smoke_nomiss smoke

. 
. **Clinical comorbidities
. ***Nb. not using creatinine of HBA1c values for now, just codes
. foreach disease in ckd dm ild copd cva lung_ca solid_ca haem_ca depr osteop frac dem chd {
  2.         label define `disease'_before 0 "No" 1 "Yes"
  3.         label values `disease'_before `disease'_before
  4.         tab `disease'_before, missing
  5.         label define `disease'_after 0 "No" 1 "Yes"
  6.         label values `disease'_after `disease'_after
  7.         tab `disease'_after, missing
  8.         gen `disease'_new = 1 if (`disease'_after == 1 & `disease'_before == 0)
  9.         recode `disease'_new .=0
 10.         label define `disease'_new 0 "No" 1 "Yes"
 11.         label values `disease'_new `disease'_new
 12.         tab `disease'_new, missing
 13.         order `disease'_new, after(`disease'_after)
 14. }

 ckd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,988       86.01       86.01
        Yes |        486       13.99      100.00
------------+-----------------------------------
      Total |      3,474      100.00

  ckd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,816       81.06       81.06
        Yes |        658       18.94      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(2,895 missing values generated)
(2,895 changes made to ckd_new)

    ckd_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,895       83.33       83.33
        Yes |        579       16.67      100.00
------------+-----------------------------------
      Total |      3,474      100.00

  dm_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,259       93.81       93.81
        Yes |        215        6.19      100.00
------------+-----------------------------------
      Total |      3,474      100.00

   dm_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,240       93.26       93.26
        Yes |        234        6.74      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(3,251 missing values generated)
(3,251 changes made to dm_new)

     dm_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,251       93.58       93.58
        Yes |        223        6.42      100.00
------------+-----------------------------------
      Total |      3,474      100.00

 ild_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,108       89.46       89.46
        Yes |        366       10.54      100.00
------------+-----------------------------------
      Total |      3,474      100.00

  ild_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,083       88.74       88.74
        Yes |        391       11.26      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(3,110 missing values generated)
(3,110 changes made to ild_new)

    ild_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,110       89.52       89.52
        Yes |        364       10.48      100.00
------------+-----------------------------------
      Total |      3,474      100.00

copd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,400       97.87       97.87
        Yes |         74        2.13      100.00
------------+-----------------------------------
      Total |      3,474      100.00

 copd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,364       96.83       96.83
        Yes |        110        3.17      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(3,365 missing values generated)
(3,365 changes made to copd_new)

   copd_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,365       96.86       96.86
        Yes |        109        3.14      100.00
------------+-----------------------------------
      Total |      3,474      100.00

 cva_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,092       89.00       89.00
        Yes |        382       11.00      100.00
------------+-----------------------------------
      Total |      3,474      100.00

  cva_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,997       86.27       86.27
        Yes |        477       13.73      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(3,038 missing values generated)
(3,038 changes made to cva_new)

    cva_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,038       87.45       87.45
        Yes |        436       12.55      100.00
------------+-----------------------------------
      Total |      3,474      100.00

lung_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,022       86.99       86.99
        Yes |        452       13.01      100.00
------------+-----------------------------------
      Total |      3,474      100.00

lung_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,911       83.79       83.79
        Yes |        563       16.21      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(2,965 missing values generated)
(2,965 changes made to lung_ca_new)

lung_ca_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,965       85.35       85.35
        Yes |        509       14.65      100.00
------------+-----------------------------------
      Total |      3,474      100.00

solid_ca_be |
       fore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        700       20.15       20.15
        Yes |      2,774       79.85      100.00
------------+-----------------------------------
      Total |      3,474      100.00

solid_ca_af |
        ter |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        399       11.49       11.49
        Yes |      3,075       88.51      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(2,846 missing values generated)
(2,846 changes made to solid_ca_new)

solid_ca_ne |
          w |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,846       81.92       81.92
        Yes |        628       18.08      100.00
------------+-----------------------------------
      Total |      3,474      100.00

haem_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,410       69.37       69.37
        Yes |      1,064       30.63      100.00
------------+-----------------------------------
      Total |      3,474      100.00

haem_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,264       65.17       65.17
        Yes |      1,210       34.83      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(2,576 missing values generated)
(2,576 changes made to haem_ca_new)

haem_ca_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,576       74.15       74.15
        Yes |        898       25.85      100.00
------------+-----------------------------------
      Total |      3,474      100.00

depr_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,324       95.68       95.68
        Yes |        150        4.32      100.00
------------+-----------------------------------
      Total |      3,474      100.00

 depr_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,281       94.44       94.44
        Yes |        193        5.56      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(3,291 missing values generated)
(3,291 changes made to depr_new)

   depr_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,291       94.73       94.73
        Yes |        183        5.27      100.00
------------+-----------------------------------
      Total |      3,474      100.00

osteop_befo |
         re |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,421       98.47       98.47
        Yes |         53        1.53      100.00
------------+-----------------------------------
      Total |      3,474      100.00

osteop_afte |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,398       97.81       97.81
        Yes |         76        2.19      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(3,399 missing values generated)
(3,399 changes made to osteop_new)

 osteop_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,399       97.84       97.84
        Yes |         75        2.16      100.00
------------+-----------------------------------
      Total |      3,474      100.00

frac_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,471       99.91       99.91
        Yes |          3        0.09      100.00
------------+-----------------------------------
      Total |      3,474      100.00

 frac_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,470       99.88       99.88
        Yes |          4        0.12      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(3,470 missing values generated)
(3,470 changes made to frac_new)

   frac_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,470       99.88       99.88
        Yes |          4        0.12      100.00
------------+-----------------------------------
      Total |      3,474      100.00

 dem_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,059       88.05       88.05
        Yes |        415       11.95      100.00
------------+-----------------------------------
      Total |      3,474      100.00

  dem_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,937       84.54       84.54
        Yes |        537       15.46      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(2,996 missing values generated)
(2,996 changes made to dem_new)

    dem_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,996       86.24       86.24
        Yes |        478       13.76      100.00
------------+-----------------------------------
      Total |      3,474      100.00

 chd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,044       87.62       87.62
        Yes |        430       12.38      100.00
------------+-----------------------------------
      Total |      3,474      100.00

  chd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,915       83.91       83.91
        Yes |        559       16.09      100.00
------------+-----------------------------------
      Total |      3,474      100.00
(2,970 missing values generated)
(2,970 changes made to chd_new)

    chd_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,970       85.49       85.49
        Yes |        504       14.51      100.00
------------+-----------------------------------
      Total |      3,474      100.00

. 
. lab var ckd_before "Chronic kidney disease"

. lab var ckd_after "Chronic kidney disease"

. lab var ckd_new "Chronic kidney disease"

. lab var dm_before "Type 2 diabetes mellitus"

. lab var dm_after "Type 2 diabetes mellitus"

. lab var dm_new "Type 2 diabetes mellitus"

. lab var ild_before "Interstitial lung disease"

. lab var ild_after "Interstitial lung disease"

. lab var ild_new "Interstitial lung disease"

. lab var copd_before "COPD"

. lab var copd_after "COPD"

. lab var copd_new "COPD"

. lab var lung_ca_before "Lung cancer"

. lab var lung_ca_after "Lung cancer"

. lab var lung_ca_new "Lung cancer"

. lab var solid_ca_before "Solid organ cancer"

. lab var solid_ca_after "Solid organ cancer"

. lab var solid_ca_new "Solid organ cancer"

. lab var haem_ca_before "Haematological cancer"

. lab var haem_ca_after "Haematological cancer"

. lab var haem_ca_new "Haematological cancer"

. lab var depr_before "Depression"

. lab var depr_after "Depression"

. lab var depr_new "Depression"

. lab var osteop_before "Osteoporosis"

. lab var osteop_after "Osteoporosis"

. lab var osteop_new "Osteoporosis"

. lab var frac_before "Fragility fracture"

. lab var frac_after "Fragility fracture"

. lab var frac_new "Fragility fracture"

. lab var dem_before "Dementia"

. lab var dem_after "Dementia"

. lab var dem_new "Dementia"

. lab var chd_before "Coronary heart disease"

. lab var chd_after "Coronary heart disease"

. lab var chd_new "Coronary heart disease"

. 
. lab var rheum_appt "Rheumatology appointment"

. lab define rheum_appt 0 "No" 1 "Yes", modify

. lab val rheum_appt rheum_appt

. 
. **All patients should have diagnostic code=============================================================*/
. tab eia_code, missing

   eia_code |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      3,474      100.00      100.00
------------+-----------------------------------
      Total |      3,474      100.00

. keep if eia_code==1
(0 observations deleted)

. 
. **Check first rheum appt date was before diagnostic code date==================================*/
. 
. tab rheum_appt, missing //proportion of patients with an rheum outpatient date (with first attendance option selec
> ted) in the 12 months before EIA code appeared in GP record; data only April 2019 onwards

Rheumatolog |
          y |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      2,303       66.29       66.29
        Yes |      1,171       33.71      100.00
------------+-----------------------------------
      Total |      3,474      100.00

. tab rheum_appt if rheum_appt_date>eia_code_date & rheum_appt_date!=. //confirm proportion who had first rheum appt
>  (i.e. not missing) after EIA code

Rheumatolog |
          y |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |        182      100.00      100.00
------------+-----------------------------------
      Total |        182      100.00

. tab rheum_appt if rheum_appt_date>(eia_code_date + 30) & rheum_appt_date!=. //confirm proportion who had first rhe
> um appt 30 days after EIA code 

Rheumatolog |
          y |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |         97      100.00      100.00
------------+-----------------------------------
      Total |         97      100.00

. tab rheum_appt if rheum_appt_date>(eia_code_date + 60) & rheum_appt_date!=. //confirm proportion who had first rhe
> um appt 60 days after EIA code - should be none
no observations

. replace rheum_appt=0 if rheum_appt_date>(eia_code_date + 60) & rheum_appt_date!=. //replace as missing if first ap
> pt >60 days after EIA code - should be none
(0 real changes made)

. replace rheum_appt_date=. if rheum_appt_date>(eia_code_date + 60) & rheum_appt_date!=. //replace as missing if fir
> st appt >60 days after EIA code - should be none
(0 real changes made)

. 
. **As above - for differently specified rheumatology appointments
. replace rheum_appt_any=0 if rheum_appt_any_date>(eia_code_date + 60) & rheum_appt_any_date!=. //replace as missing
>  those appts >60 days after EIA code
(0 real changes made)

. replace rheum_appt_any_date=. if rheum_appt_any_date>(eia_code_date + 60) & rheum_appt_any_date!=. //replace as mi
> ssing those appts >60 days after EIA code
(0 real changes made)

. replace rheum_appt2=0 if rheum_appt2_date>(eia_code_date + 60) & rheum_appt2_date!=. //replace as missing those ap
> pts >60 days after EIA code
(0 real changes made)

. replace rheum_appt2_date=. if rheum_appt2_date>(eia_code_date + 60) & rheum_appt2_date!=. //replace as missing tho
> se appts >60 days after EIA code_yea
(0 real changes made)

. replace rheum_appt3=0 if rheum_appt3_date>(eia_code_date + 60) & rheum_appt3_date!=. //replace as missing those ap
> pts >60 days after EIA code
(0 real changes made)

. replace rheum_appt3_date=. if rheum_appt3_date>(eia_code_date + 60) & rheum_appt3_date!=. //replace as missing tho
> se appts >60 days after EIA code
(0 real changes made)

. replace rheum_appt4=0 if rheum_appt4_date>(eia_code_date + 60) & rheum_appt4_date!=. //replace as missing those ap
> pts >60 days after EIA code - THIS IS AN IMPORTANT ONE TO CHECK
(460 real changes made)

. replace rheum_appt4_date=. if rheum_appt4_date>(eia_code_date + 60) & rheum_appt4_date!=. //replace as missing tho
> se appts >60 days after EIA code
(460 real changes made, 460 to missing)

. 
. *Check if first csDMARD/biologic was after rheum appt date=====================================================*/
. **csDMARDs (not including high cost MTX; wouldn't be shared care)
. gen csdmard=1 if hydroxychloroquine==1 | leflunomide==1 | methotrexate_oral==1 | methotrexate_inj==1 | sulfasalazi
> ne==1
(228 missing values generated)

. recode csdmard .=0 
(228 changes made to csdmard)

. tab csdmard, missing

    csdmard |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        228        6.56        6.56
          1 |      3,246       93.44      100.00
------------+-----------------------------------
      Total |      3,474      100.00

. 
. **Date of first csDMARD script (not including high cost MTX prescriptions)
. gen csdmard_date=min(hydroxychloroquine_date, leflunomide_date, methotrexate_oral_date, methotrexate_inj_date, sul
> fasalazine_date)
(228 missing values generated)

. format %td csdmard_date

. 
. **Generate combined methotrexate (primary care only)
. gen mtx = 1 if methotrexate_oral==1 | methotrexate_inj==1
(363 missing values generated)

. recode mtx .=0
(363 changes made to mtx)

. lab var mtx "Methotrexate"

. gen mtx_date = min(methotrexate_oral_date, methotrexate_inj_date) if mtx == 1
(363 missing values generated)

. format %td mtx_date

. 
. **Exclude if first csdmard was more than 60 days before first rheum appt
. tab csdmard if rheum_appt_date!=. & csdmard_date!=. & csdmard_date<rheum_appt_date

    csdmard |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        949      100.00      100.00
------------+-----------------------------------
      Total |        949      100.00

. tab csdmard if rheum_appt_date!=. & csdmard_date!=. & (csdmard_date + 60)<rheum_appt_date 

    csdmard |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        921      100.00      100.00
------------+-----------------------------------
      Total |        921      100.00

. gen pre_ra_csdmard_time = (rheum_appt_date - csdmard_date) if rheum_appt_date!=. & csdmard_date!=. & csdmard_date<
> rheum_appt_date
(2,525 missing values generated)

. tabstat pre_ra_csdmard_time, stats (n mean p50 p25 p75) // how long before were csdmards prescribed

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
pre_ra_csd~e |       949  695.8335       600       320       956
----------------------------------------------------------------

. tab mtx if rheum_appt_date!=. & mtx_date!=. & (mtx_date + 60)<rheum_appt_date 

Methotrexat |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        799      100.00      100.00
------------+-----------------------------------
      Total |        799      100.00

. tab hydroxychloroquine if rheum_appt_date!=. & hydroxychloroquine_date!=. & (hydroxychloroquine_date + 60)<rheum_a
> ppt_date 

hydroxychlo |
    roquine |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        382      100.00      100.00
------------+-----------------------------------
      Total |        382      100.00

. tab sulfasalazine if rheum_appt_date!=. & sulfasalazine_date!=. & (sulfasalazine_date + 60)<rheum_appt_date 

sulfasalazi |
         ne |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        285      100.00      100.00
------------+-----------------------------------
      Total |        285      100.00

. tab leflunomide if rheum_appt_date!=. & leflunomide_date!=. & (leflunomide_date + 60)<rheum_appt_date 

leflunomide |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        221      100.00      100.00
------------+-----------------------------------
      Total |        221      100.00

. drop if rheum_appt_date!=. & csdmard_date!=. & (csdmard_date + 60)<rheum_appt_date //drop if first csDMARD more th
> an 60 days before first attendance at a rheum appt 
(921 observations deleted)

. tab csdmard if rheum_appt_date==. & rheum_appt_any_date!=. & csdmard_date!=. & (csdmard_date + 60)<rheum_appt_any_
> date

    csdmard |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        681      100.00      100.00
------------+-----------------------------------
      Total |        681      100.00

. drop if rheum_appt_date==. & rheum_appt_any_date!=. & csdmard_date!=. & (csdmard_date + 60)<rheum_appt_any_date //
> drop if first csDMARD more than 60 days before first captured rheum appt that did not have first attendance tag
(681 observations deleted)

. 
. /*
> **csDMARDs (including high cost MTX)
> gen csdmard_hcd=1 if hydroxychloroquine==1 | leflunomide==1 | methotrexate==1 | methotrexate_hcd==1 | sulfasalazin
> e==1
> recode csdmard_hcd .=0 
> tab csdmard_hcd, missing
> 
> **Date of first csDMARD script (including high cost MTX prescriptions)
> gen csdmard_hcd_date=min(hydroxychloroquine_date, leflunomide_date, methotrexate_date, methotrexate_hcd_date, sulf
> asalazine_date)
> format %td csdmard_hcd_date
> 
> **Biologic use
> gen biologic=1 if abatacept==1 | adalimumab==1 | baricitinib==1 | certolizumab==1 | etanercept==1 | golimumab==1 |
>  guselkumab==1 | infliximab==1 | ixekizumab==1 | rituximab==1 | sarilumab==1 | secukinumab==1 | tocilizumab==1 | t
> ofacitinib==1 | upadacitinib==1 | ustekinumab==1 
> recode biologic .=0
> tab biologic, missing
> 
> **Date of first biologic script
> gen biologic_date=min(abatacept_date, adalimumab_date, baricitinib_date, certolizumab_date, etanercept_date, golim
> umab_date, guselkumab_date, infliximab_date, ixekizumab_date, rituximab_date, sarilumab_date, secukinumab_date, to
> cilizumab_date, tofacitinib_date, upadacitinib_date, ustekinumab_date)
> format %td biologic_date
> 
> tab biologic if rheum_appt_date!=. & biologic_date!=. & biologic_date<rheum_appt_date 
> tab biologic if rheum_appt_date!=. & biologic_date!=. & (biologic_date + 60)<rheum_appt_date 
> drop if rheum_appt_date!=. & biologic_date!=. & (biologic_date + 60)<rheum_appt_date //drop if first biologic more
>  than 60 days before first rheum_appt_date
> tab biologic if rheum_appt_date==. & rheum_appt_any_date!=. & biologic_date!=. & (biologic_date + 60)<rheum_appt_a
> ny_date
> drop if rheum_appt_date==. & rheum_appt_any_date!=. & biologic_date!=. & (biologic_date + 60)<rheum_appt_any_date 
> //drop if first biologic more than 60 days before first captured rheum appt that did not have first attendance tag
> */
. 
. *Generate diagnosis date===============================================================*/
. 
. **Use diagnostic code date (in GP record) as diagnosis date
. gen diagnosis_date=eia_code_date

. format diagnosis_date %td

. 
. *Refine diagnostic window=============================================================*/
. 
. **Keep patients with diagnosis date after start date and before end date - should be none dropped
. keep if diagnosis_date>=date("$start_date", "DMY") & diagnosis_date!=. 
(0 observations deleted)

. tab eia_code, missing

   eia_code |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      1,872      100.00      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. keep if diagnosis_date<=date("$end_date", "DMY") & diagnosis_date!=. 
(0 observations deleted)

. tab eia_code, missing

   eia_code |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      1,872      100.00      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. *Include only most recent EIA sub-diagnosis=============================================*/
. replace ra_code =0 if psa_code_date > ra_code_date & psa_code_date !=.
(16 real changes made)

. replace ra_code =0 if anksp_code_date > ra_code_date & anksp_code_date !=.
(13 real changes made)

. replace ra_code =0 if undiff_code_date > ra_code_date & undiff_code_date !=.
(3 real changes made)

. replace psa_code =0 if ra_code_date >= psa_code_date & ra_code_date !=.
(15 real changes made)

. replace psa_code =0 if anksp_code_date > psa_code_date & anksp_code_date !=.
(0 real changes made)

. replace psa_code =0 if undiff_code_date > psa_code_date & undiff_code_date !=.
(0 real changes made)

. replace anksp_code =0 if psa_code_date >= anksp_code_date & psa_code_date !=.
(1 real change made)

. replace anksp_code =0 if ra_code_date >= anksp_code_date & ra_code_date !=.
(7 real changes made)

. replace anksp_code =0 if undiff_code_date > anksp_code_date & undiff_code_date !=.
(0 real changes made)

. replace undiff_code =0 if ra_code_date >= undiff_code_date & ra_code_date !=.
(2 real changes made)

. replace undiff_code =0 if psa_code_date >= undiff_code_date & psa_code_date !=.
(1 real change made)

. replace undiff_code =0 if anksp_code_date >= undiff_code_date & anksp_code_date !=.
(0 real changes made)

. gen eia_diagnosis=1 if ra_code==1
(346 missing values generated)

. replace eia_diagnosis=2 if psa_code==1
(192 real changes made)

. replace eia_diagnosis=3 if anksp_code==1
(129 real changes made)

. replace eia_diagnosis=4 if undiff_code==1
(25 real changes made)

. lab define eia_diagnosis 1 "RA" 2 "PsA" 3 "AxSpA" 4 "Undiff IA", modify

. lab val eia_diagnosis eia_diagnosis

. tab eia_diagnosis, missing

eia_diagnos |
         is |      Freq.     Percent        Cum.
------------+-----------------------------------
         RA |      1,526       81.52       81.52
        PsA |        192       10.26       91.77
      AxSpA |        129        6.89       98.66
  Undiff IA |         25        1.34      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. drop if eia_diagnosis==. //should be none
(0 observations deleted)

. 
. decode eia_diagnosis, gen(eia_diag)

. replace eia_diag="Undiff_IA" if eia_diagnosis==4
(25 real changes made)

. 
. *Split into time windows=========================================*/
. 
. **Month/Year of GP diagnostic code
. gen year_diag=year(eia_code_date)

. format year_diag %ty

. gen month_diag=month(eia_code_date)

. gen mo_year_diagn=ym(year_diag, month_diag)

. format mo_year_diagn %tmMon-CCYY

. generate str16 mo_year_diagn_s = strofreal(mo_year_diagn,"%tmCCYY!mNN")

. lab var mo_year_diagn "Month/Year of Diagnosis"

. lab var mo_year_diagn_s "Month/Year of Diagnosis"

. 
. **Month/Year of rheum appt
. gen year_appt=year(rheum_appt_date) if rheum_appt_date!=.
(1,622 missing values generated)

. format year_appt %ty

. gen month_appt=month(rheum_appt_date) if rheum_appt_date!=. 
(1,622 missing values generated)

. gen mo_year_appt=ym(year_appt, month_appt)
(1,622 missing values generated)

. format mo_year_appt %tmMon-CCYY

. generate str16 mo_year_appt_s = strofreal(mo_year_appt,"%tmCCYY!mNN")

. 
. **Separate into 3-month time windows (for diagnosis date)
. gen diagnosis_3m = qofd(diagnosis_date)

. format diagnosis_3m %tq

. lab var diagnosis_3m "Time period for diagnosis"

. tab diagnosis_3m, missing

Time period |
        for |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
     2016q2 |          9        0.48        0.48
     2016q3 |          4        0.21        0.69
     2016q4 |         11        0.59        1.28
     2017q1 |          5        0.27        1.55
     2017q2 |         18        0.96        2.51
     2017q3 |         10        0.53        3.04
     2017q4 |          9        0.48        3.53
     2018q1 |          9        0.48        4.01
     2018q2 |          8        0.43        4.43
     2018q3 |         13        0.69        5.13
     2018q4 |          8        0.43        5.56
     2019q1 |         10        0.53        6.09
     2019q2 |         18        0.96        7.05
     2019q3 |         14        0.75        7.80
     2019q4 |         14        0.75        8.55
     2020q1 |          9        0.48        9.03
     2020q2 |         16        0.85        9.88
     2020q3 |         14        0.75       10.63
     2020q4 |         28        1.50       12.13
     2021q1 |         19        1.01       13.14
     2021q2 |         26        1.39       14.53
     2021q3 |         34        1.82       16.35
     2021q4 |         27        1.44       17.79
     2022q1 |         38        2.03       19.82
     2022q2 |         50        2.67       22.49
     2022q3 |         55        2.94       25.43
     2022q4 |         79        4.22       29.65
     2023q1 |         95        5.07       34.72
     2023q2 |        101        5.40       40.12
     2023q3 |        130        6.94       47.06
     2023q4 |        132        7.05       54.11
     2024q1 |        167        8.92       63.03
     2024q2 |        160        8.55       71.58
     2024q3 |        170        9.08       80.66
     2024q4 |        176        9.40       90.06
     2025q1 |        186        9.94      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. bys eia_diagnosis: tab diagnosis_3m, missing

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = RA

Time period |
        for |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
     2016q2 |          6        0.39        0.39
     2016q3 |          4        0.26        0.66
     2016q4 |         10        0.66        1.31
     2017q1 |          4        0.26        1.57
     2017q2 |         15        0.98        2.56
     2017q3 |          7        0.46        3.01
     2017q4 |          7        0.46        3.47
     2018q1 |          8        0.52        4.00
     2018q2 |          7        0.46        4.46
     2018q3 |         13        0.85        5.31
     2018q4 |          6        0.39        5.70
     2019q1 |          9        0.59        6.29
     2019q2 |         15        0.98        7.27
     2019q3 |         10        0.66        7.93
     2019q4 |         11        0.72        8.65
     2020q1 |          6        0.39        9.04
     2020q2 |         10        0.66        9.70
     2020q3 |         11        0.72       10.42
     2020q4 |         24        1.57       11.99
     2021q1 |         13        0.85       12.84
     2021q2 |         20        1.31       14.15
     2021q3 |         28        1.83       15.99
     2021q4 |         20        1.31       17.30
     2022q1 |         29        1.90       19.20
     2022q2 |         37        2.42       21.63
     2022q3 |         46        3.01       24.64
     2022q4 |         63        4.13       28.77
     2023q1 |         78        5.11       33.88
     2023q2 |         85        5.57       39.45
     2023q3 |        107        7.01       46.46
     2023q4 |        116        7.60       54.06
     2024q1 |        128        8.39       62.45
     2024q2 |        132        8.65       71.10
     2024q3 |        142        9.31       80.41
     2024q4 |        147        9.63       90.04
     2025q1 |        152        9.96      100.00
------------+-----------------------------------
      Total |      1,526      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = PsA

Time period |
        for |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
     2016q2 |          1        0.52        0.52
     2016q4 |          1        0.52        1.04
     2017q1 |          1        0.52        1.56
     2017q2 |          3        1.56        3.12
     2017q3 |          1        0.52        3.65
     2017q4 |          2        1.04        4.69
     2018q1 |          1        0.52        5.21
     2018q4 |          1        0.52        5.73
     2019q2 |          3        1.56        7.29
     2019q3 |          2        1.04        8.33
     2020q1 |          2        1.04        9.37
     2020q2 |          4        2.08       11.46
     2020q3 |          2        1.04       12.50
     2020q4 |          3        1.56       14.06
     2021q1 |          2        1.04       15.10
     2021q2 |          2        1.04       16.15
     2021q3 |          3        1.56       17.71
     2021q4 |          5        2.60       20.31
     2022q1 |          5        2.60       22.92
     2022q2 |          9        4.69       27.60
     2022q3 |          6        3.12       30.73
     2022q4 |          8        4.17       34.90
     2023q1 |          6        3.12       38.02
     2023q2 |          5        2.60       40.62
     2023q3 |         14        7.29       47.92
     2023q4 |         11        5.73       53.65
     2024q1 |         20       10.42       64.06
     2024q2 |         18        9.38       73.44
     2024q3 |         16        8.33       81.77
     2024q4 |         18        9.38       91.15
     2025q1 |         17        8.85      100.00
------------+-----------------------------------
      Total |        192      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = AxSpA

Time period |
        for |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
     2016q2 |          1        0.78        0.78
     2017q3 |          1        0.78        1.55
     2018q4 |          1        0.78        2.33
     2019q3 |          2        1.55        3.88
     2019q4 |          2        1.55        5.43
     2020q1 |          1        0.78        6.20
     2020q2 |          2        1.55        7.75
     2020q3 |          1        0.78        8.53
     2020q4 |          1        0.78        9.30
     2021q1 |          3        2.33       11.63
     2021q2 |          3        2.33       13.95
     2021q3 |          2        1.55       15.50
     2021q4 |          2        1.55       17.05
     2022q1 |          4        3.10       20.16
     2022q2 |          4        3.10       23.26
     2022q3 |          3        2.33       25.58
     2022q4 |          8        6.20       31.78
     2023q1 |          8        6.20       37.98
     2023q2 |         11        8.53       46.51
     2023q3 |          5        3.88       50.39
     2023q4 |          5        3.88       54.26
     2024q1 |         18       13.95       68.22
     2024q2 |          9        6.98       75.19
     2024q3 |          9        6.98       82.17
     2024q4 |          9        6.98       89.15
     2025q1 |         14       10.85      100.00
------------+-----------------------------------
      Total |        129      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = Undiff IA

Time period |
        for |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
     2016q2 |          1        4.00        4.00
     2017q3 |          1        4.00        8.00
     2018q2 |          1        4.00       12.00
     2019q1 |          1        4.00       16.00
     2019q4 |          1        4.00       20.00
     2021q1 |          1        4.00       24.00
     2021q2 |          1        4.00       28.00
     2021q3 |          1        4.00       32.00
     2023q1 |          3       12.00       44.00
     2023q3 |          4       16.00       60.00
     2024q1 |          1        4.00       64.00
     2024q2 |          1        4.00       68.00
     2024q3 |          3       12.00       80.00
     2024q4 |          2        8.00       88.00
     2025q1 |          3       12.00      100.00
------------+-----------------------------------
      Total |         25      100.00


. 
. **Separate into 12-month time windows (for diagnosis date)
. gen diagnosis_year = (floor((diagnosis_date - date("$start_date", "DMY")) / 365.25) + 1) if inrange(diagnosis_date
> , date("$start_date", "DMY"), date("$end_date", "DMY"))

. lab var diagnosis_year "Year of diagnosis"

. forvalues i = 1/$max_year {
  2.     local start = $base_year + `i' - 1
  3.     local end = `start' + 1
  4.     label define diagnosis_year_lbl `i' "Apr `start'–Mar `end'", add
  5. }

. lab val diagnosis_year diagnosis_year_lbl

. tab diagnosis_year, missing

Year of diagnosis |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |         29        1.55        1.55
Apr 2017–Mar 2018 |         46        2.46        4.01
Apr 2018–Mar 2019 |         40        2.14        6.14
Apr 2019–Mar 2020 |         54        2.88        9.03
Apr 2020–Mar 2021 |         78        4.17       13.19
Apr 2021–Mar 2022 |        124        6.62       19.82
Apr 2022–Mar 2023 |        279       14.90       34.72
Apr 2023–Mar 2024 |        530       28.31       63.03
Apr 2024–Mar 2025 |        692       36.97      100.00
------------------+-----------------------------------
            Total |      1,872      100.00

. bys eia_diagnosis: tab diagnosis_year, missing

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = RA

Year of diagnosis |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |         24        1.57        1.57
Apr 2017–Mar 2018 |         37        2.42        4.00
Apr 2018–Mar 2019 |         36        2.36        6.36
Apr 2019–Mar 2020 |         41        2.69        9.04
Apr 2020–Mar 2021 |         59        3.87       12.91
Apr 2021–Mar 2022 |         96        6.29       19.20
Apr 2022–Mar 2023 |        224       14.68       33.88
Apr 2023–Mar 2024 |        436       28.57       62.45
Apr 2024–Mar 2025 |        573       37.55      100.00
------------------+-----------------------------------
            Total |      1,526      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = PsA

Year of diagnosis |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |          3        1.56        1.56
Apr 2017–Mar 2018 |          7        3.65        5.21
Apr 2018–Mar 2019 |          1        0.52        5.73
Apr 2019–Mar 2020 |          7        3.65        9.38
Apr 2020–Mar 2021 |         11        5.73       15.10
Apr 2021–Mar 2022 |         15        7.81       22.92
Apr 2022–Mar 2023 |         29       15.10       38.02
Apr 2023–Mar 2024 |         50       26.04       64.06
Apr 2024–Mar 2025 |         69       35.94      100.00
------------------+-----------------------------------
            Total |        192      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = AxSpA

Year of diagnosis |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |          1        0.78        0.78
Apr 2017–Mar 2018 |          1        0.78        1.55
Apr 2018–Mar 2019 |          1        0.78        2.33
Apr 2019–Mar 2020 |          5        3.88        6.20
Apr 2020–Mar 2021 |          7        5.43       11.63
Apr 2021–Mar 2022 |         11        8.53       20.16
Apr 2022–Mar 2023 |         23       17.83       37.98
Apr 2023–Mar 2024 |         39       30.23       68.22
Apr 2024–Mar 2025 |         41       31.78      100.00
------------------+-----------------------------------
            Total |        129      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = Undiff IA

Year of diagnosis |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |          1        4.00        4.00
Apr 2017–Mar 2018 |          1        4.00        8.00
Apr 2018–Mar 2019 |          2        8.00       16.00
Apr 2019–Mar 2020 |          1        4.00       20.00
Apr 2020–Mar 2021 |          1        4.00       24.00
Apr 2021–Mar 2022 |          2        8.00       32.00
Apr 2022–Mar 2023 |          3       12.00       44.00
Apr 2023–Mar 2024 |          5       20.00       64.00
Apr 2024–Mar 2025 |          9       36.00      100.00
------------------+-----------------------------------
            Total |         25      100.00


. 
. **Separate into 3-month time windows (for appt date)
. gen appt_3m = qofd(rheum_appt_date)
(1,622 missing values generated)

. format appt_3m %tq

. lab var appt_3m "Time period for appointment"

. tab appt_3m, missing

Time period |
        for |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
     2015q2 |          1        0.05        0.05
     2015q3 |          2        0.11        0.16
     2015q4 |          1        0.05        0.21
     2016q1 |          2        0.11        0.32
     2016q2 |          1        0.05        0.37
     2016q3 |          2        0.11        0.48
     2016q4 |          3        0.16        0.64
     2017q2 |          1        0.05        0.69
     2017q3 |          2        0.11        0.80
     2017q4 |          2        0.11        0.91
     2018q3 |          3        0.16        1.07
     2018q4 |          3        0.16        1.23
     2019q3 |          2        0.11        1.34
     2019q4 |          2        0.11        1.44
     2020q2 |          1        0.05        1.50
     2020q3 |          1        0.05        1.55
     2020q4 |          1        0.05        1.60
     2021q1 |          1        0.05        1.66
     2021q2 |          3        0.16        1.82
     2021q3 |          2        0.11        1.92
     2021q4 |          1        0.05        1.98
     2022q1 |          4        0.21        2.19
     2022q2 |          5        0.27        2.46
     2022q3 |          8        0.43        2.88
     2022q4 |         11        0.59        3.47
     2023q1 |         18        0.96        4.43
     2023q2 |          9        0.48        4.91
     2023q3 |         19        1.01        5.93
     2023q4 |         27        1.44        7.37
     2024q1 |         41        2.19        9.56
     2024q2 |         33        1.76       11.32
     2024q3 |         17        0.91       12.23
     2024q4 |         15        0.80       13.03
     2025q1 |          6        0.32       13.35
          . |      1,622       86.65      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. bys eia_diagnosis: tab appt_3m, missing

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = RA

Time period |
        for |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
     2015q3 |          1        0.07        0.07
     2015q4 |          1        0.07        0.13
     2016q1 |          2        0.13        0.26
     2016q2 |          1        0.07        0.33
     2016q3 |          2        0.13        0.46
     2016q4 |          2        0.13        0.59
     2017q2 |          1        0.07        0.66
     2017q3 |          2        0.13        0.79
     2017q4 |          2        0.13        0.92
     2018q3 |          3        0.20        1.11
     2018q4 |          3        0.20        1.31
     2019q3 |          1        0.07        1.38
     2019q4 |          2        0.13        1.51
     2020q2 |          1        0.07        1.57
     2020q3 |          1        0.07        1.64
     2020q4 |          1        0.07        1.70
     2021q1 |          1        0.07        1.77
     2021q2 |          3        0.20        1.97
     2021q3 |          2        0.13        2.10
     2021q4 |          1        0.07        2.16
     2022q1 |          4        0.26        2.42
     2022q2 |          5        0.33        2.75
     2022q3 |          8        0.52        3.28
     2022q4 |         11        0.72        4.00
     2023q1 |         16        1.05        5.05
     2023q2 |          5        0.33        5.37
     2023q3 |         12        0.79        6.16
     2023q4 |         18        1.18        7.34
     2024q1 |         32        2.10        9.44
     2024q2 |         27        1.77       11.21
     2024q3 |         15        0.98       12.19
     2024q4 |         13        0.85       13.04
     2025q1 |          6        0.39       13.43
          . |      1,321       86.57      100.00
------------+-----------------------------------
      Total |      1,526      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = PsA

Time period |
        for |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
     2015q3 |          1        0.52        0.52
     2023q1 |          1        0.52        1.04
     2023q2 |          1        0.52        1.56
     2023q3 |          4        2.08        3.65
     2023q4 |          3        1.56        5.21
     2024q1 |          2        1.04        6.25
     2024q2 |          5        2.60        8.85
     2024q4 |          1        0.52        9.38
          . |        174       90.62      100.00
------------+-----------------------------------
      Total |        192      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = AxSpA

Time period |
        for |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
     2019q3 |          1        0.78        0.78
     2023q2 |          3        2.33        3.10
     2023q3 |          3        2.33        5.43
     2023q4 |          6        4.65       10.08
     2024q1 |          7        5.43       15.50
     2024q2 |          1        0.78       16.28
     2024q3 |          1        0.78       17.05
     2024q4 |          1        0.78       17.83
          . |        106       82.17      100.00
------------+-----------------------------------
      Total |        129      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = Undiff IA

Time period |
        for |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
     2015q2 |          1        4.00        4.00
     2016q4 |          1        4.00        8.00
     2023q1 |          1        4.00       12.00
     2024q3 |          1        4.00       16.00
          . |         21       84.00      100.00
------------+-----------------------------------
      Total |         25      100.00


. 
. **Separate into 12-month time windows (for appt date)
. gen appt_year = (floor((rheum_appt_date - date("$start_date", "DMY")) / 365.25) + 1) if inrange(rheum_appt_date, d
> ate("$start_date", "DMY"), date("$end_date", "DMY"))
(1,628 missing values generated)

. lab var appt_year "Year of appointment"

. forvalues i = 1/$max_year {
  2.     local start = $base_year + `i' - 1
  3.     local end = `start' + 1
  4.     label define appt_year_lbl `i' "Apr `start'–Mar `end'", add
  5. }

. lab val appt_year appt_year_lbl

. tab appt_year, missing

          Year of |
      appointment |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |          6        0.32        0.32
Apr 2017–Mar 2018 |          5        0.27        0.59
Apr 2018–Mar 2019 |          6        0.32        0.91
Apr 2019–Mar 2020 |          4        0.21        1.12
Apr 2020–Mar 2021 |          4        0.21        1.34
Apr 2021–Mar 2022 |         10        0.53        1.87
Apr 2022–Mar 2023 |         43        2.30        4.17
Apr 2023–Mar 2024 |         95        5.07        9.24
Apr 2024–Mar 2025 |         71        3.79       13.03
                . |      1,628       86.97      100.00
------------------+-----------------------------------
            Total |      1,872      100.00

. bys eia_diagnosis: tab appt_year, missing

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = RA

          Year of |
      appointment |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |          5        0.33        0.33
Apr 2017–Mar 2018 |          5        0.33        0.66
Apr 2018–Mar 2019 |          6        0.39        1.05
Apr 2019–Mar 2020 |          3        0.20        1.25
Apr 2020–Mar 2021 |          4        0.26        1.51
Apr 2021–Mar 2022 |         10        0.66        2.16
Apr 2022–Mar 2023 |         40        2.62        4.78
Apr 2023–Mar 2024 |         67        4.39        9.17
Apr 2024–Mar 2025 |         61        4.00       13.17
                . |      1,325       86.83      100.00
------------------+-----------------------------------
            Total |      1,526      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = PsA

          Year of |
      appointment |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2022–Mar 2023 |          1        0.52        0.52
Apr 2023–Mar 2024 |         10        5.21        5.73
Apr 2024–Mar 2025 |          6        3.12        8.85
                . |        175       91.15      100.00
------------------+-----------------------------------
            Total |        192      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = AxSpA

          Year of |
      appointment |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2019–Mar 2020 |          1        0.78        0.78
Apr 2022–Mar 2023 |          1        0.78        1.55
Apr 2023–Mar 2024 |         18       13.95       15.50
Apr 2024–Mar 2025 |          3        2.33       17.83
                . |        106       82.17      100.00
------------------+-----------------------------------
            Total |        129      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = Undiff IA

          Year of |
      appointment |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |          1        4.00        4.00
Apr 2022–Mar 2023 |          1        4.00        8.00
Apr 2024–Mar 2025 |          1        4.00       12.00
                . |         22       88.00      100.00
------------------+-----------------------------------
            Total |         25      100.00


. 
. *Define Rheumatology appointments ======================================*/
. 
. **Rheumatology appt definitions 
. tab rheum_appt, missing //proportion of patients with an rheum outpatient date (with first attendance option selec
> ted) in the 12 months before and 60 days after EIA code appeared in GP record; data only April 2019 onwards

Rheumatolog |
          y |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,622       86.65       86.65
        Yes |        250       13.35      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab mo_year_diagn rheum_appt, missing //proportion of patients with an rheum outpatient date (with first attendanc
> e option selected) in the 12 months before and 60 days after EIA code appeared in GP record; data only April 2019 
> onwards

Month/Year |     Rheumatology
        of |      appointment
 Diagnosis |        No        Yes |     Total
-----------+----------------------+----------
  Apr-2016 |         0          2 |         2 
  May-2016 |         1          1 |         2 
  Jun-2016 |         4          1 |         5 
  Jul-2016 |         1          0 |         1 
  Aug-2016 |         1          0 |         1 
  Sep-2016 |         2          0 |         2 
  Oct-2016 |         3          0 |         3 
  Nov-2016 |         1          1 |         2 
  Dec-2016 |         6          0 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         3          0 |         3 
  Apr-2017 |         7          1 |         8 
  May-2017 |         4          2 |         6 
  Jun-2017 |         3          1 |         4 
  Jul-2017 |         4          0 |         4 
  Aug-2017 |         2          1 |         3 
  Sep-2017 |         2          1 |         3 
  Oct-2017 |         3          0 |         3 
  Nov-2017 |         2          1 |         3 
  Dec-2017 |         3          0 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         3          2 |         5 
  Mar-2018 |         3          0 |         3 
  Apr-2018 |         3          0 |         3 
  May-2018 |         1          0 |         1 
  Jun-2018 |         4          0 |         4 
  Jul-2018 |         5          0 |         5 
  Aug-2018 |         2          1 |         3 
  Sep-2018 |         3          2 |         5 
  Oct-2018 |         3          0 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         1          0 |         1 
  Jan-2019 |         3          0 |         3 
  Feb-2019 |         3          0 |         3 
  Mar-2019 |         4          0 |         4 
  Apr-2019 |         3          2 |         5 
  May-2019 |         7          0 |         7 
  Jun-2019 |         5          1 |         6 
  Jul-2019 |         4          0 |         4 
  Aug-2019 |         3          1 |         4 
  Sep-2019 |         5          1 |         6 
  Oct-2019 |         6          0 |         6 
  Nov-2019 |         4          0 |         4 
  Dec-2019 |         4          0 |         4 
  Jan-2020 |         1          0 |         1 
  Feb-2020 |         3          0 |         3 
  Mar-2020 |         5          0 |         5 
  Apr-2020 |         5          0 |         5 
  May-2020 |         6          0 |         6 
  Jun-2020 |         5          0 |         5 
  Jul-2020 |         5          1 |         6 
  Aug-2020 |         2          0 |         2 
  Sep-2020 |         6          0 |         6 
  Oct-2020 |         8          1 |         9 
  Nov-2020 |         8          1 |         9 
  Dec-2020 |         9          1 |        10 
  Jan-2021 |         7          0 |         7 
  Feb-2021 |         8          0 |         8 
  Mar-2021 |         4          0 |         4 
  Apr-2021 |        10          0 |        10 
  May-2021 |        11          0 |        11 
  Jun-2021 |         5          0 |         5 
  Jul-2021 |        13          1 |        14 
  Aug-2021 |         9          2 |        11 
  Sep-2021 |         8          1 |         9 
  Oct-2021 |        13          0 |        13 
  Nov-2021 |         9          0 |         9 
  Dec-2021 |         5          0 |         5 
  Jan-2022 |         8          0 |         8 
  Feb-2022 |        13          0 |        13 
  Mar-2022 |        16          1 |        17 
  Apr-2022 |        14          2 |        16 
  May-2022 |        20          1 |        21 
  Jun-2022 |        13          0 |        13 
  Jul-2022 |        18          1 |        19 
  Aug-2022 |        15          1 |        16 
  Sep-2022 |        18          2 |        20 
  Oct-2022 |        26          3 |        29 
  Nov-2022 |        27          1 |        28 
  Dec-2022 |        20          2 |        22 
  Jan-2023 |        24          1 |        25 
  Feb-2023 |        32          5 |        37 
  Mar-2023 |        30          3 |        33 
  Apr-2023 |        27          1 |        28 
  May-2023 |        32          4 |        36 
  Jun-2023 |        32          5 |        37 
  Jul-2023 |        40          3 |        43 
  Aug-2023 |        38          7 |        45 
  Sep-2023 |        38          4 |        42 
  Oct-2023 |        38          7 |        45 
  Nov-2023 |        39          2 |        41 
  Dec-2023 |        42          4 |        46 
  Jan-2024 |        58          8 |        66 
  Feb-2024 |        39         11 |        50 
  Mar-2024 |        44          7 |        51 
  Apr-2024 |        47         10 |        57 
  May-2024 |        52          7 |        59 
  Jun-2024 |        38          6 |        44 
  Jul-2024 |        54          9 |        63 
  Aug-2024 |        44         12 |        56 
  Sep-2024 |        40         11 |        51 
  Oct-2024 |        58          6 |        64 
  Nov-2024 |        46          8 |        54 
  Dec-2024 |        44         14 |        58 
  Jan-2025 |        46         17 |        63 
  Feb-2025 |        42         16 |        58 
  Mar-2025 |        50         15 |        65 
-----------+----------------------+----------
     Total |     1,622        250 |     1,872 

. tab rheum_appt_any, missing //proportion of patients with a rheum outpatient date (without first attendance option
>  selected) in the 12 months before and 60 days after EIA code appeared in GP record; data only April 2019 onwards

rheum_appt_ |
        any |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,366       72.97       72.97
          1 |        506       27.03      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab rheum_appt2, missing //proportion of patients with a rheum outpatient date (without first attendance option se
> lected) in the 6 months before and 60 days after  EIA code appeared in GP record; data only April 2019 onwards

rheum_appt2 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,476       78.85       78.85
          1 |        396       21.15      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab rheum_appt3, missing //proportion of patients with a rheum outpatient date (without first attendance option se
> lected) in the 2 years before and 60 days after EIA code appeared in GP record; data only April 2019 onwards

rheum_appt3 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,166       62.29       62.29
          1 |        706       37.71      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab rheum_appt4, missing //proportion of patients with a rheum outpatient date (without first attendance option se
> lected) in the 2 years before and 1 year after EIA code appeared in GP record; data only April 2019 onwards

rheum_appt4 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,166       62.29       62.29
          1 |        706       37.71      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. ***Check number of rheumatology appts in the year before EIA code
. tabstat rheum_appt_count, stat (n mean sd p50 p25 p75)

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |      1872  .4679487  1.001356         0         0        .5
--------------------------------------------------------------------------

. bys diagnosis_year: tabstat rheum_appt_count, stat (n mean sd p50 p25 p75)

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2016–Mar 2017

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        29  .7586207  1.272095         0         0         1
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2017–Mar 2018

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        46  .5869565  1.086812         0         0         1
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2018–Mar 2019

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        40      .375  .8066232         0         0         0
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2019–Mar 2020

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        54  .1666667  .6369147         0         0         0
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2020–Mar 2021

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        78  .1666667  .5201565         0         0         0
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2021–Mar 2022

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |       124  .1774194  .5709554         0         0         0
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2022–Mar 2023

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |       279  .1505376  .4475248         0         0         0
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2023–Mar 2024

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |       530   .345283  .6981114         0         0         0
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2024–Mar 2025

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |       692  .7846821  1.331418         0         0         1
--------------------------------------------------------------------------

. bys appt_year: tabstat rheum_appt_count, stat (n mean sd p50 p25 p75)

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2016–Mar 2017

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |         6  2.333333  1.505545         2         1         4
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2017–Mar 2018

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |         5         2  1.224745         2         1         2
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2018–Mar 2019

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |         6       1.5  1.048809       1.5         1         2
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2019–Mar 2020

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |         4         2  1.825742         2        .5       3.5
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2020–Mar 2021

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |         4      1.25        .5         1         1       1.5
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2021–Mar 2022

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        10       1.5  1.080123         1         1         1
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2022–Mar 2023

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        43  1.534884  .9089197         1         1         2
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2023–Mar 2024

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        95  2.052632   1.04544         2         1         3
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2024–Mar 2025

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        71  2.704225  1.792001         2         1         4
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = .

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |      1628  .2223587  .6405217         0         0         0
--------------------------------------------------------------------------

. 
. ***Check medium used for rheumatology appointment
. tab rheum_appt_medium, missing

rheum_appt_ |
     medium |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         32        1.71        1.71
          2 |         34        1.82        3.53
          3 |         29        1.55        5.07
          4 |         20        1.07        6.14
          5 |         29        1.55        7.69
          9 |         11        0.59        8.28
         10 |         28        1.50        9.78
         11 |         30        1.60       11.38
         98 |         37        1.98       13.35
          . |      1,622       86.65      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. gen rheum_appt_medium_clean = rheum_appt_medium if rheum_appt_medium >0 & rheum_appt_medium<100
(1,622 missing values generated)

. recode rheum_appt_medium_clean 3=2 //recode telemedicine=telephone
(29 changes made to rheum_appt_medium_clean)

. replace rheum_appt_medium_clean=10 if rheum_appt_medium_clean>2 & rheum_appt_medium_clean!=.
(127 real changes made)

. recode rheum_appt_medium_clean .=.u
(1,622 changes made to rheum_appt_medium_clean)

. lab define rheum_appt_medium_clean 1 "Face-to-face" 2 "Telephone" 10 "Other" .u "Missing", modify

. lab val rheum_appt_medium_clean rheum_appt_medium_clean

. lab var rheum_appt_medium_clean "Rheumatology consultation medium"

. tab rheum_appt_medium_clean 

Rheumatology |
consultation |
      medium |      Freq.     Percent        Cum.
-------------+-----------------------------------
Face-to-face |         32       12.80       12.80
   Telephone |         63       25.20       38.00
       Other |        155       62.00      100.00
-------------+-----------------------------------
       Total |        250      100.00

. 
. *Gen rheum appt variable with 6m/12m+ until study end date
. gen rheum_appt_12m=rheum_appt if rheum_appt_date<=(date("$end_date", "DMY")-365) 
(1,693 missing values generated)

. recode rheum_appt_12m .=0
(1,693 changes made to rheum_appt_12m)

. lab var rheum_appt_12m "Rheumatology appt 12m+"

. lab define rheum_appt_12m 0 "No" 1 "Yes", modify

. lab val rheum_appt_12m rheum_appt_12m

. 
. gen rheum_appt_6m=rheum_appt if rheum_appt_date<=(date("$end_date", "DMY")-183) 
(1,643 missing values generated)

. recode rheum_appt_6m .=0
(1,643 changes made to rheum_appt_6m)

. lab var rheum_appt_6m "Rheumatology appt 6m+"

. lab define rheum_appt_6m 0 "No" 1 "Yes", modify

. lab val rheum_appt_6m rheum_appt_6m

. 
. **Define Rheumatology referrals ======================================*/
. 
. ***From HES OPA (referral_request_received_date)
. tab rheum_appt_ref, missing

rheum_appt_ |
        ref |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,622       86.65       86.65
          1 |        250       13.35      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. codebook rheum_appt_ref_date

--------------------------------------------------------------------------------------------------------------------
rheum_appt_ref_date                                                                                      (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [19095,23883]                 Units: 1
       Or equivalently: [12apr2012,22may2025]         Units: days
         Unique values: 231                       Missing .: 1,622/1,872

                  Mean: 23240.8 = 18aug2023(+ 19 hours)
             Std. dev.: 848.525
           Percentiles:       10%        25%        50%        75%        90%
                          22016.5      23192      23553      23749      23840
                        11apr2020  01jul2023  26jun2024  08jan2025  09apr2025

. tab mo_year_diagn rheum_appt_ref, missing

Month/Year |
        of |    rheum_appt_ref
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         0          2 |         2 
  May-2016 |         1          1 |         2 
  Jun-2016 |         4          1 |         5 
  Jul-2016 |         1          0 |         1 
  Aug-2016 |         1          0 |         1 
  Sep-2016 |         2          0 |         2 
  Oct-2016 |         3          0 |         3 
  Nov-2016 |         1          1 |         2 
  Dec-2016 |         6          0 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         3          0 |         3 
  Apr-2017 |         7          1 |         8 
  May-2017 |         4          2 |         6 
  Jun-2017 |         3          1 |         4 
  Jul-2017 |         4          0 |         4 
  Aug-2017 |         2          1 |         3 
  Sep-2017 |         2          1 |         3 
  Oct-2017 |         3          0 |         3 
  Nov-2017 |         2          1 |         3 
  Dec-2017 |         3          0 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         3          2 |         5 
  Mar-2018 |         3          0 |         3 
  Apr-2018 |         3          0 |         3 
  May-2018 |         1          0 |         1 
  Jun-2018 |         4          0 |         4 
  Jul-2018 |         5          0 |         5 
  Aug-2018 |         2          1 |         3 
  Sep-2018 |         3          2 |         5 
  Oct-2018 |         3          0 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         1          0 |         1 
  Jan-2019 |         3          0 |         3 
  Feb-2019 |         3          0 |         3 
  Mar-2019 |         4          0 |         4 
  Apr-2019 |         3          2 |         5 
  May-2019 |         7          0 |         7 
  Jun-2019 |         5          1 |         6 
  Jul-2019 |         4          0 |         4 
  Aug-2019 |         3          1 |         4 
  Sep-2019 |         5          1 |         6 
  Oct-2019 |         6          0 |         6 
  Nov-2019 |         4          0 |         4 
  Dec-2019 |         4          0 |         4 
  Jan-2020 |         1          0 |         1 
  Feb-2020 |         3          0 |         3 
  Mar-2020 |         5          0 |         5 
  Apr-2020 |         5          0 |         5 
  May-2020 |         6          0 |         6 
  Jun-2020 |         5          0 |         5 
  Jul-2020 |         5          1 |         6 
  Aug-2020 |         2          0 |         2 
  Sep-2020 |         6          0 |         6 
  Oct-2020 |         8          1 |         9 
  Nov-2020 |         8          1 |         9 
  Dec-2020 |         9          1 |        10 
  Jan-2021 |         7          0 |         7 
  Feb-2021 |         8          0 |         8 
  Mar-2021 |         4          0 |         4 
  Apr-2021 |        10          0 |        10 
  May-2021 |        11          0 |        11 
  Jun-2021 |         5          0 |         5 
  Jul-2021 |        13          1 |        14 
  Aug-2021 |         9          2 |        11 
  Sep-2021 |         8          1 |         9 
  Oct-2021 |        13          0 |        13 
  Nov-2021 |         9          0 |         9 
  Dec-2021 |         5          0 |         5 
  Jan-2022 |         8          0 |         8 
  Feb-2022 |        13          0 |        13 
  Mar-2022 |        16          1 |        17 
  Apr-2022 |        14          2 |        16 
  May-2022 |        20          1 |        21 
  Jun-2022 |        13          0 |        13 
  Jul-2022 |        18          1 |        19 
  Aug-2022 |        15          1 |        16 
  Sep-2022 |        18          2 |        20 
  Oct-2022 |        26          3 |        29 
  Nov-2022 |        27          1 |        28 
  Dec-2022 |        20          2 |        22 
  Jan-2023 |        24          1 |        25 
  Feb-2023 |        32          5 |        37 
  Mar-2023 |        30          3 |        33 
  Apr-2023 |        27          1 |        28 
  May-2023 |        32          4 |        36 
  Jun-2023 |        32          5 |        37 
  Jul-2023 |        40          3 |        43 
  Aug-2023 |        38          7 |        45 
  Sep-2023 |        38          4 |        42 
  Oct-2023 |        38          7 |        45 
  Nov-2023 |        39          2 |        41 
  Dec-2023 |        42          4 |        46 
  Jan-2024 |        58          8 |        66 
  Feb-2024 |        39         11 |        50 
  Mar-2024 |        44          7 |        51 
  Apr-2024 |        47         10 |        57 
  May-2024 |        52          7 |        59 
  Jun-2024 |        38          6 |        44 
  Jul-2024 |        54          9 |        63 
  Aug-2024 |        44         12 |        56 
  Sep-2024 |        40         11 |        51 
  Oct-2024 |        58          6 |        64 
  Nov-2024 |        46          8 |        54 
  Dec-2024 |        44         14 |        58 
  Jan-2025 |        46         17 |        63 
  Feb-2025 |        42         16 |        58 
  Mar-2025 |        50         15 |        65 
-----------+----------------------+----------
     Total |     1,622        250 |     1,872 

. tab mo_year_diagn rheum_appt_ref if rheum_appt!=., missing

Month/Year |
        of |    rheum_appt_ref
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         0          2 |         2 
  May-2016 |         1          1 |         2 
  Jun-2016 |         4          1 |         5 
  Jul-2016 |         1          0 |         1 
  Aug-2016 |         1          0 |         1 
  Sep-2016 |         2          0 |         2 
  Oct-2016 |         3          0 |         3 
  Nov-2016 |         1          1 |         2 
  Dec-2016 |         6          0 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         3          0 |         3 
  Apr-2017 |         7          1 |         8 
  May-2017 |         4          2 |         6 
  Jun-2017 |         3          1 |         4 
  Jul-2017 |         4          0 |         4 
  Aug-2017 |         2          1 |         3 
  Sep-2017 |         2          1 |         3 
  Oct-2017 |         3          0 |         3 
  Nov-2017 |         2          1 |         3 
  Dec-2017 |         3          0 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         3          2 |         5 
  Mar-2018 |         3          0 |         3 
  Apr-2018 |         3          0 |         3 
  May-2018 |         1          0 |         1 
  Jun-2018 |         4          0 |         4 
  Jul-2018 |         5          0 |         5 
  Aug-2018 |         2          1 |         3 
  Sep-2018 |         3          2 |         5 
  Oct-2018 |         3          0 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         1          0 |         1 
  Jan-2019 |         3          0 |         3 
  Feb-2019 |         3          0 |         3 
  Mar-2019 |         4          0 |         4 
  Apr-2019 |         3          2 |         5 
  May-2019 |         7          0 |         7 
  Jun-2019 |         5          1 |         6 
  Jul-2019 |         4          0 |         4 
  Aug-2019 |         3          1 |         4 
  Sep-2019 |         5          1 |         6 
  Oct-2019 |         6          0 |         6 
  Nov-2019 |         4          0 |         4 
  Dec-2019 |         4          0 |         4 
  Jan-2020 |         1          0 |         1 
  Feb-2020 |         3          0 |         3 
  Mar-2020 |         5          0 |         5 
  Apr-2020 |         5          0 |         5 
  May-2020 |         6          0 |         6 
  Jun-2020 |         5          0 |         5 
  Jul-2020 |         5          1 |         6 
  Aug-2020 |         2          0 |         2 
  Sep-2020 |         6          0 |         6 
  Oct-2020 |         8          1 |         9 
  Nov-2020 |         8          1 |         9 
  Dec-2020 |         9          1 |        10 
  Jan-2021 |         7          0 |         7 
  Feb-2021 |         8          0 |         8 
  Mar-2021 |         4          0 |         4 
  Apr-2021 |        10          0 |        10 
  May-2021 |        11          0 |        11 
  Jun-2021 |         5          0 |         5 
  Jul-2021 |        13          1 |        14 
  Aug-2021 |         9          2 |        11 
  Sep-2021 |         8          1 |         9 
  Oct-2021 |        13          0 |        13 
  Nov-2021 |         9          0 |         9 
  Dec-2021 |         5          0 |         5 
  Jan-2022 |         8          0 |         8 
  Feb-2022 |        13          0 |        13 
  Mar-2022 |        16          1 |        17 
  Apr-2022 |        14          2 |        16 
  May-2022 |        20          1 |        21 
  Jun-2022 |        13          0 |        13 
  Jul-2022 |        18          1 |        19 
  Aug-2022 |        15          1 |        16 
  Sep-2022 |        18          2 |        20 
  Oct-2022 |        26          3 |        29 
  Nov-2022 |        27          1 |        28 
  Dec-2022 |        20          2 |        22 
  Jan-2023 |        24          1 |        25 
  Feb-2023 |        32          5 |        37 
  Mar-2023 |        30          3 |        33 
  Apr-2023 |        27          1 |        28 
  May-2023 |        32          4 |        36 
  Jun-2023 |        32          5 |        37 
  Jul-2023 |        40          3 |        43 
  Aug-2023 |        38          7 |        45 
  Sep-2023 |        38          4 |        42 
  Oct-2023 |        38          7 |        45 
  Nov-2023 |        39          2 |        41 
  Dec-2023 |        42          4 |        46 
  Jan-2024 |        58          8 |        66 
  Feb-2024 |        39         11 |        50 
  Mar-2024 |        44          7 |        51 
  Apr-2024 |        47         10 |        57 
  May-2024 |        52          7 |        59 
  Jun-2024 |        38          6 |        44 
  Jul-2024 |        54          9 |        63 
  Aug-2024 |        44         12 |        56 
  Sep-2024 |        40         11 |        51 
  Oct-2024 |        58          6 |        64 
  Nov-2024 |        46          8 |        54 
  Dec-2024 |        44         14 |        58 
  Jan-2025 |        46         17 |        63 
  Feb-2025 |        42         16 |        58 
  Mar-2025 |        50         15 |        65 
-----------+----------------------+----------
     Total |     1,622        250 |     1,872 

. 
. ***From RTT clock-stop data (only available for those with clock-stop date between May 2021 and May 2022)
. tab rtt_cl_ref, missing

 rtt_cl_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        911       48.66       48.66
          1 |        961       51.34      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. codebook rtt_cl_ref_date

--------------------------------------------------------------------------------------------------------------------
rtt_cl_ref_date                                                                                          (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [19939,23883]                 Units: 1
       Or equivalently: [04aug2014,22may2025]         Units: days
         Unique values: 651                       Missing .: 911/1,872

                  Mean: 23241.7 = 19aug2023(+ 17 hours)
             Std. dev.: 801.336
           Percentiles:       10%        25%        50%        75%        90%
                            21995      23101      23563      23763      23840
                        21mar2020  01apr2023  06jul2024  22jan2025  09apr2025

. tab rtt_cl_ref if rheum_appt!=0 & rtt_cl_ref_date<=rheum_appt_date, missing 

 rtt_cl_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         53      100.00      100.00
------------+-----------------------------------
      Total |         53      100.00

. tab mo_year_diagn rtt_cl_ref, missing

Month/Year |
        of |      rtt_cl_ref
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         2          0 |         2 
  May-2016 |         0          2 |         2 
  Jun-2016 |         3          2 |         5 
  Jul-2016 |         0          1 |         1 
  Aug-2016 |         0          1 |         1 
  Sep-2016 |         1          1 |         2 
  Oct-2016 |         2          1 |         3 
  Nov-2016 |         0          2 |         2 
  Dec-2016 |         2          4 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         1          2 |         3 
  Apr-2017 |         5          3 |         8 
  May-2017 |         4          2 |         6 
  Jun-2017 |         0          4 |         4 
  Jul-2017 |         1          3 |         4 
  Aug-2017 |         0          3 |         3 
  Sep-2017 |         2          1 |         3 
  Oct-2017 |         1          2 |         3 
  Nov-2017 |         0          3 |         3 
  Dec-2017 |         0          3 |         3 
  Jan-2018 |         0          1 |         1 
  Feb-2018 |         3          2 |         5 
  Mar-2018 |         1          2 |         3 
  Apr-2018 |         1          2 |         3 
  May-2018 |         0          1 |         1 
  Jun-2018 |         4          0 |         4 
  Jul-2018 |         2          3 |         5 
  Aug-2018 |         1          2 |         3 
  Sep-2018 |         0          5 |         5 
  Oct-2018 |         1          2 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         1          0 |         1 
  Jan-2019 |         1          2 |         3 
  Feb-2019 |         2          1 |         3 
  Mar-2019 |         4          0 |         4 
  Apr-2019 |         2          3 |         5 
  May-2019 |         6          1 |         7 
  Jun-2019 |         3          3 |         6 
  Jul-2019 |         2          2 |         4 
  Aug-2019 |         2          2 |         4 
  Sep-2019 |         3          3 |         6 
  Oct-2019 |         4          2 |         6 
  Nov-2019 |         2          2 |         4 
  Dec-2019 |         2          2 |         4 
  Jan-2020 |         1          0 |         1 
  Feb-2020 |         2          1 |         3 
  Mar-2020 |         3          2 |         5 
  Apr-2020 |         5          0 |         5 
  May-2020 |         4          2 |         6 
  Jun-2020 |         3          2 |         5 
  Jul-2020 |         4          2 |         6 
  Aug-2020 |         1          1 |         2 
  Sep-2020 |         2          4 |         6 
  Oct-2020 |         6          3 |         9 
  Nov-2020 |         6          3 |         9 
  Dec-2020 |         9          1 |        10 
  Jan-2021 |         5          2 |         7 
  Feb-2021 |         4          4 |         8 
  Mar-2021 |         4          0 |         4 
  Apr-2021 |         8          2 |        10 
  May-2021 |         8          3 |        11 
  Jun-2021 |         4          1 |         5 
  Jul-2021 |        10          4 |        14 
  Aug-2021 |         8          3 |        11 
  Sep-2021 |         7          2 |         9 
  Oct-2021 |         9          4 |        13 
  Nov-2021 |         8          1 |         9 
  Dec-2021 |         5          0 |         5 
  Jan-2022 |         8          0 |         8 
  Feb-2022 |        11          2 |        13 
  Mar-2022 |        12          5 |        17 
  Apr-2022 |        12          4 |        16 
  May-2022 |        14          7 |        21 
  Jun-2022 |        11          2 |        13 
  Jul-2022 |        15          4 |        19 
  Aug-2022 |        12          4 |        16 
  Sep-2022 |        16          4 |        20 
  Oct-2022 |        23          6 |        29 
  Nov-2022 |        23          5 |        28 
  Dec-2022 |        14          8 |        22 
  Jan-2023 |        19          6 |        25 
  Feb-2023 |        26         11 |        37 
  Mar-2023 |        22         11 |        33 
  Apr-2023 |        21          7 |        28 
  May-2023 |        25         11 |        36 
  Jun-2023 |        24         13 |        37 
  Jul-2023 |        28         15 |        43 
  Aug-2023 |        29         16 |        45 
  Sep-2023 |        24         18 |        42 
  Oct-2023 |        20         25 |        45 
  Nov-2023 |        17         24 |        41 
  Dec-2023 |        26         20 |        46 
  Jan-2024 |        40         26 |        66 
  Feb-2024 |        22         28 |        50 
  Mar-2024 |        14         37 |        51 
  Apr-2024 |        25         32 |        57 
  May-2024 |        24         35 |        59 
  Jun-2024 |        15         29 |        44 
  Jul-2024 |        24         39 |        63 
  Aug-2024 |        13         43 |        56 
  Sep-2024 |        17         34 |        51 
  Oct-2024 |        10         54 |        64 
  Nov-2024 |         9         45 |        54 
  Dec-2024 |        13         45 |        58 
  Jan-2025 |        10         53 |        63 
  Feb-2025 |        11         47 |        58 
  Mar-2025 |        12         53 |        65 
-----------+----------------------+----------
     Total |       911        961 |     1,872 

. tab mo_year_diagn rtt_cl_ref if rheum_appt!=., missing

Month/Year |
        of |      rtt_cl_ref
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         2          0 |         2 
  May-2016 |         0          2 |         2 
  Jun-2016 |         3          2 |         5 
  Jul-2016 |         0          1 |         1 
  Aug-2016 |         0          1 |         1 
  Sep-2016 |         1          1 |         2 
  Oct-2016 |         2          1 |         3 
  Nov-2016 |         0          2 |         2 
  Dec-2016 |         2          4 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         1          2 |         3 
  Apr-2017 |         5          3 |         8 
  May-2017 |         4          2 |         6 
  Jun-2017 |         0          4 |         4 
  Jul-2017 |         1          3 |         4 
  Aug-2017 |         0          3 |         3 
  Sep-2017 |         2          1 |         3 
  Oct-2017 |         1          2 |         3 
  Nov-2017 |         0          3 |         3 
  Dec-2017 |         0          3 |         3 
  Jan-2018 |         0          1 |         1 
  Feb-2018 |         3          2 |         5 
  Mar-2018 |         1          2 |         3 
  Apr-2018 |         1          2 |         3 
  May-2018 |         0          1 |         1 
  Jun-2018 |         4          0 |         4 
  Jul-2018 |         2          3 |         5 
  Aug-2018 |         1          2 |         3 
  Sep-2018 |         0          5 |         5 
  Oct-2018 |         1          2 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         1          0 |         1 
  Jan-2019 |         1          2 |         3 
  Feb-2019 |         2          1 |         3 
  Mar-2019 |         4          0 |         4 
  Apr-2019 |         2          3 |         5 
  May-2019 |         6          1 |         7 
  Jun-2019 |         3          3 |         6 
  Jul-2019 |         2          2 |         4 
  Aug-2019 |         2          2 |         4 
  Sep-2019 |         3          3 |         6 
  Oct-2019 |         4          2 |         6 
  Nov-2019 |         2          2 |         4 
  Dec-2019 |         2          2 |         4 
  Jan-2020 |         1          0 |         1 
  Feb-2020 |         2          1 |         3 
  Mar-2020 |         3          2 |         5 
  Apr-2020 |         5          0 |         5 
  May-2020 |         4          2 |         6 
  Jun-2020 |         3          2 |         5 
  Jul-2020 |         4          2 |         6 
  Aug-2020 |         1          1 |         2 
  Sep-2020 |         2          4 |         6 
  Oct-2020 |         6          3 |         9 
  Nov-2020 |         6          3 |         9 
  Dec-2020 |         9          1 |        10 
  Jan-2021 |         5          2 |         7 
  Feb-2021 |         4          4 |         8 
  Mar-2021 |         4          0 |         4 
  Apr-2021 |         8          2 |        10 
  May-2021 |         8          3 |        11 
  Jun-2021 |         4          1 |         5 
  Jul-2021 |        10          4 |        14 
  Aug-2021 |         8          3 |        11 
  Sep-2021 |         7          2 |         9 
  Oct-2021 |         9          4 |        13 
  Nov-2021 |         8          1 |         9 
  Dec-2021 |         5          0 |         5 
  Jan-2022 |         8          0 |         8 
  Feb-2022 |        11          2 |        13 
  Mar-2022 |        12          5 |        17 
  Apr-2022 |        12          4 |        16 
  May-2022 |        14          7 |        21 
  Jun-2022 |        11          2 |        13 
  Jul-2022 |        15          4 |        19 
  Aug-2022 |        12          4 |        16 
  Sep-2022 |        16          4 |        20 
  Oct-2022 |        23          6 |        29 
  Nov-2022 |        23          5 |        28 
  Dec-2022 |        14          8 |        22 
  Jan-2023 |        19          6 |        25 
  Feb-2023 |        26         11 |        37 
  Mar-2023 |        22         11 |        33 
  Apr-2023 |        21          7 |        28 
  May-2023 |        25         11 |        36 
  Jun-2023 |        24         13 |        37 
  Jul-2023 |        28         15 |        43 
  Aug-2023 |        29         16 |        45 
  Sep-2023 |        24         18 |        42 
  Oct-2023 |        20         25 |        45 
  Nov-2023 |        17         24 |        41 
  Dec-2023 |        26         20 |        46 
  Jan-2024 |        40         26 |        66 
  Feb-2024 |        22         28 |        50 
  Mar-2024 |        14         37 |        51 
  Apr-2024 |        25         32 |        57 
  May-2024 |        24         35 |        59 
  Jun-2024 |        15         29 |        44 
  Jul-2024 |        24         39 |        63 
  Aug-2024 |        13         43 |        56 
  Sep-2024 |        17         34 |        51 
  Oct-2024 |        10         54 |        64 
  Nov-2024 |         9         45 |        54 
  Dec-2024 |        13         45 |        58 
  Jan-2025 |        10         53 |        63 
  Feb-2025 |        11         47 |        58 
  Mar-2025 |        12         53 |        65 
-----------+----------------------+----------
     Total |       911        961 |     1,872 

. tab rtt_cl_start, missing //check how this differs

rtt_cl_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        911       48.66       48.66
          1 |        961       51.34      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. codebook rtt_cl_start_date

--------------------------------------------------------------------------------------------------------------------
rtt_cl_start_date                                                                                        (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [20290,23858]                 Units: 1
       Or equivalently: [21jul2015,27apr2025]         Units: days
         Unique values: 676                       Missing .: 911/1,872

                  Mean:   23074 = 05mar2023(+ 1 hour)
             Std. dev.: 734.364
           Percentiles:       10%        25%        50%        75%        90%
                            21945      23021      23333      23501      23634
                        31jan2020  11jan2023  19nov2023  05may2024  15sep2024

. tab rtt_cl_start if rheum_appt!=0 & rtt_cl_start_date<=rheum_appt_date, missing 

rtt_cl_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         79      100.00      100.00
------------+-----------------------------------
      Total |         79      100.00

. 
. ***From RTT open pathway data (only available as a snapshot of those with open RTT pathways as of May 2022)
. tab rtt_op_ref, missing

 rtt_op_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        894       47.76       47.76
          1 |        978       52.24      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. codebook rtt_op_ref_date

--------------------------------------------------------------------------------------------------------------------
rtt_op_ref_date                                                                                          (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [19181,23883]                 Units: 1
       Or equivalently: [07jul2012,22may2025]         Units: days
         Unique values: 660                       Missing .: 894/1,872

                  Mean: 23286.9 = 03oct2023(+ 21 hours)
             Std. dev.:  756.25
           Percentiles:       10%        25%        50%        75%        90%
                            22247      23183    23559.5      23757      23844
                        28nov2020  22jun2023  02jul2024  16jan2025  13apr2025

. tab rtt_op_ref if rheum_appt!=0 & rtt_op_ref_date<=rheum_appt_date, missing 

 rtt_op_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         51      100.00      100.00
------------+-----------------------------------
      Total |         51      100.00

. tab mo_year_diagn rtt_op_ref, missing

Month/Year |
        of |      rtt_op_ref
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         0          2 |         2 
  May-2016 |         0          2 |         2 
  Jun-2016 |         4          1 |         5 
  Jul-2016 |         1          0 |         1 
  Aug-2016 |         1          0 |         1 
  Sep-2016 |         2          0 |         2 
  Oct-2016 |         1          2 |         3 
  Nov-2016 |         0          2 |         2 
  Dec-2016 |         5          1 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         1          2 |         3 
  Apr-2017 |         2          6 |         8 
  May-2017 |         4          2 |         6 
  Jun-2017 |         3          1 |         4 
  Jul-2017 |         2          2 |         4 
  Aug-2017 |         0          3 |         3 
  Sep-2017 |         1          2 |         3 
  Oct-2017 |         2          1 |         3 
  Nov-2017 |         1          2 |         3 
  Dec-2017 |         1          2 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         3          2 |         5 
  Mar-2018 |         1          2 |         3 
  Apr-2018 |         2          1 |         3 
  May-2018 |         1          0 |         1 
  Jun-2018 |         3          1 |         4 
  Jul-2018 |         1          4 |         5 
  Aug-2018 |         2          1 |         3 
  Sep-2018 |         2          3 |         5 
  Oct-2018 |         1          2 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         0          1 |         1 
  Jan-2019 |         3          0 |         3 
  Feb-2019 |         3          0 |         3 
  Mar-2019 |         2          2 |         4 
  Apr-2019 |         3          2 |         5 
  May-2019 |         6          1 |         7 
  Jun-2019 |         2          4 |         6 
  Jul-2019 |         3          1 |         4 
  Aug-2019 |         3          1 |         4 
  Sep-2019 |         3          3 |         6 
  Oct-2019 |         2          4 |         6 
  Nov-2019 |         2          2 |         4 
  Dec-2019 |         4          0 |         4 
  Jan-2020 |         0          1 |         1 
  Feb-2020 |         3          0 |         3 
  Mar-2020 |         3          2 |         5 
  Apr-2020 |         3          2 |         5 
  May-2020 |         5          1 |         6 
  Jun-2020 |         3          2 |         5 
  Jul-2020 |         4          2 |         6 
  Aug-2020 |         2          0 |         2 
  Sep-2020 |         5          1 |         6 
  Oct-2020 |         7          2 |         9 
  Nov-2020 |         6          3 |         9 
  Dec-2020 |         8          2 |        10 
  Jan-2021 |         6          1 |         7 
  Feb-2021 |         5          3 |         8 
  Mar-2021 |         3          1 |         4 
  Apr-2021 |         6          4 |        10 
  May-2021 |         5          6 |        11 
  Jun-2021 |         5          0 |         5 
  Jul-2021 |        11          3 |        14 
  Aug-2021 |         6          5 |        11 
  Sep-2021 |         7          2 |         9 
  Oct-2021 |        10          3 |        13 
  Nov-2021 |         7          2 |         9 
  Dec-2021 |         4          1 |         5 
  Jan-2022 |         5          3 |         8 
  Feb-2022 |        11          2 |        13 
  Mar-2022 |        14          3 |        17 
  Apr-2022 |        13          3 |        16 
  May-2022 |        18          3 |        21 
  Jun-2022 |        11          2 |        13 
  Jul-2022 |        15          4 |        19 
  Aug-2022 |        14          2 |        16 
  Sep-2022 |        17          3 |        20 
  Oct-2022 |        22          7 |        29 
  Nov-2022 |        22          6 |        28 
  Dec-2022 |        14          8 |        22 
  Jan-2023 |        18          7 |        25 
  Feb-2023 |        25         12 |        37 
  Mar-2023 |        21         12 |        33 
  Apr-2023 |        17         11 |        28 
  May-2023 |        22         14 |        36 
  Jun-2023 |        18         19 |        37 
  Jul-2023 |        25         18 |        43 
  Aug-2023 |        26         19 |        45 
  Sep-2023 |        26         16 |        42 
  Oct-2023 |        25         20 |        45 
  Nov-2023 |        17         24 |        41 
  Dec-2023 |        22         24 |        46 
  Jan-2024 |        28         38 |        66 
  Feb-2024 |        20         30 |        50 
  Mar-2024 |        23         28 |        51 
  Apr-2024 |        21         36 |        57 
  May-2024 |        12         47 |        59 
  Jun-2024 |        14         30 |        44 
  Jul-2024 |        15         48 |        63 
  Aug-2024 |        22         34 |        56 
  Sep-2024 |        18         33 |        51 
  Oct-2024 |        14         50 |        64 
  Nov-2024 |        11         43 |        54 
  Dec-2024 |        19         39 |        58 
  Jan-2025 |         7         56 |        63 
  Feb-2025 |        10         48 |        58 
  Mar-2025 |        11         54 |        65 
-----------+----------------------+----------
     Total |       894        978 |     1,872 

. tab mo_year_diagn rtt_op_ref if rheum_appt!=., missing

Month/Year |
        of |      rtt_op_ref
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         0          2 |         2 
  May-2016 |         0          2 |         2 
  Jun-2016 |         4          1 |         5 
  Jul-2016 |         1          0 |         1 
  Aug-2016 |         1          0 |         1 
  Sep-2016 |         2          0 |         2 
  Oct-2016 |         1          2 |         3 
  Nov-2016 |         0          2 |         2 
  Dec-2016 |         5          1 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         1          2 |         3 
  Apr-2017 |         2          6 |         8 
  May-2017 |         4          2 |         6 
  Jun-2017 |         3          1 |         4 
  Jul-2017 |         2          2 |         4 
  Aug-2017 |         0          3 |         3 
  Sep-2017 |         1          2 |         3 
  Oct-2017 |         2          1 |         3 
  Nov-2017 |         1          2 |         3 
  Dec-2017 |         1          2 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         3          2 |         5 
  Mar-2018 |         1          2 |         3 
  Apr-2018 |         2          1 |         3 
  May-2018 |         1          0 |         1 
  Jun-2018 |         3          1 |         4 
  Jul-2018 |         1          4 |         5 
  Aug-2018 |         2          1 |         3 
  Sep-2018 |         2          3 |         5 
  Oct-2018 |         1          2 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         0          1 |         1 
  Jan-2019 |         3          0 |         3 
  Feb-2019 |         3          0 |         3 
  Mar-2019 |         2          2 |         4 
  Apr-2019 |         3          2 |         5 
  May-2019 |         6          1 |         7 
  Jun-2019 |         2          4 |         6 
  Jul-2019 |         3          1 |         4 
  Aug-2019 |         3          1 |         4 
  Sep-2019 |         3          3 |         6 
  Oct-2019 |         2          4 |         6 
  Nov-2019 |         2          2 |         4 
  Dec-2019 |         4          0 |         4 
  Jan-2020 |         0          1 |         1 
  Feb-2020 |         3          0 |         3 
  Mar-2020 |         3          2 |         5 
  Apr-2020 |         3          2 |         5 
  May-2020 |         5          1 |         6 
  Jun-2020 |         3          2 |         5 
  Jul-2020 |         4          2 |         6 
  Aug-2020 |         2          0 |         2 
  Sep-2020 |         5          1 |         6 
  Oct-2020 |         7          2 |         9 
  Nov-2020 |         6          3 |         9 
  Dec-2020 |         8          2 |        10 
  Jan-2021 |         6          1 |         7 
  Feb-2021 |         5          3 |         8 
  Mar-2021 |         3          1 |         4 
  Apr-2021 |         6          4 |        10 
  May-2021 |         5          6 |        11 
  Jun-2021 |         5          0 |         5 
  Jul-2021 |        11          3 |        14 
  Aug-2021 |         6          5 |        11 
  Sep-2021 |         7          2 |         9 
  Oct-2021 |        10          3 |        13 
  Nov-2021 |         7          2 |         9 
  Dec-2021 |         4          1 |         5 
  Jan-2022 |         5          3 |         8 
  Feb-2022 |        11          2 |        13 
  Mar-2022 |        14          3 |        17 
  Apr-2022 |        13          3 |        16 
  May-2022 |        18          3 |        21 
  Jun-2022 |        11          2 |        13 
  Jul-2022 |        15          4 |        19 
  Aug-2022 |        14          2 |        16 
  Sep-2022 |        17          3 |        20 
  Oct-2022 |        22          7 |        29 
  Nov-2022 |        22          6 |        28 
  Dec-2022 |        14          8 |        22 
  Jan-2023 |        18          7 |        25 
  Feb-2023 |        25         12 |        37 
  Mar-2023 |        21         12 |        33 
  Apr-2023 |        17         11 |        28 
  May-2023 |        22         14 |        36 
  Jun-2023 |        18         19 |        37 
  Jul-2023 |        25         18 |        43 
  Aug-2023 |        26         19 |        45 
  Sep-2023 |        26         16 |        42 
  Oct-2023 |        25         20 |        45 
  Nov-2023 |        17         24 |        41 
  Dec-2023 |        22         24 |        46 
  Jan-2024 |        28         38 |        66 
  Feb-2024 |        20         30 |        50 
  Mar-2024 |        23         28 |        51 
  Apr-2024 |        21         36 |        57 
  May-2024 |        12         47 |        59 
  Jun-2024 |        14         30 |        44 
  Jul-2024 |        15         48 |        63 
  Aug-2024 |        22         34 |        56 
  Sep-2024 |        18         33 |        51 
  Oct-2024 |        14         50 |        64 
  Nov-2024 |        11         43 |        54 
  Dec-2024 |        19         39 |        58 
  Jan-2025 |         7         56 |        63 
  Feb-2025 |        10         48 |        58 
  Mar-2025 |        11         54 |        65 
-----------+----------------------+----------
     Total |       894        978 |     1,872 

. tab rtt_op_start, missing //check how this differs

rtt_op_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        894       47.76       47.76
          1 |        978       52.24      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. codebook rtt_op_start_date

--------------------------------------------------------------------------------------------------------------------
rtt_op_start_date                                                                                        (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [20223,23866]                 Units: 1
       Or equivalently: [15may2015,05may2025]         Units: days
         Unique values: 664                       Missing .: 894/1,872

                  Mean: 23106.3 = 06apr2023(+ 8 hours)
             Std. dev.: 684.857
           Percentiles:       10%        25%        50%        75%        90%
                            22203      23051    23318.5      23499      23629
                        15oct2020  10feb2023  04nov2023  03may2024  10sep2024

. tab rtt_op_start if rheum_appt!=0 & rtt_op_start_date<=rheum_appt_date, missing 

rtt_op_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         71      100.00      100.00
------------+-----------------------------------
      Total |         71      100.00

. 
. ***Combination of RTT clock-stop and open pathway
. gen rtt_ref_date = rtt_cl_ref_date
(911 missing values generated)

. replace rtt_ref_date = rtt_op_ref_date if rtt_cl_ref_date==. & rtt_op_ref_date!=. //need to think how to handle du
> plicate pathways
(365 real changes made)

. format %td rtt_ref_date

. gen rtt_ref =1 if rtt_ref_date!=.
(546 missing values generated)

. recode rtt_ref .=0
(546 changes made to rtt_ref)

. tab rtt_ref, missing

    rtt_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        546       29.17       29.17
          1 |      1,326       70.83      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab mo_year_diagn rtt_ref, missing

Month/Year |
        of |        rtt_ref
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         0          2 |         2 
  May-2016 |         0          2 |         2 
  Jun-2016 |         3          2 |         5 
  Jul-2016 |         0          1 |         1 
  Aug-2016 |         0          1 |         1 
  Sep-2016 |         1          1 |         2 
  Oct-2016 |         1          2 |         3 
  Nov-2016 |         0          2 |         2 
  Dec-2016 |         2          4 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         1          2 |         3 
  Apr-2017 |         2          6 |         8 
  May-2017 |         3          3 |         6 
  Jun-2017 |         0          4 |         4 
  Jul-2017 |         0          4 |         4 
  Aug-2017 |         0          3 |         3 
  Sep-2017 |         1          2 |         3 
  Oct-2017 |         1          2 |         3 
  Nov-2017 |         0          3 |         3 
  Dec-2017 |         0          3 |         3 
  Jan-2018 |         0          1 |         1 
  Feb-2018 |         2          3 |         5 
  Mar-2018 |         1          2 |         3 
  Apr-2018 |         1          2 |         3 
  May-2018 |         0          1 |         1 
  Jun-2018 |         3          1 |         4 
  Jul-2018 |         0          5 |         5 
  Aug-2018 |         1          2 |         3 
  Sep-2018 |         0          5 |         5 
  Oct-2018 |         0          3 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         0          1 |         1 
  Jan-2019 |         1          2 |         3 
  Feb-2019 |         2          1 |         3 
  Mar-2019 |         2          2 |         4 
  Apr-2019 |         2          3 |         5 
  May-2019 |         5          2 |         7 
  Jun-2019 |         1          5 |         6 
  Jul-2019 |         1          3 |         4 
  Aug-2019 |         2          2 |         4 
  Sep-2019 |         2          4 |         6 
  Oct-2019 |         1          5 |         6 
  Nov-2019 |         2          2 |         4 
  Dec-2019 |         2          2 |         4 
  Jan-2020 |         0          1 |         1 
  Feb-2020 |         2          1 |         3 
  Mar-2020 |         2          3 |         5 
  Apr-2020 |         3          2 |         5 
  May-2020 |         4          2 |         6 
  Jun-2020 |         3          2 |         5 
  Jul-2020 |         4          2 |         6 
  Aug-2020 |         1          1 |         2 
  Sep-2020 |         2          4 |         6 
  Oct-2020 |         5          4 |         9 
  Nov-2020 |         4          5 |         9 
  Dec-2020 |         7          3 |        10 
  Jan-2021 |         5          2 |         7 
  Feb-2021 |         4          4 |         8 
  Mar-2021 |         3          1 |         4 
  Apr-2021 |         6          4 |        10 
  May-2021 |         5          6 |        11 
  Jun-2021 |         4          1 |         5 
  Jul-2021 |         9          5 |        14 
  Aug-2021 |         6          5 |        11 
  Sep-2021 |         7          2 |         9 
  Oct-2021 |         9          4 |        13 
  Nov-2021 |         6          3 |         9 
  Dec-2021 |         4          1 |         5 
  Jan-2022 |         5          3 |         8 
  Feb-2022 |         9          4 |        13 
  Mar-2022 |        11          6 |        17 
  Apr-2022 |        10          6 |        16 
  May-2022 |        14          7 |        21 
  Jun-2022 |         9          4 |        13 
  Jul-2022 |        12          7 |        19 
  Aug-2022 |        11          5 |        16 
  Sep-2022 |        14          6 |        20 
  Oct-2022 |        18         11 |        29 
  Nov-2022 |        19          9 |        28 
  Dec-2022 |         9         13 |        22 
  Jan-2023 |        14         11 |        25 
  Feb-2023 |        19         18 |        37 
  Mar-2023 |        13         20 |        33 
  Apr-2023 |        16         12 |        28 
  May-2023 |        14         22 |        36 
  Jun-2023 |        11         26 |        37 
  Jul-2023 |        18         25 |        43 
  Aug-2023 |        17         28 |        45 
  Sep-2023 |        17         25 |        42 
  Oct-2023 |        10         35 |        45 
  Nov-2023 |         9         32 |        41 
  Dec-2023 |        16         30 |        46 
  Jan-2024 |        20         46 |        66 
  Feb-2024 |         8         42 |        50 
  Mar-2024 |         5         46 |        51 
  Apr-2024 |         7         50 |        57 
  May-2024 |         7         52 |        59 
  Jun-2024 |         4         40 |        44 
  Jul-2024 |         6         57 |        63 
  Aug-2024 |         6         50 |        56 
  Sep-2024 |         4         47 |        51 
  Oct-2024 |         2         62 |        64 
  Nov-2024 |         2         52 |        54 
  Dec-2024 |         4         54 |        58 
  Jan-2025 |         0         63 |        63 
  Feb-2025 |         1         57 |        58 
  Mar-2025 |         1         64 |        65 
-----------+----------------------+----------
     Total |       546      1,326 |     1,872 

. tab mo_year_diagn rtt_ref if rheum_appt!=0 & rtt_ref_date<=rheum_appt_date, missing 

Month/Year |
        of |  rtt_ref
 Diagnosis |         1 |     Total
-----------+-----------+----------
  Apr-2017 |         1 |         1 
  May-2017 |         1 |         1 
  Jun-2017 |         1 |         1 
  Aug-2017 |         1 |         1 
  Sep-2017 |         1 |         1 
  Nov-2017 |         1 |         1 
  Feb-2018 |         1 |         1 
  Sep-2018 |         1 |         1 
  Nov-2018 |         1 |         1 
  Nov-2020 |         1 |         1 
  Aug-2021 |         1 |         1 
  May-2023 |         1 |         1 
  Jun-2023 |         1 |         1 
  Oct-2023 |         1 |         1 
  Jan-2024 |         3 |         3 
  Feb-2024 |         2 |         2 
  Apr-2024 |         1 |         1 
  May-2024 |         3 |         3 
  Jul-2024 |         4 |         4 
  Aug-2024 |         2 |         2 
  Sep-2024 |         4 |         4 
  Oct-2024 |         5 |         5 
  Nov-2024 |         1 |         1 
  Dec-2024 |         4 |         4 
  Jan-2025 |         8 |         8 
  Feb-2025 |         8 |         8 
  Mar-2025 |         8 |         8 
-----------+-----------+----------
     Total |        67 |        67 

. 
. ***From clinical events (Nb. low capture of coded rheumatology referrals in clinical events at present)
. tab rheum_ref_gp_preappt, missing //last rheum referral in the 2 years before rheumatology outpatient (requires rh
> eum appt to have been present)

rheum_ref_g |
  p_preappt |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,871       99.95       99.95
          1 |          1        0.05      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab rheum_ref_gp_preappt if rheum_appt!=0 & rheum_ref_gp_preappt_date<=rheum_appt_date, missing  //last rheum refe
> rral in the 2 years before rheumatology outpatient, assuming ref date before rheum appt date (should be accounted 
> for by Python code)

rheum_ref_g |
  p_preappt |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |          1      100.00      100.00
------------+-----------------------------------
      Total |          1      100.00

. tab rheum_ref_gp_precode, missing //last rheum referral in the 2 years before IA code 

rheum_ref_g |
  p_precode |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,861       99.41       99.41
          1 |         11        0.59      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. gen referral_rheum_comb_date = rheum_ref_gp_preappt_date if rheum_ref_gp_preappt_date!=.
(1,871 missing values generated)

. replace referral_rheum_comb_date = rheum_ref_gp_precode_date if rheum_ref_gp_preappt_date==. & rheum_ref_gp_precod
> e_date!=. //combination of the two above
(10 real changes made)

. format %td referral_rheum_comb_date

. 
. ***From GP appointments (proxy)
. tab last_gp_refrheum, missing //proportion with last GP appointment in 2 years before rheum referral (pre-rheum ap
> pt); requires there to have been a rheum referral before a rheum appt

last_gp_ref |
      rheum |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,872      100.00      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. gen last_gp_prerheum_12m=last_gp_prerheum if rheum_appt_date!=. & rheum_appt_date<=(date("$end_date", "DMY")-365)
(1,693 missing values generated)

. recode last_gp_prerheum_12m .=0
(1,693 changes made to last_gp_prerheum_12m)

. lab var last_gp_prerheum_12m "GP and rheum appt 12m+"

. lab define last_gp_prerheum_12m 0 "No" 1 "Yes", modify

. lab val last_gp_prerheum_12m last_gp_prerheum_12m

. 
. gen last_gp_prerheum_6m=last_gp_prerheum if rheum_appt_date!=. & rheum_appt_date<=(date("$end_date", "DMY")-183)
(1,643 missing values generated)

. recode last_gp_prerheum_6m .=0
(1,643 changes made to last_gp_prerheum_6m)

. lab var last_gp_prerheum_6m "GP and rheum appt 6m+"

. lab define last_gp_prerheum_6m 0 "No" 1 "Yes", modify

. lab val last_gp_prerheum_6m last_gp_prerheum_6m

. 
. tab last_gp_refcode, missing //last GP appointment before rheum ref (pre-EIA code ref); requires there to have bee
> n a rheum referral before an EIA code (i.e. rheum appt could have been missing)

last_gp_ref |
       code |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,870       99.89       99.89
          1 |          2        0.11      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab last_gp_prerheum, missing //last GP appointment before rheum appt; requires there to have been a rheum appt be
> fore and EIA code

last_gp_pre |
      rheum |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,759       93.96       93.96
          1 |        113        6.04      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab last_gp_precode, missing //last GP appointment before EIA code

last_gp_pre |
       code |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        977       52.19       52.19
          1 |        895       47.81      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. ****All appts in the correct order (using clinical events referrals)
. gen all_appts=1 if last_gp_refrheum==1 & rheum_ref_gp_preappt==1 & rheum_appt==1 & (last_gp_refrheum_date<=rheum_r
> ef_gp_preappt_date) & (rheum_ref_gp_preappt_date<=rheum_appt_date)
(1,872 missing values generated)

. recode all_appts .=0
(1,872 changes made to all_appts)

. tab all_appts, missing //proportion who had a last gp appt, then rheum ref, then rheum appt

  all_appts |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,872      100.00      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. **Define who qualifies in terms of appointments and referrals ===============================*/
. 
. **AMEND THE BELOW ONCE REFERRAL DATE KNOWN
. 
. **Proportion of patients with at least 6 or 12 months of GP registration after diagnostic code
. rename has_6m_follow_up has_6m_follow_up_s 

. gen has_6m_follow_up=1 if has_6m_follow_up_s=="T"
(1,643 missing values generated)

. recode has_6m_follow_up .=0
(1,643 changes made to has_6m_follow_up)

. drop has_6m_follow_up_s

. tab has_6m_follow_up

has_6m_foll |
      ow_up |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,643       87.77       87.77
          1 |        229       12.23      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. rename has_12m_follow_up has_12m_follow_up_s 

. gen has_12m_follow_up=1 if has_12m_follow_up_s=="T"
(1,693 missing values generated)

. recode has_12m_follow_up .=0
(1,693 changes made to has_12m_follow_up)

. drop has_12m_follow_up_s

. tab has_12m_follow_up 

has_12m_fol |
     low_up |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,693       90.44       90.44
          1 |        179        9.56      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab mo_year_diagn has_6m_follow_up

Month/Year |
        of |   has_6m_follow_up
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         0          2 |         2 
  May-2016 |         1          1 |         2 
  Jun-2016 |         4          1 |         5 
  Jul-2016 |         1          0 |         1 
  Aug-2016 |         1          0 |         1 
  Sep-2016 |         2          0 |         2 
  Oct-2016 |         3          0 |         3 
  Nov-2016 |         1          1 |         2 
  Dec-2016 |         6          0 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         3          0 |         3 
  Apr-2017 |         7          1 |         8 
  May-2017 |         4          2 |         6 
  Jun-2017 |         3          1 |         4 
  Jul-2017 |         4          0 |         4 
  Aug-2017 |         2          1 |         3 
  Sep-2017 |         2          1 |         3 
  Oct-2017 |         3          0 |         3 
  Nov-2017 |         2          1 |         3 
  Dec-2017 |         3          0 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         3          2 |         5 
  Mar-2018 |         3          0 |         3 
  Apr-2018 |         3          0 |         3 
  May-2018 |         1          0 |         1 
  Jun-2018 |         4          0 |         4 
  Jul-2018 |         5          0 |         5 
  Aug-2018 |         2          1 |         3 
  Sep-2018 |         3          2 |         5 
  Oct-2018 |         3          0 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         1          0 |         1 
  Jan-2019 |         3          0 |         3 
  Feb-2019 |         3          0 |         3 
  Mar-2019 |         4          0 |         4 
  Apr-2019 |         3          2 |         5 
  May-2019 |         7          0 |         7 
  Jun-2019 |         5          1 |         6 
  Jul-2019 |         4          0 |         4 
  Aug-2019 |         3          1 |         4 
  Sep-2019 |         5          1 |         6 
  Oct-2019 |         6          0 |         6 
  Nov-2019 |         4          0 |         4 
  Dec-2019 |         4          0 |         4 
  Jan-2020 |         1          0 |         1 
  Feb-2020 |         3          0 |         3 
  Mar-2020 |         5          0 |         5 
  Apr-2020 |         5          0 |         5 
  May-2020 |         6          0 |         6 
  Jun-2020 |         5          0 |         5 
  Jul-2020 |         5          1 |         6 
  Aug-2020 |         2          0 |         2 
  Sep-2020 |         6          0 |         6 
  Oct-2020 |         8          1 |         9 
  Nov-2020 |         8          1 |         9 
  Dec-2020 |         9          1 |        10 
  Jan-2021 |         7          0 |         7 
  Feb-2021 |         8          0 |         8 
  Mar-2021 |         4          0 |         4 
  Apr-2021 |        10          0 |        10 
  May-2021 |        11          0 |        11 
  Jun-2021 |         5          0 |         5 
  Jul-2021 |        13          1 |        14 
  Aug-2021 |         9          2 |        11 
  Sep-2021 |         8          1 |         9 
  Oct-2021 |        13          0 |        13 
  Nov-2021 |         9          0 |         9 
  Dec-2021 |         5          0 |         5 
  Jan-2022 |         8          0 |         8 
  Feb-2022 |        13          0 |        13 
  Mar-2022 |        16          1 |        17 
  Apr-2022 |        14          2 |        16 
  May-2022 |        20          1 |        21 
  Jun-2022 |        13          0 |        13 
  Jul-2022 |        18          1 |        19 
  Aug-2022 |        15          1 |        16 
  Sep-2022 |        18          2 |        20 
  Oct-2022 |        26          3 |        29 
  Nov-2022 |        27          1 |        28 
  Dec-2022 |        20          2 |        22 
  Jan-2023 |        24          1 |        25 
  Feb-2023 |        32          5 |        37 
  Mar-2023 |        30          3 |        33 
  Apr-2023 |        27          1 |        28 
  May-2023 |        32          4 |        36 
  Jun-2023 |        32          5 |        37 
  Jul-2023 |        40          3 |        43 
  Aug-2023 |        38          7 |        45 
  Sep-2023 |        38          4 |        42 
  Oct-2023 |        38          7 |        45 
  Nov-2023 |        39          2 |        41 
  Dec-2023 |        42          4 |        46 
  Jan-2024 |        58          8 |        66 
  Feb-2024 |        39         11 |        50 
  Mar-2024 |        44          7 |        51 
  Apr-2024 |        47         10 |        57 
  May-2024 |        52          7 |        59 
  Jun-2024 |        38          6 |        44 
  Jul-2024 |        54          9 |        63 
  Aug-2024 |        45         11 |        56 
  Sep-2024 |        42          9 |        51 
  Oct-2024 |        60          4 |        64 
  Nov-2024 |        48          6 |        54 
  Dec-2024 |        46         12 |        58 
  Jan-2025 |        51         12 |        63 
  Feb-2025 |        46         12 |        58 
  Mar-2025 |        53         12 |        65 
-----------+----------------------+----------
     Total |     1,643        229 |     1,872 

. tab mo_year_diagn has_12m_follow_up

Month/Year |
        of |   has_12m_follow_up
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         0          2 |         2 
  May-2016 |         1          1 |         2 
  Jun-2016 |         4          1 |         5 
  Jul-2016 |         1          0 |         1 
  Aug-2016 |         1          0 |         1 
  Sep-2016 |         2          0 |         2 
  Oct-2016 |         3          0 |         3 
  Nov-2016 |         1          1 |         2 
  Dec-2016 |         6          0 |         6 
  Jan-2017 |         0          2 |         2 
  Mar-2017 |         3          0 |         3 
  Apr-2017 |         7          1 |         8 
  May-2017 |         4          2 |         6 
  Jun-2017 |         3          1 |         4 
  Jul-2017 |         4          0 |         4 
  Aug-2017 |         2          1 |         3 
  Sep-2017 |         2          1 |         3 
  Oct-2017 |         3          0 |         3 
  Nov-2017 |         2          1 |         3 
  Dec-2017 |         3          0 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         3          2 |         5 
  Mar-2018 |         3          0 |         3 
  Apr-2018 |         3          0 |         3 
  May-2018 |         1          0 |         1 
  Jun-2018 |         4          0 |         4 
  Jul-2018 |         5          0 |         5 
  Aug-2018 |         2          1 |         3 
  Sep-2018 |         3          2 |         5 
  Oct-2018 |         3          0 |         3 
  Nov-2018 |         3          1 |         4 
  Dec-2018 |         1          0 |         1 
  Jan-2019 |         3          0 |         3 
  Feb-2019 |         3          0 |         3 
  Mar-2019 |         4          0 |         4 
  Apr-2019 |         3          2 |         5 
  May-2019 |         7          0 |         7 
  Jun-2019 |         5          1 |         6 
  Jul-2019 |         4          0 |         4 
  Aug-2019 |         3          1 |         4 
  Sep-2019 |         5          1 |         6 
  Oct-2019 |         6          0 |         6 
  Nov-2019 |         4          0 |         4 
  Dec-2019 |         4          0 |         4 
  Jan-2020 |         1          0 |         1 
  Feb-2020 |         3          0 |         3 
  Mar-2020 |         5          0 |         5 
  Apr-2020 |         5          0 |         5 
  May-2020 |         6          0 |         6 
  Jun-2020 |         5          0 |         5 
  Jul-2020 |         5          1 |         6 
  Aug-2020 |         2          0 |         2 
  Sep-2020 |         6          0 |         6 
  Oct-2020 |         8          1 |         9 
  Nov-2020 |         8          1 |         9 
  Dec-2020 |         9          1 |        10 
  Jan-2021 |         7          0 |         7 
  Feb-2021 |         8          0 |         8 
  Mar-2021 |         4          0 |         4 
  Apr-2021 |        10          0 |        10 
  May-2021 |        11          0 |        11 
  Jun-2021 |         5          0 |         5 
  Jul-2021 |        13          1 |        14 
  Aug-2021 |         9          2 |        11 
  Sep-2021 |         8          1 |         9 
  Oct-2021 |        13          0 |        13 
  Nov-2021 |         9          0 |         9 
  Dec-2021 |         5          0 |         5 
  Jan-2022 |         8          0 |         8 
  Feb-2022 |        13          0 |        13 
  Mar-2022 |        16          1 |        17 
  Apr-2022 |        14          2 |        16 
  May-2022 |        20          1 |        21 
  Jun-2022 |        13          0 |        13 
  Jul-2022 |        18          1 |        19 
  Aug-2022 |        15          1 |        16 
  Sep-2022 |        18          2 |        20 
  Oct-2022 |        26          3 |        29 
  Nov-2022 |        27          1 |        28 
  Dec-2022 |        20          2 |        22 
  Jan-2023 |        24          1 |        25 
  Feb-2023 |        32          5 |        37 
  Mar-2023 |        30          3 |        33 
  Apr-2023 |        27          1 |        28 
  May-2023 |        32          4 |        36 
  Jun-2023 |        32          5 |        37 
  Jul-2023 |        40          3 |        43 
  Aug-2023 |        38          7 |        45 
  Sep-2023 |        38          4 |        42 
  Oct-2023 |        38          7 |        45 
  Nov-2023 |        39          2 |        41 
  Dec-2023 |        42          4 |        46 
  Jan-2024 |        58          8 |        66 
  Feb-2024 |        39         11 |        50 
  Mar-2024 |        45          6 |        51 
  Apr-2024 |        50          7 |        57 
  May-2024 |        53          6 |        59 
  Jun-2024 |        38          6 |        44 
  Jul-2024 |        58          5 |        63 
  Aug-2024 |        46         10 |        56 
  Sep-2024 |        46          5 |        51 
  Oct-2024 |        62          2 |        64 
  Nov-2024 |        51          3 |        54 
  Dec-2024 |        53          5 |        58 
  Jan-2025 |        56          7 |        63 
  Feb-2025 |        56          2 |        58 
  Mar-2025 |        62          3 |        65 
-----------+----------------------+----------
     Total |     1,693        179 |     1,872 

. 
. *For appt and csDMARD analyses, all patients must have 1) rheum appt 2) GP appt before rheum appt 3) 12m follow-up
>  after rheum appt 4) 12m of registration after diagnostic code
. gen has_6m_post_appt=1 if rheum_appt_date!=. & rheum_appt_date<=(date("$end_date", "DMY")-183) & has_6m_follow_up=
> =1 & last_gp_prerheum==1
(1,774 missing values generated)

. recode has_6m_post_appt .=0
(1,774 changes made to has_6m_post_appt)

. lab var has_6m_post_appt "GP/rheum/registration 6m+"

. lab define has_6m_post_appt 0 "No" 1 "Yes", modify

. lab val has_6m_post_appt has_6m_post_appt

. tab has_6m_post_appt

GP/rheum/re |
 gistration |
        6m+ |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,774       94.76       94.76
        Yes |         98        5.24      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. gen has_12m_post_appt=1 if rheum_appt_date!=. & rheum_appt_date<=(date("$end_date", "DMY")-365) & has_12m_follow_u
> p==1 & last_gp_prerheum==1
(1,803 missing values generated)

. recode has_12m_post_appt .=0
(1,803 changes made to has_12m_post_appt)

. lab var has_12m_post_appt "GP/rheum/registration 12m+"

. lab define has_12m_post_appt 0 "No" 1 "Yes", modify

. lab val has_12m_post_appt has_12m_post_appt

. tab has_12m_post_appt

GP/rheum/re |
 gistration |
       12m+ |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,803       96.31       96.31
        Yes |         69        3.69      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. *Time to rheum referral =============================================*/
. 
. **AMEND THE BELOW ONCE REFERRAL DATE KNOWN
. 
. **Time from last GP appt to rheum ref before rheum appt (i.e. if appts are present and in correct time order)
. gen time_gp_rheum_ref_appt = (rheum_ref_gp_preappt_date - last_gp_refrheum_date) if rheum_ref_gp_preappt_date!=. &
>  last_gp_refrheum_date!=. & rheum_appt_date!=. & (rheum_ref_gp_preappt_date>=last_gp_refrheum_date) & (rheum_ref_g
> p_preappt_date<=rheum_appt_date)
(1,872 missing values generated)

. tabstat time_gp_rheum_ref_appt, stats (n mean p50 p25 p75) //all patients (should be same number as all_appts)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_gp_rh~t |         0         .         .         .         .
----------------------------------------------------------------

. 
. gen gp_ref_cat=1 if time_gp_rheum_ref_appt<=3 & time_gp_rheum_ref_appt!=. 
(1,872 missing values generated)

. replace gp_ref_cat=2 if time_gp_rheum_ref_appt>3 & time_gp_rheum_ref_appt<=7 & time_gp_rheum_ref_appt!=. & gp_ref_
> cat==.
(0 real changes made)

. replace gp_ref_cat=3 if time_gp_rheum_ref_appt>7 & time_gp_rheum_ref_appt!=. & gp_ref_cat==.
(0 real changes made)

. lab define gp_ref_cat 1 "Within 3 days" 2 "Between 3-7 days" 3 "More than 7 days", modify

. lab val gp_ref_cat gp_ref_cat

. lab var gp_ref_cat "Time to GP referral"

. tab gp_ref_cat, missing

      Time to GP |
        referral |      Freq.     Percent        Cum.
-----------------+-----------------------------------
               . |      1,872      100.00      100.00
-----------------+-----------------------------------
           Total |      1,872      100.00

. 
. gen gp_ref_3d=1 if time_gp_rheum_ref_appt<=3 & time_gp_rheum_ref_appt!=. 
(1,872 missing values generated)

. replace gp_ref_3d=2 if time_gp_rheum_ref_appt>3 & time_gp_rheum_ref_appt!=.
(0 real changes made)

. lab define gp_ref_3d 1 "Within 3 days" 2 "More than 3 days", modify

. lab val gp_ref_3d gp_ref_3d

. lab var gp_ref_3d "Time to GP referral"

. tab gp_ref_3d, missing

      Time to GP |
        referral |      Freq.     Percent        Cum.
-----------------+-----------------------------------
               . |      1,872      100.00      100.00
-----------------+-----------------------------------
           Total |      1,872      100.00

. 
. **Time from last GP to rheum ref before eia code (sensitivity analysis; includes those with no rheum appt)
. gen time_gp_rheum_ref_code = (rheum_ref_gp_precode_date - last_gp_refcode_date) if rheum_ref_gp_precode_date!=. & 
> last_gp_refcode_date!=. & rheum_ref_gp_precode_date>=last_gp_refcode_date & rheum_ref_gp_precode_date<=eia_code_da
> te
(1,870 missing values generated)

. tabstat time_gp_rheum_ref_code, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_gp_rh~e |         2       225       225       206       244
----------------------------------------------------------------

. 
. **Time from last GP to rheum ref (combined - sensitivity analysis; includes those with no rheum appt)
. gen time_gp_rheum_ref_comb = time_gp_rheum_ref_appt 
(1,872 missing values generated)

. replace time_gp_rheum_ref_comb = time_gp_rheum_ref_code if time_gp_rheum_ref_appt==. & time_gp_rheum_ref_code!=.
(2 real changes made)

. tabstat time_gp_rheum_ref_comb, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_gp_rh~b |         2       225       225       206       244
----------------------------------------------------------------

. 
. *Time to rheum appointment=============================================*/
. 
. **AMEND THE BELOW ONCE REFERRAL DATE KNOWN
. 
. **Time from last GP pre-rheum appt to first rheum appt (proxy for referral to appt delay)
. gen time_gp_rheum_appt = (rheum_appt_date - last_gp_prerheum_date) if rheum_appt_date!=. & last_gp_prerheum_date!=
> . & (rheum_appt_date>=last_gp_prerheum_date)
(1,759 missing values generated)

. tabstat time_gp_rheum_appt, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_~m_appt |       113  198.2212       111        52       298
----------------------------------------------------------------

. 
. **Time from rheum ref to rheum appt (i.e. if appts are present and in correct order)
. gen time_ref_rheum_appt = (rheum_appt_date - rheum_ref_gp_preappt_date) if rheum_appt_date!=. & rheum_ref_gp_preap
> pt_date!=. & (rheum_ref_gp_preappt_date<=rheum_appt_date)
(1,871 missing values generated)

. tabstat time_ref_rheum_appt, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_ref_r~t |         1        45        45        45        45
----------------------------------------------------------------

. 
. **Time from rheum appt received date to rheum appt (i.e. if appts are present and in correct order)
. gen time_hes_rheum_appt = (rheum_appt_date - rheum_appt_ref_date) if rheum_appt_date!=. & rheum_appt_ref_date!=. &
>  (rheum_appt_ref_date<=rheum_appt_date)
(1,799 missing values generated)

. tabstat time_hes_rheum_appt, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_hes_r~t |        73  321.6164       185        91       442
----------------------------------------------------------------

. 
. **Time from RTT combined ref date to rheum appt (i.e. if appts are present and in correct order)
. gen time_rtt_rheum_appt = (rheum_appt_date - rtt_ref_date) if rheum_appt_date!=. & rtt_ref_date!=. & (rtt_ref_date
> <=rheum_appt_date)
(1,805 missing values generated)

. tabstat time_rtt_rheum_appt, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_rtt_r~t |        67  326.3433       207        75       426
----------------------------------------------------------------

. 
. **Time from RTT closed ref date to rheum appt (i.e. if appts are present and in correct order)
. gen time_rtt_cl_rheum_appt = (rheum_appt_date - rtt_cl_ref_date) if rheum_appt_date!=. & rtt_cl_ref_date!=. & (rtt
> _cl_ref_date<=rheum_appt_date)
(1,819 missing values generated)

. tabstat time_rtt_cl_rheum_appt, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_rtt_c~t |        53  324.8868       238        76       461
----------------------------------------------------------------

. 
. **Time from RTT open ref date to rheum appt (i.e. if appts are present and in correct order)
. gen time_rtt_op_rheum_appt = (rheum_appt_date - rtt_op_ref_date) if rheum_appt_date!=. & rtt_op_ref_date!=. & (rtt
> _op_ref_date<=rheum_appt_date)
(1,821 missing values generated)

. tabstat time_rtt_op_rheum_appt, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_rtt_o~t |        51  357.0392       246        91       488
----------------------------------------------------------------

. 
. gen gp_appt_cat=1 if time_gp_rheum_appt<=21 & time_gp_rheum_appt!=. 
(1,858 missing values generated)

. replace gp_appt_cat=2 if time_gp_rheum_appt>21 & time_gp_rheum_appt<=42 & time_gp_rheum_appt!=. & gp_appt_cat==.
(10 real changes made)

. replace gp_appt_cat=3 if time_gp_rheum_appt>42 & time_gp_rheum_appt!=. & gp_appt_cat==.
(89 real changes made)

. lab define gp_appt_cat 1 "Within 3 weeks" 2 "Between 3-6 weeks" 3 "More than 6 weeks", modify

. lab val gp_appt_cat gp_appt_cat

. lab var gp_appt_cat "Time to rheumatology assessment, overall"

. tab gp_appt_cat, missing

          Time to |
     rheumatology |
      assessment, |
          overall |      Freq.     Percent        Cum.
------------------+-----------------------------------
   Within 3 weeks |         14        0.75        0.75
Between 3-6 weeks |         10        0.53        1.28
More than 6 weeks |         89        4.75        6.04
                . |      1,759       93.96      100.00
------------------+-----------------------------------
            Total |      1,872      100.00

. 
. forvalues i = 1/$max_year {
  2.     local start = $base_year + `i' - 1
  3.     local end = `start' + 1
  4.         gen gp_appt_cat_`start'=gp_appt_cat if appt_year==`i'
  5.     lab define gp_appt_cat_`start' 1 "Within 3 weeks" 2 "Between 3-6 weeks" 3 "More than 6 weeks", modify
  6.         lab val gp_appt_cat_`start' gp_appt_cat_`start'
  7.         lab var gp_appt_cat_`start' "Time to rheumatology assessment, Apr `start'-Mar `end'"
  8.         tab gp_appt_cat_`start', missing
  9. }
(1,868 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2016-Mar 2017 |      Freq.     Percent        Cum.
------------------+-----------------------------------
   Within 3 weeks |          1        0.05        0.05
More than 6 weeks |          3        0.16        0.21
                . |      1,868       99.79      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,868 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2017-Mar 2018 |      Freq.     Percent        Cum.
------------------+-----------------------------------
   Within 3 weeks |          1        0.05        0.05
More than 6 weeks |          3        0.16        0.21
                . |      1,868       99.79      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,867 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2018-Mar 2019 |      Freq.     Percent        Cum.
------------------+-----------------------------------
   Within 3 weeks |          1        0.05        0.05
More than 6 weeks |          4        0.21        0.27
                . |      1,867       99.73      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,871 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2019-Mar 2020 |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 6 weeks |          1        0.05        0.05
                . |      1,871       99.95      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,871 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2020-Mar 2021 |      Freq.     Percent        Cum.
------------------+-----------------------------------
Between 3-6 weeks |          1        0.05        0.05
                . |      1,871       99.95      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,870 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2021-Mar 2022 |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 6 weeks |          2        0.11        0.11
                . |      1,870       99.89      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,865 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2022-Mar 2023 |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 6 weeks |          7        0.37        0.37
                . |      1,865       99.63      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,829 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2023-Mar 2024 |      Freq.     Percent        Cum.
------------------+-----------------------------------
   Within 3 weeks |          6        0.32        0.32
Between 3-6 weeks |          1        0.05        0.37
More than 6 weeks |         36        1.92        2.30
                . |      1,829       97.70      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,828 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2024-Mar 2025 |      Freq.     Percent        Cum.
------------------+-----------------------------------
   Within 3 weeks |          5        0.27        0.27
Between 3-6 weeks |          8        0.43        0.69
More than 6 weeks |         31        1.66        2.35
                . |      1,828       97.65      100.00
------------------+-----------------------------------
            Total |      1,872      100.00

. 
. gen gp_appt_3w=1 if time_gp_rheum_appt<=21 & time_gp_rheum_appt!=. 
(1,858 missing values generated)

. replace gp_appt_3w=2 if time_gp_rheum_appt>21 & time_gp_rheum_appt!=.
(99 real changes made)

. lab define gp_appt_3w 1 "Within 3 weeks" 2 "More than 3 weeks", modify

. lab val gp_appt_3w gp_appt_3w

. lab var gp_appt_3w "Time to rheumatology assessment, overall"

. tab gp_appt_3w, missing

          Time to |
     rheumatology |
      assessment, |
          overall |      Freq.     Percent        Cum.
------------------+-----------------------------------
   Within 3 weeks |         14        0.75        0.75
More than 3 weeks |         99        5.29        6.04
                . |      1,759       93.96      100.00
------------------+-----------------------------------
            Total |      1,872      100.00

. 
. **AMEND THE BELOW ONCE REFERRAL DATE KNOWN
. 
. gen ref_appt_cat=1 if time_ref_rheum_appt<=21 & time_ref_rheum_appt!=. 
(1,872 missing values generated)

. replace ref_appt_cat=2 if time_ref_rheum_appt>21 & time_ref_rheum_appt<=42 & time_ref_rheum_appt!=. & ref_appt_cat
> ==.
(0 real changes made)

. replace ref_appt_cat=3 if time_ref_rheum_appt>42 & time_ref_rheum_appt!=. & ref_appt_cat==.
(1 real change made)

. lab define ref_appt_cat 1 "Within 3 weeks" 2 "Between 3-6 weeks" 3 "More than 6 weeks", modify

. lab val ref_appt_cat ref_appt_cat

. lab var ref_appt_cat "Time to rheumatology assessment"

. tab ref_appt_cat, missing

          Time to |
     rheumatology |
       assessment |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 6 weeks |          1        0.05        0.05
                . |      1,871       99.95      100.00
------------------+-----------------------------------
            Total |      1,872      100.00

. 
. forvalues i = 1/$max_year {
  2.     local start = $base_year + `i' - 1
  3.     local end = `start' + 1
  4.         gen ref_appt_cat_`start'=ref_appt_cat if appt_year==`i'
  5.     lab define ref_appt_cat_`start' 1 "Within 3 weeks" 2 "Between 3-6 weeks" 3 "More than 6 weeks", modify
  6.         lab val ref_appt_cat_`start' ref_appt_cat_`start'
  7.         lab var ref_appt_cat_`start' "Time to rheumatology assessment, Apr `start'-Mar `end'"
  8.         tab ref_appt_cat_`start', missing
  9. }
(1,872 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2016-Mar 2017 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |      1,872      100.00      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,872 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2017-Mar 2018 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |      1,872      100.00      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,872 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2018-Mar 2019 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |      1,872      100.00      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,872 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2019-Mar 2020 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |      1,872      100.00      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,872 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2020-Mar 2021 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |      1,872      100.00      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,872 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2021-Mar 2022 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |      1,872      100.00      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,872 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2022-Mar 2023 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |      1,872      100.00      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,872 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2023-Mar 2024 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |      1,872      100.00      100.00
------------------+-----------------------------------
            Total |      1,872      100.00
(1,871 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2024-Mar 2025 |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 6 weeks |          1        0.05        0.05
                . |      1,871       99.95      100.00
------------------+-----------------------------------
            Total |      1,872      100.00

. 
. gen ref_appt_3w=1 if time_ref_rheum_appt<=21 & time_ref_rheum_appt!=. 
(1,872 missing values generated)

. replace ref_appt_3w=2 if time_ref_rheum_appt>21 & time_ref_rheum_appt!=.
(1 real change made)

. lab define ref_appt_3w 1 "Within 3 weeks" 2 "More than 3 weeks", modify

. lab val ref_appt_3w ref_appt_3w

. lab var ref_appt_3w "Time to rheumatology assessment"

. tab ref_appt_3w, missing

          Time to |
     rheumatology |
       assessment |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 3 weeks |          1        0.05        0.05
                . |      1,871       99.95      100.00
------------------+-----------------------------------
            Total |      1,872      100.00

. 
. *Time to EIA code==================================================*/
. 
. **Time from last GP pre-code to EIA code (sensitivity analysis; includes those with no rheum ref and/or no rheum a
> ppt)
. gen time_gp_eia_code = (eia_code_date - last_gp_precode_date) if eia_code_date!=. & last_gp_precode_date!=. & eia_
> code_date>=last_gp_precode_date
(977 missing values generated)

. tabstat time_gp_eia_code, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_gp_ei~e |       895   178.933       117        47       262
----------------------------------------------------------------

. 
. **Time from last GP to EIA diagnosis (combined - sensitivity analysis; includes those with no rheum appt)
. gen time_gp_eia_diag = time_gp_rheum_appt
(1,759 missing values generated)

. replace time_gp_eia_diag = time_gp_eia_code if time_gp_rheum_appt==. & time_gp_eia_code!=.
(787 real changes made)

. tabstat time_gp_eia_diag, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_gp_ei~g |       900  181.3911       116        48     266.5
----------------------------------------------------------------

. 
. **Time from rheum ref to EIA code (sensitivity analysis; includes those with no rheum appt)
. gen time_ref_rheum_eia = (eia_code_date - rheum_ref_gp_precode_date) if eia_code_date!=. & rheum_ref_gp_precode_da
> te!=. & rheum_ref_gp_precode_date<=eia_code_date  
(1,861 missing values generated)

. tabstat time_ref_rheum_eia, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_ref_r~a |        11  241.4545       225        84       411
----------------------------------------------------------------

. 
. **Time from rheum ref to EIA diagnosis (combined - sensitivity analysis; includes those with no rheum appt)
. gen time_ref_rheum_eia_comb = time_ref_rheum_appt
(1,871 missing values generated)

. replace time_ref_rheum_eia_comb = time_ref_rheum_eia if time_ref_rheum_appt==. & time_ref_rheum_eia!=.
(10 real changes made)

. tabstat time_ref_rheum_eia_comb, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_ref_r~b |        11  245.4545       225        84       411
----------------------------------------------------------------

. 
. **Time from rheum appt to EIA code
. gen time_rheum_eia_code = (eia_code_date - rheum_appt_date) if eia_code_date!=. & rheum_appt_date!=. 
(1,622 missing values generated)

. tabstat time_rheum_eia_code, stats (n mean p50 p25 p75) 

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_rheum~e |       250   177.468     182.5        80       295
----------------------------------------------------------------

. gen time_rheum2_eia_code = (eia_code_date - rheum_appt2_date) if eia_code_date!=. & rheum_appt2_date!=. 
(1,476 missing values generated)

. tabstat time_rheum2_eia_code, stats (n mean p50 p25 p75) 

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
t~2_eia_code |       396  78.18182        88      22.5       136
----------------------------------------------------------------

. gen time_rheum3_eia_code = (eia_code_date - rheum_appt3_date) if eia_code_date!=. & rheum_appt3_date!=. 
(1,166 missing values generated)

. tabstat time_rheum3_eia_code, stats (n mean p50 p25 p75) 

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
t~3_eia_code |       706  367.6076     381.5       213       544
----------------------------------------------------------------

. 
. *Time from rheum appt to first csDMARD prescriptions in primary care record=======================================
> ===============================*/
. 
. **Time to first csDMARD script not including high cost MTX prescriptions; prescription must be within 6 months of 
> first rheum appt for all csDMARDs below ==================*/
. gen time_to_csdmard=(csdmard_date-rheum_appt_date) if csdmard==1 & rheum_appt_date!=. & (csdmard_date<=(rheum_appt
> _date+183))
(1,771 missing values generated)

. tabstat time_to_csdmard, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_to_cs~d |       101  54.34653        55        -5       115
----------------------------------------------------------------

. 
. **All generate time to first csDMARD script not including high cost MTX prescriptions; with no time restriction ==
> ================*/
. gen time_to_csdmard_unr=(csdmard_date-rheum_appt_date) if csdmard==1 & rheum_appt_date!=.
(1,697 missing values generated)

. tabstat time_to_csdmard_unr, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_to_cs~r |       175    195.44       140        37       279
----------------------------------------------------------------

. 
. /*
> **Time to first csDMARD script for RA patients (including high cost MTX prescriptions)
> gen time_to_csdmard_hcd=(csdmard_hcd_date-rheum_appt_date) if csdmard_hcd==1 & rheum_appt_date!=. & (csdmard_hcd_d
> ate<=rheum_appt_date+183)
> tabstat time_to_csdmard_hcd if ra_code==1, stats (n mean p50 p25 p75) 
> */
. 
. **csDMARD time categories (not including high cost MTX prescriptions)
. gen csdmard_time=1 if time_to_csdmard<=90 & time_to_csdmard!=. 
(1,806 missing values generated)

. replace csdmard_time=2 if time_to_csdmard>90 & time_to_csdmard<=183 & time_to_csdmard!=.
(35 real changes made)

. replace csdmard_time=3 if time_to_csdmard>183 | time_to_csdmard==.
(1,771 real changes made)

. lab define csdmard_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify

. lab val csdmard_time csdmard_time

. lab var csdmard_time "csDMARD in primary care, overall" 

. tab csdmard_time, missing

       csDMARD in primary care, |
                        overall |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |         66        3.53        3.53
                     3-6 months |         35        1.87        5.40
No prescription within 6 months |      1,771       94.60      100.00
--------------------------------+-----------------------------------
                          Total |      1,872      100.00

. tab csdmard_time if has_6m_follow_up==1, missing

       csDMARD in primary care, |
                        overall |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |         61       26.64       26.64
                     3-6 months |         33       14.41       41.05
No prescription within 6 months |        135       58.95      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00

. tab csdmard_time if ra_code==1 & has_6m_follow_up==1, missing 

       csDMARD in primary care, |
                        overall |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |         47       25.27       25.27
                     3-6 months |         27       14.52       39.78
No prescription within 6 months |        112       60.22      100.00
--------------------------------+-----------------------------------
                          Total |        186      100.00

. tab csdmard_time if psa_code==1 & has_6m_follow_up==1, missing

       csDMARD in primary care, |
                        overall |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          5       29.41       29.41
                     3-6 months |          5       29.41       58.82
No prescription within 6 months |          7       41.18      100.00
--------------------------------+-----------------------------------
                          Total |         17      100.00

. tab csdmard_time if anksp_code==1 & has_6m_follow_up==1, missing

       csDMARD in primary care, |
                        overall |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          8       36.36       36.36
No prescription within 6 months |         14       63.64      100.00
--------------------------------+-----------------------------------
                          Total |         22      100.00

. tab csdmard_time if undiff_code==1 & has_6m_follow_up==1, missing

       csDMARD in primary care, |
                        overall |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          1       25.00       25.00
                     3-6 months |          1       25.00       50.00
No prescription within 6 months |          2       50.00      100.00
--------------------------------+-----------------------------------
                          Total |          4      100.00

. 
. forvalues i = 1/$max_year {
  2.     local start = $base_year + `i' - 1
  3.     local end = `start' + 1
  4.         gen csdmard_time_`start'=csdmard_time if appt_year==`i'
  5.         recode csdmard_time_`start' .=4
  6.     lab define csdmard_time_`start' 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months" 4 "O
> utside `start'/`end'", modify
  7.         lab val csdmard_time_`start' csdmard_time_`start'
  8.         lab var csdmard_time_`start' "csDMARD in primary care, Apr `start'-Mar `end'"
  9.         tab csdmard_time_`start' if has_6m_follow_up==1, missing
 10. }
(1,866 missing values generated)
(1,866 changes made to csdmard_time_2016)

   csDMARD in primary care, Apr |
                  2016-Mar 2017 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          2        0.87        0.87
                     3-6 months |          3        1.31        2.18
No prescription within 6 months |          1        0.44        2.62
              Outside 2016/2017 |        223       97.38      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00
(1,867 missing values generated)
(1,867 changes made to csdmard_time_2017)

   csDMARD in primary care, Apr |
                  2017-Mar 2018 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          2        0.87        0.87
No prescription within 6 months |          3        1.31        2.18
              Outside 2017/2018 |        224       97.82      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00
(1,866 missing values generated)
(1,866 changes made to csdmard_time_2018)

   csDMARD in primary care, Apr |
                  2018-Mar 2019 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          1        0.44        0.44
No prescription within 6 months |          5        2.18        2.62
              Outside 2018/2019 |        223       97.38      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00
(1,868 missing values generated)
(1,868 changes made to csdmard_time_2019)

   csDMARD in primary care, Apr |
                  2019-Mar 2020 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
No prescription within 6 months |          4        1.75        1.75
              Outside 2019/2020 |        225       98.25      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00
(1,868 missing values generated)
(1,868 changes made to csdmard_time_2020)

   csDMARD in primary care, Apr |
                  2020-Mar 2021 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                     3-6 months |          1        0.44        0.44
No prescription within 6 months |          3        1.31        1.75
              Outside 2020/2021 |        225       98.25      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00
(1,862 missing values generated)
(1,862 changes made to csdmard_time_2021)

   csDMARD in primary care, Apr |
                  2021-Mar 2022 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                     3-6 months |          4        1.75        1.75
No prescription within 6 months |          6        2.62        4.37
              Outside 2021/2022 |        219       95.63      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00
(1,829 missing values generated)
(1,829 changes made to csdmard_time_2022)

   csDMARD in primary care, Apr |
                  2022-Mar 2023 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          7        3.06        3.06
                     3-6 months |          8        3.49        6.55
No prescription within 6 months |         28       12.23       18.78
              Outside 2022/2023 |        186       81.22      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00
(1,777 missing values generated)
(1,777 changes made to csdmard_time_2023)

   csDMARD in primary care, Apr |
                  2023-Mar 2024 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |         28       12.23       12.23
                     3-6 months |         10        4.37       16.59
No prescription within 6 months |         57       24.89       41.48
              Outside 2023/2024 |        134       58.52      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00
(1,801 missing values generated)
(1,801 changes made to csdmard_time_2024)

   csDMARD in primary care, Apr |
                  2024-Mar 2025 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |         16        6.99        6.99
                     3-6 months |          7        3.06       10.04
No prescription within 6 months |         27       11.79       21.83
              Outside 2024/2025 |        179       78.17      100.00
--------------------------------+-----------------------------------
                          Total |        229      100.00

. 
. **csDMARD time categories - binary 6 months
. gen csdmard_6m=1 if time_to_csdmard<=183 & time_to_csdmard!=. 
(1,771 missing values generated)

. replace csdmard_6m=0 if time_to_csdmard>183 | time_to_csdmard==.
(1,771 real changes made)

. lab define csdmard_6m 1 "Yes" 0 "No", modify

. lab val csdmard_6m csdmard_6m

. lab var csdmard_6m "csDMARD in primary care within 6 months" 

. tab csdmard_6m, missing 

 csDMARD in |
    primary |
care within |
   6 months |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,771       94.60       94.60
        Yes |        101        5.40      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. /*
> **csDMARD time categories (including high cost MTX prescriptions)
> gen csdmard_hcd_time=1 if time_to_csdmard_hcd<=90 & time_to_csdmard_hcd!=. 
> replace csdmard_hcd_time=2 if time_to_csdmard_hcd>90 & time_to_csdmard_hcd<=183 & time_to_csdmard_hcd!=.
> replace csdmard_hcd_time=3 if time_to_csdmard_hcd>183 | time_to_csdmard_hcd==.
> lab define csdmard_hcd_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify
> lab val csdmard_hcd_time csdmard_hcd_time
> lab var csdmard_hcd_time "csDMARD in primary care" 
> tab csdmard_hcd_time if ra_code==1, missing 
> tab csdmard_hcd_time if psa_code==1, missing
> tab csdmard_hcd_time if anksp_code==1, missing 
> tab csdmard_hcd_time if undiff_code==1, missing
> */
. 
. **What was first csDMARD in GP record (not including high cost MTX prescriptions) - with time restriction - may ne
> ed to remove leflunomide (for OpenSAFELY report) due to small counts at more granular time periods
. gen first_csD=""
(1,872 missing values generated)

. foreach var of varlist hydroxychloroquine_date mtx_date sulfasalazine_date leflunomide_date {
  2.         replace first_csD="`var'" if csdmard_date==`var' & csdmard_date!=. & (`var'<=(rheum_appt_date+183)) & t
> ime_to_csdmard!=.
  3.         }
variable first_csD was str1 now str23
(14 real changes made)
(71 real changes made)
(7 real changes made)
(9 real changes made)

. gen first_csDMARD = substr(first_csD, 1, length(first_csD) - 5) if first_csD!="" 
(1,771 missing values generated)

. drop first_csD

. replace first_csDMARD="Methotrexate" if first_csDMARD=="mtx"
(71 real changes made)

. replace first_csDMARD="Sulfasalazine" if first_csDMARD=="sulfasalazine"
(7 real changes made)

. replace first_csDMARD="Hydroxychloroquine" if first_csDMARD=="hydroxychloroquine" 
(14 real changes made)

. replace first_csDMARD="Leflunomide" if first_csDMARD=="leflunomide" 
(9 real changes made)

. tab first_csDMARD if ra_code==1 //for RA patients

     first_csDMARD |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |         12       15.00       15.00
       Leflunomide |          8       10.00       25.00
      Methotrexate |         54       67.50       92.50
     Sulfasalazine |          6        7.50      100.00
-------------------+-----------------------------------
             Total |         80      100.00

. tab first_csDMARD if psa_code==1 //for PsA patients

     first_csDMARD |      Freq.     Percent        Cum.
-------------------+-----------------------------------
       Leflunomide |          1        9.09        9.09
      Methotrexate |         10       90.91      100.00
-------------------+-----------------------------------
             Total |         11      100.00

. tab first_csDMARD if anksp_code==1 //for axSpA patients

     first_csDMARD |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |          1       12.50       12.50
      Methotrexate |          7       87.50      100.00
-------------------+-----------------------------------
             Total |          8      100.00

. tab first_csDMARD if undiff_code==1 //for Undiff IA patients

     first_csDMARD |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |          1       50.00       50.00
     Sulfasalazine |          1       50.00      100.00
-------------------+-----------------------------------
             Total |          2      100.00

. 
. **What was first csDMARD in GP record (not including high cost MTX prescriptions) - without time restriction
. gen first_csD_unr=""
(1,872 missing values generated)

. foreach var of varlist hydroxychloroquine_date mtx_date sulfasalazine_date leflunomide_date {
  2.         replace first_csD_unr="`var'" if csdmard_date==`var' & csdmard_date!=.
  3.         }
variable first_csD_unr was str1 now str23
(274 real changes made)
(1,065 real changes made)
(166 real changes made)
(140 real changes made)

. gen first_csDMARD_unr = substr(first_csD_unr, 1, length(first_csD_unr) - 5) if first_csD_unr!="" 
(228 missing values generated)

. drop first_csD_unr

. replace first_csDMARD_unr="Methotrexate" if first_csDMARD_unr=="mtx"
(1,064 real changes made)

. replace first_csDMARD_unr="Sulfasalazine" if first_csDMARD_unr=="sulfasalazine"
(166 real changes made)

. replace first_csDMARD_unr="Hydroxychloroquine" if first_csDMARD_unr=="hydroxychloroquine" 
(274 real changes made)

. replace first_csDMARD_unr="Leflunomide" if first_csDMARD_unr=="leflunomide" 
(140 real changes made)

. tab first_csDMARD_unr if ra_code==1 //for RA patients

 first_csDMARD_unr |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |        218       16.38       16.38
       Leflunomide |        110        8.26       24.64
      Methotrexate |        863       64.84       89.48
     Sulfasalazine |        140       10.52      100.00
-------------------+-----------------------------------
             Total |      1,331      100.00

. tab first_csDMARD_unr if psa_code==1 //for PsA patients

 first_csDMARD_unr |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |         29       16.96       16.96
       Leflunomide |         13        7.60       24.56
      Methotrexate |        114       66.67       91.23
     Sulfasalazine |         15        8.77      100.00
-------------------+-----------------------------------
             Total |        171      100.00

. tab first_csDMARD_unr if anksp_code==1 //for axSpA patients

 first_csDMARD_unr |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |         22       18.80       18.80
       Leflunomide |         15       12.82       31.62
      Methotrexate |         72       61.54       93.16
     Sulfasalazine |          8        6.84      100.00
-------------------+-----------------------------------
             Total |        117      100.00

. tab first_csDMARD_unr if undiff_code==1 //for Undiff IA patients

 first_csDMARD_unr |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |          5       20.00       20.00
       Leflunomide |          2        8.00       28.00
      Methotrexate |         15       60.00       88.00
     Sulfasalazine |          3       12.00      100.00
-------------------+-----------------------------------
             Total |         25      100.00

. 
. /*
> **What was first csDMARD in GP record (including high cost MTX prescriptions)
> gen first_csD_hcd=""
> foreach var of varlist hydroxychloroquine_date methotrexate_date methotrexate_hcd_date sulfasalazine_date leflunom
> ide_date {
>         replace first_csD_hcd="`var'" if csdmard_hcd_date==`var' & csdmard_hcd_date!=. & (csdmard_hcd_date<=rheum_
> appt_date+183) & time_to_csdmard_hcd!=.
>         }
> gen first_csDMARD_hcd = substr(first_csD_hcd, 1, length(first_csD_hcd) - 5) if first_csD_hcd!=""
> drop first_csD_hcd
> tab first_csDMARD_hcd if ra_code==1 //for RA patients
> tab first_csDMARD_hcd if psa_code==1 //for PsA patients
> tab first_csDMARD_hcd if anksp_code==1 //for axSpA patients
> tab first_csDMARD_hcd if undiff_code==1 //for Undiff IA patients
> */
.  
. /*
> **Methotrexate use (including high cost MTX prescriptions)
> gen mtx_hcd=1 if methotrexate==1 | methotrexate_inj==1 | methotrexate_hcd==1
> recode mtx_hcd .=0 
> */
. 
. /*
> **Date of first methotrexate script (including high cost MTX prescriptions)
> gen mtx_hcd_date=min(methotrexate_date, methotrexate_inj_date, methotrexate_hcd_date)
> format %td mtx_hcd_date
> */
. 
. **Methotrexate use (not including high cost MTX prescriptions); Nb. this is just a check; need time-to-MTX instead
>  (below)
. gen mtx_6m = 1 if mtx==1 & rheum_appt==1 & (mtx_date<=rheum_appt_date+183) 
(1,789 missing values generated)

. recode mtx_6m .=0
(1,789 changes made to mtx_6m)

. gen mtx_12m = 1 if mtx==1 & rheum_appt==1 & (mtx_date<=rheum_appt_date+365)
(1,743 missing values generated)

. recode mtx_12m .=0
(1,743 changes made to mtx_12m)

. 
. tab mtx if ra_code==1 //for RA patients

Methotrexat |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        273       17.89       17.89
          1 |      1,253       82.11      100.00
------------+-----------------------------------
      Total |      1,526      100.00

. tab mtx_6m if ra_code==1 //with 6-month limit

     mtx_6m |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,463       95.87       95.87
          1 |         63        4.13      100.00
------------+-----------------------------------
      Total |      1,526      100.00

. tab mtx_12m if ra_code==1 //with 12-month limit

    mtx_12m |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,427       93.51       93.51
          1 |         99        6.49      100.00
------------+-----------------------------------
      Total |      1,526      100.00

. tab mtx if psa_code==1 //for PsA patients

Methotrexat |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         31       16.15       16.15
          1 |        161       83.85      100.00
------------+-----------------------------------
      Total |        192      100.00

. tab mtx_6m if psa_code==1 //with 6-month limit

     mtx_6m |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        182       94.79       94.79
          1 |         10        5.21      100.00
------------+-----------------------------------
      Total |        192      100.00

. tab mtx_12m if psa_code==1 //with 12-month limit

    mtx_12m |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        180       93.75       93.75
          1 |         12        6.25      100.00
------------+-----------------------------------
      Total |        192      100.00

. tab mtx if undiff_code==1 //for undiff IA patients

Methotrexat |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         25      100.00      100.00
------------+-----------------------------------
      Total |         25      100.00

. tab mtx_6m if undiff_code==1 //with 6-month limit

     mtx_6m |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         23       92.00       92.00
          1 |          2        8.00      100.00
------------+-----------------------------------
      Total |         25      100.00

. tab mtx_12m if undiff_code==1 //with 12-month limit

    mtx_12m |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         22       88.00       88.00
          1 |          3       12.00      100.00
------------+-----------------------------------
      Total |         25      100.00

. 
. /*
> **Methotrexate use (including high cost MTX prescriptions)
> tab mtx_hcd if ra_code==1 //for RA patients
> tab mtx_hcd if ra_code==1 & (mtx_hcd_date<=rheum_appt_date+183) //with 6-month limit
> tab mtx_hcd if ra_code==1 & (mtx_hcd_date<=rheum_appt_date+365) //with 12-month limit
> tab mtx_hcd if psa_code==1 //for PsA patients
> tab mtx_hcd if psa_code==1 & (mtx_hcd_date<=rheum_appt_date+183) //with 6-month limit
> tab mtx_hcd if psa_code==1 & (mtx_hcd_date<=rheum_appt_date+365) //with 12-month limit
> tab mtx_hcd if undiff_code==1 //for undiff IA patients
> tab mtx_hcd if undiff_code==1 & (mtx_hcd_date<=rheum_appt_date+183) //with 6-month limit
> tab mtx_hcd if undiff_code==1 & (mtx_hcd_date<=rheum_appt_date+365) //with 12-month limit
> */
. 
. **Check if medication issued >once
. gen mtx_shared=1 if mtx==1 & (methotrexate_oral_count>1 | methotrexate_inj_count>1)
(677 missing values generated)

. recode mtx_shared .=0
(677 changes made to mtx_shared)

. tab mtx_shared

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        677       36.16       36.16
          1 |      1,195       63.84      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. **Methotrexate use (shared care)
. tab mtx_shared if ra_code==1 //for RA patients; Nb. this is just a check; need time-to-MTX instead (below)

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        548       35.91       35.91
          1 |        978       64.09      100.00
------------+-----------------------------------
      Total |      1,526      100.00

. tab mtx_shared if ra_code==1 & (mtx_date<=rheum_appt_date+183) //with 6-month limit

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        438       31.65       31.65
          1 |        946       68.35      100.00
------------+-----------------------------------
      Total |      1,384      100.00

. tab mtx_shared if psa_code==1 //for PsA patients

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         75       39.06       39.06
          1 |        117       60.94      100.00
------------+-----------------------------------
      Total |        192      100.00

. tab mtx_shared if psa_code==1 & (mtx_date<=rheum_appt_date+183) //with 6-month limit

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         69       37.50       37.50
          1 |        115       62.50      100.00
------------+-----------------------------------
      Total |        184      100.00

. tab mtx_shared if undiff_code==1 //for undiff IA patients

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         10       40.00       40.00
          1 |         15       60.00      100.00
------------+-----------------------------------
      Total |         25      100.00

. tab mtx_shared if undiff_code==1 & (mtx_date<=rheum_appt_date+183) //with 6-month limit

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |          8       34.78       34.78
          1 |         15       65.22      100.00
------------+-----------------------------------
      Total |         23      100.00

. 
. **Check medication issue number
. gen mtx_issue=0 if mtx==1 & (methotrexate_oral_count==0 | methotrexate_inj_count==0)
(1,388 missing values generated)

. replace mtx_issue=1 if mtx==1 & (methotrexate_oral_count==1 | methotrexate_inj_count==1)
(711 real changes made)

. replace mtx_issue=2 if mtx==1 & (methotrexate_oral_count>1 | methotrexate_inj_count>1)
(1,195 real changes made)

. tab mtx_issue

  mtx_issue |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        355       22.90       22.90
          2 |      1,195       77.10      100.00
------------+-----------------------------------
      Total |      1,550      100.00

. 
. **Time to first methotrexate script for RA patients (not including high cost MTX prescriptions) - with time restri
> ction
. gen time_to_mtx=(mtx_date-rheum_appt_date) if mtx==1 & rheum_appt_date!=. & (mtx_date<=rheum_appt_date+183)
(1,789 missing values generated)

. tabstat time_to_mtx if ra_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_mtx |        63  59.14286        65       -17       115
----------------------------------------------------------------

. 
. /*
> **Time to first methotrexate script for RA patients (including high cost MTX prescriptions)
> gen time_to_mtx_hcd=(mtx_hcd_date-rheum_appt_date) if mtx_hcd==1 & rheum_appt_date!=. & (mtx_hcd_date<=rheum_appt_
> date+183)
> tabstat time_to_mtx_hcd if ra_code==1, stats (n mean p50 p25 p75)
> */
. 
. **Time to first methotrexate script for PsA patients (not including high cost MTX prescriptions)
. tabstat time_to_mtx if psa_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_mtx |        10      65.3        79        -1       132
----------------------------------------------------------------

. 
. /*
> **Time to first methotrexate script for PsA patients (including high cost MTX prescriptions)
> tabstat time_to_mtx_hcd if psa_code==1, stats (n mean p50 p25 p75)
> */
. 
. **Time to first methotrexate script for Undiff IA patients (not including high cost MTX prescriptions)
. tabstat time_to_mtx if undiff_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_mtx |         2     104.5     104.5        38       171
----------------------------------------------------------------

. 
. **Methotrexate time categories (not including high-cost MTX) - those with prescription date after 6 months (i.e. m
> issing) are still counted
. gen mtx_time=1 if time_to_mtx<=90 & time_to_mtx!=. 
(1,820 missing values generated)

. replace mtx_time=2 if time_to_mtx>90 & time_to_mtx<=183 & time_to_mtx!=.
(31 real changes made)

. replace mtx_time=3 if time_to_mtx>183 | time_to_mtx==.
(1,789 real changes made)

. lab define mtx_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify

. lab val mtx_time mtx_time

. lab var mtx_time "Methotrexate in primary care" 

. tab mtx_time if ra_code==1, missing 

   Methotrexate in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |         38        2.49        2.49
                     3-6 months |         25        1.64        4.13
No prescription within 6 months |      1,463       95.87      100.00
--------------------------------+-----------------------------------
                          Total |      1,526      100.00

. tab mtx_time if psa_code==1, missing

   Methotrexate in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          6        3.12        3.12
                     3-6 months |          4        2.08        5.21
No prescription within 6 months |        182       94.79      100.00
--------------------------------+-----------------------------------
                          Total |        192      100.00

. tab mtx_time if undiff_code==1, missing 

   Methotrexate in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          1        4.00        4.00
                     3-6 months |          1        4.00        8.00
No prescription within 6 months |         23       92.00      100.00
--------------------------------+-----------------------------------
                          Total |         25      100.00

. 
. /*
> **Methotrexate time categories for RA patients (including high-cost MTX)
> gen mtx_hcd_time=1 if time_to_mtx_hcd<=90 & time_to_mtx_hcd!=. 
> replace mtx_hcd_time=2 if time_to_mtx_hcd>90 & time_to_mtx_hcd<=183 & time_to_mtx_hcd!=.
> replace mtx_hcd_time=3 if time_to_mtx_hcd>183 | time_to_mtx_hcd==.
> lab define mtx_hcd_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify
> lab val mtx_hcd_time mtx_hcd_time
> lab var mtx_hcd_time "Methotrexate in primary care" 
> tab mtx_hcd_time if ra_code==1, missing 
> tab mtx_hcd_time if psa_code==1, missing
> tab mtx_hcd_time if undiff_code==1, missing 
> */
. 
. **Sulfasalazine use
. gen ssz=1 if sulfasalazine==1
(1,080 missing values generated)

. recode ssz .=0
(1,080 changes made to ssz)

. gen ssz_6m = 1 if sulfasalazine==1 & rheum_appt==1 & (sulfasalazine_date<=rheum_appt_date+183) 
(1,857 missing values generated)

. recode ssz_6m .=0
(1,857 changes made to ssz_6m)

. gen ssz_12m = 1 if sulfasalazine==1 & rheum_appt==1 & (sulfasalazine_date<=rheum_appt_date+365)
(1,843 missing values generated)

. recode ssz_12m .=0
(1,843 changes made to ssz_12m)

. 
. **Time to first sulfasalazine script for RA patients
. gen time_to_ssz=(sulfasalazine_date-rheum_appt_date) if sulfasalazine_date!=. & rheum_appt_date!=. & (sulfasalazin
> e_date<=rheum_appt_date+183)
(1,857 missing values generated)

. tabstat time_to_ssz if ra_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_ssz |        13  89.76923       128         1       134
----------------------------------------------------------------

. tabstat time_to_ssz if psa_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_ssz |         0         .         .         .         .
----------------------------------------------------------------

. 
. **Sulfasalazine time categories  
. gen ssz_time=1 if time_to_ssz<=90 & time_to_ssz!=. 
(1,867 missing values generated)

. replace ssz_time=2 if time_to_ssz>90 & time_to_ssz<=183 & time_to_ssz!=.
(10 real changes made)

. replace ssz_time=3 if time_to_ssz>183 | time_to_ssz==.
(1,857 real changes made)

. lab define ssz_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify

. lab val ssz_time ssz_time

. lab var ssz_time "Sulfasalazine in primary care" 

. tab ssz_time if ra_code==1, missing 

  Sulfasalazine in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          4        0.26        0.26
                     3-6 months |          9        0.59        0.85
No prescription within 6 months |      1,513       99.15      100.00
--------------------------------+-----------------------------------
                          Total |      1,526      100.00

. tab ssz_time if psa_code==1, missing

  Sulfasalazine in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
No prescription within 6 months |        192      100.00      100.00
--------------------------------+-----------------------------------
                          Total |        192      100.00

. tab ssz_time if undiff_code==1, missing 

  Sulfasalazine in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          1        4.00        4.00
No prescription within 6 months |         24       96.00      100.00
--------------------------------+-----------------------------------
                          Total |         25      100.00

. 
. **Check if medication issued >once
. gen ssz_shared=1 if ssz==1 & sulfasalazine_count>1
(1,588 missing values generated)

. recode ssz_shared .=0
(1,588 changes made to ssz_shared)

. tab ssz_shared

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,588       84.83       84.83
          1 |        284       15.17      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. **sulfasalazine use (shared care)
. tab ssz_shared if ra_code==1 

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,292       84.67       84.67
          1 |        234       15.33      100.00
------------+-----------------------------------
      Total |      1,526      100.00

. tab ssz_shared if ra_code==1 & (sulfasalazine_date<=rheum_appt_date+183)

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,106       82.91       82.91
          1 |        228       17.09      100.00
------------+-----------------------------------
      Total |      1,334      100.00

. tab ssz_shared if psa_code==1 

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        167       86.98       86.98
          1 |         25       13.02      100.00
------------+-----------------------------------
      Total |        192      100.00

. tab ssz_shared if psa_code==1 & (sulfasalazine_date<=rheum_appt_date+183) 

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        149       85.63       85.63
          1 |         25       14.37      100.00
------------+-----------------------------------
      Total |        174      100.00

. tab ssz_shared if undiff_code==1

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         24       96.00       96.00
          1 |          1        4.00      100.00
------------+-----------------------------------
      Total |         25      100.00

. tab ssz_shared if undiff_code==1 & (sulfasalazine_date<=rheum_appt_date+183)

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         21       95.45       95.45
          1 |          1        4.55      100.00
------------+-----------------------------------
      Total |         22      100.00

. 
. **Check medication issue number
. gen ssz_issue=0 if ssz==1 & sulfasalazine_count==0 
(1,872 missing values generated)

. replace ssz_issue=1 if ssz==1 & sulfasalazine_count==1 
(508 real changes made)

. replace ssz_issue=2 if ssz==1 & sulfasalazine_count>1
(284 real changes made)

. tab ssz_issue

  ssz_issue |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        508       64.14       64.14
          2 |        284       35.86      100.00
------------+-----------------------------------
      Total |        792      100.00

. 
. **Hydroxychloroquine use
. gen hcq=1 if hydroxychloroquine==1
(838 missing values generated)

. recode hcq .=0
(838 changes made to hcq)

. gen hcq_6m = 1 if hydroxychloroquine==1 & rheum_appt==1 & (hydroxychloroquine_date<=rheum_appt_date+183) 
(1,852 missing values generated)

. recode hcq_6m .=0
(1,852 changes made to hcq_6m)

. gen hcq_12m = 1 if hydroxychloroquine==1 & rheum_appt==1 & (hydroxychloroquine_date<=rheum_appt_date+365)
(1,826 missing values generated)

. recode hcq_12m .=0 
(1,826 changes made to hcq_12m)

. 
. **Time to first hydroxychloroquine script for RA patients
. gen time_to_hcq=(hydroxychloroquine_date-rheum_appt_date) if hydroxychloroquine_date!=. & rheum_appt_date!=. & (hy
> droxychloroquine_date<=rheum_appt_date+183)
(1,852 missing values generated)

. tabstat time_to_hcq if ra_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_hcq |        17  61.58824        56         7       113
----------------------------------------------------------------

. tabstat time_to_hcq if psa_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_hcq |         1       182       182       182       182
----------------------------------------------------------------

. 
. **Hydroxychloroquine time categories  
. gen hcq_time=1 if time_to_hcq<=90 & time_to_hcq!=. 
(1,860 missing values generated)

. replace hcq_time=2 if time_to_hcq>90 & time_to_hcq<=183 & time_to_hcq!=.
(8 real changes made)

. replace hcq_time=3 if time_to_hcq>183 | time_to_hcq==.
(1,852 real changes made)

. lab define hcq_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify

. lab val hcq_time hcq_time

. lab var hcq_time "Hydroxychloroquine in primary care" 

. tab hcq_time if ra_code==1, missing 

  Hydroxychloroquine in primary |
                           care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |         11        0.72        0.72
                     3-6 months |          6        0.39        1.11
No prescription within 6 months |      1,509       98.89      100.00
--------------------------------+-----------------------------------
                          Total |      1,526      100.00

. tab hcq_time if psa_code==1, missing

  Hydroxychloroquine in primary |
                           care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                     3-6 months |          1        0.52        0.52
No prescription within 6 months |        191       99.48      100.00
--------------------------------+-----------------------------------
                          Total |        192      100.00

. tab hcq_time if undiff_code==1, missing 

  Hydroxychloroquine in primary |
                           care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                     3-6 months |          1        4.00        4.00
No prescription within 6 months |         24       96.00      100.00
--------------------------------+-----------------------------------
                          Total |         25      100.00

. 
. **Check if medication issued >once
. gen hcq_shared=1 if hcq==1 & hydroxychloroquine_count>1
(1,360 missing values generated)

. recode hcq_shared .=0
(1,360 changes made to hcq_shared)

. tab hcq_shared

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,360       72.65       72.65
          1 |        512       27.35      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. **hydroxychloroquine use (shared care)
. tab hcq_shared if ra_code==1 

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,106       72.48       72.48
          1 |        420       27.52      100.00
------------+-----------------------------------
      Total |      1,526      100.00

. tab hcq_shared if ra_code==1 & (hydroxychloroquine_date<=rheum_appt_date+183)

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        936       69.96       69.96
          1 |        402       30.04      100.00
------------+-----------------------------------
      Total |      1,338      100.00

. tab hcq_shared if psa_code==1 

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        147       76.56       76.56
          1 |         45       23.44      100.00
------------+-----------------------------------
      Total |        192      100.00

. tab hcq_shared if psa_code==1 & (hydroxychloroquine_date<=rheum_appt_date+183) 

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        131       74.86       74.86
          1 |         44       25.14      100.00
------------+-----------------------------------
      Total |        175      100.00

. tab hcq_shared if undiff_code==1

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         16       64.00       64.00
          1 |          9       36.00      100.00
------------+-----------------------------------
      Total |         25      100.00

. tab hcq_shared if undiff_code==1 & (hydroxychloroquine_date<=rheum_appt_date+183)

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         14       63.64       63.64
          1 |          8       36.36      100.00
------------+-----------------------------------
      Total |         22      100.00

. 
. **Check medication issue number
. gen hcq_issue=0 if hcq==1 & hydroxychloroquine_count==0 
(1,872 missing values generated)

. replace hcq_issue=1 if hcq==1 & hydroxychloroquine_count==1 
(522 real changes made)

. replace hcq_issue=2 if hcq==1 & hydroxychloroquine_count>1
(512 real changes made)

. tab hcq_issue

  hcq_issue |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        522       50.48       50.48
          2 |        512       49.52      100.00
------------+-----------------------------------
      Total |      1,034      100.00

. 
. **Leflunomide use
. gen lef=1 if leflunomide==1
(1,211 missing values generated)

. recode lef .=0 
(1,211 changes made to lef)

. gen lef_6m = 1 if leflunomide==1 & rheum_appt==1 & (leflunomide_date<=rheum_appt_date+183) 
(1,856 missing values generated)

. recode lef_6m .=0
(1,856 changes made to lef_6m)

. gen lef_12m = 1 if leflunomide==1 & rheum_appt==1 & (leflunomide_date<=rheum_appt_date+365)
(1,846 missing values generated)

. recode lef_12m .=0 
(1,846 changes made to lef_12m)

. 
. **Time to first leflunomide script for RA patients
. gen time_to_lef=(leflunomide_date-rheum_appt_date) if leflunomide_date!=. & rheum_appt_date!=. & (leflunomide_date
> <=rheum_appt_date+183)
(1,856 missing values generated)

. tabstat time_to_lef if ra_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_lef |        14  95.85714       135        19       154
----------------------------------------------------------------

. tabstat time_to_lef if psa_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_lef |         2      70.5      70.5        26       115
----------------------------------------------------------------

. 
. **Leflunomide time categories  
. gen lef_time=1 if time_to_lef<=90 & time_to_lef!=. 
(1,865 missing values generated)

. replace lef_time=2 if time_to_lef>90 & time_to_lef<=183 & time_to_lef!=.
(9 real changes made)

. replace lef_time=3 if time_to_lef>183 | time_to_lef==.
(1,856 real changes made)

. lab define lef_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify

. lab val lef_time lef_time

. lab var lef_time "Leflunomide in primary care" 

. tab lef_time if ra_code==1, missing 

    Leflunomide in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          6        0.39        0.39
                     3-6 months |          8        0.52        0.92
No prescription within 6 months |      1,512       99.08      100.00
--------------------------------+-----------------------------------
                          Total |      1,526      100.00

. tab lef_time if psa_code==1, missing

    Leflunomide in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          1        0.52        0.52
                     3-6 months |          1        0.52        1.04
No prescription within 6 months |        190       98.96      100.00
--------------------------------+-----------------------------------
                          Total |        192      100.00

. tab lef_time if undiff_code==1, missing 

    Leflunomide in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
No prescription within 6 months |         25      100.00      100.00
--------------------------------+-----------------------------------
                          Total |         25      100.00

. 
. **Check if medication issued >once
. gen lef_shared=1 if lef==1 & leflunomide_count>1
(1,678 missing values generated)

. recode lef_shared .=0
(1,678 changes made to lef_shared)

. tab lef_shared

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,678       89.64       89.64
          1 |        194       10.36      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. **leflunomide use (shared care)
. tab lef_shared if ra_code==1 

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,362       89.25       89.25
          1 |        164       10.75      100.00
------------+-----------------------------------
      Total |      1,526      100.00

. tab lef_shared if ra_code==1 & (leflunomide_date<=rheum_appt_date+183)

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,177       88.16       88.16
          1 |        158       11.84      100.00
------------+-----------------------------------
      Total |      1,335      100.00

. tab lef_shared if psa_code==1 

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        176       91.67       91.67
          1 |         16        8.33      100.00
------------+-----------------------------------
      Total |        192      100.00

. tab lef_shared if psa_code==1 & (leflunomide_date<=rheum_appt_date+183) 

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        160       90.91       90.91
          1 |         16        9.09      100.00
------------+-----------------------------------
      Total |        176      100.00

. tab lef_shared if undiff_code==1

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         23       92.00       92.00
          1 |          2        8.00      100.00
------------+-----------------------------------
      Total |         25      100.00

. tab lef_shared if undiff_code==1 & (leflunomide_date<=rheum_appt_date+183)

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         19       90.48       90.48
          1 |          2        9.52      100.00
------------+-----------------------------------
      Total |         21      100.00

. 
. **Check medication issue number
. gen lef_issue=0 if lef==1 & leflunomide_count==0 
(1,872 missing values generated)

. replace lef_issue=1 if lef==1 & leflunomide_count==1 
(467 real changes made)

. replace lef_issue=2 if lef==1 & leflunomide_count>1
(194 real changes made)

. tab lef_issue

  lef_issue |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        467       70.65       70.65
          2 |        194       29.35      100.00
------------+-----------------------------------
      Total |        661      100.00

. 
. **For all csDMARDs, check if issued more than once 
. gen csdmard_shared=1 if lef_shared==1 | mtx_shared==1 | hcq_shared==1 | ssz_shared==1 
(598 missing values generated)

. recode csdmard_shared .=0
(598 changes made to csdmard_shared)

. tab csdmard_shared

csdmard_sha |
        red |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        598       31.94       31.94
          1 |      1,274       68.06      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. tab csdmard //for comparison

    csdmard |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        228       12.18       12.18
          1 |      1,644       87.82      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
. **Generate number of csDMARDs by time-points
. gen csdmard_num_6m =.
(1,872 missing values generated)

. replace csdmard_num_6m = 0 if (mtx_6m + ssz_6m + hcq_6m + lef_6m ==0)
(1,771 real changes made)

. replace csdmard_num_6m = 1 if (mtx_6m + ssz_6m + hcq_6m + lef_6m ==1)
(72 real changes made)

. replace csdmard_num_6m = 2 if (mtx_6m + ssz_6m + hcq_6m + lef_6m ==2)
(25 real changes made)

. replace csdmard_num_6m = 3 if (mtx_6m + ssz_6m + hcq_6m + lef_6m >2)
(4 real changes made)

. lab var csdmard_num_6m "Number of csDMARDs by 6 months"

. lab define csdmard_num_6m 0 "0" 1 "1" 2 "2" 3 ">2"

. lab val csdmard_num_6m csdmard_num_6m

. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. tab csdmard_num_6m, missing

  Number of |
csDMARDs by |
   6 months |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,771       94.60       94.60
          1 |         72        3.85       98.45
          2 |         25        1.34       99.79
         >2 |          4        0.21      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. lab define csdmard_num_6m 0 "0" 1 "1" 2 "2" 3 "More than 2"
label csdmard_num_6m already defined
r(110);

end of do-file

r(110);

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. lab define csdmard_num_6m 0 "0" 1 "1" 2 "2" 3 "More than 2", modify

. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. tab csdmard_num_6m, missing

  Number of |
csDMARDs by |
   6 months |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,771       94.60       94.60
          1 |         72        3.85       98.45
          2 |         25        1.34       99.79
More than 2 |          4        0.21      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
end of do-file

. br mtx_6m ssz_6m hcq_6m lef_6m csdmard_num_6m

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. gen csdmard_num_12m =.
(1,872 missing values generated)

. replace csdmard_num_12m = 0 if (mtx_12m + ssz_12m + hcq_12m + lef_12m ==0)
(1,722 real changes made)

. replace csdmard_num_12m = 1 if (mtx_12m + ssz_12m + hcq_12m + lef_12m ==1)
(95 real changes made)

. replace csdmard_num_12m = 2 if (mtx_12m + ssz_12m + hcq_12m + lef_12m ==2)
(35 real changes made)

. replace csdmard_num_12m = 3 if (mtx_12m + ssz_12m + hcq_12m + lef_12m >2)
(20 real changes made)

. lab var csdmard_num_12m "Number of csDMARDs by 12 months"

. lab define csdmard_num_12m 0 "0" 1 "1" 2 "2" 3 "3 or more", modify

. lab val csdmard_num_12m csdmard_num_12m

. tab csdmard_num_12m, missing

  Number of |
csDMARDs by |
  12 months |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,722       91.99       91.99
          1 |         95        5.07       97.06
          2 |         35        1.87       98.93
  3 or more |         20        1.07      100.00
------------+-----------------------------------
      Total |      1,872      100.00

. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. gen csdmard_comb_6m =.
(1,872 missing values generated)

. replace csdmard_comb_6m = 0 if (mtx_6m + ssz_6m + hcq_6m + lef_6m ==0)
(1,771 real changes made)

. replace csdmard_comb_6m = 1 if (mtx_6m==1 & ssz_6m!=1 & hcq_6m!=1 & lef_6m!=1)
(57 real changes made)

. replace csdmard_comb_6m = 2 if (mtx_6m==1 & (ssz_6m==1 | hcq_6m==1 | lef_6m==1))
(26 real changes made)

. replace csdmard_comb_6m = 3 if (mtx_6m!=1 & (ssz_6m==1 | hcq_6m==1 | lef_6m==1))
(18 real changes made)

. lab var csdmard_comb_6m "csDMARDs by 6 months"

. lab define csdmard_comb_6m 0 "No csDMARDs" 1 "Methotrexate monotherapy" 2 "Methotrexate combination therapy" 3 "No
> n-methotrexate csDMARD(s)", modify

. lab val csdmard_comb_6m csdmard_comb_6m

. tab csdmard_comb_6m, missing

            csDMARDs by 6 months |      Freq.     Percent        Cum.
---------------------------------+-----------------------------------
                     No csDMARDs |      1,771       94.60       94.60
        Methotrexate monotherapy |         57        3.04       97.65
Methotrexate combination therapy |         26        1.39       99.04
     Non-methotrexate csDMARD(s) |         18        0.96      100.00
---------------------------------+-----------------------------------
                           Total |      1,872      100.00

. 
end of do-file

. br mtx_6m ssz_6m hcq_6m lef_6m csdmard_num_6m rheum_appt_date mtx_date sulfasalazine_date hydroxychloroquine_date 
> leflunomide_date csdmard_num_6m csdmard_comb_6m csdmard_num_12m

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. gen csdmard_comb_12m =.
(1,872 missing values generated)

. replace csdmard_comb_12m = 0 if (mtx_12m + ssz_12m + hcq_12m + lef_12m ==0)
(1,722 real changes made)

. replace csdmard_comb_12m = 1 if (mtx_12m==1 & ssz_12m!=1 & hcq_12m!=1 & lef_12m!=1)
(76 real changes made)

. replace csdmard_comb_12m = 2 if (mtx_12m==1 & (ssz_12m==1 | hcq_12m==1 | lef_12m==1))
(53 real changes made)

. replace csdmard_comb_12m = 3 if (mtx_12m!=1 & (ssz_12m==1 | hcq_12m==1 | lef_12m==1))
(21 real changes made)

. lab var csdmard_comb_12m "csDMARDs by 12 months"

. lab define csdmard_comb_12m 0 "No csDMARDs" 1 "Methotrexate monotherapy" 2 "Methotrexate combination therapy" 3 "N
> on-methotrexate csDMARD(s)", modify

. lab val csdmard_comb_12m csdmard_comb_12m

. tab csdmard_comb_12m, missing

           csDMARDs by 12 months |      Freq.     Percent        Cum.
---------------------------------+-----------------------------------
                     No csDMARDs |      1,722       91.99       91.99
        Methotrexate monotherapy |         76        4.06       96.05
Methotrexate combination therapy |         53        2.83       98.88
     Non-methotrexate csDMARD(s) |         21        1.12      100.00
---------------------------------+-----------------------------------
                           Total |      1,872      100.00

.  
. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. import delimited "$projectdir/output/dataset.csv", clear
(encoding automatically selected: ISO-8859-1)
(102 vars, 1,895 obs)

. 
. **Set Ado file path
. adopath + "$projectdir/analysis/extra_ados"
  [1]  (BASE)      "C:\Program Files\Stata18\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata18\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "C:\Users\Mark\ado\personal/"
  [5]  (PLUS)      "C:\Users\Mark\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "C:\Users\Mark\OneDrive\PhD Project\OpenSAFELY NEIAA\inflammatory_rheum/analysis/extra_ados"

. 
. **Set index dates ===========================================================*/
. global start_date = "01/04/2016" //for outpatient analyses, data may only be available from April 2019

. global end_date = "31/03/2025"

. global base_year = year(date("$start_date", "DMY"))

. global end_year = year(date("$end_date", "DMY"))

. global max_year = $end_year - $base_year

. 
. **Conversion for dates====================================================*
. 
. ***Variables ending in _date that are string
. ds *_date, has(type string)
eia_code_d~e  chd_before~e  depr_befor~e  lung_ca_af~e  rf_test_date  r~eappt_date  sulfasalaz~e  rtt_cl_sta~e
ra_code_date  dm_before_~e  osteop_bef~e  solid_ca_a~e  ccp_test_d~e  rheum~e_date  hydroxychl~e  rtt_cl_ref~e
psa_code_d~e  ild_before~e  frac_befor~e  haem_ca_af~e  bmi_date      ~erheum_date  steroids_d~e  rtt_cl_end~e
anksp_code~e  copd_befor~e  dem_before~e  ckd_after_~e  r~_appt_date  l~ecode_date  lef_last_d~e  rtt_op_sta~e
undiff_cod~e  cva_before~e  chd_after_~e  depr_after~e  rheum~f_date  ~frheum_date  mtx_oral_l~e  rtt_op_ref~e
rf_code_date  lung_ca_be~e  dm_after_d~e  osteop_aft~e  rheum~y_date  l~fcode_date  mtx_inj_la~e  rtt_op_end~e
ccp_code_d~e  solid_ca_b~e  ild_after_~e  frac_after~e  rheum~2_date  leflunomid~e  ssz_last_d~e
seropositi~e  haem_ca_be~e  copd_after~e  dem_after_~e  rheum~3_date  metho~l_date  hcq_last_d~e
erosive_ra~e  ckd_before~e  cva_after_~e  creatinin~te  rheum~4_date  metho~j_date  steroid_la~e

. local string_dates `r(varlist)'

. foreach var of local string_dates {
  2.     gen `var'_num = date(`var', "YMD")
  3.     format `var'_num %td
  4.     order `var'_num, after(`var')
  5.     drop `var'
  6.     rename `var'_num `var'
  7. }
(324 missing values generated)
(1,723 missing values generated)
(1,733 missing values generated)
(1,850 missing values generated)
(1,880 missing values generated)
(1,878 missing values generated)
(1,694 missing values generated)
(1,865 missing values generated)
(1,665 missing values generated)
(1,793 missing values generated)
(1,693 missing values generated)
(1,854 missing values generated)
(1,674 missing values generated)
(1,630 missing values generated)
(357 missing values generated)
(1,296 missing values generated)
(1,618 missing values generated)
(1,809 missing values generated)
(1,870 missing values generated)
(1,893 missing values generated)
(1,657 missing values generated)
(1,577 missing values generated)
(1,773 missing values generated)
(1,698 missing values generated)
(1,835 missing values generated)
(1,647 missing values generated)
(1,578 missing values generated)
(215 missing values generated)
(1,230 missing values generated)
(1,554 missing values generated)
(1,791 missing values generated)
(1,845 missing values generated)
(1,890 missing values generated)
(1,623 missing values generated)
(1,882 missing values generated)
(1,857 missing values generated)
(1,885 missing values generated)
(1,894 missing values generated)
(1,253 missing values generated)
(1,253 missing values generated)
(745 missing values generated)
(909 missing values generated)
(630 missing values generated)
(389 missing values generated)
(1,887 missing values generated)
(1,875 missing values generated)
(1,527 missing values generated)
(784 missing values generated)
(1,892 missing values generated)
(1,887 missing values generated)
(1,319 missing values generated)
(764 missing values generated)
(543 missing values generated)
(1,197 missing values generated)
(962 missing values generated)
(351 missing values generated)
(1,319 missing values generated)
(764 missing values generated)
(543 missing values generated)
(1,197 missing values generated)
(962 missing values generated)
(351 missing values generated)
(735 missing values generated)
(735 missing values generated)
(735 missing values generated)
(724 missing values generated)
(724 missing values generated)
(724 missing values generated)

. 
. ***Variables ending in _date that are numeric
. foreach var of varlist *_date {
  2.     capture confirm string variable `var'
  3.     if _rc != 0 {
  4.         format `var' %td
  5.     }
  6. }

. 
. ***Create binary indicator for each
. ds *_date
eia_code_d~e  chd_before~e  depr_befor~e  lung_ca_af~e  rf_test_date  r~eappt_date  sulfasalaz~e  rtt_cl_sta~e
ra_code_date  dm_before_~e  osteop_bef~e  solid_ca_a~e  ccp_test_d~e  rheum~e_date  hydroxychl~e  rtt_cl_ref~e
psa_code_d~e  ild_before~e  frac_befor~e  haem_ca_af~e  bmi_date      ~erheum_date  steroids_d~e  rtt_cl_end~e
anksp_code~e  copd_befor~e  dem_before~e  ckd_after_~e  r~_appt_date  l~ecode_date  lef_last_d~e  rtt_op_sta~e
undiff_cod~e  cva_before~e  chd_after_~e  depr_after~e  rheum~f_date  ~frheum_date  mtx_oral_l~e  rtt_op_ref~e
rf_code_date  lung_ca_be~e  dm_after_d~e  osteop_aft~e  rheum~y_date  l~fcode_date  mtx_inj_la~e  rtt_op_end~e
ccp_code_d~e  solid_ca_b~e  ild_after_~e  frac_after~e  rheum~2_date  leflunomid~e  ssz_last_d~e
seropositi~e  haem_ca_be~e  copd_after~e  dem_after_~e  rheum~3_date  metho~l_date  hcq_last_d~e
erosive_ra~e  ckd_before~e  cva_after_~e  creatinin~te  rheum~4_date  metho~j_date  steroid_la~e

. local dates `r(varlist)'

. foreach var of local dates {
  2.         local newvar =  substr("`var'", 1, length("`var'") - 5)
  3.         gen `newvar' = (`var'!=. )
  4.         order `newvar', after(`var')
  5. }

. 
end of do-file

. br

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. import delimited "$projectdir/output/dataset.csv", clear
(encoding automatically selected: ISO-8859-1)
(102 vars, 1,895 obs)

. 
. **Set Ado file path
. adopath + "$projectdir/analysis/extra_ados"
  [1]  (BASE)      "C:\Program Files\Stata18\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata18\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "C:\Users\Mark\ado\personal/"
  [5]  (PLUS)      "C:\Users\Mark\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "C:\Users\Mark\OneDrive\PhD Project\OpenSAFELY NEIAA\inflammatory_rheum/analysis/extra_ados"

. 
. **Set index dates ===========================================================*/
. global start_date = "01/04/2016" //for outpatient analyses, data may only be available from April 2019

. global end_date = "31/03/2025"

. global base_year = year(date("$start_date", "DMY"))

. global end_year = year(date("$end_date", "DMY"))

. global max_year = $end_year - $base_year

. 
. **Conversion for dates====================================================*
. 
. ***Variables ending in _date that are string
. ds *_date, has(type string)
eia_code_d~e  chd_before~e  depr_befor~e  lung_ca_af~e  rf_test_date  r~eappt_date  sulfasalaz~e  rtt_cl_sta~e
ra_code_date  dm_before_~e  osteop_bef~e  solid_ca_a~e  ccp_test_d~e  rheum~e_date  hydroxychl~e  rtt_cl_ref~e
psa_code_d~e  ild_before~e  frac_befor~e  haem_ca_af~e  bmi_date      ~erheum_date  steroids_d~e  rtt_cl_end~e
anksp_code~e  copd_befor~e  dem_before~e  ckd_after_~e  r~_appt_date  l~ecode_date  lef_last_d~e  rtt_op_sta~e
undiff_cod~e  cva_before~e  chd_after_~e  depr_after~e  rheum~f_date  ~frheum_date  mtx_oral_l~e  rtt_op_ref~e
rf_code_date  lung_ca_be~e  dm_after_d~e  osteop_aft~e  rheum~y_date  l~fcode_date  mtx_inj_la~e  rtt_op_end~e
ccp_code_d~e  solid_ca_b~e  ild_after_~e  frac_after~e  rheum~2_date  leflunomid~e  ssz_last_d~e
seropositi~e  haem_ca_be~e  copd_after~e  dem_after_~e  rheum~3_date  metho~l_date  hcq_last_d~e
erosive_ra~e  ckd_before~e  cva_after_~e  creatinin~te  rheum~4_date  metho~j_date  steroid_la~e

. local string_dates `r(varlist)'

. foreach var of local string_dates {
  2.     gen `var'_num = date(`var', "YMD")
  3.     format `var'_num %td
  4.     order `var'_num, after(`var')
  5.     drop `var'
  6.     rename `var'_num `var'
  7. }
(324 missing values generated)
(1,723 missing values generated)
(1,733 missing values generated)
(1,850 missing values generated)
(1,880 missing values generated)
(1,878 missing values generated)
(1,694 missing values generated)
(1,865 missing values generated)
(1,665 missing values generated)
(1,793 missing values generated)
(1,693 missing values generated)
(1,854 missing values generated)
(1,674 missing values generated)
(1,630 missing values generated)
(357 missing values generated)
(1,296 missing values generated)
(1,618 missing values generated)
(1,809 missing values generated)
(1,870 missing values generated)
(1,893 missing values generated)
(1,657 missing values generated)
(1,577 missing values generated)
(1,773 missing values generated)
(1,698 missing values generated)
(1,835 missing values generated)
(1,647 missing values generated)
(1,578 missing values generated)
(215 missing values generated)
(1,230 missing values generated)
(1,554 missing values generated)
(1,791 missing values generated)
(1,845 missing values generated)
(1,890 missing values generated)
(1,623 missing values generated)
(1,882 missing values generated)
(1,857 missing values generated)
(1,885 missing values generated)
(1,894 missing values generated)
(1,253 missing values generated)
(1,253 missing values generated)
(745 missing values generated)
(909 missing values generated)
(630 missing values generated)
(389 missing values generated)
(1,887 missing values generated)
(1,875 missing values generated)
(1,527 missing values generated)
(784 missing values generated)
(1,892 missing values generated)
(1,887 missing values generated)
(1,319 missing values generated)
(764 missing values generated)
(543 missing values generated)
(1,197 missing values generated)
(962 missing values generated)
(351 missing values generated)
(1,319 missing values generated)
(764 missing values generated)
(543 missing values generated)
(1,197 missing values generated)
(962 missing values generated)
(351 missing values generated)
(735 missing values generated)
(735 missing values generated)
(735 missing values generated)
(724 missing values generated)
(724 missing values generated)
(724 missing values generated)

. 
. ***Variables ending in _date that are numeric
. foreach var of varlist *_date {
  2.     capture confirm string variable `var'
  3.     if _rc != 0 {
  4.         format `var' %td
  5.     }
  6. }

. 
. ***Create binary indicator for each
. ds *_date
eia_code_d~e  chd_before~e  depr_befor~e  lung_ca_af~e  rf_test_date  r~eappt_date  sulfasalaz~e  rtt_cl_sta~e
ra_code_date  dm_before_~e  osteop_bef~e  solid_ca_a~e  ccp_test_d~e  rheum~e_date  hydroxychl~e  rtt_cl_ref~e
psa_code_d~e  ild_before~e  frac_befor~e  haem_ca_af~e  bmi_date      ~erheum_date  steroids_d~e  rtt_cl_end~e
anksp_code~e  copd_befor~e  dem_before~e  ckd_after_~e  r~_appt_date  l~ecode_date  lef_last_d~e  rtt_op_sta~e
undiff_cod~e  cva_before~e  chd_after_~e  depr_after~e  rheum~f_date  ~frheum_date  mtx_oral_l~e  rtt_op_ref~e
rf_code_date  lung_ca_be~e  dm_after_d~e  osteop_aft~e  rheum~y_date  l~fcode_date  mtx_inj_la~e  rtt_op_end~e
ccp_code_d~e  solid_ca_b~e  ild_after_~e  frac_after~e  rheum~2_date  leflunomid~e  ssz_last_d~e
seropositi~e  haem_ca_be~e  copd_after~e  dem_after_~e  rheum~3_date  metho~l_date  hcq_last_d~e
erosive_ra~e  ckd_before~e  cva_after_~e  creatinin~te  rheum~4_date  metho~j_date  steroid_la~e

. local dates `r(varlist)'

. foreach var of local dates {
  2.         local newvar =  substr("`var'", 1, length("`var'") - 5)
  3.         gen `newvar' = (`var'!=. )
  4.         order `newvar', after(`var')
  5.         lab define `newvar' 0 "No" 1 "Yes"
  6.         lab val `newvar' `newvar'
  7. }

. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. import delimited "$projectdir/output/dataset.csv", clear
(encoding automatically selected: ISO-8859-1)
(102 vars, 1,895 obs)

. 
. **Set Ado file path
. adopath + "$projectdir/analysis/extra_ados"
  [1]  (BASE)      "C:\Program Files\Stata18\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata18\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "C:\Users\Mark\ado\personal/"
  [5]  (PLUS)      "C:\Users\Mark\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "C:\Users\Mark\OneDrive\PhD Project\OpenSAFELY NEIAA\inflammatory_rheum/analysis/extra_ados"

. 
. **Set index dates ===========================================================*/
. global start_date = "01/04/2016" //for outpatient analyses, data may only be available from April 2019

. global end_date = "31/03/2025"

. global base_year = year(date("$start_date", "DMY"))

. global end_year = year(date("$end_date", "DMY"))

. global max_year = $end_year - $base_year

. 
. **Conversion for dates====================================================*
. 
. ***Variables ending in _date that are string
. ds *_date, has(type string)
eia_code_d~e  chd_before~e  depr_befor~e  lung_ca_af~e  rf_test_date  r~eappt_date  sulfasalaz~e  rtt_cl_sta~e
ra_code_date  dm_before_~e  osteop_bef~e  solid_ca_a~e  ccp_test_d~e  rheum~e_date  hydroxychl~e  rtt_cl_ref~e
psa_code_d~e  ild_before~e  frac_befor~e  haem_ca_af~e  bmi_date      ~erheum_date  steroids_d~e  rtt_cl_end~e
anksp_code~e  copd_befor~e  dem_before~e  ckd_after_~e  r~_appt_date  l~ecode_date  lef_last_d~e  rtt_op_sta~e
undiff_cod~e  cva_before~e  chd_after_~e  depr_after~e  rheum~f_date  ~frheum_date  mtx_oral_l~e  rtt_op_ref~e
rf_code_date  lung_ca_be~e  dm_after_d~e  osteop_aft~e  rheum~y_date  l~fcode_date  mtx_inj_la~e  rtt_op_end~e
ccp_code_d~e  solid_ca_b~e  ild_after_~e  frac_after~e  rheum~2_date  leflunomid~e  ssz_last_d~e
seropositi~e  haem_ca_be~e  copd_after~e  dem_after_~e  rheum~3_date  metho~l_date  hcq_last_d~e
erosive_ra~e  ckd_before~e  cva_after_~e  creatinin~te  rheum~4_date  metho~j_date  steroid_la~e

. local string_dates `r(varlist)'

. foreach var of local string_dates {
  2.     gen `var'_num = date(`var', "YMD")
  3.     format `var'_num %td
  4.     order `var'_num, after(`var')
  5.     drop `var'
  6.     rename `var'_num `var'
  7. }
(324 missing values generated)
(1,723 missing values generated)
(1,733 missing values generated)
(1,850 missing values generated)
(1,880 missing values generated)
(1,878 missing values generated)
(1,694 missing values generated)
(1,865 missing values generated)
(1,665 missing values generated)
(1,793 missing values generated)
(1,693 missing values generated)
(1,854 missing values generated)
(1,674 missing values generated)
(1,630 missing values generated)
(357 missing values generated)
(1,296 missing values generated)
(1,618 missing values generated)
(1,809 missing values generated)
(1,870 missing values generated)
(1,893 missing values generated)
(1,657 missing values generated)
(1,577 missing values generated)
(1,773 missing values generated)
(1,698 missing values generated)
(1,835 missing values generated)
(1,647 missing values generated)
(1,578 missing values generated)
(215 missing values generated)
(1,230 missing values generated)
(1,554 missing values generated)
(1,791 missing values generated)
(1,845 missing values generated)
(1,890 missing values generated)
(1,623 missing values generated)
(1,882 missing values generated)
(1,857 missing values generated)
(1,885 missing values generated)
(1,894 missing values generated)
(1,253 missing values generated)
(1,253 missing values generated)
(745 missing values generated)
(909 missing values generated)
(630 missing values generated)
(389 missing values generated)
(1,887 missing values generated)
(1,875 missing values generated)
(1,527 missing values generated)
(784 missing values generated)
(1,892 missing values generated)
(1,887 missing values generated)
(1,319 missing values generated)
(764 missing values generated)
(543 missing values generated)
(1,197 missing values generated)
(962 missing values generated)
(351 missing values generated)
(1,319 missing values generated)
(764 missing values generated)
(543 missing values generated)
(1,197 missing values generated)
(962 missing values generated)
(351 missing values generated)
(735 missing values generated)
(735 missing values generated)
(735 missing values generated)
(724 missing values generated)
(724 missing values generated)
(724 missing values generated)

. 
. ***Variables ending in _date that are numeric
. foreach var of varlist *_date {
  2.     capture confirm string variable `var'
  3.     if _rc != 0 {
  4.         format `var' %td
  5.     }
  6. }

. 
. ***Create binary indicator for each
. ds *_date
eia_code_d~e  chd_before~e  depr_befor~e  lung_ca_af~e  rf_test_date  r~eappt_date  sulfasalaz~e  rtt_cl_sta~e
ra_code_date  dm_before_~e  osteop_bef~e  solid_ca_a~e  ccp_test_d~e  rheum~e_date  hydroxychl~e  rtt_cl_ref~e
psa_code_d~e  ild_before~e  frac_befor~e  haem_ca_af~e  bmi_date      ~erheum_date  steroids_d~e  rtt_cl_end~e
anksp_code~e  copd_befor~e  dem_before~e  ckd_after_~e  r~_appt_date  l~ecode_date  lef_last_d~e  rtt_op_sta~e
undiff_cod~e  cva_before~e  chd_after_~e  depr_after~e  rheum~f_date  ~frheum_date  mtx_oral_l~e  rtt_op_ref~e
rf_code_date  lung_ca_be~e  dm_after_d~e  osteop_aft~e  rheum~y_date  l~fcode_date  mtx_inj_la~e  rtt_op_end~e
ccp_code_d~e  solid_ca_b~e  ild_after_~e  frac_after~e  rheum~2_date  leflunomid~e  ssz_last_d~e
seropositi~e  haem_ca_be~e  copd_after~e  dem_after_~e  rheum~3_date  metho~l_date  hcq_last_d~e
erosive_ra~e  ckd_before~e  cva_after_~e  creatinin~te  rheum~4_date  metho~j_date  steroid_la~e

. local dates `r(varlist)'

. foreach var of local dates {
  2.         local newvar =  substr("`var'", 1, length("`var'") - 5)
  3.         gen `newvar' = (`var'!=. )
  4.         order `newvar', after(`var')
  5.         lab define `newvar' 0 "No" 1 "Yes"
  6.         lab val `newvar' `newvar'
  7.         tab `newvar', missing
  8. }

   eia_code |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |      1,895      100.00      100.00
------------+-----------------------------------
      Total |      1,895      100.00

    ra_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        324       17.10       17.10
        Yes |      1,571       82.90      100.00
------------+-----------------------------------
      Total |      1,895      100.00

   psa_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,723       90.92       90.92
        Yes |        172        9.08      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 anksp_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,733       91.45       91.45
        Yes |        162        8.55      100.00
------------+-----------------------------------
      Total |      1,895      100.00

undiff_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,850       97.63       97.63
        Yes |         45        2.37      100.00
------------+-----------------------------------
      Total |      1,895      100.00

    rf_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,880       99.21       99.21
        Yes |         15        0.79      100.00
------------+-----------------------------------
      Total |      1,895      100.00

   ccp_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,878       99.10       99.10
        Yes |         17        0.90      100.00
------------+-----------------------------------
      Total |      1,895      100.00

seropositiv |
     e_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,694       89.39       89.39
        Yes |        201       10.61      100.00
------------+-----------------------------------
      Total |      1,895      100.00

erosive_ra_ |
       code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,865       98.42       98.42
        Yes |         30        1.58      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 chd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,665       87.86       87.86
        Yes |        230       12.14      100.00
------------+-----------------------------------
      Total |      1,895      100.00

  dm_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,793       94.62       94.62
        Yes |        102        5.38      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 ild_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,693       89.34       89.34
        Yes |        202       10.66      100.00
------------+-----------------------------------
      Total |      1,895      100.00

copd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,854       97.84       97.84
        Yes |         41        2.16      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 cva_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,674       88.34       88.34
        Yes |        221       11.66      100.00
------------+-----------------------------------
      Total |      1,895      100.00

lung_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,630       86.02       86.02
        Yes |        265       13.98      100.00
------------+-----------------------------------
      Total |      1,895      100.00

solid_ca_be |
       fore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        357       18.84       18.84
        Yes |      1,538       81.16      100.00
------------+-----------------------------------
      Total |      1,895      100.00

haem_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,296       68.39       68.39
        Yes |        599       31.61      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 ckd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,618       85.38       85.38
        Yes |        277       14.62      100.00
------------+-----------------------------------
      Total |      1,895      100.00

depr_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,809       95.46       95.46
        Yes |         86        4.54      100.00
------------+-----------------------------------
      Total |      1,895      100.00

osteop_befo |
         re |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,870       98.68       98.68
        Yes |         25        1.32      100.00
------------+-----------------------------------
      Total |      1,895      100.00

frac_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,893       99.89       99.89
        Yes |          2        0.11      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 dem_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,657       87.44       87.44
        Yes |        238       12.56      100.00
------------+-----------------------------------
      Total |      1,895      100.00

  chd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,577       83.22       83.22
        Yes |        318       16.78      100.00
------------+-----------------------------------
      Total |      1,895      100.00

   dm_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,773       93.56       93.56
        Yes |        122        6.44      100.00
------------+-----------------------------------
      Total |      1,895      100.00

  ild_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,698       89.60       89.60
        Yes |        197       10.40      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 copd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,835       96.83       96.83
        Yes |         60        3.17      100.00
------------+-----------------------------------
      Total |      1,895      100.00

  cva_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,647       86.91       86.91
        Yes |        248       13.09      100.00
------------+-----------------------------------
      Total |      1,895      100.00

lung_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,578       83.27       83.27
        Yes |        317       16.73      100.00
------------+-----------------------------------
      Total |      1,895      100.00

solid_ca_af |
        ter |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        215       11.35       11.35
        Yes |      1,680       88.65      100.00
------------+-----------------------------------
      Total |      1,895      100.00

haem_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,230       64.91       64.91
        Yes |        665       35.09      100.00
------------+-----------------------------------
      Total |      1,895      100.00

  ckd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,554       82.01       82.01
        Yes |        341       17.99      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 depr_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,791       94.51       94.51
        Yes |        104        5.49      100.00
------------+-----------------------------------
      Total |      1,895      100.00

osteop_afte |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,845       97.36       97.36
        Yes |         50        2.64      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 frac_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,890       99.74       99.74
        Yes |          5        0.26      100.00
------------+-----------------------------------
      Total |      1,895      100.00

  dem_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,623       85.65       85.65
        Yes |        272       14.35      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 creatinine |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,882       99.31       99.31
        Yes |         13        0.69      100.00
------------+-----------------------------------
      Total |      1,895      100.00

    rf_test |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,857       97.99       97.99
        Yes |         38        2.01      100.00
------------+-----------------------------------
      Total |      1,895      100.00

   ccp_test |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,885       99.47       99.47
        Yes |         10        0.53      100.00
------------+-----------------------------------
      Total |      1,895      100.00

        bmi |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,894       99.95       99.95
        Yes |          1        0.05      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 rheum_appt |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,253       66.12       66.12
        Yes |        642       33.88      100.00
------------+-----------------------------------
      Total |      1,895      100.00

rheum_appt_ |
        ref |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,253       66.12       66.12
        Yes |        642       33.88      100.00
------------+-----------------------------------
      Total |      1,895      100.00

rheum_appt_ |
        any |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        745       39.31       39.31
        Yes |      1,150       60.69      100.00
------------+-----------------------------------
      Total |      1,895      100.00

rheum_appt2 |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        909       47.97       47.97
        Yes |        986       52.03      100.00
------------+-----------------------------------
      Total |      1,895      100.00

rheum_appt3 |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        630       33.25       33.25
        Yes |      1,265       66.75      100.00
------------+-----------------------------------
      Total |      1,895      100.00

rheum_appt4 |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        389       20.53       20.53
        Yes |      1,506       79.47      100.00
------------+-----------------------------------
      Total |      1,895      100.00

rheum_ref_g |
  p_preappt |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,887       99.58       99.58
        Yes |          8        0.42      100.00
------------+-----------------------------------
      Total |      1,895      100.00

rheum_ref_g |
  p_precode |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,875       98.94       98.94
        Yes |         20        1.06      100.00
------------+-----------------------------------
      Total |      1,895      100.00

last_gp_pre |
      rheum |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,527       80.58       80.58
        Yes |        368       19.42      100.00
------------+-----------------------------------
      Total |      1,895      100.00

last_gp_pre |
       code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        784       41.37       41.37
        Yes |      1,111       58.63      100.00
------------+-----------------------------------
      Total |      1,895      100.00

last_gp_ref |
      rheum |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,892       99.84       99.84
        Yes |          3        0.16      100.00
------------+-----------------------------------
      Total |      1,895      100.00

last_gp_ref |
       code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,887       99.58       99.58
        Yes |          8        0.42      100.00
------------+-----------------------------------
      Total |      1,895      100.00

leflunomide |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,319       69.60       69.60
        Yes |        576       30.40      100.00
------------+-----------------------------------
      Total |      1,895      100.00

methotrexat |
     e_oral |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        764       40.32       40.32
        Yes |      1,131       59.68      100.00
------------+-----------------------------------
      Total |      1,895      100.00

methotrexat |
      e_inj |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        543       28.65       28.65
        Yes |      1,352       71.35      100.00
------------+-----------------------------------
      Total |      1,895      100.00

sulfasalazi |
         ne |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,197       63.17       63.17
        Yes |        698       36.83      100.00
------------+-----------------------------------
      Total |      1,895      100.00

hydroxychlo |
    roquine |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        962       50.77       50.77
        Yes |        933       49.23      100.00
------------+-----------------------------------
      Total |      1,895      100.00

   steroids |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        351       18.52       18.52
        Yes |      1,544       81.48      100.00
------------+-----------------------------------
      Total |      1,895      100.00

   lef_last |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,319       69.60       69.60
        Yes |        576       30.40      100.00
------------+-----------------------------------
      Total |      1,895      100.00

mtx_oral_la |
         st |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        764       40.32       40.32
        Yes |      1,131       59.68      100.00
------------+-----------------------------------
      Total |      1,895      100.00

mtx_inj_las |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        543       28.65       28.65
        Yes |      1,352       71.35      100.00
------------+-----------------------------------
      Total |      1,895      100.00

   ssz_last |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,197       63.17       63.17
        Yes |        698       36.83      100.00
------------+-----------------------------------
      Total |      1,895      100.00

   hcq_last |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        962       50.77       50.77
        Yes |        933       49.23      100.00
------------+-----------------------------------
      Total |      1,895      100.00

steroid_las |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        351       18.52       18.52
        Yes |      1,544       81.48      100.00
------------+-----------------------------------
      Total |      1,895      100.00

rtt_cl_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        735       38.79       38.79
        Yes |      1,160       61.21      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 rtt_cl_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        735       38.79       38.79
        Yes |      1,160       61.21      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 rtt_cl_end |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        735       38.79       38.79
        Yes |      1,160       61.21      100.00
------------+-----------------------------------
      Total |      1,895      100.00

rtt_op_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        724       38.21       38.21
        Yes |      1,171       61.79      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 rtt_op_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        724       38.21       38.21
        Yes |      1,171       61.79      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 rtt_op_end |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        724       38.21       38.21
        Yes |      1,171       61.79      100.00
------------+-----------------------------------
      Total |      1,895      100.00

. 
. /*
> **Will also need to amend conversion for biologic dates ====================================================*
> ***Some dates are given with month/year only, so adding day 15 to enable them to be processed as dates
> ***Would do this by labelling as _date_hcd then doing similar to above/below, but adding 15 days first
> 
> foreach var of varlist   abatacept_date                                         ///
>                                                  adalimumab_date                                        ///     
>                                                  baricitinib_date                                       ///
>                                                  certolizumab_date                                      ///
>                                                  etanercept_date                                        ///
>                                                  golimumab_date                                         ///
>                                                  guselkumab_date                                        ///     
>                                                  infliximab_date                                        ///
>                                                  ixekizumab_date                                        ///
>                                                  methotrexate_hcd_date                          ///
>                                                  rituximab_date                                         ///
>                                                  sarilumab_date                                         ///
>                                                  secukinumab_date                                       ///     
>                                                  tocilizumab_date                                       ///
>                                                  tofacitinib_date                                       ///
>                                                  upadacitinib_date                                      ///
>                                                  ustekinumab_date                                       ///
>                                                  {
>                                                         
>                 capture confirm string variable `var'
>                 if _rc!=0 {
>                         assert `var'==.
>                         rename `var' `var'_date
>                 }
>         
>                 else {
>                                 replace `var' = `var' + "-15"
>                                 rename `var' `var'_dstr
>                                 replace `var'_dstr = " " if `var'_dstr == "-15"
>                                 gen `var'_date = date(`var'_dstr, "YMD") 
>                                 order `var'_date, after(`var'_dstr)
>                                 drop `var'_dstr
>                 }
>         
>         format `var'_date %td
> }
> */
.                                          
. **Create and label variables ===========================================================*/
. 
. ***Age variables
. *Create categorised age
. drop if age<18 & age !=.
(0 observations deleted)

. drop if age>109 & age !=.
(0 observations deleted)

. drop if age==.
(0 observations deleted)

. lab var age "Age at diagnosis"

. 
. recode age 18/39.9999 = 1 /// 
>            40/49.9999 = 2 ///
>                    50/59.9999 = 3 ///
>                60/69.9999 = 4 ///
>                    70/79.9999 = 5 ///
>                    80/max = 6, gen(agegroup) 
(1,895 differences between age and agegroup)

. 
. label define agegroup   1 "18-39" ///
>                                                 2 "40-49" ///
>                                                 3 "50-59" ///
>                                                 4 "60-69" ///
>                                                 5 "70-79" ///
>                                                 6 "80+"

.                                                 
. label values agegroup agegroup

. lab var agegroup "Age group"

. tab agegroup, missing

  Age group |      Freq.     Percent        Cum.
------------+-----------------------------------
      18-39 |        833       43.96       43.96
      40-49 |        269       14.20       58.15
      50-59 |        232       12.24       70.40
      60-69 |        212       11.19       81.58
      70-79 |        141        7.44       89.02
        80+ |        208       10.98      100.00
------------+-----------------------------------
      Total |      1,895      100.00

. order agegroup, after(age)

. 
. ***Sex
. gen male = 1 if sex == "male"
(940 missing values generated)

. replace male = 0 if sex == "female"
(940 real changes made)

. lab var male "Male"

. lab define male 0 "No" 1 "Yes", modify

. lab val male male

. tab male, missing

       Male |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        940       49.60       49.60
        Yes |        955       50.40      100.00
------------+-----------------------------------
      Total |      1,895      100.00

. order male, after(sex)

. 
. ***Ethnicity
. gen ethnicity_n = 1 if ethnicity == "White"
(1,719 missing values generated)

. replace ethnicity_n = 2 if ethnicity == "Asian or Asian British"
(116 real changes made)

. replace ethnicity_n = 3 if ethnicity == "Black or Black British"
(146 real changes made)

. replace ethnicity_n = 4 if ethnicity == "Mixed"
(70 real changes made)

. replace ethnicity_n = 5 if ethnicity == "Chinese or Other Ethnic Groups"
(218 real changes made)

. replace ethnicity_n = 6 if ethnicity == "Unknown"
(1,169 real changes made)

. 
. 
. label define ethnicity_n        1 "White"                                               ///
>                                                         2 "Asian or Asian British"              ///
>                                                         3 "Black or Black British"      ///
>                                                         4 "Mixed"                                               //
> /
>                                                         5 "Chinese or Other Ethnic Groups" ///
>                                                         6 "Not known", modify

.                                                         
. label values ethnicity_n ethnicity_n

. lab var ethnicity_n "Ethnicity"

. tab ethnicity_n, missing

                     Ethnicity |      Freq.     Percent        Cum.
-------------------------------+-----------------------------------
                         White |        176        9.29        9.29
        Asian or Asian British |        116        6.12       15.41
        Black or Black British |        146        7.70       23.11
                         Mixed |         70        3.69       26.81
Chinese or Other Ethnic Groups |        218       11.50       38.31
                     Not known |      1,169       61.69      100.00
-------------------------------+-----------------------------------
                         Total |      1,895      100.00

. drop ethnicity

. rename ethnicity_n ethnicity 

. 
. ***Practice regions
. encode region, gen(nuts_region)

. tab region, missing

                  region |      Freq.     Percent        Cum.
-------------------------+-----------------------------------
                    East |        209       11.03       11.03
           East Midlands |        202       10.66       21.69
                  London |        200       10.55       32.24
              North East |        195       10.29       42.53
              North West |        222       11.72       54.25
              South East |        222       11.72       65.96
              South West |        221       11.66       77.63
           West Midlands |        220       11.61       89.23
Yorkshire and The Humber |        204       10.77      100.00
-------------------------+-----------------------------------
                   Total |      1,895      100.00

. replace region="Not known" if region==""
(0 real changes made)

. gen region_nospace=region

. replace region_nospace="SouthWest" if region=="South West"
(221 real changes made)

. replace region_nospace="EastMidlands" if region=="East Midlands"
(202 real changes made)

. replace region_nospace="East" if region=="East"
(0 real changes made)

. replace region_nospace="London" if region=="London"
(0 real changes made)

. replace region_nospace="NorthEast" if region=="North East"
(195 real changes made)

. replace region_nospace="NorthWest" if region=="North West"
(222 real changes made)

. replace region_nospace="SouthEast" if region=="South East"
(222 real changes made)

. replace region_nospace="WestMidlands" if region=="West Midlands"
(220 real changes made)

. replace region_nospace="YorkshireandTheHumber" if region=="Yorkshire and The Humber"
(204 real changes made)

. 
. ***IMD
. gen imd = 1 if imd_quintile == "1 (most deprived)"
(1,546 missing values generated)

. replace imd = 2 if imd_quintile == "2"
(356 real changes made)

. replace imd = 3 if imd_quintile == "3"
(365 real changes made)

. replace imd = 4 if imd_quintile == "4"
(333 real changes made)

. replace imd = 5 if imd_quintile == "5 (least deprived)"
(368 real changes made)

. replace imd = .u if imd_quintile == "Unknown"
(124 real changes made, 124 to missing)

. lab var imd "Index of multiple deprivation"

. lab define imd 1 "1 (most deprived)" ///
>                            2 "2" ///
>                            3 "3" ///
>                            4 "4" ///
>                            5 "5 (least deprived)" ///
>                            .u "Not known"

. lab val imd imd                    

. tab imd, missing

 Index of multiple |
       deprivation |      Freq.     Percent        Cum.
-------------------+-----------------------------------
 1 (most deprived) |        349       18.42       18.42
                 2 |        356       18.79       37.20
                 3 |        365       19.26       56.46
                 4 |        333       17.57       74.04
5 (least deprived) |        368       19.42       93.46
         Not known |        124        6.54      100.00
-------------------+-----------------------------------
             Total |      1,895      100.00

. drop imd_quintile

. 
. ***Body Mass Index
. *Recode strange values 
. replace bmi_value = . if bmi_value == 0 
(0 real changes made)

. replace bmi_value = . if !inrange(bmi_value, 10, 80)
(0 real changes made)

. 
. *Restrict to within 10 years of EIA diagnosis date and aged>16 
. gen bmi_time = (eia_code_date - bmi_date)/365.25
(1,894 missing values generated)

. gen bmi_age = age - bmi_time
(1,894 missing values generated)

. replace bmi_value = . if bmi_age < 16 
(0 real changes made)

. replace bmi_value = . if bmi_time > 10 & bmi_time != . 
(0 real changes made)

. 
. *Set to missing if no date, and vice versa 
. replace bmi_value = . if bmi_date == . 
(0 real changes made)

. replace bmi_date = . if bmi_value == . 
(0 real changes made)

. replace bmi_time = . if bmi_value == . 
(0 real changes made)

. replace bmi_age = . if bmi_value == . 
(0 real changes made)

. 
. *Create BMI categories
. gen     bmicat = .
(1,895 missing values generated)

. recode  bmicat . = 1 if bmi_value < 18.5
(0 changes made to bmicat)

. recode  bmicat . = 2 if bmi_value < 25
(0 changes made to bmicat)

. recode  bmicat . = 3 if bmi_value < 30
(0 changes made to bmicat)

. recode  bmicat . = 4 if bmi_value < 35
(0 changes made to bmicat)

. recode  bmicat . = 5 if bmi_value < 40
(0 changes made to bmicat)

. recode  bmicat . = 6 if bmi_value < .
(1 changes made to bmicat)

. replace bmicat = .u if bmi_value >= .
(1,894 real changes made, 1,894 to missing)

. 
. label define bmicat 1 "Underweight (<18.5)"     ///
>                                         2 "Normal (18.5-24.9)"          ///
>                                         3 "Overweight (25-29.9)"        ///
>                                         4 "Obese I (30-34.9)"           ///
>                                         5 "Obese II (35-39.9)"          ///
>                                         6 "Obese III (40+)"                     ///
>                                         .u "Not known"

.                                         
. label values bmicat bmicat

. lab var bmicat "BMI"

. tab bmicat, missing

                 BMI |      Freq.     Percent        Cum.
---------------------+-----------------------------------
     Obese III (40+) |          1        0.05        0.05
           Not known |      1,894       99.95      100.00
---------------------+-----------------------------------
               Total |      1,895      100.00

. order bmicat, after (bmi_value)

. drop bmi_age bmi_time

. 
. *Create less granular categorisation
. recode bmicat 1/3 .u = 1 4 = 2 5 = 3 6 = 4, gen(obese4cat)
(1,895 differences between bmicat and obese4cat)

. 
. label define obese4cat  1 "No record of obesity"        ///
>                                                 2 "Obese I (30-34.9)"           ///
>                                                 3 "Obese II (35-39.9)"          ///
>                                                 4 "Obese III (40+)"             

. 
. label values obese4cat obese4cat

. order obese4cat, after(bmicat)

. lab var obese4cat "Obesity categories"

. 
. ***Smoking 
. label define smoke 1 "Never" 2 "Former" 3 "Current" .u "Not known"

. 
. gen     smoke = 1  if smoking_status == "N"
(1,871 missing values generated)

. replace smoke = 2  if smoking_status == "E"
(704 real changes made)

. replace smoke = 3  if smoking_status == "S"
(1,163 real changes made)

. replace smoke = .u if smoking_status == "M"
(4 real changes made, 4 to missing)

. replace smoke = .u if smoking_status == "" 
(0 real changes made)

. 
. label values smoke smoke

. lab var smoke "Smoking status"

. drop smoking_status

. tab smoke, missing

    Smoking |
     status |      Freq.     Percent        Cum.
------------+-----------------------------------
      Never |         24        1.27        1.27
     Former |        704       37.15       38.42
    Current |      1,163       61.37       99.79
  Not known |          4        0.21      100.00
------------+-----------------------------------
      Total |      1,895      100.00

. 
. *Create non-missing 3-category variable for current smoking (assumes missing smoking is never smoking)
. recode smoke .u = 1, gen(smoke_nomiss)
(4 differences between smoke and smoke_nomiss)

. order smoke_nomiss, after(smoke)

. label values smoke_nomiss smoke

. 
. **Clinical comorbidities
. ***Nb. not using creatinine of HBA1c values for now, just codes
. foreach disease in ckd dm ild copd cva lung_ca solid_ca haem_ca depr osteop frac dem chd {
  2.         tab `disease'_before, missing
  3.         tab `disease'_after, missing
  4.         gen `disease'_new = 1 if (`disease'_after == 1 & `disease'_before == 0)
  5.         recode `disease'_new .=0
  6.         label define `disease'_new 0 "No" 1 "Yes"
  7.         label values `disease'_new `disease'_new
  8.         tab `disease'_new, missing
  9.         order `disease'_new, after(`disease'_after)
 10. }

 ckd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,618       85.38       85.38
        Yes |        277       14.62      100.00
------------+-----------------------------------
      Total |      1,895      100.00

  ckd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,554       82.01       82.01
        Yes |        341       17.99      100.00
------------+-----------------------------------
      Total |      1,895      100.00
(1,590 missing values generated)
(1,590 changes made to ckd_new)

    ckd_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,590       83.91       83.91
        Yes |        305       16.09      100.00
------------+-----------------------------------
      Total |      1,895      100.00

  dm_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,793       94.62       94.62
        Yes |        102        5.38      100.00
------------+-----------------------------------
      Total |      1,895      100.00

   dm_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,773       93.56       93.56
        Yes |        122        6.44      100.00
------------+-----------------------------------
      Total |      1,895      100.00
(1,774 missing values generated)
(1,774 changes made to dm_new)

     dm_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,774       93.61       93.61
        Yes |        121        6.39      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 ild_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,693       89.34       89.34
        Yes |        202       10.66      100.00
------------+-----------------------------------
      Total |      1,895      100.00

  ild_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,698       89.60       89.60
        Yes |        197       10.40      100.00
------------+-----------------------------------
      Total |      1,895      100.00
(1,716 missing values generated)
(1,716 changes made to ild_new)

    ild_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,716       90.55       90.55
        Yes |        179        9.45      100.00
------------+-----------------------------------
      Total |      1,895      100.00

copd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,854       97.84       97.84
        Yes |         41        2.16      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 copd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,835       96.83       96.83
        Yes |         60        3.17      100.00
------------+-----------------------------------
      Total |      1,895      100.00
(1,835 missing values generated)
(1,835 changes made to copd_new)

   copd_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,835       96.83       96.83
        Yes |         60        3.17      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 cva_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,674       88.34       88.34
        Yes |        221       11.66      100.00
------------+-----------------------------------
      Total |      1,895      100.00

  cva_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,647       86.91       86.91
        Yes |        248       13.09      100.00
------------+-----------------------------------
      Total |      1,895      100.00
(1,668 missing values generated)
(1,668 changes made to cva_new)

    cva_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,668       88.02       88.02
        Yes |        227       11.98      100.00
------------+-----------------------------------
      Total |      1,895      100.00

lung_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,630       86.02       86.02
        Yes |        265       13.98      100.00
------------+-----------------------------------
      Total |      1,895      100.00

lung_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,578       83.27       83.27
        Yes |        317       16.73      100.00
------------+-----------------------------------
      Total |      1,895      100.00
(1,624 missing values generated)
(1,624 changes made to lung_ca_new)

lung_ca_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,624       85.70       85.70
        Yes |        271       14.30      100.00
------------+-----------------------------------
      Total |      1,895      100.00

solid_ca_be |
       fore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        357       18.84       18.84
        Yes |      1,538       81.16      100.00
------------+-----------------------------------
      Total |      1,895      100.00

solid_ca_af |
        ter |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        215       11.35       11.35
        Yes |      1,680       88.65      100.00
------------+-----------------------------------
      Total |      1,895      100.00
(1,576 missing values generated)
(1,576 changes made to solid_ca_new)

solid_ca_ne |
          w |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,576       83.17       83.17
        Yes |        319       16.83      100.00
------------+-----------------------------------
      Total |      1,895      100.00

haem_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,296       68.39       68.39
        Yes |        599       31.61      100.00
------------+-----------------------------------
      Total |      1,895      100.00

haem_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,230       64.91       64.91
        Yes |        665       35.09      100.00
------------+-----------------------------------
      Total |      1,895      100.00
(1,418 missing values generated)
(1,418 changes made to haem_ca_new)

haem_ca_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,418       74.83       74.83
        Yes |        477       25.17      100.00
------------+-----------------------------------
      Total |      1,895      100.00

depr_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,809       95.46       95.46
        Yes |         86        4.54      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 depr_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,791       94.51       94.51
        Yes |        104        5.49      100.00
------------+-----------------------------------
      Total |      1,895      100.00
(1,792 missing values generated)
(1,792 changes made to depr_new)

   depr_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,792       94.56       94.56
        Yes |        103        5.44      100.00
------------+-----------------------------------
      Total |      1,895      100.00

osteop_befo |
         re |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,870       98.68       98.68
        Yes |         25        1.32      100.00
------------+-----------------------------------
      Total |      1,895      100.00

osteop_afte |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,845       97.36       97.36
        Yes |         50        2.64      100.00
------------+-----------------------------------
      Total |      1,895      100.00
(1,847 missing values generated)
(1,847 changes made to osteop_new)

 osteop_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,847       97.47       97.47
        Yes |         48        2.53      100.00
------------+-----------------------------------
      Total |      1,895      100.00

frac_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,893       99.89       99.89
        Yes |          2        0.11      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 frac_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,890       99.74       99.74
        Yes |          5        0.26      100.00
------------+-----------------------------------
      Total |      1,895      100.00
(1,890 missing values generated)
(1,890 changes made to frac_new)

   frac_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,890       99.74       99.74
        Yes |          5        0.26      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 dem_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,657       87.44       87.44
        Yes |        238       12.56      100.00
------------+-----------------------------------
      Total |      1,895      100.00

  dem_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,623       85.65       85.65
        Yes |        272       14.35      100.00
------------+-----------------------------------
      Total |      1,895      100.00
(1,653 missing values generated)
(1,653 changes made to dem_new)

    dem_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,653       87.23       87.23
        Yes |        242       12.77      100.00
------------+-----------------------------------
      Total |      1,895      100.00

 chd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,665       87.86       87.86
        Yes |        230       12.14      100.00
------------+-----------------------------------
      Total |      1,895      100.00

  chd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,577       83.22       83.22
        Yes |        318       16.78      100.00
------------+-----------------------------------
      Total |      1,895      100.00
(1,603 missing values generated)
(1,603 changes made to chd_new)

    chd_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,603       84.59       84.59
        Yes |        292       15.41      100.00
------------+-----------------------------------
      Total |      1,895      100.00

. 
. *Label remaining variables 
. lab var ckd_before "Chronic kidney disease"

. lab var ckd_after "Chronic kidney disease"

. lab var ckd_new "Chronic kidney disease"

. lab var dm_before "Type 2 diabetes mellitus"

. lab var dm_after "Type 2 diabetes mellitus"

. lab var dm_new "Type 2 diabetes mellitus"

. lab var ild_before "Interstitial lung disease"

. lab var ild_after "Interstitial lung disease"

. lab var ild_new "Interstitial lung disease"

. lab var copd_before "COPD"

. lab var copd_after "COPD"

. lab var copd_new "COPD"

. lab var lung_ca_before "Lung cancer"

. lab var lung_ca_after "Lung cancer"

. lab var lung_ca_new "Lung cancer"

. lab var solid_ca_before "Solid organ cancer"

. lab var solid_ca_after "Solid organ cancer"

. lab var solid_ca_new "Solid organ cancer"

. lab var haem_ca_before "Haematological cancer"

. lab var haem_ca_after "Haematological cancer"

. lab var haem_ca_new "Haematological cancer"

. lab var depr_before "Depression"

. lab var depr_after "Depression"

. lab var depr_new "Depression"

. lab var osteop_before "Osteoporosis"

. lab var osteop_after "Osteoporosis"

. lab var osteop_new "Osteoporosis"

. lab var frac_before "Fragility fracture"

. lab var frac_after "Fragility fracture"

. lab var frac_new "Fragility fracture"

. lab var dem_before "Dementia"

. lab var dem_after "Dementia"

. lab var dem_new "Dementia"

. lab var chd_before "Coronary heart disease"

. lab var chd_after "Coronary heart disease"

. lab var chd_new "Coronary heart disease"

. 
. lab var rheum_appt "First rheumatology appointment within 12 months"

. lab var rheum_appt_any "Any rheumatology appointment within 12 months"

. lab var rheum_appt2 "Any rheumatology appointment within 6 months"

. lab var rheum_appt3 "Any rheumatology appointment within 24 months"

. 
. lab var eia_code "Inflammatory arthritis"

. lab var ra_code "Rheumatoid arthritis"

. lab var psa_code "Psoriatic arthritis"

. lab var anksp_code "Axial spondyloarthritis"

. lab var undiff_code "Undifferentiated inflammatory arthritis"

. 
. 
. **All patients should have diagnostic code=============================================================*/
. tab eia_code, missing

Inflammator |
y arthritis |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |      1,895      100.00      100.00
------------+-----------------------------------
      Total |      1,895      100.00

. keep if eia_code==1
(0 observations deleted)

. 
. **Check first rheum appt date was before diagnostic code date==================================*/
. 
. **Rheumatology appt definitions 
. tab rheum_appt, missing //proportion of patients with an rheum outpatient date (with first attendance option selec
> ted) in the 12 months before and 60 days after EIA code appeared in GP record; data only April 2019 onwards

      First |
rheumatolog |
          y |
appointment |
  within 12 |
     months |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,253       66.12       66.12
        Yes |        642       33.88      100.00
------------+-----------------------------------
      Total |      1,895      100.00

. tab mo_year_diagn rheum_appt, missing //proportion of patients with an rheum outpatient date (with first attendanc
> e option selected) in the 12 months before and 60 days after EIA code appeared in GP record; data only April 2019 
> onwards
variable mo_year_diagn not found
r(111);

end of do-file

r(111);

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. codebook rf_code

--------------------------------------------------------------------------------------------------------------------
rf_code                                                                                                  (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric (float)
                 Label: rf_code

                 Range: [0,1]                         Units: 1
         Unique values: 2                         Missing .: 0/1,895

            Tabulation: Freq.   Numeric  Label
                        1,880         0  No
                           15         1  Yes

. codebook rf_test_value

--------------------------------------------------------------------------------------------------------------------
rf_test_value                                                                                            (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric (float)

                 Range: [.49810165,98.594498]         Units: 1.000e-08
         Unique values: 38                        Missing .: 1,857/1,895

                  Mean: 45.4463
             Std. dev.: 29.4971

           Percentiles:     10%       25%       50%       75%       90%
                        10.0294   19.7863   42.3669   71.7897   86.8916

. tabstat rf_test_value, stats (n mean p50 p25 p75) //recode on the basis of values

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
rf_test_va~e |        38  45.44631  42.36688  19.78626   71.7897
----------------------------------------------------------------

. gen rf_pos_ra if (rf_test_value>=20 & rf_test_value!=.) | rf_code==1
=exp required
r(100);

end of do-file

r(100);

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. gen rf_pos_ra = 1 if (rf_test_value>=20 & rf_test_value!=.) | rf_code==1
(1,853 missing values generated)

. recode rf_pos_ra .=0 //Nb. 0 will also include those where test not done (or not coded for)
(1,853 changes made to rf_pos_ra)

. lab define rf_pos_ra 0 "RF negative/not known" 1 "RF positive"

. lab val rf_pos_ra rf_pos_ra

. lab var rf_pos_ra "Rheumatoid factor positive"

. tab rf_pos_ra if ra_code==1, missing

    Rheumatoid factor |
             positive |      Freq.     Percent        Cum.
----------------------+-----------------------------------
RF negative/not known |      1,534       97.64       97.64
          RF positive |         37        2.36      100.00
----------------------+-----------------------------------
                Total |      1,571      100.00

. 
end of do-file

. br rf*

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. codebook ccp_code

--------------------------------------------------------------------------------------------------------------------
ccp_code                                                                                                 (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric (float)
                 Label: ccp_code

                 Range: [0,1]                         Units: 1
         Unique values: 2                         Missing .: 0/1,895

            Tabulation: Freq.   Numeric  Label
                        1,878         0  No
                           17         1  Yes

. codebook ccp_test_value

--------------------------------------------------------------------------------------------------------------------
ccp_test_value                                                                                           (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric (float)

                 Range: [6.6003747,93.917793]         Units: 1.000e-07
         Unique values: 10                        Missing .: 1,885/1,895

                  Mean: 55.3607
             Std. dev.: 30.0678

           Percentiles:     10%       25%       50%       75%       90%
                        18.8288   31.6433   51.2475   87.9277   93.0228

. tabstat ccp_test_value, stats (n mean p50 p25 p75) //recode on the basis of values

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
ccp_test_v~e |        10  55.36074  51.24747  31.64327  87.92772
----------------------------------------------------------------

. gen ccp_pos_ra = 1 if (ccp_test_value>=20 & ccp_test_value!=.) | ccp_code==1
(1,869 missing values generated)

. recode ccp_pos_ra .=0 //Nb. 0 will also include those where test not done (or not coded for)
(1,869 changes made to ccp_pos_ra)

. lab define ccp_pos_ra 0 "CCP negative/not known" 1 "CCP positive"

. lab val ccp_pos_ra ccp_pos_ra

. lab var ccp_pos_ra "CCP positive"

. tab ccp_pos_ra if ra_code==1, missing

          CCP positive |      Freq.     Percent        Cum.
-----------------------+-----------------------------------
CCP negative/not known |      1,549       98.60       98.60
          CCP positive |         22        1.40      100.00
-----------------------+-----------------------------------
                 Total |      1,571      100.00

. 
end of do-file

. br ccp*

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. gen seropos_ra = 1 if ra_positive_ra==1 | ccp_pos_ra==1 | seropositive_code==1 //check ranges
ra_positive_ra not found
r(111);

end of do-file

r(111);

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. gen seropos_ra = 1 if ra_pos_ra==1 | ccp_pos_ra==1 | seropositive_code==1 //check ranges
ra_pos_ra not found
r(111);

end of do-file

r(111);

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. gen seropos_ra = 1 if rf_pos_ra==1 | ccp_pos_ra==1 | seropositive_code==1 //check ranges
(1,665 missing values generated)

. recode seropos_ra .=0 //Nb. 0 will also include those where test not done (or not coded for)
(1,665 changes made to seropos_ra)

. lab define seropos_ra 0 "Seronegative/not known" 1 "Seropositive"

. lab val seropos_ra seropos_ra

. lab var seropos_ra "Seropositivity"

. tab seropos_ra if ra_code==1, missing

        Seropositivity |      Freq.     Percent        Cum.
-----------------------+-----------------------------------
Seronegative/not known |      1,352       86.06       86.06
          Seropositive |        219       13.94      100.00
-----------------------+-----------------------------------
                 Total |      1,571      100.00

. 
end of do-file

. br rf_pos_ra ccp_pos_ra seropos_ra seropositive_code

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. 
. import delimited "$projectdir/output/dataset.csv", clear
(encoding automatically selected: ISO-8859-1)
(105 vars, 1,331 obs)

. 
. **Set Ado file path
. adopath + "$projectdir/analysis/extra_ados"
  [1]  (BASE)      "C:\Program Files\Stata18\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata18\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "C:\Users\Mark\ado\personal/"
  [5]  (PLUS)      "C:\Users\Mark\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "C:\Users\Mark\OneDrive\PhD Project\OpenSAFELY NEIAA\inflammatory_rheum/analysis/extra_ados"

. 
. **Set index dates ===========================================================*/
. global start_date = "01/04/2016" //for outpatient analyses, data may only be available from April 2019

. global end_date = "31/03/2025"

. global base_year = year(date("$start_date", "DMY"))

. global end_year = year(date("$end_date", "DMY"))

. global max_year = $end_year - $base_year

. 
. **Conversion for dates====================================================*
. 
. ***Variables ending in _date that are string
. ds *_date, has(type string)
eia_code_d~e  chd_before~e  depr_befor~e  solid_ca_a~e  ccp_test_d~e  rheum~e_date  hydroxychl~e  ~m_last_date
ra_code_date  dm_before_~e  osteop_bef~e  haem_ca_af~e  bmi_date      ~erheum_date  lef_last_d~e  rtt_cl_sta~e
psa_code_d~e  ild_before~e  dem_before~e  ckd_after_~e  r~_appt_date  l~ecode_date  mtx_oral_l~e  rtt_cl_ref~e
anksp_code~e  copd_befor~e  chd_after_~e  depr_after~e  rheum~f_date  ~frheum_date  mtx_inj_la~e  rtt_cl_end~e
undiff_cod~e  cva_before~e  dm_after_d~e  osteop_aft~e  rheum~y_date  l~fcode_date  ssz_last_d~e  rtt_op_sta~e
rf_code_date  lung_ca_be~e  ild_after_~e  frac_after~e  rheum~2_date  leflunomid~e  hcq_last_d~e  rtt_op_ref~e
ccp_code_d~e  solid_ca_b~e  copd_after~e  dem_after_~e  rheum~3_date  metho~l_date  steroid_fi~e  rtt_op_end~e
seropositi~e  haem_ca_be~e  cva_after_~e  creatinin~te  rheum~4_date  metho~j_date  steroid_la~e
erosive_ra~e  ckd_before~e  lung_ca_af~e  rf_test_date  r~eappt_date  sulfasalaz~e  steroid_12..

. local string_dates `r(varlist)'

. foreach var of local string_dates {
  2.     gen `var'_num = date(`var', "YMD")
  3.     format `var'_num %td
  4.     order `var'_num, after(`var')
  5.     drop `var'
  6.     rename `var'_num `var'
  7. }
(229 missing values generated)
(1,207 missing values generated)
(1,217 missing values generated)
(1,296 missing values generated)
(1,320 missing values generated)
(1,319 missing values generated)
(1,200 missing values generated)
(1,311 missing values generated)
(1,154 missing values generated)
(1,253 missing values generated)
(1,188 missing values generated)
(1,301 missing values generated)
(1,178 missing values generated)
(1,140 missing values generated)
(245 missing values generated)
(896 missing values generated)
(1,133 missing values generated)
(1,274 missing values generated)
(1,313 missing values generated)
(1,164 missing values generated)
(1,114 missing values generated)
(1,244 missing values generated)
(1,185 missing values generated)
(1,293 missing values generated)
(1,153 missing values generated)
(1,096 missing values generated)
(160 missing values generated)
(866 missing values generated)
(1,081 missing values generated)
(1,254 missing values generated)
(1,300 missing values generated)
(1,327 missing values generated)
(1,129 missing values generated)
(1,324 missing values generated)
(1,307 missing values generated)
(1,324 missing values generated)
(1,330 missing values generated)
(883 missing values generated)
(883 missing values generated)
(519 missing values generated)
(627 missing values generated)
(433 missing values generated)
(269 missing values generated)
(1,327 missing values generated)
(1,317 missing values generated)
(1,068 missing values generated)
(536 missing values generated)
(1,330 missing values generated)
(1,326 missing values generated)
(932 missing values generated)
(547 missing values generated)
(394 missing values generated)
(834 missing values generated)
(682 missing values generated)
(932 missing values generated)
(547 missing values generated)
(394 missing values generated)
(834 missing values generated)
(682 missing values generated)
(484 missing values generated)
(484 missing values generated)
(609 missing values generated)
(609 missing values generated)
(200 missing values generated)
(200 missing values generated)
(200 missing values generated)
(186 missing values generated)
(186 missing values generated)
(186 missing values generated)

. 
. ***Variables ending in _date that are numeric
. foreach var of varlist *_date {
  2.     capture confirm string variable `var'
  3.     if _rc != 0 {
  4.         format `var' %td
  5.     }
  6. }

. 
. ***Create binary indicator for each
. ds *_date
eia_code_d~e  chd_before~e  depr_befor~e  lung_ca_af~e  rf_test_date  r~eappt_date  sulfasalaz~e  steroid_12..
ra_code_date  dm_before_~e  osteop_bef~e  solid_ca_a~e  ccp_test_d~e  rheum~e_date  hydroxychl~e  ~m_last_date
psa_code_d~e  ild_before~e  frac_befor~e  haem_ca_af~e  bmi_date      ~erheum_date  lef_last_d~e  rtt_cl_sta~e
anksp_code~e  copd_befor~e  dem_before~e  ckd_after_~e  r~_appt_date  l~ecode_date  mtx_oral_l~e  rtt_cl_ref~e
undiff_cod~e  cva_before~e  chd_after_~e  depr_after~e  rheum~f_date  ~frheum_date  mtx_inj_la~e  rtt_cl_end~e
rf_code_date  lung_ca_be~e  dm_after_d~e  osteop_aft~e  rheum~y_date  l~fcode_date  ssz_last_d~e  rtt_op_sta~e
ccp_code_d~e  solid_ca_b~e  ild_after_~e  frac_after~e  rheum~2_date  leflunomid~e  hcq_last_d~e  rtt_op_ref~e
seropositi~e  haem_ca_be~e  copd_after~e  dem_after_~e  rheum~3_date  metho~l_date  steroid_fi~e  rtt_op_end~e
erosive_ra~e  ckd_before~e  cva_after_~e  creatinin~te  rheum~4_date  metho~j_date  steroid_la~e

. local dates `r(varlist)'

. foreach var of local dates {
  2.         local newvar =  substr("`var'", 1, length("`var'") - 5)
  3.         gen `newvar' = (`var'!=. )
  4.         order `newvar', after(`var')
  5.         lab define `newvar' 0 "No" 1 "Yes"
  6.         lab val `newvar' `newvar'
  7.         tab `newvar', missing
  8. }

   eia_code |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |      1,331      100.00      100.00
------------+-----------------------------------
      Total |      1,331      100.00

    ra_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        229       17.21       17.21
        Yes |      1,102       82.79      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   psa_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,207       90.68       90.68
        Yes |        124        9.32      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 anksp_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,217       91.44       91.44
        Yes |        114        8.56      100.00
------------+-----------------------------------
      Total |      1,331      100.00

undiff_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,296       97.37       97.37
        Yes |         35        2.63      100.00
------------+-----------------------------------
      Total |      1,331      100.00

    rf_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,320       99.17       99.17
        Yes |         11        0.83      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   ccp_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,319       99.10       99.10
        Yes |         12        0.90      100.00
------------+-----------------------------------
      Total |      1,331      100.00

seropositiv |
     e_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,200       90.16       90.16
        Yes |        131        9.84      100.00
------------+-----------------------------------
      Total |      1,331      100.00

erosive_ra_ |
       code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,311       98.50       98.50
        Yes |         20        1.50      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 chd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,154       86.70       86.70
        Yes |        177       13.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  dm_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,253       94.14       94.14
        Yes |         78        5.86      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 ild_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,188       89.26       89.26
        Yes |        143       10.74      100.00
------------+-----------------------------------
      Total |      1,331      100.00

copd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,301       97.75       97.75
        Yes |         30        2.25      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 cva_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,178       88.50       88.50
        Yes |        153       11.50      100.00
------------+-----------------------------------
      Total |      1,331      100.00

lung_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,140       85.65       85.65
        Yes |        191       14.35      100.00
------------+-----------------------------------
      Total |      1,331      100.00

solid_ca_be |
       fore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        245       18.41       18.41
        Yes |      1,086       81.59      100.00
------------+-----------------------------------
      Total |      1,331      100.00

haem_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        896       67.32       67.32
        Yes |        435       32.68      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 ckd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,133       85.12       85.12
        Yes |        198       14.88      100.00
------------+-----------------------------------
      Total |      1,331      100.00

depr_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,274       95.72       95.72
        Yes |         57        4.28      100.00
------------+-----------------------------------
      Total |      1,331      100.00

osteop_befo |
         re |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,313       98.65       98.65
        Yes |         18        1.35      100.00
------------+-----------------------------------
      Total |      1,331      100.00

frac_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,331      100.00      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 dem_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,164       87.45       87.45
        Yes |        167       12.55      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  chd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,114       83.70       83.70
        Yes |        217       16.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   dm_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,244       93.46       93.46
        Yes |         87        6.54      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  ild_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,185       89.03       89.03
        Yes |        146       10.97      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 copd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,293       97.15       97.15
        Yes |         38        2.85      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  cva_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,153       86.63       86.63
        Yes |        178       13.37      100.00
------------+-----------------------------------
      Total |      1,331      100.00

lung_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,096       82.34       82.34
        Yes |        235       17.66      100.00
------------+-----------------------------------
      Total |      1,331      100.00

solid_ca_af |
        ter |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        160       12.02       12.02
        Yes |      1,171       87.98      100.00
------------+-----------------------------------
      Total |      1,331      100.00

haem_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        866       65.06       65.06
        Yes |        465       34.94      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  ckd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,081       81.22       81.22
        Yes |        250       18.78      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 depr_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,254       94.21       94.21
        Yes |         77        5.79      100.00
------------+-----------------------------------
      Total |      1,331      100.00

osteop_afte |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,300       97.67       97.67
        Yes |         31        2.33      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 frac_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,327       99.70       99.70
        Yes |          4        0.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  dem_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,129       84.82       84.82
        Yes |        202       15.18      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 creatinine |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,324       99.47       99.47
        Yes |          7        0.53      100.00
------------+-----------------------------------
      Total |      1,331      100.00

    rf_test |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,307       98.20       98.20
        Yes |         24        1.80      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   ccp_test |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,324       99.47       99.47
        Yes |          7        0.53      100.00
------------+-----------------------------------
      Total |      1,331      100.00

        bmi |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,330       99.92       99.92
        Yes |          1        0.08      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 rheum_appt |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        883       66.34       66.34
        Yes |        448       33.66      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_appt_ |
        ref |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        883       66.34       66.34
        Yes |        448       33.66      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_appt_ |
        any |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        519       38.99       38.99
        Yes |        812       61.01      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_appt2 |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        627       47.11       47.11
        Yes |        704       52.89      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_appt3 |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        433       32.53       32.53
        Yes |        898       67.47      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_appt4 |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        269       20.21       20.21
        Yes |      1,062       79.79      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_ref_g |
  p_preappt |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,327       99.70       99.70
        Yes |          4        0.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_ref_g |
  p_precode |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,317       98.95       98.95
        Yes |         14        1.05      100.00
------------+-----------------------------------
      Total |      1,331      100.00

last_gp_pre |
      rheum |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,068       80.24       80.24
        Yes |        263       19.76      100.00
------------+-----------------------------------
      Total |      1,331      100.00

last_gp_pre |
       code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        536       40.27       40.27
        Yes |        795       59.73      100.00
------------+-----------------------------------
      Total |      1,331      100.00

last_gp_ref |
      rheum |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,330       99.92       99.92
        Yes |          1        0.08      100.00
------------+-----------------------------------
      Total |      1,331      100.00

last_gp_ref |
       code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,326       99.62       99.62
        Yes |          5        0.38      100.00
------------+-----------------------------------
      Total |      1,331      100.00

leflunomide |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        932       70.02       70.02
        Yes |        399       29.98      100.00
------------+-----------------------------------
      Total |      1,331      100.00

methotrexat |
     e_oral |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        547       41.10       41.10
        Yes |        784       58.90      100.00
------------+-----------------------------------
      Total |      1,331      100.00

methotrexat |
      e_inj |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        394       29.60       29.60
        Yes |        937       70.40      100.00
------------+-----------------------------------
      Total |      1,331      100.00

sulfasalazi |
         ne |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        834       62.66       62.66
        Yes |        497       37.34      100.00
------------+-----------------------------------
      Total |      1,331      100.00

hydroxychlo |
    roquine |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        682       51.24       51.24
        Yes |        649       48.76      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   lef_last |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        932       70.02       70.02
        Yes |        399       29.98      100.00
------------+-----------------------------------
      Total |      1,331      100.00

mtx_oral_la |
         st |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        547       41.10       41.10
        Yes |        784       58.90      100.00
------------+-----------------------------------
      Total |      1,331      100.00

mtx_inj_las |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        394       29.60       29.60
        Yes |        937       70.40      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   ssz_last |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        834       62.66       62.66
        Yes |        497       37.34      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   hcq_last |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        682       51.24       51.24
        Yes |        649       48.76      100.00
------------+-----------------------------------
      Total |      1,331      100.00

steroid_fir |
         st |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        484       36.36       36.36
        Yes |        847       63.64      100.00
------------+-----------------------------------
      Total |      1,331      100.00

steroid_las |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        484       36.36       36.36
        Yes |        847       63.64      100.00
------------+-----------------------------------
      Total |      1,331      100.00

steroid_12m |
     _first |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        609       45.76       45.76
        Yes |        722       54.24      100.00
------------+-----------------------------------
      Total |      1,331      100.00

steroid_12m |
      _last |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        609       45.76       45.76
        Yes |        722       54.24      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rtt_cl_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        200       15.03       15.03
        Yes |      1,131       84.97      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 rtt_cl_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        200       15.03       15.03
        Yes |      1,131       84.97      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 rtt_cl_end |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        200       15.03       15.03
        Yes |      1,131       84.97      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rtt_op_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        186       13.97       13.97
        Yes |      1,145       86.03      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 rtt_op_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        186       13.97       13.97
        Yes |      1,145       86.03      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 rtt_op_end |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        186       13.97       13.97
        Yes |      1,145       86.03      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. 
. /*
> **Will also need to amend conversion for biologic dates ====================================================*
> ***Some dates are given with month/year only, so adding day 15 to enable them to be processed as dates
> ***Would do this by labelling as _date_hcd then doing similar to above/below, but adding 15 days first
> 
> foreach var of varlist   abatacept_date                                         ///
>                                                  adalimumab_date                                        ///     
>                                                  baricitinib_date                                       ///
>                                                  certolizumab_date                                      ///
>                                                  etanercept_date                                        ///
>                                                  golimumab_date                                         ///
>                                                  guselkumab_date                                        ///     
>                                                  infliximab_date                                        ///
>                                                  ixekizumab_date                                        ///
>                                                  methotrexate_hcd_date                          ///
>                                                  rituximab_date                                         ///
>                                                  sarilumab_date                                         ///
>                                                  secukinumab_date                                       ///     
>                                                  tocilizumab_date                                       ///
>                                                  tofacitinib_date                                       ///
>                                                  upadacitinib_date                                      ///
>                                                  ustekinumab_date                                       ///
>                                                  {
>                                                         
>                 capture confirm string variable `var'
>                 if _rc!=0 {
>                         assert `var'==.
>                         rename `var' `var'_date
>                 }
>         
>                 else {
>                                 replace `var' = `var' + "-15"
>                                 rename `var' `var'_dstr
>                                 replace `var'_dstr = " " if `var'_dstr == "-15"
>                                 gen `var'_date = date(`var'_dstr, "YMD") 
>                                 order `var'_date, after(`var'_dstr)
>                                 drop `var'_dstr
>                 }
>         
>         format `var'_date %td
> }
> */
.                                          
. **Create and label variables ===========================================================*/
. 
. ***Age variables
. *Create categorised age
. drop if age<18 & age !=.
(0 observations deleted)

. drop if age>109 & age !=.
(0 observations deleted)

. drop if age==.
(0 observations deleted)

. lab var age "Age at diagnosis"

. 
. recode age 18/39.9999 = 1 /// 
>            40/49.9999 = 2 ///
>                    50/59.9999 = 3 ///
>                60/69.9999 = 4 ///
>                    70/79.9999 = 5 ///
>                    80/max = 6, gen(agegroup) 
(1,331 differences between age and agegroup)

. 
. label define agegroup   1 "18-39" ///
>                                                 2 "40-49" ///
>                                                 3 "50-59" ///
>                                                 4 "60-69" ///
>                                                 5 "70-79" ///
>                                                 6 "80+"

.                                                 
. label values agegroup agegroup

. lab var agegroup "Age group"

. tab agegroup, missing

  Age group |      Freq.     Percent        Cum.
------------+-----------------------------------
      18-39 |        578       43.43       43.43
      40-49 |        203       15.25       58.68
      50-59 |        173       13.00       71.68
      60-69 |        132        9.92       81.59
      70-79 |         99        7.44       89.03
        80+ |        146       10.97      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. order agegroup, after(age)

. 
. ***Sex
. gen male = 1 if sex == "male"
(660 missing values generated)

. replace male = 0 if sex == "female"
(660 real changes made)

. lab var male "Male"

. lab define male 0 "No" 1 "Yes", modify

. lab val male male

. tab male, missing

       Male |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        660       49.59       49.59
        Yes |        671       50.41      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. order male, after(sex)

. 
. ***Ethnicity
. gen ethnicity_n = 1 if ethnicity == "White"
(1,209 missing values generated)

. replace ethnicity_n = 2 if ethnicity == "Asian or Asian British"
(78 real changes made)

. replace ethnicity_n = 3 if ethnicity == "Black or Black British"
(100 real changes made)

. replace ethnicity_n = 4 if ethnicity == "Mixed"
(44 real changes made)

. replace ethnicity_n = 5 if ethnicity == "Chinese or Other Ethnic Groups"
(147 real changes made)

. replace ethnicity_n = 6 if ethnicity == "Unknown"
(840 real changes made)

. 
. 
. label define ethnicity_n        1 "White"                                               ///
>                                                         2 "Asian or Asian British"              ///
>                                                         3 "Black or Black British"      ///
>                                                         4 "Mixed"                                               //
> /
>                                                         5 "Chinese or Other Ethnic Groups" ///
>                                                         6 "Not known", modify

.                                                         
. label values ethnicity_n ethnicity_n

. lab var ethnicity_n "Ethnicity"

. tab ethnicity_n, missing

                     Ethnicity |      Freq.     Percent        Cum.
-------------------------------+-----------------------------------
                         White |        122        9.17        9.17
        Asian or Asian British |         78        5.86       15.03
        Black or Black British |        100        7.51       22.54
                         Mixed |         44        3.31       25.85
Chinese or Other Ethnic Groups |        147       11.04       36.89
                     Not known |        840       63.11      100.00
-------------------------------+-----------------------------------
                         Total |      1,331      100.00

. drop ethnicity

. rename ethnicity_n ethnicity 

. 
. ***Practice regions
. encode region, gen(nuts_region)

. tab region, missing

                  region |      Freq.     Percent        Cum.
-------------------------+-----------------------------------
                    East |        158       11.87       11.87
           East Midlands |        139       10.44       22.31
                  London |        137       10.29       32.61
              North East |        130        9.77       42.37
              North West |        154       11.57       53.94
              South East |        157       11.80       65.74
              South West |        156       11.72       77.46
           West Midlands |        152       11.42       88.88
Yorkshire and The Humber |        148       11.12      100.00
-------------------------+-----------------------------------
                   Total |      1,331      100.00

. replace region="Not known" if region==""
(0 real changes made)

. gen region_nospace=region

. replace region_nospace="SouthWest" if region=="South West"
(156 real changes made)

. replace region_nospace="EastMidlands" if region=="East Midlands"
(139 real changes made)

. replace region_nospace="East" if region=="East"
(0 real changes made)

. replace region_nospace="London" if region=="London"
(0 real changes made)

. replace region_nospace="NorthEast" if region=="North East"
(130 real changes made)

. replace region_nospace="NorthWest" if region=="North West"
(154 real changes made)

. replace region_nospace="SouthEast" if region=="South East"
(157 real changes made)

. replace region_nospace="WestMidlands" if region=="West Midlands"
(152 real changes made)

. replace region_nospace="YorkshireandTheHumber" if region=="Yorkshire and The Humber"
(148 real changes made)

. 
. ***IMD
. gen imd = 1 if imd_quintile == "1 (most deprived)"
(1,095 missing values generated)

. replace imd = 2 if imd_quintile == "2"
(249 real changes made)

. replace imd = 3 if imd_quintile == "3"
(251 real changes made)

. replace imd = 4 if imd_quintile == "4"
(235 real changes made)

. replace imd = 5 if imd_quintile == "5 (least deprived)"
(258 real changes made)

. replace imd = .u if imd_quintile == "Unknown"
(102 real changes made, 102 to missing)

. lab var imd "Index of multiple deprivation"

. lab define imd 1 "1 (most deprived)" ///
>                            2 "2" ///
>                            3 "3" ///
>                            4 "4" ///
>                            5 "5 (least deprived)" ///
>                            .u "Not known"

. lab val imd imd                    

. tab imd, missing

 Index of multiple |
       deprivation |      Freq.     Percent        Cum.
-------------------+-----------------------------------
 1 (most deprived) |        236       17.73       17.73
                 2 |        249       18.71       36.44
                 3 |        251       18.86       55.30
                 4 |        235       17.66       72.95
5 (least deprived) |        258       19.38       92.34
         Not known |        102        7.66      100.00
-------------------+-----------------------------------
             Total |      1,331      100.00

. drop imd_quintile

. 
. ***Body Mass Index
. *Recode strange values 
. replace bmi_value = . if bmi_value == 0 
(0 real changes made)

. replace bmi_value = . if !inrange(bmi_value, 10, 80)
(0 real changes made)

. 
. *Restrict to within 10 years of EIA diagnosis date and aged>16 
. gen bmi_time = (eia_code_date - bmi_date)/365.25
(1,330 missing values generated)

. gen bmi_age = age - bmi_time
(1,330 missing values generated)

. replace bmi_value = . if bmi_age < 16 
(0 real changes made)

. replace bmi_value = . if bmi_time > 10 & bmi_time != . 
(0 real changes made)

. 
. *Set to missing if no date, and vice versa 
. replace bmi_value = . if bmi_date == . 
(0 real changes made)

. replace bmi_date = . if bmi_value == . 
(0 real changes made)

. replace bmi_time = . if bmi_value == . 
(0 real changes made)

. replace bmi_age = . if bmi_value == . 
(0 real changes made)

. 
. *Create BMI categories
. gen     bmicat = .
(1,331 missing values generated)

. recode  bmicat . = 1 if bmi_value < 18.5
(0 changes made to bmicat)

. recode  bmicat . = 2 if bmi_value < 25
(0 changes made to bmicat)

. recode  bmicat . = 3 if bmi_value < 30
(0 changes made to bmicat)

. recode  bmicat . = 4 if bmi_value < 35
(0 changes made to bmicat)

. recode  bmicat . = 5 if bmi_value < 40
(0 changes made to bmicat)

. recode  bmicat . = 6 if bmi_value < .
(1 changes made to bmicat)

. replace bmicat = .u if bmi_value >= .
(1,330 real changes made, 1,330 to missing)

. 
. label define bmicat 1 "Underweight (<18.5)"     ///
>                                         2 "Normal (18.5-24.9)"          ///
>                                         3 "Overweight (25-29.9)"        ///
>                                         4 "Obese I (30-34.9)"           ///
>                                         5 "Obese II (35-39.9)"          ///
>                                         6 "Obese III (40+)"                     ///
>                                         .u "Not known"

.                                         
. label values bmicat bmicat

. lab var bmicat "BMI"

. tab bmicat, missing

                 BMI |      Freq.     Percent        Cum.
---------------------+-----------------------------------
     Obese III (40+) |          1        0.08        0.08
           Not known |      1,330       99.92      100.00
---------------------+-----------------------------------
               Total |      1,331      100.00

. order bmicat, after (bmi_value)

. drop bmi_age bmi_time

. 
. *Create less granular categorisation
. recode bmicat 1/3 .u = 1 4 = 2 5 = 3 6 = 4, gen(obese4cat)
(1,331 differences between bmicat and obese4cat)

. 
. label define obese4cat  1 "No record of obesity"        ///
>                                                 2 "Obese I (30-34.9)"           ///
>                                                 3 "Obese II (35-39.9)"          ///
>                                                 4 "Obese III (40+)"             

. 
. label values obese4cat obese4cat

. order obese4cat, after(bmicat)

. lab var obese4cat "Obesity categories"

. 
. ***Smoking 
. label define smoke 1 "Never" 2 "Former" 3 "Current" .u "Not known"

. 
. gen     smoke = 1  if smoking_status == "N"
(1,315 missing values generated)

. replace smoke = 2  if smoking_status == "E"
(506 real changes made)

. replace smoke = 3  if smoking_status == "S"
(807 real changes made)

. replace smoke = .u if smoking_status == "M"
(2 real changes made, 2 to missing)

. replace smoke = .u if smoking_status == "" 
(0 real changes made)

. 
. label values smoke smoke

. lab var smoke "Smoking status"

. drop smoking_status

. tab smoke, missing

    Smoking |
     status |      Freq.     Percent        Cum.
------------+-----------------------------------
      Never |         16        1.20        1.20
     Former |        506       38.02       39.22
    Current |        807       60.63       99.85
  Not known |          2        0.15      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. 
. *Create non-missing 3-category variable for current smoking (assumes missing smoking is never smoking)
. recode smoke .u = 1, gen(smoke_nomiss)
(2 differences between smoke and smoke_nomiss)

. order smoke_nomiss, after(smoke)

. label values smoke_nomiss smoke

. 
. **Clinical comorbidities
. ***Nb. not using creatinine of HBA1c values for now, just codes
. foreach disease in ckd dm ild copd cva lung_ca solid_ca haem_ca depr osteop frac dem chd {
  2.         tab `disease'_before, missing
  3.         tab `disease'_after, missing
  4.         gen `disease'_new = 1 if (`disease'_after == 1 & `disease'_before == 0)
  5.         recode `disease'_new .=0
  6.         label define `disease'_new 0 "No" 1 "Yes"
  7.         label values `disease'_new `disease'_new
  8.         tab `disease'_new, missing
  9.         order `disease'_new, after(`disease'_after)
 10. }

 ckd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,133       85.12       85.12
        Yes |        198       14.88      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  ckd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,081       81.22       81.22
        Yes |        250       18.78      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,107 missing values generated)
(1,107 changes made to ckd_new)

    ckd_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,107       83.17       83.17
        Yes |        224       16.83      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  dm_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,253       94.14       94.14
        Yes |         78        5.86      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   dm_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,244       93.46       93.46
        Yes |         87        6.54      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,245 missing values generated)
(1,245 changes made to dm_new)

     dm_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,245       93.54       93.54
        Yes |         86        6.46      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 ild_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,188       89.26       89.26
        Yes |        143       10.74      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  ild_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,185       89.03       89.03
        Yes |        146       10.97      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,198 missing values generated)
(1,198 changes made to ild_new)

    ild_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,198       90.01       90.01
        Yes |        133        9.99      100.00
------------+-----------------------------------
      Total |      1,331      100.00

copd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,301       97.75       97.75
        Yes |         30        2.25      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 copd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,293       97.15       97.15
        Yes |         38        2.85      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,293 missing values generated)
(1,293 changes made to copd_new)

   copd_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,293       97.15       97.15
        Yes |         38        2.85      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 cva_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,178       88.50       88.50
        Yes |        153       11.50      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  cva_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,153       86.63       86.63
        Yes |        178       13.37      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,170 missing values generated)
(1,170 changes made to cva_new)

    cva_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,170       87.90       87.90
        Yes |        161       12.10      100.00
------------+-----------------------------------
      Total |      1,331      100.00

lung_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,140       85.65       85.65
        Yes |        191       14.35      100.00
------------+-----------------------------------
      Total |      1,331      100.00

lung_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,096       82.34       82.34
        Yes |        235       17.66      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,126 missing values generated)
(1,126 changes made to lung_ca_new)

lung_ca_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,126       84.60       84.60
        Yes |        205       15.40      100.00
------------+-----------------------------------
      Total |      1,331      100.00

solid_ca_be |
       fore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        245       18.41       18.41
        Yes |      1,086       81.59      100.00
------------+-----------------------------------
      Total |      1,331      100.00

solid_ca_af |
        ter |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        160       12.02       12.02
        Yes |      1,171       87.98      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,111 missing values generated)
(1,111 changes made to solid_ca_new)

solid_ca_ne |
          w |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,111       83.47       83.47
        Yes |        220       16.53      100.00
------------+-----------------------------------
      Total |      1,331      100.00

haem_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        896       67.32       67.32
        Yes |        435       32.68      100.00
------------+-----------------------------------
      Total |      1,331      100.00

haem_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        866       65.06       65.06
        Yes |        465       34.94      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,001 missing values generated)
(1,001 changes made to haem_ca_new)

haem_ca_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,001       75.21       75.21
        Yes |        330       24.79      100.00
------------+-----------------------------------
      Total |      1,331      100.00

depr_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,274       95.72       95.72
        Yes |         57        4.28      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 depr_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,254       94.21       94.21
        Yes |         77        5.79      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,255 missing values generated)
(1,255 changes made to depr_new)

   depr_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,255       94.29       94.29
        Yes |         76        5.71      100.00
------------+-----------------------------------
      Total |      1,331      100.00

osteop_befo |
         re |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,313       98.65       98.65
        Yes |         18        1.35      100.00
------------+-----------------------------------
      Total |      1,331      100.00

osteop_afte |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,300       97.67       97.67
        Yes |         31        2.33      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,302 missing values generated)
(1,302 changes made to osteop_new)

 osteop_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,302       97.82       97.82
        Yes |         29        2.18      100.00
------------+-----------------------------------
      Total |      1,331      100.00

frac_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,331      100.00      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 frac_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,327       99.70       99.70
        Yes |          4        0.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,327 missing values generated)
(1,327 changes made to frac_new)

   frac_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,327       99.70       99.70
        Yes |          4        0.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 dem_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,164       87.45       87.45
        Yes |        167       12.55      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  dem_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,129       84.82       84.82
        Yes |        202       15.18      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,149 missing values generated)
(1,149 changes made to dem_new)

    dem_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,149       86.33       86.33
        Yes |        182       13.67      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 chd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,154       86.70       86.70
        Yes |        177       13.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  chd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,114       83.70       83.70
        Yes |        217       16.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,133 missing values generated)
(1,133 changes made to chd_new)

    chd_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,133       85.12       85.12
        Yes |        198       14.88      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. 
. *Label remaining variables 
. lab var ckd_before "Chronic kidney disease"

. lab var ckd_after "Chronic kidney disease"

. lab var ckd_new "Chronic kidney disease"

. lab var dm_before "Type 2 diabetes mellitus"

. lab var dm_after "Type 2 diabetes mellitus"

. lab var dm_new "Type 2 diabetes mellitus"

. lab var ild_before "Interstitial lung disease"

. lab var ild_after "Interstitial lung disease"

. lab var ild_new "Interstitial lung disease"

. lab var copd_before "COPD"

. lab var copd_after "COPD"

. lab var copd_new "COPD"

. lab var lung_ca_before "Lung cancer"

. lab var lung_ca_after "Lung cancer"

. lab var lung_ca_new "Lung cancer"

. lab var solid_ca_before "Solid organ cancer"

. lab var solid_ca_after "Solid organ cancer"

. lab var solid_ca_new "Solid organ cancer"

. lab var haem_ca_before "Haematological cancer"

. lab var haem_ca_after "Haematological cancer"

. lab var haem_ca_new "Haematological cancer"

. lab var depr_before "Depression"

. lab var depr_after "Depression"

. lab var depr_new "Depression"

. lab var osteop_before "Osteoporosis"

. lab var osteop_after "Osteoporosis"

. lab var osteop_new "Osteoporosis"

. lab var frac_before "Fragility fracture"

. lab var frac_after "Fragility fracture"

. lab var frac_new "Fragility fracture"

. lab var dem_before "Dementia"

. lab var dem_after "Dementia"

. lab var dem_new "Dementia"

. lab var chd_before "Coronary heart disease"

. lab var chd_after "Coronary heart disease"

. lab var chd_new "Coronary heart disease"

. 
. lab var rheum_appt "First rheumatology appointment within 12 months"

. lab var rheum_appt_any "Any rheumatology appointment within 12 months"

. lab var rheum_appt2 "Any rheumatology appointment within 6 months"

. lab var rheum_appt3 "Any rheumatology appointment within 24 months"

. 
. lab var eia_code "Inflammatory arthritis"

. lab var ra_code "Rheumatoid arthritis"

. lab var psa_code "Psoriatic arthritis"

. lab var anksp_code "Axial spondyloarthritis"

. lab var undiff_code "Undifferentiated inflammatory arthritis"

. 
. **RF and CCP positivity (blood test and/or diagnostic code)
. codebook rf_code

--------------------------------------------------------------------------------------------------------------------
rf_code                                                                                                  (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric (float)
                 Label: rf_code

                 Range: [0,1]                         Units: 1
         Unique values: 2                         Missing .: 0/1,331

            Tabulation: Freq.   Numeric  Label
                        1,320         0  No
                           11         1  Yes

. codebook rf_test_value

--------------------------------------------------------------------------------------------------------------------
rf_test_value                                                                                            (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric (float)

                 Range: [.49810165,98.594498]         Units: 1.000e-08
         Unique values: 24                        Missing .: 1,307/1,331

                  Mean:  47.343
             Std. dev.: 31.6022

           Percentiles:     10%       25%       50%       75%       90%
                        10.0294   19.5745   42.3669    78.607   86.8916

. tabstat rf_test_value, stats (n mean p50 p25 p75) //recode on the basis of values

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
rf_test_va~e |        24  47.34299  42.36688  19.57446  78.60697
----------------------------------------------------------------

. gen rf_pos_ra = 1 if (rf_test_value>=20 & rf_test_value!=.) | rf_code==1 //check ranges
(1,304 missing values generated)

. recode rf_pos_ra .=0 //Nb. 0 will also include those where test not done (or not coded for)
(1,304 changes made to rf_pos_ra)

. lab define rf_pos_ra 0 "RF negative/not known" 1 "RF positive"

. lab val rf_pos_ra rf_pos_ra

. lab var rf_pos_ra "Rheumatoid factor positivity"

. tab rf_pos_ra if ra_code==1, missing

    Rheumatoid factor |
           positivity |      Freq.     Percent        Cum.
----------------------+-----------------------------------
RF negative/not known |      1,079       97.91       97.91
          RF positive |         23        2.09      100.00
----------------------+-----------------------------------
                Total |      1,102      100.00

. 
. codebook ccp_code

--------------------------------------------------------------------------------------------------------------------
ccp_code                                                                                                 (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric (float)
                 Label: ccp_code

                 Range: [0,1]                         Units: 1
         Unique values: 2                         Missing .: 0/1,331

            Tabulation: Freq.   Numeric  Label
                        1,319         0  No
                           12         1  Yes

. codebook ccp_test_value

--------------------------------------------------------------------------------------------------------------------
ccp_test_value                                                                                           (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric (float)

                 Range: [6.6003747,92.127792]         Units: 1.000e-07
         Unique values: 7                         Missing .: 1,324/1,331

            Tabulation: Freq.  Value
                            1  6.6003747
                            1  31.05724
                            1  31.643269
                            1  42.460194
                            1  69.956726
                            1  87.927719
                            1  92.127792
                        1,324  .

. tabstat ccp_test_value, stats (n mean p50 p25 p75) //recode on the basis of values

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
ccp_test_v~e |         7   51.6819  42.46019  31.05724  87.92772
----------------------------------------------------------------

. gen ccp_pos_ra = 1 if (ccp_test_value>=10 & ccp_test_value!=.) | ccp_code==1 //check ranges
(1,313 missing values generated)

. recode ccp_pos_ra .=0 //Nb. 0 will also include those where test not done (or not coded for)
(1,313 changes made to ccp_pos_ra)

. lab define ccp_pos_ra 0 "CCP negative/not known" 1 "CCP positive"

. lab val ccp_pos_ra ccp_pos_ra

. lab var ccp_pos_ra "CCP positivity"

. tab ccp_pos_ra if ra_code==1, missing

        CCP positivity |      Freq.     Percent        Cum.
-----------------------+-----------------------------------
CCP negative/not known |      1,087       98.64       98.64
          CCP positive |         15        1.36      100.00
-----------------------+-----------------------------------
                 Total |      1,102      100.00

. 
. **Seropositive RA (RF and/or CCP positive and/or seropositive diagnostic code)
. gen seropos_ra = 1 if rf_pos_ra==1 | ccp_pos_ra==1 | seropositive_code==1 //check ranges
(1,182 missing values generated)

. recode seropos_ra .=0 //Nb. 0 will also include those where test not done (or not coded for)
(1,182 changes made to seropos_ra)

. lab define seropos_ra 0 "Seronegative/not known" 1 "Seropositive"

. lab val seropos_ra seropos_ra

. lab var seropos_ra "Seropositivity"

. tab seropos_ra if ra_code==1, missing

        Seropositivity |      Freq.     Percent        Cum.
-----------------------+-----------------------------------
Seronegative/not known |        962       87.30       87.30
          Seropositive |        140       12.70      100.00
-----------------------+-----------------------------------
                 Total |      1,102      100.00

. 
. **Erosive codes
. lab var erosive_ra "Erosive rheumatoid arthritis"
erosive_ra ambiguous abbreviation
r(111);

end of do-file

r(111);

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. 
. import delimited "$projectdir/output/dataset.csv", clear
(encoding automatically selected: ISO-8859-1)
(105 vars, 1,331 obs)

. 
. **Set Ado file path
. adopath + "$projectdir/analysis/extra_ados"
  [1]  (BASE)      "C:\Program Files\Stata18\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata18\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "C:\Users\Mark\ado\personal/"
  [5]  (PLUS)      "C:\Users\Mark\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "C:\Users\Mark\OneDrive\PhD Project\OpenSAFELY NEIAA\inflammatory_rheum/analysis/extra_ados"

. 
. **Set index dates ===========================================================*/
. global start_date = "01/04/2016" //for outpatient analyses, data may only be available from April 2019

. global end_date = "31/03/2025"

. global base_year = year(date("$start_date", "DMY"))

. global end_year = year(date("$end_date", "DMY"))

. global max_year = $end_year - $base_year

. 
. **Conversion for dates====================================================*
. 
. ***Variables ending in _date that are string
. ds *_date, has(type string)
eia_code_d~e  chd_before~e  depr_befor~e  solid_ca_a~e  ccp_test_d~e  rheum~e_date  hydroxychl~e  ~m_last_date
ra_code_date  dm_before_~e  osteop_bef~e  haem_ca_af~e  bmi_date      ~erheum_date  lef_last_d~e  rtt_cl_sta~e
psa_code_d~e  ild_before~e  dem_before~e  ckd_after_~e  r~_appt_date  l~ecode_date  mtx_oral_l~e  rtt_cl_ref~e
anksp_code~e  copd_befor~e  chd_after_~e  depr_after~e  rheum~f_date  ~frheum_date  mtx_inj_la~e  rtt_cl_end~e
undiff_cod~e  cva_before~e  dm_after_d~e  osteop_aft~e  rheum~y_date  l~fcode_date  ssz_last_d~e  rtt_op_sta~e
rf_code_date  lung_ca_be~e  ild_after_~e  frac_after~e  rheum~2_date  leflunomid~e  hcq_last_d~e  rtt_op_ref~e
ccp_code_d~e  solid_ca_b~e  copd_after~e  dem_after_~e  rheum~3_date  metho~l_date  steroid_fi~e  rtt_op_end~e
seropositi~e  haem_ca_be~e  cva_after_~e  creatinin~te  rheum~4_date  metho~j_date  steroid_la~e
erosive_ra~e  ckd_before~e  lung_ca_af~e  rf_test_date  r~eappt_date  sulfasalaz~e  steroid_12..

. local string_dates `r(varlist)'

. foreach var of local string_dates {
  2.     gen `var'_num = date(`var', "YMD")
  3.     format `var'_num %td
  4.     order `var'_num, after(`var')
  5.     drop `var'
  6.     rename `var'_num `var'
  7. }
(229 missing values generated)
(1,207 missing values generated)
(1,217 missing values generated)
(1,296 missing values generated)
(1,320 missing values generated)
(1,319 missing values generated)
(1,200 missing values generated)
(1,311 missing values generated)
(1,154 missing values generated)
(1,253 missing values generated)
(1,188 missing values generated)
(1,301 missing values generated)
(1,178 missing values generated)
(1,140 missing values generated)
(245 missing values generated)
(896 missing values generated)
(1,133 missing values generated)
(1,274 missing values generated)
(1,313 missing values generated)
(1,164 missing values generated)
(1,114 missing values generated)
(1,244 missing values generated)
(1,185 missing values generated)
(1,293 missing values generated)
(1,153 missing values generated)
(1,096 missing values generated)
(160 missing values generated)
(866 missing values generated)
(1,081 missing values generated)
(1,254 missing values generated)
(1,300 missing values generated)
(1,327 missing values generated)
(1,129 missing values generated)
(1,324 missing values generated)
(1,307 missing values generated)
(1,324 missing values generated)
(1,330 missing values generated)
(883 missing values generated)
(883 missing values generated)
(519 missing values generated)
(627 missing values generated)
(433 missing values generated)
(269 missing values generated)
(1,327 missing values generated)
(1,317 missing values generated)
(1,068 missing values generated)
(536 missing values generated)
(1,330 missing values generated)
(1,326 missing values generated)
(932 missing values generated)
(547 missing values generated)
(394 missing values generated)
(834 missing values generated)
(682 missing values generated)
(932 missing values generated)
(547 missing values generated)
(394 missing values generated)
(834 missing values generated)
(682 missing values generated)
(484 missing values generated)
(484 missing values generated)
(609 missing values generated)
(609 missing values generated)
(200 missing values generated)
(200 missing values generated)
(200 missing values generated)
(186 missing values generated)
(186 missing values generated)
(186 missing values generated)

. 
. ***Variables ending in _date that are numeric
. foreach var of varlist *_date {
  2.     capture confirm string variable `var'
  3.     if _rc != 0 {
  4.         format `var' %td
  5.     }
  6. }

. 
. ***Create binary indicator for each
. ds *_date
eia_code_d~e  chd_before~e  depr_befor~e  lung_ca_af~e  rf_test_date  r~eappt_date  sulfasalaz~e  steroid_12..
ra_code_date  dm_before_~e  osteop_bef~e  solid_ca_a~e  ccp_test_d~e  rheum~e_date  hydroxychl~e  ~m_last_date
psa_code_d~e  ild_before~e  frac_befor~e  haem_ca_af~e  bmi_date      ~erheum_date  lef_last_d~e  rtt_cl_sta~e
anksp_code~e  copd_befor~e  dem_before~e  ckd_after_~e  r~_appt_date  l~ecode_date  mtx_oral_l~e  rtt_cl_ref~e
undiff_cod~e  cva_before~e  chd_after_~e  depr_after~e  rheum~f_date  ~frheum_date  mtx_inj_la~e  rtt_cl_end~e
rf_code_date  lung_ca_be~e  dm_after_d~e  osteop_aft~e  rheum~y_date  l~fcode_date  ssz_last_d~e  rtt_op_sta~e
ccp_code_d~e  solid_ca_b~e  ild_after_~e  frac_after~e  rheum~2_date  leflunomid~e  hcq_last_d~e  rtt_op_ref~e
seropositi~e  haem_ca_be~e  copd_after~e  dem_after_~e  rheum~3_date  metho~l_date  steroid_fi~e  rtt_op_end~e
erosive_ra~e  ckd_before~e  cva_after_~e  creatinin~te  rheum~4_date  metho~j_date  steroid_la~e

. local dates `r(varlist)'

. foreach var of local dates {
  2.         local newvar =  substr("`var'", 1, length("`var'") - 5)
  3.         gen `newvar' = (`var'!=. )
  4.         order `newvar', after(`var')
  5.         lab define `newvar' 0 "No" 1 "Yes"
  6.         lab val `newvar' `newvar'
  7.         tab `newvar', missing
  8. }

   eia_code |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |      1,331      100.00      100.00
------------+-----------------------------------
      Total |      1,331      100.00

    ra_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        229       17.21       17.21
        Yes |      1,102       82.79      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   psa_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,207       90.68       90.68
        Yes |        124        9.32      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 anksp_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,217       91.44       91.44
        Yes |        114        8.56      100.00
------------+-----------------------------------
      Total |      1,331      100.00

undiff_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,296       97.37       97.37
        Yes |         35        2.63      100.00
------------+-----------------------------------
      Total |      1,331      100.00

    rf_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,320       99.17       99.17
        Yes |         11        0.83      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   ccp_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,319       99.10       99.10
        Yes |         12        0.90      100.00
------------+-----------------------------------
      Total |      1,331      100.00

seropositiv |
     e_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,200       90.16       90.16
        Yes |        131        9.84      100.00
------------+-----------------------------------
      Total |      1,331      100.00

erosive_ra_ |
       code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,311       98.50       98.50
        Yes |         20        1.50      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 chd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,154       86.70       86.70
        Yes |        177       13.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  dm_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,253       94.14       94.14
        Yes |         78        5.86      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 ild_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,188       89.26       89.26
        Yes |        143       10.74      100.00
------------+-----------------------------------
      Total |      1,331      100.00

copd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,301       97.75       97.75
        Yes |         30        2.25      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 cva_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,178       88.50       88.50
        Yes |        153       11.50      100.00
------------+-----------------------------------
      Total |      1,331      100.00

lung_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,140       85.65       85.65
        Yes |        191       14.35      100.00
------------+-----------------------------------
      Total |      1,331      100.00

solid_ca_be |
       fore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        245       18.41       18.41
        Yes |      1,086       81.59      100.00
------------+-----------------------------------
      Total |      1,331      100.00

haem_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        896       67.32       67.32
        Yes |        435       32.68      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 ckd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,133       85.12       85.12
        Yes |        198       14.88      100.00
------------+-----------------------------------
      Total |      1,331      100.00

depr_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,274       95.72       95.72
        Yes |         57        4.28      100.00
------------+-----------------------------------
      Total |      1,331      100.00

osteop_befo |
         re |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,313       98.65       98.65
        Yes |         18        1.35      100.00
------------+-----------------------------------
      Total |      1,331      100.00

frac_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,331      100.00      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 dem_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,164       87.45       87.45
        Yes |        167       12.55      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  chd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,114       83.70       83.70
        Yes |        217       16.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   dm_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,244       93.46       93.46
        Yes |         87        6.54      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  ild_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,185       89.03       89.03
        Yes |        146       10.97      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 copd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,293       97.15       97.15
        Yes |         38        2.85      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  cva_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,153       86.63       86.63
        Yes |        178       13.37      100.00
------------+-----------------------------------
      Total |      1,331      100.00

lung_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,096       82.34       82.34
        Yes |        235       17.66      100.00
------------+-----------------------------------
      Total |      1,331      100.00

solid_ca_af |
        ter |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        160       12.02       12.02
        Yes |      1,171       87.98      100.00
------------+-----------------------------------
      Total |      1,331      100.00

haem_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        866       65.06       65.06
        Yes |        465       34.94      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  ckd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,081       81.22       81.22
        Yes |        250       18.78      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 depr_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,254       94.21       94.21
        Yes |         77        5.79      100.00
------------+-----------------------------------
      Total |      1,331      100.00

osteop_afte |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,300       97.67       97.67
        Yes |         31        2.33      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 frac_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,327       99.70       99.70
        Yes |          4        0.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  dem_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,129       84.82       84.82
        Yes |        202       15.18      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 creatinine |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,324       99.47       99.47
        Yes |          7        0.53      100.00
------------+-----------------------------------
      Total |      1,331      100.00

    rf_test |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,307       98.20       98.20
        Yes |         24        1.80      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   ccp_test |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,324       99.47       99.47
        Yes |          7        0.53      100.00
------------+-----------------------------------
      Total |      1,331      100.00

        bmi |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,330       99.92       99.92
        Yes |          1        0.08      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 rheum_appt |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        883       66.34       66.34
        Yes |        448       33.66      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_appt_ |
        ref |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        883       66.34       66.34
        Yes |        448       33.66      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_appt_ |
        any |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        519       38.99       38.99
        Yes |        812       61.01      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_appt2 |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        627       47.11       47.11
        Yes |        704       52.89      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_appt3 |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        433       32.53       32.53
        Yes |        898       67.47      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_appt4 |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        269       20.21       20.21
        Yes |      1,062       79.79      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_ref_g |
  p_preappt |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,327       99.70       99.70
        Yes |          4        0.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_ref_g |
  p_precode |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,317       98.95       98.95
        Yes |         14        1.05      100.00
------------+-----------------------------------
      Total |      1,331      100.00

last_gp_pre |
      rheum |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,068       80.24       80.24
        Yes |        263       19.76      100.00
------------+-----------------------------------
      Total |      1,331      100.00

last_gp_pre |
       code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        536       40.27       40.27
        Yes |        795       59.73      100.00
------------+-----------------------------------
      Total |      1,331      100.00

last_gp_ref |
      rheum |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,330       99.92       99.92
        Yes |          1        0.08      100.00
------------+-----------------------------------
      Total |      1,331      100.00

last_gp_ref |
       code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,326       99.62       99.62
        Yes |          5        0.38      100.00
------------+-----------------------------------
      Total |      1,331      100.00

leflunomide |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        932       70.02       70.02
        Yes |        399       29.98      100.00
------------+-----------------------------------
      Total |      1,331      100.00

methotrexat |
     e_oral |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        547       41.10       41.10
        Yes |        784       58.90      100.00
------------+-----------------------------------
      Total |      1,331      100.00

methotrexat |
      e_inj |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        394       29.60       29.60
        Yes |        937       70.40      100.00
------------+-----------------------------------
      Total |      1,331      100.00

sulfasalazi |
         ne |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        834       62.66       62.66
        Yes |        497       37.34      100.00
------------+-----------------------------------
      Total |      1,331      100.00

hydroxychlo |
    roquine |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        682       51.24       51.24
        Yes |        649       48.76      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   lef_last |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        932       70.02       70.02
        Yes |        399       29.98      100.00
------------+-----------------------------------
      Total |      1,331      100.00

mtx_oral_la |
         st |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        547       41.10       41.10
        Yes |        784       58.90      100.00
------------+-----------------------------------
      Total |      1,331      100.00

mtx_inj_las |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        394       29.60       29.60
        Yes |        937       70.40      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   ssz_last |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        834       62.66       62.66
        Yes |        497       37.34      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   hcq_last |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        682       51.24       51.24
        Yes |        649       48.76      100.00
------------+-----------------------------------
      Total |      1,331      100.00

steroid_fir |
         st |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        484       36.36       36.36
        Yes |        847       63.64      100.00
------------+-----------------------------------
      Total |      1,331      100.00

steroid_las |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        484       36.36       36.36
        Yes |        847       63.64      100.00
------------+-----------------------------------
      Total |      1,331      100.00

steroid_12m |
     _first |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        609       45.76       45.76
        Yes |        722       54.24      100.00
------------+-----------------------------------
      Total |      1,331      100.00

steroid_12m |
      _last |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        609       45.76       45.76
        Yes |        722       54.24      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rtt_cl_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        200       15.03       15.03
        Yes |      1,131       84.97      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 rtt_cl_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        200       15.03       15.03
        Yes |      1,131       84.97      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 rtt_cl_end |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        200       15.03       15.03
        Yes |      1,131       84.97      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rtt_op_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        186       13.97       13.97
        Yes |      1,145       86.03      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 rtt_op_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        186       13.97       13.97
        Yes |      1,145       86.03      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 rtt_op_end |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        186       13.97       13.97
        Yes |      1,145       86.03      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. 
. /*
> **Will also need to amend conversion for biologic dates ====================================================*
> ***Some dates are given with month/year only, so adding day 15 to enable them to be processed as dates
> ***Would do this by labelling as _date_hcd then doing similar to above/below, but adding 15 days first
> 
> foreach var of varlist   abatacept_date                                         ///
>                                                  adalimumab_date                                        ///     
>                                                  baricitinib_date                                       ///
>                                                  certolizumab_date                                      ///
>                                                  etanercept_date                                        ///
>                                                  golimumab_date                                         ///
>                                                  guselkumab_date                                        ///     
>                                                  infliximab_date                                        ///
>                                                  ixekizumab_date                                        ///
>                                                  methotrexate_hcd_date                          ///
>                                                  rituximab_date                                         ///
>                                                  sarilumab_date                                         ///
>                                                  secukinumab_date                                       ///     
>                                                  tocilizumab_date                                       ///
>                                                  tofacitinib_date                                       ///
>                                                  upadacitinib_date                                      ///
>                                                  ustekinumab_date                                       ///
>                                                  {
>                                                         
>                 capture confirm string variable `var'
>                 if _rc!=0 {
>                         assert `var'==.
>                         rename `var' `var'_date
>                 }
>         
>                 else {
>                                 replace `var' = `var' + "-15"
>                                 rename `var' `var'_dstr
>                                 replace `var'_dstr = " " if `var'_dstr == "-15"
>                                 gen `var'_date = date(`var'_dstr, "YMD") 
>                                 order `var'_date, after(`var'_dstr)
>                                 drop `var'_dstr
>                 }
>         
>         format `var'_date %td
> }
> */
.                                          
. **Create and label variables ===========================================================*/
. 
. ***Age variables
. *Create categorised age
. drop if age<18 & age !=.
(0 observations deleted)

. drop if age>109 & age !=.
(0 observations deleted)

. drop if age==.
(0 observations deleted)

. lab var age "Age at diagnosis"

. 
. recode age 18/39.9999 = 1 /// 
>            40/49.9999 = 2 ///
>                    50/59.9999 = 3 ///
>                60/69.9999 = 4 ///
>                    70/79.9999 = 5 ///
>                    80/max = 6, gen(agegroup) 
(1,331 differences between age and agegroup)

. 
. label define agegroup   1 "18-39" ///
>                                                 2 "40-49" ///
>                                                 3 "50-59" ///
>                                                 4 "60-69" ///
>                                                 5 "70-79" ///
>                                                 6 "80+"

.                                                 
. label values agegroup agegroup

. lab var agegroup "Age group"

. tab agegroup, missing

  Age group |      Freq.     Percent        Cum.
------------+-----------------------------------
      18-39 |        578       43.43       43.43
      40-49 |        203       15.25       58.68
      50-59 |        173       13.00       71.68
      60-69 |        132        9.92       81.59
      70-79 |         99        7.44       89.03
        80+ |        146       10.97      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. order agegroup, after(age)

. 
. ***Sex
. gen male = 1 if sex == "male"
(660 missing values generated)

. replace male = 0 if sex == "female"
(660 real changes made)

. lab var male "Male"

. lab define male 0 "No" 1 "Yes", modify

. lab val male male

. tab male, missing

       Male |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        660       49.59       49.59
        Yes |        671       50.41      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. order male, after(sex)

. 
. ***Ethnicity
. gen ethnicity_n = 1 if ethnicity == "White"
(1,209 missing values generated)

. replace ethnicity_n = 2 if ethnicity == "Asian or Asian British"
(78 real changes made)

. replace ethnicity_n = 3 if ethnicity == "Black or Black British"
(100 real changes made)

. replace ethnicity_n = 4 if ethnicity == "Mixed"
(44 real changes made)

. replace ethnicity_n = 5 if ethnicity == "Chinese or Other Ethnic Groups"
(147 real changes made)

. replace ethnicity_n = 6 if ethnicity == "Unknown"
(840 real changes made)

. 
. 
. label define ethnicity_n        1 "White"                                               ///
>                                                         2 "Asian or Asian British"              ///
>                                                         3 "Black or Black British"      ///
>                                                         4 "Mixed"                                               //
> /
>                                                         5 "Chinese or Other Ethnic Groups" ///
>                                                         6 "Not known", modify

.                                                         
. label values ethnicity_n ethnicity_n

. lab var ethnicity_n "Ethnicity"

. tab ethnicity_n, missing

                     Ethnicity |      Freq.     Percent        Cum.
-------------------------------+-----------------------------------
                         White |        122        9.17        9.17
        Asian or Asian British |         78        5.86       15.03
        Black or Black British |        100        7.51       22.54
                         Mixed |         44        3.31       25.85
Chinese or Other Ethnic Groups |        147       11.04       36.89
                     Not known |        840       63.11      100.00
-------------------------------+-----------------------------------
                         Total |      1,331      100.00

. drop ethnicity

. rename ethnicity_n ethnicity 

. 
. ***Practice regions
. encode region, gen(nuts_region)

. tab region, missing

                  region |      Freq.     Percent        Cum.
-------------------------+-----------------------------------
                    East |        158       11.87       11.87
           East Midlands |        139       10.44       22.31
                  London |        137       10.29       32.61
              North East |        130        9.77       42.37
              North West |        154       11.57       53.94
              South East |        157       11.80       65.74
              South West |        156       11.72       77.46
           West Midlands |        152       11.42       88.88
Yorkshire and The Humber |        148       11.12      100.00
-------------------------+-----------------------------------
                   Total |      1,331      100.00

. replace region="Not known" if region==""
(0 real changes made)

. gen region_nospace=region

. replace region_nospace="SouthWest" if region=="South West"
(156 real changes made)

. replace region_nospace="EastMidlands" if region=="East Midlands"
(139 real changes made)

. replace region_nospace="East" if region=="East"
(0 real changes made)

. replace region_nospace="London" if region=="London"
(0 real changes made)

. replace region_nospace="NorthEast" if region=="North East"
(130 real changes made)

. replace region_nospace="NorthWest" if region=="North West"
(154 real changes made)

. replace region_nospace="SouthEast" if region=="South East"
(157 real changes made)

. replace region_nospace="WestMidlands" if region=="West Midlands"
(152 real changes made)

. replace region_nospace="YorkshireandTheHumber" if region=="Yorkshire and The Humber"
(148 real changes made)

. 
. ***IMD
. gen imd = 1 if imd_quintile == "1 (most deprived)"
(1,095 missing values generated)

. replace imd = 2 if imd_quintile == "2"
(249 real changes made)

. replace imd = 3 if imd_quintile == "3"
(251 real changes made)

. replace imd = 4 if imd_quintile == "4"
(235 real changes made)

. replace imd = 5 if imd_quintile == "5 (least deprived)"
(258 real changes made)

. replace imd = .u if imd_quintile == "Unknown"
(102 real changes made, 102 to missing)

. lab var imd "Index of multiple deprivation"

. lab define imd 1 "1 (most deprived)" ///
>                            2 "2" ///
>                            3 "3" ///
>                            4 "4" ///
>                            5 "5 (least deprived)" ///
>                            .u "Not known"

. lab val imd imd                    

. tab imd, missing

 Index of multiple |
       deprivation |      Freq.     Percent        Cum.
-------------------+-----------------------------------
 1 (most deprived) |        236       17.73       17.73
                 2 |        249       18.71       36.44
                 3 |        251       18.86       55.30
                 4 |        235       17.66       72.95
5 (least deprived) |        258       19.38       92.34
         Not known |        102        7.66      100.00
-------------------+-----------------------------------
             Total |      1,331      100.00

. drop imd_quintile

. 
. ***Body Mass Index
. *Recode strange values 
. replace bmi_value = . if bmi_value == 0 
(0 real changes made)

. replace bmi_value = . if !inrange(bmi_value, 10, 80)
(0 real changes made)

. 
. *Restrict to within 10 years of EIA diagnosis date and aged>16 
. gen bmi_time = (eia_code_date - bmi_date)/365.25
(1,330 missing values generated)

. gen bmi_age = age - bmi_time
(1,330 missing values generated)

. replace bmi_value = . if bmi_age < 16 
(0 real changes made)

. replace bmi_value = . if bmi_time > 10 & bmi_time != . 
(0 real changes made)

. 
. *Set to missing if no date, and vice versa 
. replace bmi_value = . if bmi_date == . 
(0 real changes made)

. replace bmi_date = . if bmi_value == . 
(0 real changes made)

. replace bmi_time = . if bmi_value == . 
(0 real changes made)

. replace bmi_age = . if bmi_value == . 
(0 real changes made)

. 
. *Create BMI categories
. gen     bmicat = .
(1,331 missing values generated)

. recode  bmicat . = 1 if bmi_value < 18.5
(0 changes made to bmicat)

. recode  bmicat . = 2 if bmi_value < 25
(0 changes made to bmicat)

. recode  bmicat . = 3 if bmi_value < 30
(0 changes made to bmicat)

. recode  bmicat . = 4 if bmi_value < 35
(0 changes made to bmicat)

. recode  bmicat . = 5 if bmi_value < 40
(0 changes made to bmicat)

. recode  bmicat . = 6 if bmi_value < .
(1 changes made to bmicat)

. replace bmicat = .u if bmi_value >= .
(1,330 real changes made, 1,330 to missing)

. 
. label define bmicat 1 "Underweight (<18.5)"     ///
>                                         2 "Normal (18.5-24.9)"          ///
>                                         3 "Overweight (25-29.9)"        ///
>                                         4 "Obese I (30-34.9)"           ///
>                                         5 "Obese II (35-39.9)"          ///
>                                         6 "Obese III (40+)"                     ///
>                                         .u "Not known"

.                                         
. label values bmicat bmicat

. lab var bmicat "BMI"

. tab bmicat, missing

                 BMI |      Freq.     Percent        Cum.
---------------------+-----------------------------------
     Obese III (40+) |          1        0.08        0.08
           Not known |      1,330       99.92      100.00
---------------------+-----------------------------------
               Total |      1,331      100.00

. order bmicat, after (bmi_value)

. drop bmi_age bmi_time

. 
. *Create less granular categorisation
. recode bmicat 1/3 .u = 1 4 = 2 5 = 3 6 = 4, gen(obese4cat)
(1,331 differences between bmicat and obese4cat)

. 
. label define obese4cat  1 "No record of obesity"        ///
>                                                 2 "Obese I (30-34.9)"           ///
>                                                 3 "Obese II (35-39.9)"          ///
>                                                 4 "Obese III (40+)"             

. 
. label values obese4cat obese4cat

. order obese4cat, after(bmicat)

. lab var obese4cat "Obesity categories"

. 
. ***Smoking 
. label define smoke 1 "Never" 2 "Former" 3 "Current" .u "Not known"

. 
. gen     smoke = 1  if smoking_status == "N"
(1,315 missing values generated)

. replace smoke = 2  if smoking_status == "E"
(506 real changes made)

. replace smoke = 3  if smoking_status == "S"
(807 real changes made)

. replace smoke = .u if smoking_status == "M"
(2 real changes made, 2 to missing)

. replace smoke = .u if smoking_status == "" 
(0 real changes made)

. 
. label values smoke smoke

. lab var smoke "Smoking status"

. drop smoking_status

. tab smoke, missing

    Smoking |
     status |      Freq.     Percent        Cum.
------------+-----------------------------------
      Never |         16        1.20        1.20
     Former |        506       38.02       39.22
    Current |        807       60.63       99.85
  Not known |          2        0.15      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. 
. *Create non-missing 3-category variable for current smoking (assumes missing smoking is never smoking)
. recode smoke .u = 1, gen(smoke_nomiss)
(2 differences between smoke and smoke_nomiss)

. order smoke_nomiss, after(smoke)

. label values smoke_nomiss smoke

. 
. **Clinical comorbidities
. ***Nb. not using creatinine of HBA1c values for now, just codes
. foreach disease in ckd dm ild copd cva lung_ca solid_ca haem_ca depr osteop frac dem chd {
  2.         tab `disease'_before, missing
  3.         tab `disease'_after, missing
  4.         gen `disease'_new = 1 if (`disease'_after == 1 & `disease'_before == 0)
  5.         recode `disease'_new .=0
  6.         label define `disease'_new 0 "No" 1 "Yes"
  7.         label values `disease'_new `disease'_new
  8.         tab `disease'_new, missing
  9.         order `disease'_new, after(`disease'_after)
 10. }

 ckd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,133       85.12       85.12
        Yes |        198       14.88      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  ckd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,081       81.22       81.22
        Yes |        250       18.78      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,107 missing values generated)
(1,107 changes made to ckd_new)

    ckd_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,107       83.17       83.17
        Yes |        224       16.83      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  dm_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,253       94.14       94.14
        Yes |         78        5.86      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   dm_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,244       93.46       93.46
        Yes |         87        6.54      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,245 missing values generated)
(1,245 changes made to dm_new)

     dm_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,245       93.54       93.54
        Yes |         86        6.46      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 ild_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,188       89.26       89.26
        Yes |        143       10.74      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  ild_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,185       89.03       89.03
        Yes |        146       10.97      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,198 missing values generated)
(1,198 changes made to ild_new)

    ild_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,198       90.01       90.01
        Yes |        133        9.99      100.00
------------+-----------------------------------
      Total |      1,331      100.00

copd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,301       97.75       97.75
        Yes |         30        2.25      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 copd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,293       97.15       97.15
        Yes |         38        2.85      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,293 missing values generated)
(1,293 changes made to copd_new)

   copd_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,293       97.15       97.15
        Yes |         38        2.85      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 cva_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,178       88.50       88.50
        Yes |        153       11.50      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  cva_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,153       86.63       86.63
        Yes |        178       13.37      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,170 missing values generated)
(1,170 changes made to cva_new)

    cva_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,170       87.90       87.90
        Yes |        161       12.10      100.00
------------+-----------------------------------
      Total |      1,331      100.00

lung_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,140       85.65       85.65
        Yes |        191       14.35      100.00
------------+-----------------------------------
      Total |      1,331      100.00

lung_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,096       82.34       82.34
        Yes |        235       17.66      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,126 missing values generated)
(1,126 changes made to lung_ca_new)

lung_ca_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,126       84.60       84.60
        Yes |        205       15.40      100.00
------------+-----------------------------------
      Total |      1,331      100.00

solid_ca_be |
       fore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        245       18.41       18.41
        Yes |      1,086       81.59      100.00
------------+-----------------------------------
      Total |      1,331      100.00

solid_ca_af |
        ter |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        160       12.02       12.02
        Yes |      1,171       87.98      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,111 missing values generated)
(1,111 changes made to solid_ca_new)

solid_ca_ne |
          w |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,111       83.47       83.47
        Yes |        220       16.53      100.00
------------+-----------------------------------
      Total |      1,331      100.00

haem_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        896       67.32       67.32
        Yes |        435       32.68      100.00
------------+-----------------------------------
      Total |      1,331      100.00

haem_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        866       65.06       65.06
        Yes |        465       34.94      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,001 missing values generated)
(1,001 changes made to haem_ca_new)

haem_ca_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,001       75.21       75.21
        Yes |        330       24.79      100.00
------------+-----------------------------------
      Total |      1,331      100.00

depr_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,274       95.72       95.72
        Yes |         57        4.28      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 depr_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,254       94.21       94.21
        Yes |         77        5.79      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,255 missing values generated)
(1,255 changes made to depr_new)

   depr_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,255       94.29       94.29
        Yes |         76        5.71      100.00
------------+-----------------------------------
      Total |      1,331      100.00

osteop_befo |
         re |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,313       98.65       98.65
        Yes |         18        1.35      100.00
------------+-----------------------------------
      Total |      1,331      100.00

osteop_afte |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,300       97.67       97.67
        Yes |         31        2.33      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,302 missing values generated)
(1,302 changes made to osteop_new)

 osteop_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,302       97.82       97.82
        Yes |         29        2.18      100.00
------------+-----------------------------------
      Total |      1,331      100.00

frac_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,331      100.00      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 frac_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,327       99.70       99.70
        Yes |          4        0.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,327 missing values generated)
(1,327 changes made to frac_new)

   frac_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,327       99.70       99.70
        Yes |          4        0.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 dem_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,164       87.45       87.45
        Yes |        167       12.55      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  dem_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,129       84.82       84.82
        Yes |        202       15.18      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,149 missing values generated)
(1,149 changes made to dem_new)

    dem_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,149       86.33       86.33
        Yes |        182       13.67      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 chd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,154       86.70       86.70
        Yes |        177       13.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  chd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,114       83.70       83.70
        Yes |        217       16.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,133 missing values generated)
(1,133 changes made to chd_new)

    chd_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,133       85.12       85.12
        Yes |        198       14.88      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. 
. *Label remaining variables 
. lab var ckd_before "Chronic kidney disease"

. lab var ckd_after "Chronic kidney disease"

. lab var ckd_new "Chronic kidney disease"

. lab var dm_before "Type 2 diabetes mellitus"

. lab var dm_after "Type 2 diabetes mellitus"

. lab var dm_new "Type 2 diabetes mellitus"

. lab var ild_before "Interstitial lung disease"

. lab var ild_after "Interstitial lung disease"

. lab var ild_new "Interstitial lung disease"

. lab var copd_before "COPD"

. lab var copd_after "COPD"

. lab var copd_new "COPD"

. lab var lung_ca_before "Lung cancer"

. lab var lung_ca_after "Lung cancer"

. lab var lung_ca_new "Lung cancer"

. lab var solid_ca_before "Solid organ cancer"

. lab var solid_ca_after "Solid organ cancer"

. lab var solid_ca_new "Solid organ cancer"

. lab var haem_ca_before "Haematological cancer"

. lab var haem_ca_after "Haematological cancer"

. lab var haem_ca_new "Haematological cancer"

. lab var depr_before "Depression"

. lab var depr_after "Depression"

. lab var depr_new "Depression"

. lab var osteop_before "Osteoporosis"

. lab var osteop_after "Osteoporosis"

. lab var osteop_new "Osteoporosis"

. lab var frac_before "Fragility fracture"

. lab var frac_after "Fragility fracture"

. lab var frac_new "Fragility fracture"

. lab var dem_before "Dementia"

. lab var dem_after "Dementia"

. lab var dem_new "Dementia"

. lab var chd_before "Coronary heart disease"

. lab var chd_after "Coronary heart disease"

. lab var chd_new "Coronary heart disease"

. 
. lab var rheum_appt "First rheumatology appointment within 12 months"

. lab var rheum_appt_any "Any rheumatology appointment within 12 months"

. lab var rheum_appt2 "Any rheumatology appointment within 6 months"

. lab var rheum_appt3 "Any rheumatology appointment within 24 months"

. 
. lab var eia_code "Inflammatory arthritis"

. lab var ra_code "Rheumatoid arthritis"

. lab var psa_code "Psoriatic arthritis"

. lab var anksp_code "Axial spondyloarthritis"

. lab var undiff_code "Undifferentiated inflammatory arthritis"

. 
. **RF and CCP positivity (blood test and/or diagnostic code)
. codebook rf_code

--------------------------------------------------------------------------------------------------------------------
rf_code                                                                                                  (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric (float)
                 Label: rf_code

                 Range: [0,1]                         Units: 1
         Unique values: 2                         Missing .: 0/1,331

            Tabulation: Freq.   Numeric  Label
                        1,320         0  No
                           11         1  Yes

. codebook rf_test_value

--------------------------------------------------------------------------------------------------------------------
rf_test_value                                                                                            (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric (float)

                 Range: [.49810165,98.594498]         Units: 1.000e-08
         Unique values: 24                        Missing .: 1,307/1,331

                  Mean:  47.343
             Std. dev.: 31.6022

           Percentiles:     10%       25%       50%       75%       90%
                        10.0294   19.5745   42.3669    78.607   86.8916

. tabstat rf_test_value, stats (n mean p50 p25 p75) //recode on the basis of values

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
rf_test_va~e |        24  47.34299  42.36688  19.57446  78.60697
----------------------------------------------------------------

. gen rf_pos_ra = 1 if (rf_test_value>=20 & rf_test_value!=.) | rf_code==1 //check ranges
(1,304 missing values generated)

. recode rf_pos_ra .=0 //Nb. 0 will also include those where test not done (or not coded for)
(1,304 changes made to rf_pos_ra)

. lab define rf_pos_ra 0 "RF negative/not known" 1 "RF positive"

. lab val rf_pos_ra rf_pos_ra

. lab var rf_pos_ra "Rheumatoid factor positivity"

. tab rf_pos_ra if ra_code==1, missing

    Rheumatoid factor |
           positivity |      Freq.     Percent        Cum.
----------------------+-----------------------------------
RF negative/not known |      1,079       97.91       97.91
          RF positive |         23        2.09      100.00
----------------------+-----------------------------------
                Total |      1,102      100.00

. 
. codebook ccp_code

--------------------------------------------------------------------------------------------------------------------
ccp_code                                                                                                 (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric (float)
                 Label: ccp_code

                 Range: [0,1]                         Units: 1
         Unique values: 2                         Missing .: 0/1,331

            Tabulation: Freq.   Numeric  Label
                        1,319         0  No
                           12         1  Yes

. codebook ccp_test_value

--------------------------------------------------------------------------------------------------------------------
ccp_test_value                                                                                           (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric (float)

                 Range: [6.6003747,92.127792]         Units: 1.000e-07
         Unique values: 7                         Missing .: 1,324/1,331

            Tabulation: Freq.  Value
                            1  6.6003747
                            1  31.05724
                            1  31.643269
                            1  42.460194
                            1  69.956726
                            1  87.927719
                            1  92.127792
                        1,324  .

. tabstat ccp_test_value, stats (n mean p50 p25 p75) //recode on the basis of values

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
ccp_test_v~e |         7   51.6819  42.46019  31.05724  87.92772
----------------------------------------------------------------

. gen ccp_pos_ra = 1 if (ccp_test_value>=10 & ccp_test_value!=.) | ccp_code==1 //check ranges
(1,313 missing values generated)

. recode ccp_pos_ra .=0 //Nb. 0 will also include those where test not done (or not coded for)
(1,313 changes made to ccp_pos_ra)

. lab define ccp_pos_ra 0 "CCP negative/not known" 1 "CCP positive"

. lab val ccp_pos_ra ccp_pos_ra

. lab var ccp_pos_ra "CCP positivity"

. tab ccp_pos_ra if ra_code==1, missing

        CCP positivity |      Freq.     Percent        Cum.
-----------------------+-----------------------------------
CCP negative/not known |      1,087       98.64       98.64
          CCP positive |         15        1.36      100.00
-----------------------+-----------------------------------
                 Total |      1,102      100.00

. 
. **Seropositive RA (RF and/or CCP positive and/or seropositive diagnostic code)
. gen seropos_ra = 1 if rf_pos_ra==1 | ccp_pos_ra==1 | seropositive_code==1 //check ranges
(1,182 missing values generated)

. recode seropos_ra .=0 //Nb. 0 will also include those where test not done (or not coded for)
(1,182 changes made to seropos_ra)

. lab define seropos_ra 0 "Seronegative/not known" 1 "Seropositive"

. lab val seropos_ra seropos_ra

. lab var seropos_ra "Seropositivity"

. tab seropos_ra if ra_code==1, missing

        Seropositivity |      Freq.     Percent        Cum.
-----------------------+-----------------------------------
Seronegative/not known |        962       87.30       87.30
          Seropositive |        140       12.70      100.00
-----------------------+-----------------------------------
                 Total |      1,102      100.00

. 
. **Erosive codes
. lab var erosive_ra_code "Erosive rheumatoid arthritis"

. tab erosive_ra_code if ra_code==1 //Nb. 0 will also include those where test not done (or not coded for)

    Erosive |
 rheumatoid |
  arthritis |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,084       98.37       98.37
        Yes |         18        1.63      100.00
------------+-----------------------------------
      Total |      1,102      100.00

. 
. **All patients should have diagnostic code=============================================================*/
. tab eia_code, missing

Inflammator |
y arthritis |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |      1,331      100.00      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. keep if eia_code==1
(0 observations deleted)

. 
. **Check first rheum appt date was before diagnostic code date==================================*/
. 
. **Rheumatology appt definitions 
. tab rheum_appt, missing //proportion of patients with an rheum outpatient date (with first attendance option selec
> ted) in the 12 months before and 60 days after EIA code appeared in GP record; data only April 2019 onwards

      First |
rheumatolog |
          y |
appointment |
  within 12 |
     months |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        883       66.34       66.34
        Yes |        448       33.66      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. tab mo_year_diagn rheum_appt, missing //proportion of patients with an rheum outpatient date (with first attendanc
> e option selected) in the 12 months before and 60 days after EIA code appeared in GP record; data only April 2019 
> onwards
variable mo_year_diagn not found
r(111);

end of do-file

r(111);

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. 
. import delimited "$projectdir/output/dataset.csv", clear
(encoding automatically selected: ISO-8859-1)
(105 vars, 1,331 obs)

. 
. **Set Ado file path
. adopath + "$projectdir/analysis/extra_ados"
  [1]  (BASE)      "C:\Program Files\Stata18\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata18\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "C:\Users\Mark\ado\personal/"
  [5]  (PLUS)      "C:\Users\Mark\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "C:\Users\Mark\OneDrive\PhD Project\OpenSAFELY NEIAA\inflammatory_rheum/analysis/extra_ados"

. 
. **Set index dates ===========================================================*/
. global start_date = "01/04/2016" //for outpatient analyses, data may only be available from April 2019

. global end_date = "31/03/2025"

. global base_year = year(date("$start_date", "DMY"))

. global end_year = year(date("$end_date", "DMY"))

. global max_year = $end_year - $base_year

. 
. **Conversion for dates====================================================*
. 
. ***Variables ending in _date that are string
. ds *_date, has(type string)
eia_code_d~e  chd_before~e  depr_befor~e  solid_ca_a~e  ccp_test_d~e  rheum~e_date  hydroxychl~e  ~m_last_date
ra_code_date  dm_before_~e  osteop_bef~e  haem_ca_af~e  bmi_date      ~erheum_date  lef_last_d~e  rtt_cl_sta~e
psa_code_d~e  ild_before~e  dem_before~e  ckd_after_~e  r~_appt_date  l~ecode_date  mtx_oral_l~e  rtt_cl_ref~e
anksp_code~e  copd_befor~e  chd_after_~e  depr_after~e  rheum~f_date  ~frheum_date  mtx_inj_la~e  rtt_cl_end~e
undiff_cod~e  cva_before~e  dm_after_d~e  osteop_aft~e  rheum~y_date  l~fcode_date  ssz_last_d~e  rtt_op_sta~e
rf_code_date  lung_ca_be~e  ild_after_~e  frac_after~e  rheum~2_date  leflunomid~e  hcq_last_d~e  rtt_op_ref~e
ccp_code_d~e  solid_ca_b~e  copd_after~e  dem_after_~e  rheum~3_date  metho~l_date  steroid_fi~e  rtt_op_end~e
seropositi~e  haem_ca_be~e  cva_after_~e  creatinin~te  rheum~4_date  metho~j_date  steroid_la~e
erosive_ra~e  ckd_before~e  lung_ca_af~e  rf_test_date  r~eappt_date  sulfasalaz~e  steroid_12..

. local string_dates `r(varlist)'

. foreach var of local string_dates {
  2.     gen `var'_num = date(`var', "YMD")
  3.     format `var'_num %td
  4.     order `var'_num, after(`var')
  5.     drop `var'
  6.     rename `var'_num `var'
  7. }
(229 missing values generated)
(1,207 missing values generated)
(1,217 missing values generated)
(1,296 missing values generated)
(1,320 missing values generated)
(1,319 missing values generated)
(1,200 missing values generated)
(1,311 missing values generated)
(1,154 missing values generated)
(1,253 missing values generated)
(1,188 missing values generated)
(1,301 missing values generated)
(1,178 missing values generated)
(1,140 missing values generated)
(245 missing values generated)
(896 missing values generated)
(1,133 missing values generated)
(1,274 missing values generated)
(1,313 missing values generated)
(1,164 missing values generated)
(1,114 missing values generated)
(1,244 missing values generated)
(1,185 missing values generated)
(1,293 missing values generated)
(1,153 missing values generated)
(1,096 missing values generated)
(160 missing values generated)
(866 missing values generated)
(1,081 missing values generated)
(1,254 missing values generated)
(1,300 missing values generated)
(1,327 missing values generated)
(1,129 missing values generated)
(1,324 missing values generated)
(1,307 missing values generated)
(1,324 missing values generated)
(1,330 missing values generated)
(883 missing values generated)
(883 missing values generated)
(519 missing values generated)
(627 missing values generated)
(433 missing values generated)
(269 missing values generated)
(1,327 missing values generated)
(1,317 missing values generated)
(1,068 missing values generated)
(536 missing values generated)
(1,330 missing values generated)
(1,326 missing values generated)
(932 missing values generated)
(547 missing values generated)
(394 missing values generated)
(834 missing values generated)
(682 missing values generated)
(932 missing values generated)
(547 missing values generated)
(394 missing values generated)
(834 missing values generated)
(682 missing values generated)
(484 missing values generated)
(484 missing values generated)
(609 missing values generated)
(609 missing values generated)
(200 missing values generated)
(200 missing values generated)
(200 missing values generated)
(186 missing values generated)
(186 missing values generated)
(186 missing values generated)

. 
. ***Variables ending in _date that are numeric
. foreach var of varlist *_date {
  2.     capture confirm string variable `var'
  3.     if _rc != 0 {
  4.         format `var' %td
  5.     }
  6. }

. 
. ***Create binary indicator for each
. ds *_date
eia_code_d~e  chd_before~e  depr_befor~e  lung_ca_af~e  rf_test_date  r~eappt_date  sulfasalaz~e  steroid_12..
ra_code_date  dm_before_~e  osteop_bef~e  solid_ca_a~e  ccp_test_d~e  rheum~e_date  hydroxychl~e  ~m_last_date
psa_code_d~e  ild_before~e  frac_befor~e  haem_ca_af~e  bmi_date      ~erheum_date  lef_last_d~e  rtt_cl_sta~e
anksp_code~e  copd_befor~e  dem_before~e  ckd_after_~e  r~_appt_date  l~ecode_date  mtx_oral_l~e  rtt_cl_ref~e
undiff_cod~e  cva_before~e  chd_after_~e  depr_after~e  rheum~f_date  ~frheum_date  mtx_inj_la~e  rtt_cl_end~e
rf_code_date  lung_ca_be~e  dm_after_d~e  osteop_aft~e  rheum~y_date  l~fcode_date  ssz_last_d~e  rtt_op_sta~e
ccp_code_d~e  solid_ca_b~e  ild_after_~e  frac_after~e  rheum~2_date  leflunomid~e  hcq_last_d~e  rtt_op_ref~e
seropositi~e  haem_ca_be~e  copd_after~e  dem_after_~e  rheum~3_date  metho~l_date  steroid_fi~e  rtt_op_end~e
erosive_ra~e  ckd_before~e  cva_after_~e  creatinin~te  rheum~4_date  metho~j_date  steroid_la~e

. local dates `r(varlist)'

. foreach var of local dates {
  2.         local newvar =  substr("`var'", 1, length("`var'") - 5)
  3.         gen `newvar' = (`var'!=. )
  4.         order `newvar', after(`var')
  5.         lab define `newvar' 0 "No" 1 "Yes"
  6.         lab val `newvar' `newvar'
  7.         tab `newvar', missing
  8. }

   eia_code |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |      1,331      100.00      100.00
------------+-----------------------------------
      Total |      1,331      100.00

    ra_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        229       17.21       17.21
        Yes |      1,102       82.79      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   psa_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,207       90.68       90.68
        Yes |        124        9.32      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 anksp_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,217       91.44       91.44
        Yes |        114        8.56      100.00
------------+-----------------------------------
      Total |      1,331      100.00

undiff_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,296       97.37       97.37
        Yes |         35        2.63      100.00
------------+-----------------------------------
      Total |      1,331      100.00

    rf_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,320       99.17       99.17
        Yes |         11        0.83      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   ccp_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,319       99.10       99.10
        Yes |         12        0.90      100.00
------------+-----------------------------------
      Total |      1,331      100.00

seropositiv |
     e_code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,200       90.16       90.16
        Yes |        131        9.84      100.00
------------+-----------------------------------
      Total |      1,331      100.00

erosive_ra_ |
       code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,311       98.50       98.50
        Yes |         20        1.50      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 chd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,154       86.70       86.70
        Yes |        177       13.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  dm_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,253       94.14       94.14
        Yes |         78        5.86      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 ild_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,188       89.26       89.26
        Yes |        143       10.74      100.00
------------+-----------------------------------
      Total |      1,331      100.00

copd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,301       97.75       97.75
        Yes |         30        2.25      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 cva_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,178       88.50       88.50
        Yes |        153       11.50      100.00
------------+-----------------------------------
      Total |      1,331      100.00

lung_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,140       85.65       85.65
        Yes |        191       14.35      100.00
------------+-----------------------------------
      Total |      1,331      100.00

solid_ca_be |
       fore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        245       18.41       18.41
        Yes |      1,086       81.59      100.00
------------+-----------------------------------
      Total |      1,331      100.00

haem_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        896       67.32       67.32
        Yes |        435       32.68      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 ckd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,133       85.12       85.12
        Yes |        198       14.88      100.00
------------+-----------------------------------
      Total |      1,331      100.00

depr_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,274       95.72       95.72
        Yes |         57        4.28      100.00
------------+-----------------------------------
      Total |      1,331      100.00

osteop_befo |
         re |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,313       98.65       98.65
        Yes |         18        1.35      100.00
------------+-----------------------------------
      Total |      1,331      100.00

frac_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,331      100.00      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 dem_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,164       87.45       87.45
        Yes |        167       12.55      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  chd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,114       83.70       83.70
        Yes |        217       16.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   dm_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,244       93.46       93.46
        Yes |         87        6.54      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  ild_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,185       89.03       89.03
        Yes |        146       10.97      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 copd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,293       97.15       97.15
        Yes |         38        2.85      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  cva_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,153       86.63       86.63
        Yes |        178       13.37      100.00
------------+-----------------------------------
      Total |      1,331      100.00

lung_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,096       82.34       82.34
        Yes |        235       17.66      100.00
------------+-----------------------------------
      Total |      1,331      100.00

solid_ca_af |
        ter |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        160       12.02       12.02
        Yes |      1,171       87.98      100.00
------------+-----------------------------------
      Total |      1,331      100.00

haem_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        866       65.06       65.06
        Yes |        465       34.94      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  ckd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,081       81.22       81.22
        Yes |        250       18.78      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 depr_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,254       94.21       94.21
        Yes |         77        5.79      100.00
------------+-----------------------------------
      Total |      1,331      100.00

osteop_afte |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,300       97.67       97.67
        Yes |         31        2.33      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 frac_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,327       99.70       99.70
        Yes |          4        0.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  dem_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,129       84.82       84.82
        Yes |        202       15.18      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 creatinine |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,324       99.47       99.47
        Yes |          7        0.53      100.00
------------+-----------------------------------
      Total |      1,331      100.00

    rf_test |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,307       98.20       98.20
        Yes |         24        1.80      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   ccp_test |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,324       99.47       99.47
        Yes |          7        0.53      100.00
------------+-----------------------------------
      Total |      1,331      100.00

        bmi |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,330       99.92       99.92
        Yes |          1        0.08      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 rheum_appt |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        883       66.34       66.34
        Yes |        448       33.66      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_appt_ |
        ref |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        883       66.34       66.34
        Yes |        448       33.66      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_appt_ |
        any |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        519       38.99       38.99
        Yes |        812       61.01      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_appt2 |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        627       47.11       47.11
        Yes |        704       52.89      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_appt3 |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        433       32.53       32.53
        Yes |        898       67.47      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_appt4 |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        269       20.21       20.21
        Yes |      1,062       79.79      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_ref_g |
  p_preappt |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,327       99.70       99.70
        Yes |          4        0.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rheum_ref_g |
  p_precode |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,317       98.95       98.95
        Yes |         14        1.05      100.00
------------+-----------------------------------
      Total |      1,331      100.00

last_gp_pre |
      rheum |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,068       80.24       80.24
        Yes |        263       19.76      100.00
------------+-----------------------------------
      Total |      1,331      100.00

last_gp_pre |
       code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        536       40.27       40.27
        Yes |        795       59.73      100.00
------------+-----------------------------------
      Total |      1,331      100.00

last_gp_ref |
      rheum |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,330       99.92       99.92
        Yes |          1        0.08      100.00
------------+-----------------------------------
      Total |      1,331      100.00

last_gp_ref |
       code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,326       99.62       99.62
        Yes |          5        0.38      100.00
------------+-----------------------------------
      Total |      1,331      100.00

leflunomide |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        932       70.02       70.02
        Yes |        399       29.98      100.00
------------+-----------------------------------
      Total |      1,331      100.00

methotrexat |
     e_oral |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        547       41.10       41.10
        Yes |        784       58.90      100.00
------------+-----------------------------------
      Total |      1,331      100.00

methotrexat |
      e_inj |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        394       29.60       29.60
        Yes |        937       70.40      100.00
------------+-----------------------------------
      Total |      1,331      100.00

sulfasalazi |
         ne |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        834       62.66       62.66
        Yes |        497       37.34      100.00
------------+-----------------------------------
      Total |      1,331      100.00

hydroxychlo |
    roquine |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        682       51.24       51.24
        Yes |        649       48.76      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   lef_last |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        932       70.02       70.02
        Yes |        399       29.98      100.00
------------+-----------------------------------
      Total |      1,331      100.00

mtx_oral_la |
         st |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        547       41.10       41.10
        Yes |        784       58.90      100.00
------------+-----------------------------------
      Total |      1,331      100.00

mtx_inj_las |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        394       29.60       29.60
        Yes |        937       70.40      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   ssz_last |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        834       62.66       62.66
        Yes |        497       37.34      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   hcq_last |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        682       51.24       51.24
        Yes |        649       48.76      100.00
------------+-----------------------------------
      Total |      1,331      100.00

steroid_fir |
         st |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        484       36.36       36.36
        Yes |        847       63.64      100.00
------------+-----------------------------------
      Total |      1,331      100.00

steroid_las |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        484       36.36       36.36
        Yes |        847       63.64      100.00
------------+-----------------------------------
      Total |      1,331      100.00

steroid_12m |
     _first |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        609       45.76       45.76
        Yes |        722       54.24      100.00
------------+-----------------------------------
      Total |      1,331      100.00

steroid_12m |
      _last |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        609       45.76       45.76
        Yes |        722       54.24      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rtt_cl_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        200       15.03       15.03
        Yes |      1,131       84.97      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 rtt_cl_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        200       15.03       15.03
        Yes |      1,131       84.97      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 rtt_cl_end |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        200       15.03       15.03
        Yes |      1,131       84.97      100.00
------------+-----------------------------------
      Total |      1,331      100.00

rtt_op_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        186       13.97       13.97
        Yes |      1,145       86.03      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 rtt_op_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        186       13.97       13.97
        Yes |      1,145       86.03      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 rtt_op_end |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        186       13.97       13.97
        Yes |      1,145       86.03      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. 
. /*
> **Will also need to amend conversion for biologic dates ====================================================*
> ***Some dates are given with month/year only, so adding day 15 to enable them to be processed as dates
> ***Would do this by labelling as _date_hcd then doing similar to above/below, but adding 15 days first
> 
> foreach var of varlist   abatacept_date                                         ///
>                                                  adalimumab_date                                        ///     
>                                                  baricitinib_date                                       ///
>                                                  certolizumab_date                                      ///
>                                                  etanercept_date                                        ///
>                                                  golimumab_date                                         ///
>                                                  guselkumab_date                                        ///     
>                                                  infliximab_date                                        ///
>                                                  ixekizumab_date                                        ///
>                                                  methotrexate_hcd_date                          ///
>                                                  rituximab_date                                         ///
>                                                  sarilumab_date                                         ///
>                                                  secukinumab_date                                       ///     
>                                                  tocilizumab_date                                       ///
>                                                  tofacitinib_date                                       ///
>                                                  upadacitinib_date                                      ///
>                                                  ustekinumab_date                                       ///
>                                                  {
>                                                         
>                 capture confirm string variable `var'
>                 if _rc!=0 {
>                         assert `var'==.
>                         rename `var' `var'_date
>                 }
>         
>                 else {
>                                 replace `var' = `var' + "-15"
>                                 rename `var' `var'_dstr
>                                 replace `var'_dstr = " " if `var'_dstr == "-15"
>                                 gen `var'_date = date(`var'_dstr, "YMD") 
>                                 order `var'_date, after(`var'_dstr)
>                                 drop `var'_dstr
>                 }
>         
>         format `var'_date %td
> }
> */
.                                          
. **Create and label variables ===========================================================*/
. 
. ***Age variables
. *Create categorised age
. drop if age<18 & age !=.
(0 observations deleted)

. drop if age>109 & age !=.
(0 observations deleted)

. drop if age==.
(0 observations deleted)

. lab var age "Age at diagnosis"

. 
. recode age 18/39.9999 = 1 /// 
>            40/49.9999 = 2 ///
>                    50/59.9999 = 3 ///
>                60/69.9999 = 4 ///
>                    70/79.9999 = 5 ///
>                    80/max = 6, gen(agegroup) 
(1,331 differences between age and agegroup)

. 
. label define agegroup   1 "18-39" ///
>                                                 2 "40-49" ///
>                                                 3 "50-59" ///
>                                                 4 "60-69" ///
>                                                 5 "70-79" ///
>                                                 6 "80+"

.                                                 
. label values agegroup agegroup

. lab var agegroup "Age group"

. tab agegroup, missing

  Age group |      Freq.     Percent        Cum.
------------+-----------------------------------
      18-39 |        578       43.43       43.43
      40-49 |        203       15.25       58.68
      50-59 |        173       13.00       71.68
      60-69 |        132        9.92       81.59
      70-79 |         99        7.44       89.03
        80+ |        146       10.97      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. order agegroup, after(age)

. 
. ***Sex
. gen male = 1 if sex == "male"
(660 missing values generated)

. replace male = 0 if sex == "female"
(660 real changes made)

. lab var male "Male"

. lab define male 0 "No" 1 "Yes", modify

. lab val male male

. tab male, missing

       Male |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        660       49.59       49.59
        Yes |        671       50.41      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. order male, after(sex)

. 
. ***Ethnicity
. gen ethnicity_n = 1 if ethnicity == "White"
(1,209 missing values generated)

. replace ethnicity_n = 2 if ethnicity == "Asian or Asian British"
(78 real changes made)

. replace ethnicity_n = 3 if ethnicity == "Black or Black British"
(100 real changes made)

. replace ethnicity_n = 4 if ethnicity == "Mixed"
(44 real changes made)

. replace ethnicity_n = 5 if ethnicity == "Chinese or Other Ethnic Groups"
(147 real changes made)

. replace ethnicity_n = 6 if ethnicity == "Unknown"
(840 real changes made)

. 
. 
. label define ethnicity_n        1 "White"                                               ///
>                                                         2 "Asian or Asian British"              ///
>                                                         3 "Black or Black British"      ///
>                                                         4 "Mixed"                                               //
> /
>                                                         5 "Chinese or Other Ethnic Groups" ///
>                                                         6 "Not known", modify

.                                                         
. label values ethnicity_n ethnicity_n

. lab var ethnicity_n "Ethnicity"

. tab ethnicity_n, missing

                     Ethnicity |      Freq.     Percent        Cum.
-------------------------------+-----------------------------------
                         White |        122        9.17        9.17
        Asian or Asian British |         78        5.86       15.03
        Black or Black British |        100        7.51       22.54
                         Mixed |         44        3.31       25.85
Chinese or Other Ethnic Groups |        147       11.04       36.89
                     Not known |        840       63.11      100.00
-------------------------------+-----------------------------------
                         Total |      1,331      100.00

. drop ethnicity

. rename ethnicity_n ethnicity 

. 
. ***Practice regions
. encode region, gen(nuts_region)

. tab region, missing

                  region |      Freq.     Percent        Cum.
-------------------------+-----------------------------------
                    East |        158       11.87       11.87
           East Midlands |        139       10.44       22.31
                  London |        137       10.29       32.61
              North East |        130        9.77       42.37
              North West |        154       11.57       53.94
              South East |        157       11.80       65.74
              South West |        156       11.72       77.46
           West Midlands |        152       11.42       88.88
Yorkshire and The Humber |        148       11.12      100.00
-------------------------+-----------------------------------
                   Total |      1,331      100.00

. replace region="Not known" if region==""
(0 real changes made)

. gen region_nospace=region

. replace region_nospace="SouthWest" if region=="South West"
(156 real changes made)

. replace region_nospace="EastMidlands" if region=="East Midlands"
(139 real changes made)

. replace region_nospace="East" if region=="East"
(0 real changes made)

. replace region_nospace="London" if region=="London"
(0 real changes made)

. replace region_nospace="NorthEast" if region=="North East"
(130 real changes made)

. replace region_nospace="NorthWest" if region=="North West"
(154 real changes made)

. replace region_nospace="SouthEast" if region=="South East"
(157 real changes made)

. replace region_nospace="WestMidlands" if region=="West Midlands"
(152 real changes made)

. replace region_nospace="YorkshireandTheHumber" if region=="Yorkshire and The Humber"
(148 real changes made)

. 
. ***IMD
. gen imd = 1 if imd_quintile == "1 (most deprived)"
(1,095 missing values generated)

. replace imd = 2 if imd_quintile == "2"
(249 real changes made)

. replace imd = 3 if imd_quintile == "3"
(251 real changes made)

. replace imd = 4 if imd_quintile == "4"
(235 real changes made)

. replace imd = 5 if imd_quintile == "5 (least deprived)"
(258 real changes made)

. replace imd = .u if imd_quintile == "Unknown"
(102 real changes made, 102 to missing)

. lab var imd "Index of multiple deprivation"

. lab define imd 1 "1 (most deprived)" ///
>                            2 "2" ///
>                            3 "3" ///
>                            4 "4" ///
>                            5 "5 (least deprived)" ///
>                            .u "Not known"

. lab val imd imd                    

. tab imd, missing

 Index of multiple |
       deprivation |      Freq.     Percent        Cum.
-------------------+-----------------------------------
 1 (most deprived) |        236       17.73       17.73
                 2 |        249       18.71       36.44
                 3 |        251       18.86       55.30
                 4 |        235       17.66       72.95
5 (least deprived) |        258       19.38       92.34
         Not known |        102        7.66      100.00
-------------------+-----------------------------------
             Total |      1,331      100.00

. drop imd_quintile

. 
. ***Body Mass Index
. *Recode strange values 
. replace bmi_value = . if bmi_value == 0 
(0 real changes made)

. replace bmi_value = . if !inrange(bmi_value, 10, 80)
(0 real changes made)

. 
. *Restrict to within 10 years of EIA diagnosis date and aged>16 
. gen bmi_time = (eia_code_date - bmi_date)/365.25
(1,330 missing values generated)

. gen bmi_age = age - bmi_time
(1,330 missing values generated)

. replace bmi_value = . if bmi_age < 16 
(0 real changes made)

. replace bmi_value = . if bmi_time > 10 & bmi_time != . 
(0 real changes made)

. 
. *Set to missing if no date, and vice versa 
. replace bmi_value = . if bmi_date == . 
(0 real changes made)

. replace bmi_date = . if bmi_value == . 
(0 real changes made)

. replace bmi_time = . if bmi_value == . 
(0 real changes made)

. replace bmi_age = . if bmi_value == . 
(0 real changes made)

. 
. *Create BMI categories
. gen     bmicat = .
(1,331 missing values generated)

. recode  bmicat . = 1 if bmi_value < 18.5
(0 changes made to bmicat)

. recode  bmicat . = 2 if bmi_value < 25
(0 changes made to bmicat)

. recode  bmicat . = 3 if bmi_value < 30
(0 changes made to bmicat)

. recode  bmicat . = 4 if bmi_value < 35
(0 changes made to bmicat)

. recode  bmicat . = 5 if bmi_value < 40
(0 changes made to bmicat)

. recode  bmicat . = 6 if bmi_value < .
(1 changes made to bmicat)

. replace bmicat = .u if bmi_value >= .
(1,330 real changes made, 1,330 to missing)

. 
. label define bmicat 1 "Underweight (<18.5)"     ///
>                                         2 "Normal (18.5-24.9)"          ///
>                                         3 "Overweight (25-29.9)"        ///
>                                         4 "Obese I (30-34.9)"           ///
>                                         5 "Obese II (35-39.9)"          ///
>                                         6 "Obese III (40+)"                     ///
>                                         .u "Not known"

.                                         
. label values bmicat bmicat

. lab var bmicat "BMI"

. tab bmicat, missing

                 BMI |      Freq.     Percent        Cum.
---------------------+-----------------------------------
     Obese III (40+) |          1        0.08        0.08
           Not known |      1,330       99.92      100.00
---------------------+-----------------------------------
               Total |      1,331      100.00

. order bmicat, after (bmi_value)

. drop bmi_age bmi_time

. 
. *Create less granular categorisation
. recode bmicat 1/3 .u = 1 4 = 2 5 = 3 6 = 4, gen(obese4cat)
(1,331 differences between bmicat and obese4cat)

. 
. label define obese4cat  1 "No record of obesity"        ///
>                                                 2 "Obese I (30-34.9)"           ///
>                                                 3 "Obese II (35-39.9)"          ///
>                                                 4 "Obese III (40+)"             

. 
. label values obese4cat obese4cat

. order obese4cat, after(bmicat)

. lab var obese4cat "Obesity categories"

. 
. ***Smoking 
. label define smoke 1 "Never" 2 "Former" 3 "Current" .u "Not known"

. 
. gen     smoke = 1  if smoking_status == "N"
(1,315 missing values generated)

. replace smoke = 2  if smoking_status == "E"
(506 real changes made)

. replace smoke = 3  if smoking_status == "S"
(807 real changes made)

. replace smoke = .u if smoking_status == "M"
(2 real changes made, 2 to missing)

. replace smoke = .u if smoking_status == "" 
(0 real changes made)

. 
. label values smoke smoke

. lab var smoke "Smoking status"

. drop smoking_status

. tab smoke, missing

    Smoking |
     status |      Freq.     Percent        Cum.
------------+-----------------------------------
      Never |         16        1.20        1.20
     Former |        506       38.02       39.22
    Current |        807       60.63       99.85
  Not known |          2        0.15      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. 
. *Create non-missing 3-category variable for current smoking (assumes missing smoking is never smoking)
. recode smoke .u = 1, gen(smoke_nomiss)
(2 differences between smoke and smoke_nomiss)

. order smoke_nomiss, after(smoke)

. label values smoke_nomiss smoke

. 
. **Clinical comorbidities
. ***Nb. not using creatinine of HBA1c values for now, just codes
. foreach disease in ckd dm ild copd cva lung_ca solid_ca haem_ca depr osteop frac dem chd {
  2.         tab `disease'_before, missing
  3.         tab `disease'_after, missing
  4.         gen `disease'_new = 1 if (`disease'_after == 1 & `disease'_before == 0)
  5.         recode `disease'_new .=0
  6.         label define `disease'_new 0 "No" 1 "Yes"
  7.         label values `disease'_new `disease'_new
  8.         tab `disease'_new, missing
  9.         order `disease'_new, after(`disease'_after)
 10. }

 ckd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,133       85.12       85.12
        Yes |        198       14.88      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  ckd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,081       81.22       81.22
        Yes |        250       18.78      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,107 missing values generated)
(1,107 changes made to ckd_new)

    ckd_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,107       83.17       83.17
        Yes |        224       16.83      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  dm_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,253       94.14       94.14
        Yes |         78        5.86      100.00
------------+-----------------------------------
      Total |      1,331      100.00

   dm_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,244       93.46       93.46
        Yes |         87        6.54      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,245 missing values generated)
(1,245 changes made to dm_new)

     dm_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,245       93.54       93.54
        Yes |         86        6.46      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 ild_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,188       89.26       89.26
        Yes |        143       10.74      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  ild_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,185       89.03       89.03
        Yes |        146       10.97      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,198 missing values generated)
(1,198 changes made to ild_new)

    ild_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,198       90.01       90.01
        Yes |        133        9.99      100.00
------------+-----------------------------------
      Total |      1,331      100.00

copd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,301       97.75       97.75
        Yes |         30        2.25      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 copd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,293       97.15       97.15
        Yes |         38        2.85      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,293 missing values generated)
(1,293 changes made to copd_new)

   copd_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,293       97.15       97.15
        Yes |         38        2.85      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 cva_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,178       88.50       88.50
        Yes |        153       11.50      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  cva_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,153       86.63       86.63
        Yes |        178       13.37      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,170 missing values generated)
(1,170 changes made to cva_new)

    cva_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,170       87.90       87.90
        Yes |        161       12.10      100.00
------------+-----------------------------------
      Total |      1,331      100.00

lung_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,140       85.65       85.65
        Yes |        191       14.35      100.00
------------+-----------------------------------
      Total |      1,331      100.00

lung_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,096       82.34       82.34
        Yes |        235       17.66      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,126 missing values generated)
(1,126 changes made to lung_ca_new)

lung_ca_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,126       84.60       84.60
        Yes |        205       15.40      100.00
------------+-----------------------------------
      Total |      1,331      100.00

solid_ca_be |
       fore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        245       18.41       18.41
        Yes |      1,086       81.59      100.00
------------+-----------------------------------
      Total |      1,331      100.00

solid_ca_af |
        ter |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        160       12.02       12.02
        Yes |      1,171       87.98      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,111 missing values generated)
(1,111 changes made to solid_ca_new)

solid_ca_ne |
          w |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,111       83.47       83.47
        Yes |        220       16.53      100.00
------------+-----------------------------------
      Total |      1,331      100.00

haem_ca_bef |
        ore |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        896       67.32       67.32
        Yes |        435       32.68      100.00
------------+-----------------------------------
      Total |      1,331      100.00

haem_ca_aft |
         er |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        866       65.06       65.06
        Yes |        465       34.94      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,001 missing values generated)
(1,001 changes made to haem_ca_new)

haem_ca_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,001       75.21       75.21
        Yes |        330       24.79      100.00
------------+-----------------------------------
      Total |      1,331      100.00

depr_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,274       95.72       95.72
        Yes |         57        4.28      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 depr_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,254       94.21       94.21
        Yes |         77        5.79      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,255 missing values generated)
(1,255 changes made to depr_new)

   depr_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,255       94.29       94.29
        Yes |         76        5.71      100.00
------------+-----------------------------------
      Total |      1,331      100.00

osteop_befo |
         re |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,313       98.65       98.65
        Yes |         18        1.35      100.00
------------+-----------------------------------
      Total |      1,331      100.00

osteop_afte |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,300       97.67       97.67
        Yes |         31        2.33      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,302 missing values generated)
(1,302 changes made to osteop_new)

 osteop_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,302       97.82       97.82
        Yes |         29        2.18      100.00
------------+-----------------------------------
      Total |      1,331      100.00

frac_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,331      100.00      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 frac_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,327       99.70       99.70
        Yes |          4        0.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,327 missing values generated)
(1,327 changes made to frac_new)

   frac_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,327       99.70       99.70
        Yes |          4        0.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 dem_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,164       87.45       87.45
        Yes |        167       12.55      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  dem_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,129       84.82       84.82
        Yes |        202       15.18      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,149 missing values generated)
(1,149 changes made to dem_new)

    dem_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,149       86.33       86.33
        Yes |        182       13.67      100.00
------------+-----------------------------------
      Total |      1,331      100.00

 chd_before |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,154       86.70       86.70
        Yes |        177       13.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00

  chd_after |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,114       83.70       83.70
        Yes |        217       16.30      100.00
------------+-----------------------------------
      Total |      1,331      100.00
(1,133 missing values generated)
(1,133 changes made to chd_new)

    chd_new |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,133       85.12       85.12
        Yes |        198       14.88      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. 
. *Label remaining variables 
. lab var ckd_before "Chronic kidney disease"

. lab var ckd_after "Chronic kidney disease"

. lab var ckd_new "Chronic kidney disease"

. lab var dm_before "Type 2 diabetes mellitus"

. lab var dm_after "Type 2 diabetes mellitus"

. lab var dm_new "Type 2 diabetes mellitus"

. lab var ild_before "Interstitial lung disease"

. lab var ild_after "Interstitial lung disease"

. lab var ild_new "Interstitial lung disease"

. lab var copd_before "COPD"

. lab var copd_after "COPD"

. lab var copd_new "COPD"

. lab var lung_ca_before "Lung cancer"

. lab var lung_ca_after "Lung cancer"

. lab var lung_ca_new "Lung cancer"

. lab var solid_ca_before "Solid organ cancer"

. lab var solid_ca_after "Solid organ cancer"

. lab var solid_ca_new "Solid organ cancer"

. lab var haem_ca_before "Haematological cancer"

. lab var haem_ca_after "Haematological cancer"

. lab var haem_ca_new "Haematological cancer"

. lab var depr_before "Depression"

. lab var depr_after "Depression"

. lab var depr_new "Depression"

. lab var osteop_before "Osteoporosis"

. lab var osteop_after "Osteoporosis"

. lab var osteop_new "Osteoporosis"

. lab var frac_before "Fragility fracture"

. lab var frac_after "Fragility fracture"

. lab var frac_new "Fragility fracture"

. lab var dem_before "Dementia"

. lab var dem_after "Dementia"

. lab var dem_new "Dementia"

. lab var chd_before "Coronary heart disease"

. lab var chd_after "Coronary heart disease"

. lab var chd_new "Coronary heart disease"

. 
. lab var rheum_appt "First rheumatology appointment within 12 months"

. lab var rheum_appt_any "Any rheumatology appointment within 12 months"

. lab var rheum_appt2 "Any rheumatology appointment within 6 months"

. lab var rheum_appt3 "Any rheumatology appointment within 24 months"

. 
. lab var eia_code "Inflammatory arthritis"

. lab var ra_code "Rheumatoid arthritis"

. lab var psa_code "Psoriatic arthritis"

. lab var anksp_code "Axial spondyloarthritis"

. lab var undiff_code "Undifferentiated inflammatory arthritis"

. 
. **RF and CCP positivity (blood test and/or diagnostic code)
. codebook rf_code

--------------------------------------------------------------------------------------------------------------------
rf_code                                                                                                  (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric (float)
                 Label: rf_code

                 Range: [0,1]                         Units: 1
         Unique values: 2                         Missing .: 0/1,331

            Tabulation: Freq.   Numeric  Label
                        1,320         0  No
                           11         1  Yes

. codebook rf_test_value

--------------------------------------------------------------------------------------------------------------------
rf_test_value                                                                                            (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric (float)

                 Range: [.49810165,98.594498]         Units: 1.000e-08
         Unique values: 24                        Missing .: 1,307/1,331

                  Mean:  47.343
             Std. dev.: 31.6022

           Percentiles:     10%       25%       50%       75%       90%
                        10.0294   19.5745   42.3669    78.607   86.8916

. tabstat rf_test_value, stats (n mean p50 p25 p75) //recode on the basis of values

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
rf_test_va~e |        24  47.34299  42.36688  19.57446  78.60697
----------------------------------------------------------------

. gen rf_pos_ra = 1 if (rf_test_value>=20 & rf_test_value!=.) | rf_code==1 //check ranges
(1,304 missing values generated)

. recode rf_pos_ra .=0 //Nb. 0 will also include those where test not done (or not coded for)
(1,304 changes made to rf_pos_ra)

. lab define rf_pos_ra 0 "RF negative/not known" 1 "RF positive"

. lab val rf_pos_ra rf_pos_ra

. lab var rf_pos_ra "Rheumatoid factor positivity"

. tab rf_pos_ra if ra_code==1, missing

    Rheumatoid factor |
           positivity |      Freq.     Percent        Cum.
----------------------+-----------------------------------
RF negative/not known |      1,079       97.91       97.91
          RF positive |         23        2.09      100.00
----------------------+-----------------------------------
                Total |      1,102      100.00

. 
. codebook ccp_code

--------------------------------------------------------------------------------------------------------------------
ccp_code                                                                                                 (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric (float)
                 Label: ccp_code

                 Range: [0,1]                         Units: 1
         Unique values: 2                         Missing .: 0/1,331

            Tabulation: Freq.   Numeric  Label
                        1,319         0  No
                           12         1  Yes

. codebook ccp_test_value

--------------------------------------------------------------------------------------------------------------------
ccp_test_value                                                                                           (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric (float)

                 Range: [6.6003747,92.127792]         Units: 1.000e-07
         Unique values: 7                         Missing .: 1,324/1,331

            Tabulation: Freq.  Value
                            1  6.6003747
                            1  31.05724
                            1  31.643269
                            1  42.460194
                            1  69.956726
                            1  87.927719
                            1  92.127792
                        1,324  .

. tabstat ccp_test_value, stats (n mean p50 p25 p75) //recode on the basis of values

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
ccp_test_v~e |         7   51.6819  42.46019  31.05724  87.92772
----------------------------------------------------------------

. gen ccp_pos_ra = 1 if (ccp_test_value>=10 & ccp_test_value!=.) | ccp_code==1 //check ranges
(1,313 missing values generated)

. recode ccp_pos_ra .=0 //Nb. 0 will also include those where test not done (or not coded for)
(1,313 changes made to ccp_pos_ra)

. lab define ccp_pos_ra 0 "CCP negative/not known" 1 "CCP positive"

. lab val ccp_pos_ra ccp_pos_ra

. lab var ccp_pos_ra "CCP positivity"

. tab ccp_pos_ra if ra_code==1, missing

        CCP positivity |      Freq.     Percent        Cum.
-----------------------+-----------------------------------
CCP negative/not known |      1,087       98.64       98.64
          CCP positive |         15        1.36      100.00
-----------------------+-----------------------------------
                 Total |      1,102      100.00

. 
. **Seropositive RA (RF and/or CCP positive and/or seropositive diagnostic code)
. gen seropos_ra = 1 if rf_pos_ra==1 | ccp_pos_ra==1 | seropositive_code==1 //check ranges
(1,182 missing values generated)

. recode seropos_ra .=0 //Nb. 0 will also include those where test not done (or not coded for)
(1,182 changes made to seropos_ra)

. lab define seropos_ra 0 "Seronegative/not known" 1 "Seropositive"

. lab val seropos_ra seropos_ra

. lab var seropos_ra "Seropositivity"

. tab seropos_ra if ra_code==1, missing

        Seropositivity |      Freq.     Percent        Cum.
-----------------------+-----------------------------------
Seronegative/not known |        962       87.30       87.30
          Seropositive |        140       12.70      100.00
-----------------------+-----------------------------------
                 Total |      1,102      100.00

. 
. **Erosive codes
. lab var erosive_ra_code "Erosive rheumatoid arthritis"

. tab erosive_ra_code if ra_code==1 //Nb. 0 will also include those where test not done (or not coded for)

    Erosive |
 rheumatoid |
  arthritis |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,084       98.37       98.37
        Yes |         18        1.63      100.00
------------+-----------------------------------
      Total |      1,102      100.00

. 
. **All patients should have diagnostic code=============================================================*/
. tab eia_code, missing

Inflammator |
y arthritis |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |      1,331      100.00      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. keep if eia_code==1
(0 observations deleted)

. 
. **Check first rheum appt date was before diagnostic code date==================================*/
. 
. **Rheumatology appt definitions 
. tab rheum_appt, missing //proportion of patients with an rheum outpatient date (with first attendance option selec
> ted) in the 12 months before and 60 days after EIA code appeared in GP record; data only April 2019 onwards

      First |
rheumatolog |
          y |
appointment |
  within 12 |
     months |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        883       66.34       66.34
        Yes |        448       33.66      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. tab rheum_appt if rheum_appt_date>eia_code_date & rheum_appt_date!=. //confirm proportion who had first rheum appt
>  (i.e. not missing) after EIA code

      First |
rheumatolog |
          y |
appointment |
  within 12 |
     months |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |         64      100.00      100.00
------------+-----------------------------------
      Total |         64      100.00

. tab rheum_appt if rheum_appt_date>(eia_code_date + 30) & rheum_appt_date!=. //confirm proportion who had first rhe
> um appt 30 days after EIA code 

      First |
rheumatolog |
          y |
appointment |
  within 12 |
     months |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |         33      100.00      100.00
------------+-----------------------------------
      Total |         33      100.00

. tab rheum_appt if rheum_appt_date>(eia_code_date + 60) & rheum_appt_date!=. //confirm proportion who had first rhe
> um appt 60 days after EIA code - should be none
no observations

. replace rheum_appt=0 if rheum_appt_date>(eia_code_date + 60) & rheum_appt_date!=. //replace as missing if first ap
> pt >60 days after EIA code - should be none
(0 real changes made)

. replace rheum_appt_date=. if rheum_appt_date>(eia_code_date + 60) & rheum_appt_date!=. //replace as missing if fir
> st appt >60 days after EIA code - should be none
(0 real changes made)

. 
. tab rheum_appt_any, missing //proportion of patients with a rheum outpatient date (without first attendance option
>  selected) in the 12 months before and 60 days after EIA code appeared in GP record; data only April 2019 onwards

        Any |
rheumatolog |
          y |
appointment |
  within 12 |
     months |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        519       38.99       38.99
        Yes |        812       61.01      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. tab rheum_appt_any if rheum_appt_any_date>eia_code_date & rheum_appt_any_date!=. //confirm proportion who had firs
> t rheum appt (i.e. not missing) after EIA code

        Any |
rheumatolog |
          y |
appointment |
  within 12 |
     months |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |         74      100.00      100.00
------------+-----------------------------------
      Total |         74      100.00

. tab rheum_appt_any if rheum_appt_any_date>(eia_code_date + 60) & rheum_appt_any_date!=. //confirm proportion who h
> ad first rheum appt 60 days after EIA code - should be none
no observations

. replace rheum_appt_any=0 if rheum_appt_any_date>(eia_code_date + 60) & rheum_appt_any_date!=. //replace as missing
>  those appts >60 days after EIA code
(0 real changes made)

. replace rheum_appt_any_date=. if rheum_appt_any_date>(eia_code_date + 60) & rheum_appt_any_date!=. //replace as mi
> ssing those appts >60 days after EIA code
(0 real changes made)

. 
. tab rheum_appt2, missing //proportion of patients with a rheum outpatient date (without first attendance option se
> lected) in the 6 months before and 60 days after  EIA code appeared in GP record; data only April 2019 onwards

        Any |
rheumatolog |
          y |
appointment |
   within 6 |
     months |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        627       47.11       47.11
        Yes |        704       52.89      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. tab rheum_appt2 if rheum_appt2_date>eia_code_date & rheum_appt2_date!=. //confirm proportion who had first rheum a
> ppt (i.e. not missing) after EIA code

        Any |
rheumatolog |
          y |
appointment |
   within 6 |
     months |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |        122      100.00      100.00
------------+-----------------------------------
      Total |        122      100.00

. tab rheum_appt2 if rheum_appt2_date>(eia_code_date + 60) & rheum_appt2_date!=. //confirm proportion who had first 
> rheum appt 60 days after EIA code - should be none
no observations

. replace rheum_appt2=0 if rheum_appt2_date>(eia_code_date + 60) & rheum_appt2_date!=. //replace as missing those ap
> pts >60 days after EIA code
(0 real changes made)

. replace rheum_appt2_date=. if rheum_appt2_date>(eia_code_date + 60) & rheum_appt2_date!=. //replace as missing tho
> se appts >60 days after EIA code
(0 real changes made)

. 
. tab rheum_appt3, missing //proportion of patients with a rheum outpatient date (without first attendance option se
> lected) in the 2 years before and 60 days after EIA code appeared in GP record; data only April 2019 onwards

        Any |
rheumatolog |
          y |
appointment |
  within 24 |
     months |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        433       32.53       32.53
        Yes |        898       67.47      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. tab rheum_appt3 if rheum_appt3_date>eia_code_date & rheum_appt3_date!=. //confirm proportion who had first rheum a
> ppt (i.e. not missing) after EIA code

        Any |
rheumatolog |
          y |
appointment |
  within 24 |
     months |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |         49      100.00      100.00
------------+-----------------------------------
      Total |         49      100.00

. tab rheum_appt3 if rheum_appt3_date>(eia_code_date + 60) & rheum_appt3_date!=. //confirm proportion who had first 
> rheum appt 60 days after EIA code - should be none
no observations

. replace rheum_appt3=0 if rheum_appt3_date>(eia_code_date + 60) & rheum_appt3_date!=. //replace as missing those ap
> pts >60 days after EIA code
(0 real changes made)

. replace rheum_appt3_date=. if rheum_appt3_date>(eia_code_date + 60) & rheum_appt3_date!=. //replace as missing tho
> se appts >60 days after EIA code
(0 real changes made)

. 
. **THIS IS AN IMPORTANT ONE TO CHECK (for delayed rheumatology appointments)
. tab rheum_appt4, missing //proportion of patients with a rheum outpatient date (without first attendance option se
> lected) in the 2 years before and 1 year after EIA code appeared in GP record; data only April 2019 onwards

rheum_appt4 |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        269       20.21       20.21
        Yes |      1,062       79.79      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. tab rheum_appt4 if rheum_appt4_date>eia_code_date & rheum_appt4_date!=. //confirm proportion who had first rheum a
> ppt (i.e. not missing) after EIA code

rheum_appt4 |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |        213      100.00      100.00
------------+-----------------------------------
      Total |        213      100.00

. tab rheum_appt4 if rheum_appt4_date>(eia_code_date + 60) & rheum_appt4_date!=. //confirm proportion who had first 
> rheum appt 60 days after EIA code

rheum_appt4 |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |        164      100.00      100.00
------------+-----------------------------------
      Total |        164      100.00

. replace rheum_appt4=0 if rheum_appt4_date>(eia_code_date + 60) & rheum_appt4_date!=. //replace as missing those ap
> pts >60 days after EIA code
(164 real changes made)

. replace rheum_appt4_date=. if rheum_appt4_date>(eia_code_date + 60) & rheum_appt4_date!=. //replace as missing tho
> se appts >60 days after EIA code
(164 real changes made, 164 to missing)

. 
. *Check if first csDMARD/biologic was after rheum appt date=====================================================*/
. **csDMARDs (not including high cost MTX; wouldn't be shared care)
. gen csdmard=1 if hydroxychloroquine==1 | leflunomide==1 | methotrexate_oral==1 | methotrexate_inj==1 | sulfasalazi
> ne==1
(156 missing values generated)

. recode csdmard .=0 
(156 changes made to csdmard)

. tab csdmard, missing

    csdmard |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        156       11.72       11.72
          1 |      1,175       88.28      100.00
------------+-----------------------------------
      Total |      1,331      100.00

. 
. **Date of first csDMARD script (not including high cost MTX prescriptions)
. gen csdmard_date=min(hydroxychloroquine_date, leflunomide_date, methotrexate_oral_date, methotrexate_inj_date, sul
> fasalazine_date)
(156 missing values generated)

. format %td csdmard_date

. 
. **Generate combined methotrexate (primary care only)
. gen mtx = 1 if methotrexate_oral==1 | methotrexate_inj==1
(241 missing values generated)

. recode mtx .=0
(241 changes made to mtx)

. lab var mtx "Methotrexate"

. gen mtx_date = min(methotrexate_oral_date, methotrexate_inj_date) if mtx == 1
(241 missing values generated)

. format %td mtx_date

. 
. **Exclude if first csdmard was more than 60 days before first rheum appt
. tab csdmard if rheum_appt_date!=. & csdmard_date!=. & csdmard_date<rheum_appt_date

    csdmard |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        315      100.00      100.00
------------+-----------------------------------
      Total |        315      100.00

. tab csdmard if rheum_appt_date!=. & csdmard_date!=. & (csdmard_date + 60)<rheum_appt_date

    csdmard |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        299      100.00      100.00
------------+-----------------------------------
      Total |        299      100.00

.  
. gen pre_ra_csdmard_time = (rheum_appt_date - csdmard_date) if rheum_appt_date!=. & csdmard_date!=. & csdmard_date<
> rheum_appt_date
(1,016 missing values generated)

. tabstat pre_ra_csdmard_time, stats (n mean p50 p25 p75) // how long before were csdmards prescribed

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
pre_ra_csd~e |       315  637.0349       522       266       915
----------------------------------------------------------------

. 
. tab mtx if rheum_appt_date!=. & mtx_date!=. & (mtx_date + 60)<rheum_appt_date 

Methotrexat |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        238      100.00      100.00
------------+-----------------------------------
      Total |        238      100.00

. tab hydroxychloroquine if rheum_appt_date!=. & hydroxychloroquine_date!=. & (hydroxychloroquine_date + 60)<rheum_a
> ppt_date 

hydroxychlo |
    roquine |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |        108      100.00      100.00
------------+-----------------------------------
      Total |        108      100.00

. tab sulfasalazine if rheum_appt_date!=. & sulfasalazine_date!=. & (sulfasalazine_date + 60)<rheum_appt_date 

sulfasalazi |
         ne |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |         75      100.00      100.00
------------+-----------------------------------
      Total |         75      100.00

. tab leflunomide if rheum_appt_date!=. & leflunomide_date!=. & (leflunomide_date + 60)<rheum_appt_date 

leflunomide |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |         57      100.00      100.00
------------+-----------------------------------
      Total |         57      100.00

. 
. drop if rheum_appt_date!=. & csdmard_date!=. & (csdmard_date + 60)<rheum_appt_date //drop if first csDMARD more th
> an 60 days before first attendance at a rheum appt 
(299 observations deleted)

. 
. tab csdmard if rheum_appt_date==. & rheum_appt_any_date!=. & csdmard_date!=. & (csdmard_date + 60)<rheum_appt_any_
> date

    csdmard |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        225      100.00      100.00
------------+-----------------------------------
      Total |        225      100.00

. drop if rheum_appt_date==. & rheum_appt_any_date!=. & csdmard_date!=. & (csdmard_date + 60)<rheum_appt_any_date //
> drop if first csDMARD more than 60 days before first captured rheum appt that did not have first attendance tag
(225 observations deleted)

. 
. /*
> **csDMARDs (including high cost MTX)
> gen csdmard_hcd=1 if hydroxychloroquine==1 | leflunomide==1 | methotrexate==1 | methotrexate_hcd==1 | sulfasalazin
> e==1
> recode csdmard_hcd .=0 
> tab csdmard_hcd, missing
> 
> **Date of first csDMARD script (including high cost MTX prescriptions)
> gen csdmard_hcd_date=min(hydroxychloroquine_date, leflunomide_date, methotrexate_date, methotrexate_hcd_date, sulf
> asalazine_date)
> format %td csdmard_hcd_date
> 
> **Biologic use
> gen biologic=1 if abatacept==1 | adalimumab==1 | baricitinib==1 | certolizumab==1 | etanercept==1 | golimumab==1 |
>  guselkumab==1 | infliximab==1 | ixekizumab==1 | rituximab==1 | sarilumab==1 | secukinumab==1 | tocilizumab==1 | t
> ofacitinib==1 | upadacitinib==1 | ustekinumab==1 
> recode biologic .=0
> tab biologic, missing
> 
> **Date of first biologic script
> gen biologic_date=min(abatacept_date, adalimumab_date, baricitinib_date, certolizumab_date, etanercept_date, golim
> umab_date, guselkumab_date, infliximab_date, ixekizumab_date, rituximab_date, sarilumab_date, secukinumab_date, to
> cilizumab_date, tofacitinib_date, upadacitinib_date, ustekinumab_date)
> format %td biologic_date
> 
> tab biologic if rheum_appt_date!=. & biologic_date!=. & biologic_date<rheum_appt_date 
> tab biologic if rheum_appt_date!=. & biologic_date!=. & (biologic_date + 60)<rheum_appt_date 
> drop if rheum_appt_date!=. & biologic_date!=. & (biologic_date + 60)<rheum_appt_date //drop if first biologic more
>  than 60 days before first rheum_appt_date
> tab biologic if rheum_appt_date==. & rheum_appt_any_date!=. & biologic_date!=. & (biologic_date + 60)<rheum_appt_a
> ny_date
> drop if rheum_appt_date==. & rheum_appt_any_date!=. & biologic_date!=. & (biologic_date + 60)<rheum_appt_any_date 
> //drop if first biologic more than 60 days before first captured rheum appt that did not have first attendance tag
> */
. 
. *Generate diagnosis date===============================================================*/
. 
. **Use diagnostic code date (in GP record) as diagnosis date
. gen diagnosis_date=eia_code_date

. format diagnosis_date %td

. 
. *Refine diagnostic window=============================================================*/
. 
. **Keep patients with diagnosis date after start date and before end date - should be none dropped
. keep if diagnosis_date>=date("$start_date", "DMY") & diagnosis_date!=. 
(0 observations deleted)

. tab eia_code, missing

Inflammator |
y arthritis |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |        807      100.00      100.00
------------+-----------------------------------
      Total |        807      100.00

. keep if diagnosis_date<=date("$end_date", "DMY") & diagnosis_date!=. 
(0 observations deleted)

. tab eia_code, missing

Inflammator |
y arthritis |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |        807      100.00      100.00
------------+-----------------------------------
      Total |        807      100.00

. 
. *Include only most recent EIA sub-diagnosis=============================================*/
. replace ra_code =0 if psa_code_date > ra_code_date & psa_code_date !=.
(11 real changes made)

. replace ra_code =0 if anksp_code_date > ra_code_date & anksp_code_date !=.
(9 real changes made)

. replace ra_code =0 if undiff_code_date > ra_code_date & undiff_code_date !=.
(1 real change made)

. replace psa_code =0 if ra_code_date >= psa_code_date & ra_code_date !=.
(10 real changes made)

. replace psa_code =0 if anksp_code_date > psa_code_date & anksp_code_date !=.
(0 real changes made)

. replace psa_code =0 if undiff_code_date > psa_code_date & undiff_code_date !=.
(1 real change made)

. replace anksp_code =0 if psa_code_date >= anksp_code_date & psa_code_date !=.
(0 real changes made)

. replace anksp_code =0 if ra_code_date >= anksp_code_date & ra_code_date !=.
(3 real changes made)

. replace anksp_code =0 if undiff_code_date > anksp_code_date & undiff_code_date !=.
(0 real changes made)

. replace undiff_code =0 if ra_code_date >= undiff_code_date & ra_code_date !=.
(2 real changes made)

. replace undiff_code =0 if psa_code_date >= undiff_code_date & psa_code_date !=.
(2 real changes made)

. replace undiff_code =0 if anksp_code_date >= undiff_code_date & anksp_code_date !=.
(0 real changes made)

. gen eia_diagnosis=1 if ra_code==1
(146 missing values generated)

. replace eia_diagnosis=2 if psa_code==1
(68 real changes made)

. replace eia_diagnosis=3 if anksp_code==1
(59 real changes made)

. replace eia_diagnosis=4 if undiff_code==1
(19 real changes made)

. lab define eia_diagnosis 1 "RA" 2 "PsA" 3 "AxSpA" 4 "Undiff IA", modify

. lab val eia_diagnosis eia_diagnosis

. tab eia_diagnosis, missing

eia_diagnos |
         is |      Freq.     Percent        Cum.
------------+-----------------------------------
         RA |        661       81.91       81.91
        PsA |         68        8.43       90.33
      AxSpA |         59        7.31       97.65
  Undiff IA |         19        2.35      100.00
------------+-----------------------------------
      Total |        807      100.00

. drop if eia_diagnosis==. //should be none
(0 observations deleted)

. 
. decode eia_diagnosis, gen(eia_diag)

. replace eia_diag="Undiff_IA" if eia_diagnosis==4
(19 real changes made)

. 
. *Disease phenotype (for RA)=========================================*/
. 
. 
. *Split into time windows=========================================*/
. 
. **Month/Year of GP diagnostic code
. gen year_diag=year(eia_code_date)

. format year_diag %ty

. gen month_diag=month(eia_code_date)

. gen mo_year_diagn=ym(year_diag, month_diag)

. format mo_year_diagn %tmMon-CCYY

. generate str16 mo_year_diagn_s = strofreal(mo_year_diagn,"%tmCCYY!mNN")

. lab var mo_year_diagn "Month/Year of Diagnosis"

. lab var mo_year_diagn_s "Month/Year of Diagnosis"

. 
. **Month/Year of rheum appt
. gen year_appt=year(rheum_appt_date) if rheum_appt_date!=.
(658 missing values generated)

. format year_appt %ty

. gen month_appt=month(rheum_appt_date) if rheum_appt_date!=. 
(658 missing values generated)

. gen mo_year_appt=ym(year_appt, month_appt)
(658 missing values generated)

. format mo_year_appt %tmMon-CCYY

. generate str16 mo_year_appt_s = strofreal(mo_year_appt,"%tmCCYY!mNN")

. 
. **Separate into 3-month time windows (for diagnosis date)
. gen diagnosis_3m = qofd(diagnosis_date)

. format diagnosis_3m %tq

. lab var diagnosis_3m "Time period for diagnosis"

. tab diagnosis_3m, missing

Time period |
        for |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
     2016q2 |          4        0.50        0.50
     2016q3 |          5        0.62        1.12
     2016q4 |          3        0.37        1.49
     2017q1 |          4        0.50        1.98
     2017q2 |          1        0.12        2.11
     2017q3 |          4        0.50        2.60
     2017q4 |          3        0.37        2.97
     2018q1 |          4        0.50        3.47
     2018q2 |         11        1.36        4.83
     2018q3 |          2        0.25        5.08
     2018q4 |          6        0.74        5.82
     2019q1 |          5        0.62        6.44
     2019q2 |          8        0.99        7.43
     2019q3 |          5        0.62        8.05
     2019q4 |          6        0.74        8.80
     2020q1 |          6        0.74        9.54
     2020q2 |          5        0.62       10.16
     2020q3 |          8        0.99       11.15
     2020q4 |          9        1.12       12.27
     2021q1 |          8        0.99       13.26
     2021q2 |         12        1.49       14.75
     2021q3 |         10        1.24       15.99
     2021q4 |         13        1.61       17.60
     2022q1 |         17        2.11       19.70
     2022q2 |         15        1.86       21.56
     2022q3 |         25        3.10       24.66
     2022q4 |         25        3.10       27.76
     2023q1 |         42        5.20       32.96
     2023q2 |         41        5.08       38.04
     2023q3 |         44        5.45       43.49
     2023q4 |         66        8.18       51.67
     2024q1 |         60        7.43       59.11
     2024q2 |         78        9.67       68.77
     2024q3 |         85       10.53       79.31
     2024q4 |         75        9.29       88.60
     2025q1 |         92       11.40      100.00
------------+-----------------------------------
      Total |        807      100.00

. bys eia_diagnosis: tab diagnosis_3m, missing

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = RA

Time period |
        for |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
     2016q2 |          3        0.45        0.45
     2016q3 |          4        0.61        1.06
     2016q4 |          3        0.45        1.51
     2017q1 |          4        0.61        2.12
     2017q2 |          1        0.15        2.27
     2017q3 |          4        0.61        2.87
     2017q4 |          2        0.30        3.18
     2018q1 |          2        0.30        3.48
     2018q2 |         11        1.66        5.14
     2018q3 |          2        0.30        5.45
     2018q4 |          5        0.76        6.20
     2019q1 |          4        0.61        6.81
     2019q2 |          6        0.91        7.72
     2019q3 |          5        0.76        8.47
     2019q4 |          6        0.91        9.38
     2020q1 |          6        0.91       10.29
     2020q2 |          4        0.61       10.89
     2020q3 |          6        0.91       11.80
     2020q4 |          8        1.21       13.01
     2021q1 |          6        0.91       13.92
     2021q2 |         11        1.66       15.58
     2021q3 |         10        1.51       17.10
     2021q4 |         11        1.66       18.76
     2022q1 |         15        2.27       21.03
     2022q2 |         10        1.51       22.54
     2022q3 |         22        3.33       25.87
     2022q4 |         16        2.42       28.29
     2023q1 |         33        4.99       33.28
     2023q2 |         29        4.39       37.67
     2023q3 |         34        5.14       42.81
     2023q4 |         49        7.41       50.23
     2024q1 |         48        7.26       57.49
     2024q2 |         65        9.83       67.32
     2024q3 |         73       11.04       78.37
     2024q4 |         66        9.98       88.35
     2025q1 |         77       11.65      100.00
------------+-----------------------------------
      Total |        661      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = PsA

Time period |
        for |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
     2016q2 |          1        1.47        1.47
     2016q3 |          1        1.47        2.94
     2018q4 |          1        1.47        4.41
     2019q1 |          1        1.47        5.88
     2019q2 |          1        1.47        7.35
     2020q2 |          1        1.47        8.82
     2020q4 |          1        1.47       10.29
     2021q1 |          1        1.47       11.76
     2021q4 |          1        1.47       13.24
     2022q1 |          1        1.47       14.71
     2022q2 |          2        2.94       17.65
     2022q3 |          1        1.47       19.12
     2022q4 |          4        5.88       25.00
     2023q1 |          1        1.47       26.47
     2023q2 |          4        5.88       32.35
     2023q3 |          4        5.88       38.24
     2023q4 |         10       14.71       52.94
     2024q1 |          4        5.88       58.82
     2024q2 |          7       10.29       69.12
     2024q3 |          9       13.24       82.35
     2024q4 |          5        7.35       89.71
     2025q1 |          7       10.29      100.00
------------+-----------------------------------
      Total |         68      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = AxSpA

Time period |
        for |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
     2017q4 |          1        1.69        1.69
     2018q1 |          2        3.39        5.08
     2019q2 |          1        1.69        6.78
     2020q3 |          1        1.69        8.47
     2021q1 |          1        1.69       10.17
     2021q2 |          1        1.69       11.86
     2021q4 |          1        1.69       13.56
     2022q1 |          1        1.69       15.25
     2022q2 |          3        5.08       20.34
     2022q3 |          2        3.39       23.73
     2022q4 |          5        8.47       32.20
     2023q1 |          5        8.47       40.68
     2023q2 |          4        6.78       47.46
     2023q3 |          5        8.47       55.93
     2023q4 |          6       10.17       66.10
     2024q1 |          5        8.47       74.58
     2024q2 |          6       10.17       84.75
     2024q3 |          2        3.39       88.14
     2024q4 |          3        5.08       93.22
     2025q1 |          4        6.78      100.00
------------+-----------------------------------
      Total |         59      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = Undiff IA

Time period |
        for |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
     2020q3 |          1        5.26        5.26
     2023q1 |          3       15.79       21.05
     2023q2 |          4       21.05       42.11
     2023q3 |          1        5.26       47.37
     2023q4 |          1        5.26       52.63
     2024q1 |          3       15.79       68.42
     2024q3 |          1        5.26       73.68
     2024q4 |          1        5.26       78.95
     2025q1 |          4       21.05      100.00
------------+-----------------------------------
      Total |         19      100.00


. 
. **Separate into 12-month time windows (for diagnosis date)
. gen diagnosis_year = (floor((diagnosis_date - date("$start_date", "DMY")) / 365.25) + 1) if inrange(diagnosis_date
> , date("$start_date", "DMY"), date("$end_date", "DMY"))

. lab var diagnosis_year "Year of diagnosis"

. forvalues i = 1/$max_year {
  2.     local start = $base_year + `i' - 1
  3.     local end = `start' + 1
  4.     label define diagnosis_year_lbl `i' "Apr `start'–Mar `end'", add
  5. }

. lab val diagnosis_year diagnosis_year_lbl

. tab diagnosis_year, missing

Year of diagnosis |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |         16        1.98        1.98
Apr 2017–Mar 2018 |         12        1.49        3.47
Apr 2018–Mar 2019 |         24        2.97        6.44
Apr 2019–Mar 2020 |         25        3.10        9.54
Apr 2020–Mar 2021 |         30        3.72       13.26
Apr 2021–Mar 2022 |         52        6.44       19.70
Apr 2022–Mar 2023 |        107       13.26       32.96
Apr 2023–Mar 2024 |        211       26.15       59.11
Apr 2024–Mar 2025 |        330       40.89      100.00
------------------+-----------------------------------
            Total |        807      100.00

. bys eia_diagnosis: tab diagnosis_year, missing

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = RA

Year of diagnosis |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |         14        2.12        2.12
Apr 2017–Mar 2018 |          9        1.36        3.48
Apr 2018–Mar 2019 |         22        3.33        6.81
Apr 2019–Mar 2020 |         23        3.48       10.29
Apr 2020–Mar 2021 |         24        3.63       13.92
Apr 2021–Mar 2022 |         47        7.11       21.03
Apr 2022–Mar 2023 |         81       12.25       33.28
Apr 2023–Mar 2024 |        160       24.21       57.49
Apr 2024–Mar 2025 |        281       42.51      100.00
------------------+-----------------------------------
            Total |        661      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = PsA

Year of diagnosis |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |          2        2.94        2.94
Apr 2018–Mar 2019 |          2        2.94        5.88
Apr 2019–Mar 2020 |          1        1.47        7.35
Apr 2020–Mar 2021 |          3        4.41       11.76
Apr 2021–Mar 2022 |          2        2.94       14.71
Apr 2022–Mar 2023 |          8       11.76       26.47
Apr 2023–Mar 2024 |         22       32.35       58.82
Apr 2024–Mar 2025 |         28       41.18      100.00
------------------+-----------------------------------
            Total |         68      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = AxSpA

Year of diagnosis |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2017–Mar 2018 |          3        5.08        5.08
Apr 2019–Mar 2020 |          1        1.69        6.78
Apr 2020–Mar 2021 |          2        3.39       10.17
Apr 2021–Mar 2022 |          3        5.08       15.25
Apr 2022–Mar 2023 |         15       25.42       40.68
Apr 2023–Mar 2024 |         20       33.90       74.58
Apr 2024–Mar 2025 |         15       25.42      100.00
------------------+-----------------------------------
            Total |         59      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = Undiff IA

Year of diagnosis |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2020–Mar 2021 |          1        5.26        5.26
Apr 2022–Mar 2023 |          3       15.79       21.05
Apr 2023–Mar 2024 |          9       47.37       68.42
Apr 2024–Mar 2025 |          6       31.58      100.00
------------------+-----------------------------------
            Total |         19      100.00


. 
. **Separate into 3-month time windows (for appt date)
. gen appt_3m = qofd(rheum_appt_date)
(658 missing values generated)

. format appt_3m %tq

. lab var appt_3m "Time period for appointment"

. tab appt_3m, missing

Time period |
        for |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
     2015q4 |          1        0.12        0.12
     2016q2 |          1        0.12        0.25
     2017q1 |          1        0.12        0.37
     2017q4 |          2        0.25        0.62
     2018q1 |          1        0.12        0.74
     2018q2 |          1        0.12        0.87
     2018q3 |          1        0.12        0.99
     2018q4 |          1        0.12        1.12
     2019q1 |          2        0.25        1.36
     2019q3 |          2        0.25        1.61
     2019q4 |          1        0.12        1.73
     2020q2 |          1        0.12        1.86
     2020q3 |          1        0.12        1.98
     2021q1 |          1        0.12        2.11
     2021q2 |          1        0.12        2.23
     2021q4 |          1        0.12        2.35
     2022q1 |          1        0.12        2.48
     2022q2 |          3        0.37        2.85
     2022q3 |          6        0.74        3.59
     2022q4 |          6        0.74        4.34
     2023q1 |          5        0.62        4.96
     2023q2 |         11        1.36        6.32
     2023q3 |          4        0.50        6.82
     2023q4 |         23        2.85        9.67
     2024q1 |         13        1.61       11.28
     2024q2 |         24        2.97       14.25
     2024q3 |          7        0.87       15.12
     2024q4 |         16        1.98       17.10
     2025q1 |         10        1.24       18.34
     2025q2 |          1        0.12       18.46
          . |        658       81.54      100.00
------------+-----------------------------------
      Total |        807      100.00

. bys eia_diagnosis: tab appt_3m, missing

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = RA

Time period |
        for |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
     2015q4 |          1        0.15        0.15
     2016q2 |          1        0.15        0.30
     2017q4 |          2        0.30        0.61
     2018q1 |          1        0.15        0.76
     2018q2 |          1        0.15        0.91
     2018q3 |          1        0.15        1.06
     2018q4 |          1        0.15        1.21
     2019q1 |          2        0.30        1.51
     2019q3 |          2        0.30        1.82
     2019q4 |          1        0.15        1.97
     2020q3 |          1        0.15        2.12
     2021q1 |          1        0.15        2.27
     2021q2 |          1        0.15        2.42
     2022q1 |          1        0.15        2.57
     2022q2 |          2        0.30        2.87
     2022q3 |          6        0.91        3.78
     2022q4 |          3        0.45        4.24
     2023q1 |          4        0.61        4.84
     2023q2 |          7        1.06        5.90
     2023q3 |          3        0.45        6.35
     2023q4 |         19        2.87        9.23
     2024q1 |         10        1.51       10.74
     2024q2 |         19        2.87       13.62
     2024q3 |          6        0.91       14.52
     2024q4 |         16        2.42       16.94
     2025q1 |         10        1.51       18.46
          . |        539       81.54      100.00
------------+-----------------------------------
      Total |        661      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = PsA

Time period |
        for |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
     2020q2 |          1        1.47        1.47
     2022q4 |          1        1.47        2.94
     2023q1 |          1        1.47        4.41
     2023q2 |          2        2.94        7.35
     2023q3 |          1        1.47        8.82
     2023q4 |          2        2.94       11.76
     2024q1 |          3        4.41       16.18
     2024q2 |          3        4.41       20.59
     2024q3 |          1        1.47       22.06
     2025q2 |          1        1.47       23.53
          . |         52       76.47      100.00
------------+-----------------------------------
      Total |         68      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = AxSpA

Time period |
        for |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
     2017q1 |          1        1.69        1.69
     2021q4 |          1        1.69        3.39
     2022q2 |          1        1.69        5.08
     2022q4 |          1        1.69        6.78
     2023q2 |          2        3.39       10.17
     2023q4 |          2        3.39       13.56
     2024q2 |          2        3.39       16.95
          . |         49       83.05      100.00
------------+-----------------------------------
      Total |         59      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = Undiff IA

Time period |
        for |
appointment |      Freq.     Percent        Cum.
------------+-----------------------------------
     2022q4 |          1        5.26        5.26
          . |         18       94.74      100.00
------------+-----------------------------------
      Total |         19      100.00


. 
. **Separate into 12-month time windows (for appt date)
. gen appt_year = (floor((rheum_appt_date - date("$start_date", "DMY")) / 365.25) + 1) if inrange(rheum_appt_date, d
> ate("$start_date", "DMY"), date("$end_date", "DMY"))
(660 missing values generated)

. lab var appt_year "Year of appointment"

. forvalues i = 1/$max_year {
  2.     local start = $base_year + `i' - 1
  3.     local end = `start' + 1
  4.     label define appt_year_lbl `i' "Apr `start'–Mar `end'", add
  5. }

. lab val appt_year appt_year_lbl

. tab appt_year, missing

          Year of |
      appointment |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |          2        0.25        0.25
Apr 2017–Mar 2018 |          3        0.37        0.62
Apr 2018–Mar 2019 |          5        0.62        1.24
Apr 2019–Mar 2020 |          3        0.37        1.61
Apr 2020–Mar 2021 |          3        0.37        1.98
Apr 2021–Mar 2022 |          3        0.37        2.35
Apr 2022–Mar 2023 |         20        2.48        4.83
Apr 2023–Mar 2024 |         51        6.32       11.15
Apr 2024–Mar 2025 |         57        7.06       18.22
                . |        660       81.78      100.00
------------------+-----------------------------------
            Total |        807      100.00

. bys eia_diagnosis: tab appt_year, missing

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = RA

          Year of |
      appointment |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |          1        0.15        0.15
Apr 2017–Mar 2018 |          3        0.45        0.61
Apr 2018–Mar 2019 |          5        0.76        1.36
Apr 2019–Mar 2020 |          3        0.45        1.82
Apr 2020–Mar 2021 |          2        0.30        2.12
Apr 2021–Mar 2022 |          2        0.30        2.42
Apr 2022–Mar 2023 |         15        2.27        4.69
Apr 2023–Mar 2024 |         39        5.90       10.59
Apr 2024–Mar 2025 |         51        7.72       18.31
                . |        540       81.69      100.00
------------------+-----------------------------------
            Total |        661      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = PsA

          Year of |
      appointment |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2020–Mar 2021 |          1        1.47        1.47
Apr 2022–Mar 2023 |          2        2.94        4.41
Apr 2023–Mar 2024 |          8       11.76       16.18
Apr 2024–Mar 2025 |          4        5.88       22.06
                . |         53       77.94      100.00
------------------+-----------------------------------
            Total |         68      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = AxSpA

          Year of |
      appointment |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2016–Mar 2017 |          1        1.69        1.69
Apr 2021–Mar 2022 |          1        1.69        3.39
Apr 2022–Mar 2023 |          2        3.39        6.78
Apr 2023–Mar 2024 |          4        6.78       13.56
Apr 2024–Mar 2025 |          2        3.39       16.95
                . |         49       83.05      100.00
------------------+-----------------------------------
            Total |         59      100.00

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = Undiff IA

          Year of |
      appointment |      Freq.     Percent        Cum.
------------------+-----------------------------------
Apr 2022–Mar 2023 |          1        5.26        5.26
                . |         18       94.74      100.00
------------------+-----------------------------------
            Total |         19      100.00


. 
. *Define Rheumatology appointments ======================================*/
. 
. tab mo_year_diagn rheum_appt, missing //proportion of patients with an rheum outpatient date (with first attendanc
> e option selected) in the 12 months before and 60 days after EIA code appeared in GP record; data only April 2019 
> onwards

           |  First rheumatology
Month/Year | appointment within 12
        of |        months
 Diagnosis |        No        Yes |     Total
-----------+----------------------+----------
  Apr-2016 |         2          0 |         2 
  May-2016 |         1          0 |         1 
  Jun-2016 |         1          0 |         1 
  Jul-2016 |         3          0 |         3 
  Aug-2016 |         1          1 |         2 
  Oct-2016 |         1          0 |         1 
  Nov-2016 |         1          1 |         2 
  Jan-2017 |         1          0 |         1 
  Mar-2017 |         3          0 |         3 
  May-2017 |         1          0 |         1 
  Jul-2017 |         2          0 |         2 
  Sep-2017 |         2          0 |         2 
  Dec-2017 |         2          1 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         2          0 |         2 
  Mar-2018 |         1          0 |         1 
  Apr-2018 |         3          0 |         3 
  May-2018 |         2          1 |         3 
  Jun-2018 |         4          1 |         5 
  Jul-2018 |         1          0 |         1 
  Sep-2018 |         0          1 |         1 
  Oct-2018 |         2          0 |         2 
  Nov-2018 |         1          0 |         1 
  Dec-2018 |         3          0 |         3 
  Jan-2019 |         1          1 |         2 
  Feb-2019 |         1          0 |         1 
  Mar-2019 |         2          0 |         2 
  Apr-2019 |         1          1 |         2 
  May-2019 |         1          1 |         2 
  Jun-2019 |         2          2 |         4 
  Jul-2019 |         1          0 |         1 
  Aug-2019 |         1          1 |         2 
  Sep-2019 |         2          0 |         2 
  Oct-2019 |         1          0 |         1 
  Nov-2019 |         2          1 |         3 
  Dec-2019 |         2          0 |         2 
  Jan-2020 |         3          1 |         4 
  Mar-2020 |         2          0 |         2 
  May-2020 |         3          0 |         3 
  Jun-2020 |         2          0 |         2 
  Jul-2020 |         5          0 |         5 
  Aug-2020 |         2          0 |         2 
  Sep-2020 |         1          0 |         1 
  Oct-2020 |         1          0 |         1 
  Nov-2020 |         5          0 |         5 
  Dec-2020 |         2          1 |         3 
  Jan-2021 |         5          0 |         5 
  Feb-2021 |         1          1 |         2 
  Mar-2021 |         1          0 |         1 
  Apr-2021 |         5          0 |         5 
  May-2021 |         4          0 |         4 
  Jun-2021 |         3          0 |         3 
  Jul-2021 |         1          0 |         1 
  Aug-2021 |         2          1 |         3 
  Sep-2021 |         6          0 |         6 
  Oct-2021 |         5          0 |         5 
  Nov-2021 |         3          0 |         3 
  Dec-2021 |         5          0 |         5 
  Jan-2022 |         6          0 |         6 
  Feb-2022 |         4          1 |         5 
  Mar-2022 |         5          1 |         6 
  Apr-2022 |         2          1 |         3 
  May-2022 |         6          0 |         6 
  Jun-2022 |         6          0 |         6 
  Jul-2022 |        11          0 |        11 
  Aug-2022 |         4          0 |         4 
  Sep-2022 |         8          2 |        10 
  Oct-2022 |         8          0 |         8 
  Nov-2022 |         7          1 |         8 
  Dec-2022 |         7          2 |         9 
  Jan-2023 |        10          2 |        12 
  Feb-2023 |        11          3 |        14 
  Mar-2023 |        16          0 |        16 
  Apr-2023 |         8          2 |        10 
  May-2023 |        17          3 |        20 
  Jun-2023 |        10          1 |        11 
  Jul-2023 |         8          0 |         8 
  Aug-2023 |        12          2 |        14 
  Sep-2023 |        21          1 |        22 
  Oct-2023 |        21          5 |        26 
  Nov-2023 |        21          2 |        23 
  Dec-2023 |        15          2 |        17 
  Jan-2024 |        21          6 |        27 
  Feb-2024 |        12          1 |        13 
  Mar-2024 |        15          5 |        20 
  Apr-2024 |        27          5 |        32 
  May-2024 |        15          6 |        21 
  Jun-2024 |        20          5 |        25 
  Jul-2024 |        29          7 |        36 
  Aug-2024 |        20          8 |        28 
  Sep-2024 |        17          4 |        21 
  Oct-2024 |        16          5 |        21 
  Nov-2024 |        13          4 |        17 
  Dec-2024 |        23         14 |        37 
  Jan-2025 |        20          6 |        26 
  Feb-2025 |        17          9 |        26 
  Mar-2025 |        24         16 |        40 
-----------+----------------------+----------
     Total |       658        149 |       807 

. 
. ***Check number of rheumatology appts in the year before EIA code
. tabstat rheum_appt_count, stat (n mean sd p50 p25 p75)

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |       807  .6802974   1.20458         0         0         1
--------------------------------------------------------------------------

. bys diagnosis_year: tabstat rheum_appt_count, stat (n mean sd p50 p25 p75)

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2016–Mar 2017

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        16     .5625  1.030776         0         0         1
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2017–Mar 2018

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        12  .8333333  1.403459         0         0       1.5
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2018–Mar 2019

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        24  .7916667  1.141287         0         0       1.5
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2019–Mar 2020

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        25       .68  1.180395         0         0         1
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2020–Mar 2021

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        30        .4  1.162637         0         0         0
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2021–Mar 2022

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        52  .2307692  .8991365         0         0         0
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2022–Mar 2023

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |       107  .2803738  .7866143         0         0         0
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2023–Mar 2024

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |       211  .4218009  .7219673         0         0         1
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> diagnosis_year = Apr 2024–Mar 2025

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |       330  1.063636  1.478995         0         0         2
--------------------------------------------------------------------------

. bys appt_year: tabstat rheum_appt_count, stat (n mean sd p50 p25 p75)

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2016–Mar 2017

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |         2       2.5   2.12132       2.5         1         4
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2017–Mar 2018

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |         3  2.666667  1.154701         2         2         4
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2018–Mar 2019

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |         5       2.4  1.140175         2         2         3
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2019–Mar 2020

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |         3         2         1         2         1         3
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2020–Mar 2021

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |         3         5         1         5         4         6
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2021–Mar 2022

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |         3  .6666667  .5773503         1         0         1
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2022–Mar 2023

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        20      1.55  1.145931         1         1         2
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2023–Mar 2024

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        51  2.156863  1.332254         2         1         3
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = Apr 2024–Mar 2025

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |        57  2.754386   1.31313         3         2         4
--------------------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> appt_year = .

    Variable |         N      Mean        SD       p50       p25       p75
-------------+------------------------------------------------------------
rheum_appt~t |       660  .3075758  .7639071         0         0         0
--------------------------------------------------------------------------

. 
. ***Check medium used for rheumatology appointment
. tab rheum_appt_medium, missing

rheum_appt_ |
     medium |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         11        1.36        1.36
          2 |         15        1.86        3.22
          3 |         15        1.86        5.08
          4 |         20        2.48        7.56
          5 |         21        2.60       10.16
          9 |         21        2.60       12.76
         10 |         14        1.73       14.50
         11 |         20        2.48       16.98
         98 |         12        1.49       18.46
          . |        658       81.54      100.00
------------+-----------------------------------
      Total |        807      100.00

. gen rheum_appt_medium_clean = rheum_appt_medium if rheum_appt_medium >0 & rheum_appt_medium<100
(658 missing values generated)

. recode rheum_appt_medium_clean 3=2 //recode telemedicine=telephone
(15 changes made to rheum_appt_medium_clean)

. replace rheum_appt_medium_clean=10 if rheum_appt_medium_clean>2 & rheum_appt_medium_clean!=.
(94 real changes made)

. recode rheum_appt_medium_clean .=.u
(658 changes made to rheum_appt_medium_clean)

. lab define rheum_appt_medium_clean 1 "Face-to-face" 2 "Telephone" 10 "Other" .u "Missing", modify

. lab val rheum_appt_medium_clean rheum_appt_medium_clean

. lab var rheum_appt_medium_clean "Rheumatology consultation medium"

. tab rheum_appt_medium_clean 

Rheumatology |
consultation |
      medium |      Freq.     Percent        Cum.
-------------+-----------------------------------
Face-to-face |         11        7.38        7.38
   Telephone |         30       20.13       27.52
       Other |        108       72.48      100.00
-------------+-----------------------------------
       Total |        149      100.00

. 
. *Gen rheum appt variable with 6m/12m+ until study end date
. gen rheum_appt_12m=rheum_appt if rheum_appt_date<=(date("$end_date", "DMY")-365) 
(716 missing values generated)

. recode rheum_appt_12m .=0
(716 changes made to rheum_appt_12m)

. lab var rheum_appt_12m "Rheumatology appt 12m+"

. lab define rheum_appt_12m 0 "No" 1 "Yes", modify

. lab val rheum_appt_12m rheum_appt_12m

. 
. gen rheum_appt_6m=rheum_appt if rheum_appt_date<=(date("$end_date", "DMY")-183) 
(685 missing values generated)

. recode rheum_appt_6m .=0
(685 changes made to rheum_appt_6m)

. lab var rheum_appt_6m "Rheumatology appt 6m+"

. lab define rheum_appt_6m 0 "No" 1 "Yes", modify

. lab val rheum_appt_6m rheum_appt_6m

. 
. **Define Rheumatology referrals ======================================*/
. 
. ***From HES OPA (referral_request_received_date)
. tab rheum_appt_ref, missing

rheum_appt_ |
        ref |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        658       81.54       81.54
        Yes |        149       18.46      100.00
------------+-----------------------------------
      Total |        807      100.00

. codebook rheum_appt_ref_date

--------------------------------------------------------------------------------------------------------------------
rheum_appt_ref_date                                                                                      (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [20501,23881]                 Units: 1
       Or equivalently: [17feb2016,20may2025]         Units: days
         Unique values: 139                       Missing .: 658/807

                  Mean: 23250.5 = 28aug2023(+ 12 hours)
             Std. dev.: 779.124
           Percentiles:       10%        25%        50%        75%        90%
                            21827      23071      23561      23765      23844
                        05oct2019  02mar2023  04jul2024  24jan2025  13apr2025

. tab mo_year_diagn rheum_appt_ref, missing

Month/Year |
        of |    rheum_appt_ref
 Diagnosis |        No        Yes |     Total
-----------+----------------------+----------
  Apr-2016 |         2          0 |         2 
  May-2016 |         1          0 |         1 
  Jun-2016 |         1          0 |         1 
  Jul-2016 |         3          0 |         3 
  Aug-2016 |         1          1 |         2 
  Oct-2016 |         1          0 |         1 
  Nov-2016 |         1          1 |         2 
  Jan-2017 |         1          0 |         1 
  Mar-2017 |         3          0 |         3 
  May-2017 |         1          0 |         1 
  Jul-2017 |         2          0 |         2 
  Sep-2017 |         2          0 |         2 
  Dec-2017 |         2          1 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         2          0 |         2 
  Mar-2018 |         1          0 |         1 
  Apr-2018 |         3          0 |         3 
  May-2018 |         2          1 |         3 
  Jun-2018 |         4          1 |         5 
  Jul-2018 |         1          0 |         1 
  Sep-2018 |         0          1 |         1 
  Oct-2018 |         2          0 |         2 
  Nov-2018 |         1          0 |         1 
  Dec-2018 |         3          0 |         3 
  Jan-2019 |         1          1 |         2 
  Feb-2019 |         1          0 |         1 
  Mar-2019 |         2          0 |         2 
  Apr-2019 |         1          1 |         2 
  May-2019 |         1          1 |         2 
  Jun-2019 |         2          2 |         4 
  Jul-2019 |         1          0 |         1 
  Aug-2019 |         1          1 |         2 
  Sep-2019 |         2          0 |         2 
  Oct-2019 |         1          0 |         1 
  Nov-2019 |         2          1 |         3 
  Dec-2019 |         2          0 |         2 
  Jan-2020 |         3          1 |         4 
  Mar-2020 |         2          0 |         2 
  May-2020 |         3          0 |         3 
  Jun-2020 |         2          0 |         2 
  Jul-2020 |         5          0 |         5 
  Aug-2020 |         2          0 |         2 
  Sep-2020 |         1          0 |         1 
  Oct-2020 |         1          0 |         1 
  Nov-2020 |         5          0 |         5 
  Dec-2020 |         2          1 |         3 
  Jan-2021 |         5          0 |         5 
  Feb-2021 |         1          1 |         2 
  Mar-2021 |         1          0 |         1 
  Apr-2021 |         5          0 |         5 
  May-2021 |         4          0 |         4 
  Jun-2021 |         3          0 |         3 
  Jul-2021 |         1          0 |         1 
  Aug-2021 |         2          1 |         3 
  Sep-2021 |         6          0 |         6 
  Oct-2021 |         5          0 |         5 
  Nov-2021 |         3          0 |         3 
  Dec-2021 |         5          0 |         5 
  Jan-2022 |         6          0 |         6 
  Feb-2022 |         4          1 |         5 
  Mar-2022 |         5          1 |         6 
  Apr-2022 |         2          1 |         3 
  May-2022 |         6          0 |         6 
  Jun-2022 |         6          0 |         6 
  Jul-2022 |        11          0 |        11 
  Aug-2022 |         4          0 |         4 
  Sep-2022 |         8          2 |        10 
  Oct-2022 |         8          0 |         8 
  Nov-2022 |         7          1 |         8 
  Dec-2022 |         7          2 |         9 
  Jan-2023 |        10          2 |        12 
  Feb-2023 |        11          3 |        14 
  Mar-2023 |        16          0 |        16 
  Apr-2023 |         8          2 |        10 
  May-2023 |        17          3 |        20 
  Jun-2023 |        10          1 |        11 
  Jul-2023 |         8          0 |         8 
  Aug-2023 |        12          2 |        14 
  Sep-2023 |        21          1 |        22 
  Oct-2023 |        21          5 |        26 
  Nov-2023 |        21          2 |        23 
  Dec-2023 |        15          2 |        17 
  Jan-2024 |        21          6 |        27 
  Feb-2024 |        12          1 |        13 
  Mar-2024 |        15          5 |        20 
  Apr-2024 |        27          5 |        32 
  May-2024 |        15          6 |        21 
  Jun-2024 |        20          5 |        25 
  Jul-2024 |        29          7 |        36 
  Aug-2024 |        20          8 |        28 
  Sep-2024 |        17          4 |        21 
  Oct-2024 |        16          5 |        21 
  Nov-2024 |        13          4 |        17 
  Dec-2024 |        23         14 |        37 
  Jan-2025 |        20          6 |        26 
  Feb-2025 |        17          9 |        26 
  Mar-2025 |        24         16 |        40 
-----------+----------------------+----------
     Total |       658        149 |       807 

. tab mo_year_diagn rheum_appt_ref if rheum_appt!=., missing

Month/Year |
        of |    rheum_appt_ref
 Diagnosis |        No        Yes |     Total
-----------+----------------------+----------
  Apr-2016 |         2          0 |         2 
  May-2016 |         1          0 |         1 
  Jun-2016 |         1          0 |         1 
  Jul-2016 |         3          0 |         3 
  Aug-2016 |         1          1 |         2 
  Oct-2016 |         1          0 |         1 
  Nov-2016 |         1          1 |         2 
  Jan-2017 |         1          0 |         1 
  Mar-2017 |         3          0 |         3 
  May-2017 |         1          0 |         1 
  Jul-2017 |         2          0 |         2 
  Sep-2017 |         2          0 |         2 
  Dec-2017 |         2          1 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         2          0 |         2 
  Mar-2018 |         1          0 |         1 
  Apr-2018 |         3          0 |         3 
  May-2018 |         2          1 |         3 
  Jun-2018 |         4          1 |         5 
  Jul-2018 |         1          0 |         1 
  Sep-2018 |         0          1 |         1 
  Oct-2018 |         2          0 |         2 
  Nov-2018 |         1          0 |         1 
  Dec-2018 |         3          0 |         3 
  Jan-2019 |         1          1 |         2 
  Feb-2019 |         1          0 |         1 
  Mar-2019 |         2          0 |         2 
  Apr-2019 |         1          1 |         2 
  May-2019 |         1          1 |         2 
  Jun-2019 |         2          2 |         4 
  Jul-2019 |         1          0 |         1 
  Aug-2019 |         1          1 |         2 
  Sep-2019 |         2          0 |         2 
  Oct-2019 |         1          0 |         1 
  Nov-2019 |         2          1 |         3 
  Dec-2019 |         2          0 |         2 
  Jan-2020 |         3          1 |         4 
  Mar-2020 |         2          0 |         2 
  May-2020 |         3          0 |         3 
  Jun-2020 |         2          0 |         2 
  Jul-2020 |         5          0 |         5 
  Aug-2020 |         2          0 |         2 
  Sep-2020 |         1          0 |         1 
  Oct-2020 |         1          0 |         1 
  Nov-2020 |         5          0 |         5 
  Dec-2020 |         2          1 |         3 
  Jan-2021 |         5          0 |         5 
  Feb-2021 |         1          1 |         2 
  Mar-2021 |         1          0 |         1 
  Apr-2021 |         5          0 |         5 
  May-2021 |         4          0 |         4 
  Jun-2021 |         3          0 |         3 
  Jul-2021 |         1          0 |         1 
  Aug-2021 |         2          1 |         3 
  Sep-2021 |         6          0 |         6 
  Oct-2021 |         5          0 |         5 
  Nov-2021 |         3          0 |         3 
  Dec-2021 |         5          0 |         5 
  Jan-2022 |         6          0 |         6 
  Feb-2022 |         4          1 |         5 
  Mar-2022 |         5          1 |         6 
  Apr-2022 |         2          1 |         3 
  May-2022 |         6          0 |         6 
  Jun-2022 |         6          0 |         6 
  Jul-2022 |        11          0 |        11 
  Aug-2022 |         4          0 |         4 
  Sep-2022 |         8          2 |        10 
  Oct-2022 |         8          0 |         8 
  Nov-2022 |         7          1 |         8 
  Dec-2022 |         7          2 |         9 
  Jan-2023 |        10          2 |        12 
  Feb-2023 |        11          3 |        14 
  Mar-2023 |        16          0 |        16 
  Apr-2023 |         8          2 |        10 
  May-2023 |        17          3 |        20 
  Jun-2023 |        10          1 |        11 
  Jul-2023 |         8          0 |         8 
  Aug-2023 |        12          2 |        14 
  Sep-2023 |        21          1 |        22 
  Oct-2023 |        21          5 |        26 
  Nov-2023 |        21          2 |        23 
  Dec-2023 |        15          2 |        17 
  Jan-2024 |        21          6 |        27 
  Feb-2024 |        12          1 |        13 
  Mar-2024 |        15          5 |        20 
  Apr-2024 |        27          5 |        32 
  May-2024 |        15          6 |        21 
  Jun-2024 |        20          5 |        25 
  Jul-2024 |        29          7 |        36 
  Aug-2024 |        20          8 |        28 
  Sep-2024 |        17          4 |        21 
  Oct-2024 |        16          5 |        21 
  Nov-2024 |        13          4 |        17 
  Dec-2024 |        23         14 |        37 
  Jan-2025 |        20          6 |        26 
  Feb-2025 |        17          9 |        26 
  Mar-2025 |        24         16 |        40 
-----------+----------------------+----------
     Total |       658        149 |       807 

. 
. ***From RTT clock-stop data (only available for those with clock-stop date between May 2021 and May 2022)
. tab rtt_cl_ref, missing

 rtt_cl_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        119       14.75       14.75
        Yes |        688       85.25      100.00
------------+-----------------------------------
      Total |        807      100.00

. codebook rtt_cl_ref_date

--------------------------------------------------------------------------------------------------------------------
rtt_cl_ref_date                                                                                          (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [18885,23884]                 Units: 1
       Or equivalently: [15sep2011,23may2025]         Units: days
         Unique values: 495                       Missing .: 119/807

                  Mean: 23283.8 = 30sep2023(+ 18 hours)
             Std. dev.: 787.552
           Percentiles:       10%        25%        50%        75%        90%
                            22121      23242    23577.5      23749      23844
                        25jul2020  20aug2023  20jul2024  08jan2025  13apr2025

. tab rtt_cl_ref if rheum_appt!=0 & rtt_cl_ref_date<=rheum_appt_date, missing 

 rtt_cl_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |         46      100.00      100.00
------------+-----------------------------------
      Total |         46      100.00

. tab mo_year_diagn rtt_cl_ref, missing

Month/Year |
        of |      rtt_cl_ref
 Diagnosis |        No        Yes |     Total
-----------+----------------------+----------
  Apr-2016 |         0          2 |         2 
  May-2016 |         0          1 |         1 
  Jun-2016 |         0          1 |         1 
  Jul-2016 |         0          3 |         3 
  Aug-2016 |         0          2 |         2 
  Oct-2016 |         0          1 |         1 
  Nov-2016 |         0          2 |         2 
  Jan-2017 |         0          1 |         1 
  Mar-2017 |         1          2 |         3 
  May-2017 |         0          1 |         1 
  Jul-2017 |         0          2 |         2 
  Sep-2017 |         1          1 |         2 
  Dec-2017 |         0          3 |         3 
  Jan-2018 |         0          1 |         1 
  Feb-2018 |         0          2 |         2 
  Mar-2018 |         1          0 |         1 
  Apr-2018 |         0          3 |         3 
  May-2018 |         0          3 |         3 
  Jun-2018 |         0          5 |         5 
  Jul-2018 |         0          1 |         1 
  Sep-2018 |         0          1 |         1 
  Oct-2018 |         1          1 |         2 
  Nov-2018 |         0          1 |         1 
  Dec-2018 |         2          1 |         3 
  Jan-2019 |         0          2 |         2 
  Feb-2019 |         0          1 |         1 
  Mar-2019 |         1          1 |         2 
  Apr-2019 |         0          2 |         2 
  May-2019 |         0          2 |         2 
  Jun-2019 |         0          4 |         4 
  Jul-2019 |         0          1 |         1 
  Aug-2019 |         1          1 |         2 
  Sep-2019 |         1          1 |         2 
  Oct-2019 |         0          1 |         1 
  Nov-2019 |         0          3 |         3 
  Dec-2019 |         0          2 |         2 
  Jan-2020 |         0          4 |         4 
  Mar-2020 |         0          2 |         2 
  May-2020 |         1          2 |         3 
  Jun-2020 |         0          2 |         2 
  Jul-2020 |         1          4 |         5 
  Aug-2020 |         0          2 |         2 
  Sep-2020 |         0          1 |         1 
  Oct-2020 |         0          1 |         1 
  Nov-2020 |         1          4 |         5 
  Dec-2020 |         1          2 |         3 
  Jan-2021 |         1          4 |         5 
  Feb-2021 |         0          2 |         2 
  Mar-2021 |         0          1 |         1 
  Apr-2021 |         1          4 |         5 
  May-2021 |         0          4 |         4 
  Jun-2021 |         1          2 |         3 
  Jul-2021 |         0          1 |         1 
  Aug-2021 |         0          3 |         3 
  Sep-2021 |         0          6 |         6 
  Oct-2021 |         0          5 |         5 
  Nov-2021 |         3          0 |         3 
  Dec-2021 |         3          2 |         5 
  Jan-2022 |         1          5 |         6 
  Feb-2022 |         1          4 |         5 
  Mar-2022 |         0          6 |         6 
  Apr-2022 |         0          3 |         3 
  May-2022 |         0          6 |         6 
  Jun-2022 |         0          6 |         6 
  Jul-2022 |         2          9 |        11 
  Aug-2022 |         0          4 |         4 
  Sep-2022 |         1          9 |        10 
  Oct-2022 |         3          5 |         8 
  Nov-2022 |         3          5 |         8 
  Dec-2022 |         2          7 |         9 
  Jan-2023 |         1         11 |        12 
  Feb-2023 |         0         14 |        14 
  Mar-2023 |         5         11 |        16 
  Apr-2023 |         1          9 |        10 
  May-2023 |         2         18 |        20 
  Jun-2023 |         0         11 |        11 
  Jul-2023 |         0          8 |         8 
  Aug-2023 |         1         13 |        14 
  Sep-2023 |         2         20 |        22 
  Oct-2023 |         2         24 |        26 
  Nov-2023 |         4         19 |        23 
  Dec-2023 |         5         12 |        17 
  Jan-2024 |         4         23 |        27 
  Feb-2024 |         2         11 |        13 
  Mar-2024 |         2         18 |        20 
  Apr-2024 |         4         28 |        32 
  May-2024 |         5         16 |        21 
  Jun-2024 |         3         22 |        25 
  Jul-2024 |         6         30 |        36 
  Aug-2024 |         3         25 |        28 
  Sep-2024 |         6         15 |        21 
  Oct-2024 |         3         18 |        21 
  Nov-2024 |         0         17 |        17 
  Dec-2024 |         6         31 |        37 
  Jan-2025 |         4         22 |        26 
  Feb-2025 |         4         22 |        26 
  Mar-2025 |         9         31 |        40 
-----------+----------------------+----------
     Total |       119        688 |       807 

. tab mo_year_diagn rtt_cl_ref if rheum_appt!=., missing

Month/Year |
        of |      rtt_cl_ref
 Diagnosis |        No        Yes |     Total
-----------+----------------------+----------
  Apr-2016 |         0          2 |         2 
  May-2016 |         0          1 |         1 
  Jun-2016 |         0          1 |         1 
  Jul-2016 |         0          3 |         3 
  Aug-2016 |         0          2 |         2 
  Oct-2016 |         0          1 |         1 
  Nov-2016 |         0          2 |         2 
  Jan-2017 |         0          1 |         1 
  Mar-2017 |         1          2 |         3 
  May-2017 |         0          1 |         1 
  Jul-2017 |         0          2 |         2 
  Sep-2017 |         1          1 |         2 
  Dec-2017 |         0          3 |         3 
  Jan-2018 |         0          1 |         1 
  Feb-2018 |         0          2 |         2 
  Mar-2018 |         1          0 |         1 
  Apr-2018 |         0          3 |         3 
  May-2018 |         0          3 |         3 
  Jun-2018 |         0          5 |         5 
  Jul-2018 |         0          1 |         1 
  Sep-2018 |         0          1 |         1 
  Oct-2018 |         1          1 |         2 
  Nov-2018 |         0          1 |         1 
  Dec-2018 |         2          1 |         3 
  Jan-2019 |         0          2 |         2 
  Feb-2019 |         0          1 |         1 
  Mar-2019 |         1          1 |         2 
  Apr-2019 |         0          2 |         2 
  May-2019 |         0          2 |         2 
  Jun-2019 |         0          4 |         4 
  Jul-2019 |         0          1 |         1 
  Aug-2019 |         1          1 |         2 
  Sep-2019 |         1          1 |         2 
  Oct-2019 |         0          1 |         1 
  Nov-2019 |         0          3 |         3 
  Dec-2019 |         0          2 |         2 
  Jan-2020 |         0          4 |         4 
  Mar-2020 |         0          2 |         2 
  May-2020 |         1          2 |         3 
  Jun-2020 |         0          2 |         2 
  Jul-2020 |         1          4 |         5 
  Aug-2020 |         0          2 |         2 
  Sep-2020 |         0          1 |         1 
  Oct-2020 |         0          1 |         1 
  Nov-2020 |         1          4 |         5 
  Dec-2020 |         1          2 |         3 
  Jan-2021 |         1          4 |         5 
  Feb-2021 |         0          2 |         2 
  Mar-2021 |         0          1 |         1 
  Apr-2021 |         1          4 |         5 
  May-2021 |         0          4 |         4 
  Jun-2021 |         1          2 |         3 
  Jul-2021 |         0          1 |         1 
  Aug-2021 |         0          3 |         3 
  Sep-2021 |         0          6 |         6 
  Oct-2021 |         0          5 |         5 
  Nov-2021 |         3          0 |         3 
  Dec-2021 |         3          2 |         5 
  Jan-2022 |         1          5 |         6 
  Feb-2022 |         1          4 |         5 
  Mar-2022 |         0          6 |         6 
  Apr-2022 |         0          3 |         3 
  May-2022 |         0          6 |         6 
  Jun-2022 |         0          6 |         6 
  Jul-2022 |         2          9 |        11 
  Aug-2022 |         0          4 |         4 
  Sep-2022 |         1          9 |        10 
  Oct-2022 |         3          5 |         8 
  Nov-2022 |         3          5 |         8 
  Dec-2022 |         2          7 |         9 
  Jan-2023 |         1         11 |        12 
  Feb-2023 |         0         14 |        14 
  Mar-2023 |         5         11 |        16 
  Apr-2023 |         1          9 |        10 
  May-2023 |         2         18 |        20 
  Jun-2023 |         0         11 |        11 
  Jul-2023 |         0          8 |         8 
  Aug-2023 |         1         13 |        14 
  Sep-2023 |         2         20 |        22 
  Oct-2023 |         2         24 |        26 
  Nov-2023 |         4         19 |        23 
  Dec-2023 |         5         12 |        17 
  Jan-2024 |         4         23 |        27 
  Feb-2024 |         2         11 |        13 
  Mar-2024 |         2         18 |        20 
  Apr-2024 |         4         28 |        32 
  May-2024 |         5         16 |        21 
  Jun-2024 |         3         22 |        25 
  Jul-2024 |         6         30 |        36 
  Aug-2024 |         3         25 |        28 
  Sep-2024 |         6         15 |        21 
  Oct-2024 |         3         18 |        21 
  Nov-2024 |         0         17 |        17 
  Dec-2024 |         6         31 |        37 
  Jan-2025 |         4         22 |        26 
  Feb-2025 |         4         22 |        26 
  Mar-2025 |         9         31 |        40 
-----------+----------------------+----------
     Total |       119        688 |       807 

. tab rtt_cl_start, missing //check how this differs

rtt_cl_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        119       14.75       14.75
        Yes |        688       85.25      100.00
------------+-----------------------------------
      Total |        807      100.00

. codebook rtt_cl_start_date

--------------------------------------------------------------------------------------------------------------------
rtt_cl_start_date                                                                                        (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [20197,23883]                 Units: 1
       Or equivalently: [19apr2015,22may2025]         Units: days
         Unique values: 530                       Missing .: 119/807

                  Mean: 23157.3 = 27may2023(+ 8 hours)
             Std. dev.:  713.49
           Percentiles:       10%        25%        50%        75%        90%
                            22128    23063.5      23388      23578      23712
                        01aug2020  22feb2023  13jan2024  21jul2024  02dec2024

. tab rtt_cl_start if rheum_appt!=0 & rtt_cl_start_date<=rheum_appt_date, missing 

rtt_cl_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |         60      100.00      100.00
------------+-----------------------------------
      Total |         60      100.00

. 
. ***From RTT open pathway data (only available as a snapshot of those with open RTT pathways as of May 2022)
. tab rtt_op_ref, missing

 rtt_op_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        102       12.64       12.64
        Yes |        705       87.36      100.00
------------+-----------------------------------
      Total |        807      100.00

. codebook rtt_op_ref_date

--------------------------------------------------------------------------------------------------------------------
rtt_op_ref_date                                                                                          (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [19969,23884]                 Units: 1
       Or equivalently: [03sep2014,23may2025]         Units: days
         Unique values: 511                       Missing .: 102/807

                  Mean: 23283.3 = 30sep2023(+ 6 hours)
             Std. dev.: 740.961
           Percentiles:       10%        25%        50%        75%        90%
                            22161      23159      23568      23755      23843
                        03sep2020  29may2023  11jul2024  14jan2025  12apr2025

. tab rtt_op_ref if rheum_appt!=0 & rtt_op_ref_date<=rheum_appt_date, missing 

 rtt_op_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |         39      100.00      100.00
------------+-----------------------------------
      Total |         39      100.00

. tab mo_year_diagn rtt_op_ref, missing

Month/Year |
        of |      rtt_op_ref
 Diagnosis |        No        Yes |     Total
-----------+----------------------+----------
  Apr-2016 |         1          1 |         2 
  May-2016 |         0          1 |         1 
  Jun-2016 |         0          1 |         1 
  Jul-2016 |         2          1 |         3 
  Aug-2016 |         0          2 |         2 
  Oct-2016 |         0          1 |         1 
  Nov-2016 |         0          2 |         2 
  Jan-2017 |         1          0 |         1 
  Mar-2017 |         0          3 |         3 
  May-2017 |         1          0 |         1 
  Jul-2017 |         1          1 |         2 
  Sep-2017 |         0          2 |         2 
  Dec-2017 |         0          3 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         1          1 |         2 
  Mar-2018 |         0          1 |         1 
  Apr-2018 |         0          3 |         3 
  May-2018 |         0          3 |         3 
  Jun-2018 |         2          3 |         5 
  Jul-2018 |         0          1 |         1 
  Sep-2018 |         0          1 |         1 
  Oct-2018 |         0          2 |         2 
  Nov-2018 |         0          1 |         1 
  Dec-2018 |         0          3 |         3 
  Jan-2019 |         1          1 |         2 
  Feb-2019 |         1          0 |         1 
  Mar-2019 |         0          2 |         2 
  Apr-2019 |         0          2 |         2 
  May-2019 |         0          2 |         2 
  Jun-2019 |         1          3 |         4 
  Jul-2019 |         0          1 |         1 
  Aug-2019 |         0          2 |         2 
  Sep-2019 |         0          2 |         2 
  Oct-2019 |         1          0 |         1 
  Nov-2019 |         0          3 |         3 
  Dec-2019 |         0          2 |         2 
  Jan-2020 |         1          3 |         4 
  Mar-2020 |         1          1 |         2 
  May-2020 |         0          3 |         3 
  Jun-2020 |         0          2 |         2 
  Jul-2020 |         0          5 |         5 
  Aug-2020 |         0          2 |         2 
  Sep-2020 |         0          1 |         1 
  Oct-2020 |         0          1 |         1 
  Nov-2020 |         1          4 |         5 
  Dec-2020 |         1          2 |         3 
  Jan-2021 |         1          4 |         5 
  Feb-2021 |         0          2 |         2 
  Mar-2021 |         0          1 |         1 
  Apr-2021 |         0          5 |         5 
  May-2021 |         1          3 |         4 
  Jun-2021 |         0          3 |         3 
  Jul-2021 |         1          0 |         1 
  Aug-2021 |         1          2 |         3 
  Sep-2021 |         0          6 |         6 
  Oct-2021 |         2          3 |         5 
  Nov-2021 |         1          2 |         3 
  Dec-2021 |         0          5 |         5 
  Jan-2022 |         1          5 |         6 
  Feb-2022 |         2          3 |         5 
  Mar-2022 |         1          5 |         6 
  Apr-2022 |         0          3 |         3 
  May-2022 |         0          6 |         6 
  Jun-2022 |         1          5 |         6 
  Jul-2022 |         0         11 |        11 
  Aug-2022 |         0          4 |         4 
  Sep-2022 |         2          8 |        10 
  Oct-2022 |         0          8 |         8 
  Nov-2022 |         1          7 |         8 
  Dec-2022 |         0          9 |         9 
  Jan-2023 |         3          9 |        12 
  Feb-2023 |         2         12 |        14 
  Mar-2023 |         0         16 |        16 
  Apr-2023 |         3          7 |        10 
  May-2023 |         2         18 |        20 
  Jun-2023 |         2          9 |        11 
  Jul-2023 |         1          7 |         8 
  Aug-2023 |         1         13 |        14 
  Sep-2023 |         3         19 |        22 
  Oct-2023 |         3         23 |        26 
  Nov-2023 |         3         20 |        23 
  Dec-2023 |         3         14 |        17 
  Jan-2024 |         4         23 |        27 
  Feb-2024 |         2         11 |        13 
  Mar-2024 |         3         17 |        20 
  Apr-2024 |         5         27 |        32 
  May-2024 |         2         19 |        21 
  Jun-2024 |         0         25 |        25 
  Jul-2024 |         3         33 |        36 
  Aug-2024 |         3         25 |        28 
  Sep-2024 |         2         19 |        21 
  Oct-2024 |         4         17 |        21 
  Nov-2024 |         1         16 |        17 
  Dec-2024 |         4         33 |        37 
  Jan-2025 |         3         23 |        26 
  Feb-2025 |         3         23 |        26 
  Mar-2025 |         4         36 |        40 
-----------+----------------------+----------
     Total |       102        705 |       807 

. tab mo_year_diagn rtt_op_ref if rheum_appt!=., missing

Month/Year |
        of |      rtt_op_ref
 Diagnosis |        No        Yes |     Total
-----------+----------------------+----------
  Apr-2016 |         1          1 |         2 
  May-2016 |         0          1 |         1 
  Jun-2016 |         0          1 |         1 
  Jul-2016 |         2          1 |         3 
  Aug-2016 |         0          2 |         2 
  Oct-2016 |         0          1 |         1 
  Nov-2016 |         0          2 |         2 
  Jan-2017 |         1          0 |         1 
  Mar-2017 |         0          3 |         3 
  May-2017 |         1          0 |         1 
  Jul-2017 |         1          1 |         2 
  Sep-2017 |         0          2 |         2 
  Dec-2017 |         0          3 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         1          1 |         2 
  Mar-2018 |         0          1 |         1 
  Apr-2018 |         0          3 |         3 
  May-2018 |         0          3 |         3 
  Jun-2018 |         2          3 |         5 
  Jul-2018 |         0          1 |         1 
  Sep-2018 |         0          1 |         1 
  Oct-2018 |         0          2 |         2 
  Nov-2018 |         0          1 |         1 
  Dec-2018 |         0          3 |         3 
  Jan-2019 |         1          1 |         2 
  Feb-2019 |         1          0 |         1 
  Mar-2019 |         0          2 |         2 
  Apr-2019 |         0          2 |         2 
  May-2019 |         0          2 |         2 
  Jun-2019 |         1          3 |         4 
  Jul-2019 |         0          1 |         1 
  Aug-2019 |         0          2 |         2 
  Sep-2019 |         0          2 |         2 
  Oct-2019 |         1          0 |         1 
  Nov-2019 |         0          3 |         3 
  Dec-2019 |         0          2 |         2 
  Jan-2020 |         1          3 |         4 
  Mar-2020 |         1          1 |         2 
  May-2020 |         0          3 |         3 
  Jun-2020 |         0          2 |         2 
  Jul-2020 |         0          5 |         5 
  Aug-2020 |         0          2 |         2 
  Sep-2020 |         0          1 |         1 
  Oct-2020 |         0          1 |         1 
  Nov-2020 |         1          4 |         5 
  Dec-2020 |         1          2 |         3 
  Jan-2021 |         1          4 |         5 
  Feb-2021 |         0          2 |         2 
  Mar-2021 |         0          1 |         1 
  Apr-2021 |         0          5 |         5 
  May-2021 |         1          3 |         4 
  Jun-2021 |         0          3 |         3 
  Jul-2021 |         1          0 |         1 
  Aug-2021 |         1          2 |         3 
  Sep-2021 |         0          6 |         6 
  Oct-2021 |         2          3 |         5 
  Nov-2021 |         1          2 |         3 
  Dec-2021 |         0          5 |         5 
  Jan-2022 |         1          5 |         6 
  Feb-2022 |         2          3 |         5 
  Mar-2022 |         1          5 |         6 
  Apr-2022 |         0          3 |         3 
  May-2022 |         0          6 |         6 
  Jun-2022 |         1          5 |         6 
  Jul-2022 |         0         11 |        11 
  Aug-2022 |         0          4 |         4 
  Sep-2022 |         2          8 |        10 
  Oct-2022 |         0          8 |         8 
  Nov-2022 |         1          7 |         8 
  Dec-2022 |         0          9 |         9 
  Jan-2023 |         3          9 |        12 
  Feb-2023 |         2         12 |        14 
  Mar-2023 |         0         16 |        16 
  Apr-2023 |         3          7 |        10 
  May-2023 |         2         18 |        20 
  Jun-2023 |         2          9 |        11 
  Jul-2023 |         1          7 |         8 
  Aug-2023 |         1         13 |        14 
  Sep-2023 |         3         19 |        22 
  Oct-2023 |         3         23 |        26 
  Nov-2023 |         3         20 |        23 
  Dec-2023 |         3         14 |        17 
  Jan-2024 |         4         23 |        27 
  Feb-2024 |         2         11 |        13 
  Mar-2024 |         3         17 |        20 
  Apr-2024 |         5         27 |        32 
  May-2024 |         2         19 |        21 
  Jun-2024 |         0         25 |        25 
  Jul-2024 |         3         33 |        36 
  Aug-2024 |         3         25 |        28 
  Sep-2024 |         2         19 |        21 
  Oct-2024 |         4         17 |        21 
  Nov-2024 |         1         16 |        17 
  Dec-2024 |         4         33 |        37 
  Jan-2025 |         3         23 |        26 
  Feb-2025 |         3         23 |        26 
  Mar-2025 |         4         36 |        40 
-----------+----------------------+----------
     Total |       102        705 |       807 

. tab rtt_op_start, missing //check how this differs

rtt_op_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        102       12.64       12.64
        Yes |        705       87.36      100.00
------------+-----------------------------------
      Total |        807      100.00

. codebook rtt_op_start_date

--------------------------------------------------------------------------------------------------------------------
rtt_op_start_date                                                                                        (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [20297,23882]                 Units: 1
       Or equivalently: [28jul2015,21may2025]         Units: days
         Unique values: 535                       Missing .: 102/807

                  Mean: 23180.9 = 19jun2023(+ 21 hours)
             Std. dev.: 666.596
           Percentiles:       10%        25%        50%        75%        90%
                            22265      23099      23385      23574      23729
                        16dec2020  30mar2023  10jan2024  17jul2024  19dec2024

. tab rtt_op_start if rheum_appt!=0 & rtt_op_start_date<=rheum_appt_date, missing 

rtt_op_star |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |         47      100.00      100.00
------------+-----------------------------------
      Total |         47      100.00

. 
. ***Combination of RTT clock-stop and open pathway
. gen rtt_ref_date = rtt_cl_ref_date
(119 missing values generated)

. replace rtt_ref_date = rtt_op_ref_date if rtt_cl_ref_date==. & rtt_op_ref_date!=. //need to think how to handle du
> plicate pathways
(104 real changes made)

. format %td rtt_ref_date

. gen rtt_ref =1 if rtt_ref_date!=.
(15 missing values generated)

. recode rtt_ref .=0
(15 changes made to rtt_ref)

. tab rtt_ref, missing

    rtt_ref |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         15        1.86        1.86
          1 |        792       98.14      100.00
------------+-----------------------------------
      Total |        807      100.00

. tab mo_year_diagn rtt_ref, missing

Month/Year |
        of |        rtt_ref
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         0          2 |         2 
  May-2016 |         0          1 |         1 
  Jun-2016 |         0          1 |         1 
  Jul-2016 |         0          3 |         3 
  Aug-2016 |         0          2 |         2 
  Oct-2016 |         0          1 |         1 
  Nov-2016 |         0          2 |         2 
  Jan-2017 |         0          1 |         1 
  Mar-2017 |         0          3 |         3 
  May-2017 |         0          1 |         1 
  Jul-2017 |         0          2 |         2 
  Sep-2017 |         0          2 |         2 
  Dec-2017 |         0          3 |         3 
  Jan-2018 |         0          1 |         1 
  Feb-2018 |         0          2 |         2 
  Mar-2018 |         0          1 |         1 
  Apr-2018 |         0          3 |         3 
  May-2018 |         0          3 |         3 
  Jun-2018 |         0          5 |         5 
  Jul-2018 |         0          1 |         1 
  Sep-2018 |         0          1 |         1 
  Oct-2018 |         0          2 |         2 
  Nov-2018 |         0          1 |         1 
  Dec-2018 |         0          3 |         3 
  Jan-2019 |         0          2 |         2 
  Feb-2019 |         0          1 |         1 
  Mar-2019 |         0          2 |         2 
  Apr-2019 |         0          2 |         2 
  May-2019 |         0          2 |         2 
  Jun-2019 |         0          4 |         4 
  Jul-2019 |         0          1 |         1 
  Aug-2019 |         0          2 |         2 
  Sep-2019 |         0          2 |         2 
  Oct-2019 |         0          1 |         1 
  Nov-2019 |         0          3 |         3 
  Dec-2019 |         0          2 |         2 
  Jan-2020 |         0          4 |         4 
  Mar-2020 |         0          2 |         2 
  May-2020 |         0          3 |         3 
  Jun-2020 |         0          2 |         2 
  Jul-2020 |         0          5 |         5 
  Aug-2020 |         0          2 |         2 
  Sep-2020 |         0          1 |         1 
  Oct-2020 |         0          1 |         1 
  Nov-2020 |         1          4 |         5 
  Dec-2020 |         0          3 |         3 
  Jan-2021 |         0          5 |         5 
  Feb-2021 |         0          2 |         2 
  Mar-2021 |         0          1 |         1 
  Apr-2021 |         0          5 |         5 
  May-2021 |         0          4 |         4 
  Jun-2021 |         0          3 |         3 
  Jul-2021 |         0          1 |         1 
  Aug-2021 |         0          3 |         3 
  Sep-2021 |         0          6 |         6 
  Oct-2021 |         0          5 |         5 
  Nov-2021 |         1          2 |         3 
  Dec-2021 |         0          5 |         5 
  Jan-2022 |         0          6 |         6 
  Feb-2022 |         1          4 |         5 
  Mar-2022 |         0          6 |         6 
  Apr-2022 |         0          3 |         3 
  May-2022 |         0          6 |         6 
  Jun-2022 |         0          6 |         6 
  Jul-2022 |         0         11 |        11 
  Aug-2022 |         0          4 |         4 
  Sep-2022 |         1          9 |        10 
  Oct-2022 |         0          8 |         8 
  Nov-2022 |         1          7 |         8 
  Dec-2022 |         0          9 |         9 
  Jan-2023 |         0         12 |        12 
  Feb-2023 |         0         14 |        14 
  Mar-2023 |         0         16 |        16 
  Apr-2023 |         1          9 |        10 
  May-2023 |         0         20 |        20 
  Jun-2023 |         0         11 |        11 
  Jul-2023 |         0          8 |         8 
  Aug-2023 |         0         14 |        14 
  Sep-2023 |         0         22 |        22 
  Oct-2023 |         0         26 |        26 
  Nov-2023 |         0         23 |        23 
  Dec-2023 |         1         16 |        17 
  Jan-2024 |         1         26 |        27 
  Feb-2024 |         0         13 |        13 
  Mar-2024 |         0         20 |        20 
  Apr-2024 |         2         30 |        32 
  May-2024 |         0         21 |        21 
  Jun-2024 |         0         25 |        25 
  Jul-2024 |         1         35 |        36 
  Aug-2024 |         1         27 |        28 
  Sep-2024 |         1         20 |        21 
  Oct-2024 |         0         21 |        21 
  Nov-2024 |         0         17 |        17 
  Dec-2024 |         1         36 |        37 
  Jan-2025 |         1         25 |        26 
  Feb-2025 |         0         26 |        26 
  Mar-2025 |         0         40 |        40 
-----------+----------------------+----------
     Total |        15        792 |       807 

. tab mo_year_diagn rtt_ref if rheum_appt!=0 & rtt_ref_date<=rheum_appt_date, missing 

Month/Year |
        of |  rtt_ref
 Diagnosis |         1 |     Total
-----------+-----------+----------
  May-2018 |         1 |         1 
  Sep-2018 |         1 |         1 
  Jun-2019 |         1 |         1 
  Aug-2019 |         1 |         1 
  Jan-2020 |         1 |         1 
  Dec-2020 |         1 |         1 
  Feb-2021 |         1 |         1 
  Feb-2022 |         1 |         1 
  Apr-2023 |         1 |         1 
  Feb-2024 |         1 |         1 
  Mar-2024 |         1 |         1 
  Apr-2024 |         2 |         2 
  Jun-2024 |         1 |         1 
  Jul-2024 |         2 |         2 
  Aug-2024 |         5 |         5 
  Sep-2024 |         1 |         1 
  Oct-2024 |         1 |         1 
  Nov-2024 |         1 |         1 
  Dec-2024 |         7 |         7 
  Jan-2025 |         3 |         3 
  Feb-2025 |         8 |         8 
  Mar-2025 |         7 |         7 
-----------+-----------+----------
     Total |        49 |        49 

. 
. ***From clinical events (Nb. low capture of coded rheumatology referrals in clinical events at present)
. tab rheum_ref_gp_preappt, missing //last rheum referral in the 2 years before rheumatology outpatient (requires rh
> eum appt to have been present)

rheum_ref_g |
  p_preappt |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        806       99.88       99.88
        Yes |          1        0.12      100.00
------------+-----------------------------------
      Total |        807      100.00

. tab rheum_ref_gp_preappt if rheum_appt!=0 & rheum_ref_gp_preappt_date<=rheum_appt_date, missing  //last rheum refe
> rral in the 2 years before rheumatology outpatient, assuming ref date before rheum appt date (should be accounted 
> for by Python code)

rheum_ref_g |
  p_preappt |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |          1      100.00      100.00
------------+-----------------------------------
      Total |          1      100.00

. tab rheum_ref_gp_precode, missing //last rheum referral in the 2 years before IA code 

rheum_ref_g |
  p_precode |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        801       99.26       99.26
        Yes |          6        0.74      100.00
------------+-----------------------------------
      Total |        807      100.00

. gen referral_rheum_comb_date = rheum_ref_gp_preappt_date if rheum_ref_gp_preappt_date!=.
(806 missing values generated)

. replace referral_rheum_comb_date = rheum_ref_gp_precode_date if rheum_ref_gp_preappt_date==. & rheum_ref_gp_precod
> e_date!=. //combination of the two above
(5 real changes made)

. format %td referral_rheum_comb_date

. 
. ***From GP appointments (proxy)
. tab last_gp_refrheum, missing //proportion with last GP appointment in 2 years before rheum referral (pre-rheum ap
> pt); requires there to have been a rheum referral before a rheum appt

last_gp_ref |
      rheum |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        807      100.00      100.00
------------+-----------------------------------
      Total |        807      100.00

. 
. gen last_gp_prerheum_12m=last_gp_prerheum if rheum_appt_date!=. & rheum_appt_date<=(date("$end_date", "DMY")-365)
(716 missing values generated)

. recode last_gp_prerheum_12m .=0
(716 changes made to last_gp_prerheum_12m)

. lab var last_gp_prerheum_12m "GP and rheum appt 12m+"

. lab define last_gp_prerheum_12m 0 "No" 1 "Yes", modify

. lab val last_gp_prerheum_12m last_gp_prerheum_12m

. 
. gen last_gp_prerheum_6m=last_gp_prerheum if rheum_appt_date!=. & rheum_appt_date<=(date("$end_date", "DMY")-183)
(685 missing values generated)

. recode last_gp_prerheum_6m .=0
(685 changes made to last_gp_prerheum_6m)

. lab var last_gp_prerheum_6m "GP and rheum appt 6m+"

. lab define last_gp_prerheum_6m 0 "No" 1 "Yes", modify

. lab val last_gp_prerheum_6m last_gp_prerheum_6m

. 
. tab last_gp_refcode, missing //last GP appointment before rheum ref (pre-EIA code ref); requires there to have bee
> n a rheum referral before an EIA code (i.e. rheum appt could have been missing)

last_gp_ref |
       code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        804       99.63       99.63
        Yes |          3        0.37      100.00
------------+-----------------------------------
      Total |        807      100.00

. tab last_gp_prerheum, missing //last GP appointment before rheum appt; requires there to have been a rheum appt be
> fore and EIA code

last_gp_pre |
      rheum |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        729       90.33       90.33
        Yes |         78        9.67      100.00
------------+-----------------------------------
      Total |        807      100.00

. tab last_gp_precode, missing //last GP appointment before EIA code

last_gp_pre |
       code |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        371       45.97       45.97
        Yes |        436       54.03      100.00
------------+-----------------------------------
      Total |        807      100.00

. 
. ****All appts in the correct order (using clinical events referrals)
. gen all_appts=1 if last_gp_refrheum==1 & rheum_ref_gp_preappt==1 & rheum_appt==1 & (last_gp_refrheum_date<=rheum_r
> ef_gp_preappt_date) & (rheum_ref_gp_preappt_date<=rheum_appt_date)
(807 missing values generated)

. recode all_appts .=0
(807 changes made to all_appts)

. tab all_appts, missing //proportion who had a last gp appt, then rheum ref, then rheum appt

  all_appts |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        807      100.00      100.00
------------+-----------------------------------
      Total |        807      100.00

. 
. **Define who qualifies in terms of appointments and referrals ===============================*/
. 
. **AMEND THE BELOW ONCE REFERRAL DATE KNOWN
. 
. **Proportion of patients with at least 6 or 12 months of GP registration after diagnostic code
. rename has_6m_follow_up has_6m_follow_up_s 

. gen has_6m_follow_up=1 if has_6m_follow_up_s=="T"
(685 missing values generated)

. recode has_6m_follow_up .=0
(685 changes made to has_6m_follow_up)

. drop has_6m_follow_up_s

. tab has_6m_follow_up

has_6m_foll |
      ow_up |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        685       84.88       84.88
          1 |        122       15.12      100.00
------------+-----------------------------------
      Total |        807      100.00

. rename has_12m_follow_up has_12m_follow_up_s 

. gen has_12m_follow_up=1 if has_12m_follow_up_s=="T"
(716 missing values generated)

. recode has_12m_follow_up .=0
(716 changes made to has_12m_follow_up)

. drop has_12m_follow_up_s

. tab has_12m_follow_up 

has_12m_fol |
     low_up |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        716       88.72       88.72
          1 |         91       11.28      100.00
------------+-----------------------------------
      Total |        807      100.00

. tab mo_year_diagn has_6m_follow_up

Month/Year |
        of |   has_6m_follow_up
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         2          0 |         2 
  May-2016 |         1          0 |         1 
  Jun-2016 |         1          0 |         1 
  Jul-2016 |         3          0 |         3 
  Aug-2016 |         1          1 |         2 
  Oct-2016 |         1          0 |         1 
  Nov-2016 |         1          1 |         2 
  Jan-2017 |         1          0 |         1 
  Mar-2017 |         3          0 |         3 
  May-2017 |         1          0 |         1 
  Jul-2017 |         2          0 |         2 
  Sep-2017 |         2          0 |         2 
  Dec-2017 |         2          1 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         2          0 |         2 
  Mar-2018 |         1          0 |         1 
  Apr-2018 |         3          0 |         3 
  May-2018 |         2          1 |         3 
  Jun-2018 |         4          1 |         5 
  Jul-2018 |         1          0 |         1 
  Sep-2018 |         0          1 |         1 
  Oct-2018 |         2          0 |         2 
  Nov-2018 |         1          0 |         1 
  Dec-2018 |         3          0 |         3 
  Jan-2019 |         1          1 |         2 
  Feb-2019 |         1          0 |         1 
  Mar-2019 |         2          0 |         2 
  Apr-2019 |         1          1 |         2 
  May-2019 |         1          1 |         2 
  Jun-2019 |         2          2 |         4 
  Jul-2019 |         1          0 |         1 
  Aug-2019 |         1          1 |         2 
  Sep-2019 |         2          0 |         2 
  Oct-2019 |         1          0 |         1 
  Nov-2019 |         2          1 |         3 
  Dec-2019 |         2          0 |         2 
  Jan-2020 |         3          1 |         4 
  Mar-2020 |         2          0 |         2 
  May-2020 |         3          0 |         3 
  Jun-2020 |         2          0 |         2 
  Jul-2020 |         5          0 |         5 
  Aug-2020 |         2          0 |         2 
  Sep-2020 |         1          0 |         1 
  Oct-2020 |         1          0 |         1 
  Nov-2020 |         5          0 |         5 
  Dec-2020 |         2          1 |         3 
  Jan-2021 |         5          0 |         5 
  Feb-2021 |         1          1 |         2 
  Mar-2021 |         1          0 |         1 
  Apr-2021 |         5          0 |         5 
  May-2021 |         4          0 |         4 
  Jun-2021 |         3          0 |         3 
  Jul-2021 |         1          0 |         1 
  Aug-2021 |         2          1 |         3 
  Sep-2021 |         6          0 |         6 
  Oct-2021 |         5          0 |         5 
  Nov-2021 |         3          0 |         3 
  Dec-2021 |         5          0 |         5 
  Jan-2022 |         6          0 |         6 
  Feb-2022 |         4          1 |         5 
  Mar-2022 |         5          1 |         6 
  Apr-2022 |         2          1 |         3 
  May-2022 |         6          0 |         6 
  Jun-2022 |         6          0 |         6 
  Jul-2022 |        11          0 |        11 
  Aug-2022 |         4          0 |         4 
  Sep-2022 |         8          2 |        10 
  Oct-2022 |         8          0 |         8 
  Nov-2022 |         7          1 |         8 
  Dec-2022 |         7          2 |         9 
  Jan-2023 |        10          2 |        12 
  Feb-2023 |        11          3 |        14 
  Mar-2023 |        16          0 |        16 
  Apr-2023 |         8          2 |        10 
  May-2023 |        17          3 |        20 
  Jun-2023 |        10          1 |        11 
  Jul-2023 |         8          0 |         8 
  Aug-2023 |        12          2 |        14 
  Sep-2023 |        21          1 |        22 
  Oct-2023 |        21          5 |        26 
  Nov-2023 |        21          2 |        23 
  Dec-2023 |        15          2 |        17 
  Jan-2024 |        21          6 |        27 
  Feb-2024 |        12          1 |        13 
  Mar-2024 |        15          5 |        20 
  Apr-2024 |        27          5 |        32 
  May-2024 |        15          6 |        21 
  Jun-2024 |        20          5 |        25 
  Jul-2024 |        29          7 |        36 
  Aug-2024 |        20          8 |        28 
  Sep-2024 |        17          4 |        21 
  Oct-2024 |        17          4 |        21 
  Nov-2024 |        13          4 |        17 
  Dec-2024 |        30          7 |        37 
  Jan-2025 |        23          3 |        26 
  Feb-2025 |        24          2 |        26 
  Mar-2025 |        33          7 |        40 
-----------+----------------------+----------
     Total |       685        122 |       807 

. tab mo_year_diagn has_12m_follow_up

Month/Year |
        of |   has_12m_follow_up
 Diagnosis |         0          1 |     Total
-----------+----------------------+----------
  Apr-2016 |         2          0 |         2 
  May-2016 |         1          0 |         1 
  Jun-2016 |         1          0 |         1 
  Jul-2016 |         3          0 |         3 
  Aug-2016 |         1          1 |         2 
  Oct-2016 |         1          0 |         1 
  Nov-2016 |         1          1 |         2 
  Jan-2017 |         1          0 |         1 
  Mar-2017 |         3          0 |         3 
  May-2017 |         1          0 |         1 
  Jul-2017 |         2          0 |         2 
  Sep-2017 |         2          0 |         2 
  Dec-2017 |         2          1 |         3 
  Jan-2018 |         1          0 |         1 
  Feb-2018 |         2          0 |         2 
  Mar-2018 |         1          0 |         1 
  Apr-2018 |         3          0 |         3 
  May-2018 |         2          1 |         3 
  Jun-2018 |         4          1 |         5 
  Jul-2018 |         1          0 |         1 
  Sep-2018 |         0          1 |         1 
  Oct-2018 |         2          0 |         2 
  Nov-2018 |         1          0 |         1 
  Dec-2018 |         3          0 |         3 
  Jan-2019 |         1          1 |         2 
  Feb-2019 |         1          0 |         1 
  Mar-2019 |         2          0 |         2 
  Apr-2019 |         1          1 |         2 
  May-2019 |         1          1 |         2 
  Jun-2019 |         2          2 |         4 
  Jul-2019 |         1          0 |         1 
  Aug-2019 |         1          1 |         2 
  Sep-2019 |         2          0 |         2 
  Oct-2019 |         1          0 |         1 
  Nov-2019 |         2          1 |         3 
  Dec-2019 |         2          0 |         2 
  Jan-2020 |         3          1 |         4 
  Mar-2020 |         2          0 |         2 
  May-2020 |         3          0 |         3 
  Jun-2020 |         2          0 |         2 
  Jul-2020 |         5          0 |         5 
  Aug-2020 |         2          0 |         2 
  Sep-2020 |         1          0 |         1 
  Oct-2020 |         1          0 |         1 
  Nov-2020 |         5          0 |         5 
  Dec-2020 |         2          1 |         3 
  Jan-2021 |         5          0 |         5 
  Feb-2021 |         1          1 |         2 
  Mar-2021 |         1          0 |         1 
  Apr-2021 |         5          0 |         5 
  May-2021 |         4          0 |         4 
  Jun-2021 |         3          0 |         3 
  Jul-2021 |         1          0 |         1 
  Aug-2021 |         2          1 |         3 
  Sep-2021 |         6          0 |         6 
  Oct-2021 |         5          0 |         5 
  Nov-2021 |         3          0 |         3 
  Dec-2021 |         5          0 |         5 
  Jan-2022 |         6          0 |         6 
  Feb-2022 |         4          1 |         5 
  Mar-2022 |         5          1 |         6 
  Apr-2022 |         2          1 |         3 
  May-2022 |         6          0 |         6 
  Jun-2022 |         6          0 |         6 
  Jul-2022 |        11          0 |        11 
  Aug-2022 |         4          0 |         4 
  Sep-2022 |         8          2 |        10 
  Oct-2022 |         8          0 |         8 
  Nov-2022 |         7          1 |         8 
  Dec-2022 |         7          2 |         9 
  Jan-2023 |        10          2 |        12 
  Feb-2023 |        11          3 |        14 
  Mar-2023 |        16          0 |        16 
  Apr-2023 |         8          2 |        10 
  May-2023 |        17          3 |        20 
  Jun-2023 |        10          1 |        11 
  Jul-2023 |         8          0 |         8 
  Aug-2023 |        12          2 |        14 
  Sep-2023 |        21          1 |        22 
  Oct-2023 |        21          5 |        26 
  Nov-2023 |        21          2 |        23 
  Dec-2023 |        15          2 |        17 
  Jan-2024 |        21          6 |        27 
  Feb-2024 |        12          1 |        13 
  Mar-2024 |        15          5 |        20 
  Apr-2024 |        29          3 |        32 
  May-2024 |        15          6 |        21 
  Jun-2024 |        23          2 |        25 
  Jul-2024 |        32          4 |        36 
  Aug-2024 |        23          5 |        28 
  Sep-2024 |        20          1 |        21 
  Oct-2024 |        17          4 |        21 
  Nov-2024 |        17          0 |        17 
  Dec-2024 |        33          4 |        37 
  Jan-2025 |        25          1 |        26 
  Feb-2025 |        26          0 |        26 
  Mar-2025 |        39          1 |        40 
-----------+----------------------+----------
     Total |       716         91 |       807 

. 
. *For appt and csDMARD analyses, all patients must have 1) rheum appt 2) GP appt before rheum appt 3) 12m follow-up
>  after rheum appt 4) 12m of registration after diagnostic code
. gen has_6m_post_appt=1 if rheum_appt_date!=. & rheum_appt_date<=(date("$end_date", "DMY")-183) & has_6m_follow_up=
> =1 & last_gp_prerheum==1
(748 missing values generated)

. recode has_6m_post_appt .=0
(748 changes made to has_6m_post_appt)

. lab var has_6m_post_appt "GP/rheum/registration 6m+"

. lab define has_6m_post_appt 0 "No" 1 "Yes", modify

. lab val has_6m_post_appt has_6m_post_appt

. tab has_6m_post_appt

GP/rheum/re |
 gistration |
        6m+ |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        748       92.69       92.69
        Yes |         59        7.31      100.00
------------+-----------------------------------
      Total |        807      100.00

. 
. gen has_12m_post_appt=1 if rheum_appt_date!=. & rheum_appt_date<=(date("$end_date", "DMY")-365) & has_12m_follow_u
> p==1 & last_gp_prerheum==1
(767 missing values generated)

. recode has_12m_post_appt .=0
(767 changes made to has_12m_post_appt)

. lab var has_12m_post_appt "GP/rheum/registration 12m+"

. lab define has_12m_post_appt 0 "No" 1 "Yes", modify

. lab val has_12m_post_appt has_12m_post_appt

. tab has_12m_post_appt

GP/rheum/re |
 gistration |
       12m+ |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        767       95.04       95.04
        Yes |         40        4.96      100.00
------------+-----------------------------------
      Total |        807      100.00

. 
. *Time to rheum referral =============================================*/
. 
. **AMEND THE BELOW ONCE REFERRAL DATE KNOWN
. 
. **Time from last GP appt to rheum ref before rheum appt (i.e. if appts are present and in correct time order)
. gen time_gp_rheum_ref_appt = (rheum_ref_gp_preappt_date - last_gp_refrheum_date) if rheum_ref_gp_preappt_date!=. &
>  last_gp_refrheum_date!=. & rheum_appt_date!=. & (rheum_ref_gp_preappt_date>=last_gp_refrheum_date) & (rheum_ref_g
> p_preappt_date<=rheum_appt_date)
(807 missing values generated)

. tabstat time_gp_rheum_ref_appt, stats (n mean p50 p25 p75) //all patients (should be same number as all_appts)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_gp_rh~t |         0         .         .         .         .
----------------------------------------------------------------

. 
. gen gp_ref_cat=1 if time_gp_rheum_ref_appt<=3 & time_gp_rheum_ref_appt!=. 
(807 missing values generated)

. replace gp_ref_cat=2 if time_gp_rheum_ref_appt>3 & time_gp_rheum_ref_appt<=7 & time_gp_rheum_ref_appt!=. & gp_ref_
> cat==.
(0 real changes made)

. replace gp_ref_cat=3 if time_gp_rheum_ref_appt>7 & time_gp_rheum_ref_appt!=. & gp_ref_cat==.
(0 real changes made)

. lab define gp_ref_cat 1 "Within 3 days" 2 "Between 3-7 days" 3 "More than 7 days", modify

. lab val gp_ref_cat gp_ref_cat

. lab var gp_ref_cat "Time to GP referral"

. tab gp_ref_cat, missing

      Time to GP |
        referral |      Freq.     Percent        Cum.
-----------------+-----------------------------------
               . |        807      100.00      100.00
-----------------+-----------------------------------
           Total |        807      100.00

. 
. gen gp_ref_3d=1 if time_gp_rheum_ref_appt<=3 & time_gp_rheum_ref_appt!=. 
(807 missing values generated)

. replace gp_ref_3d=2 if time_gp_rheum_ref_appt>3 & time_gp_rheum_ref_appt!=.
(0 real changes made)

. lab define gp_ref_3d 1 "Within 3 days" 2 "More than 3 days", modify

. lab val gp_ref_3d gp_ref_3d

. lab var gp_ref_3d "Time to GP referral"

. tab gp_ref_3d, missing

      Time to GP |
        referral |      Freq.     Percent        Cum.
-----------------+-----------------------------------
               . |        807      100.00      100.00
-----------------+-----------------------------------
           Total |        807      100.00

. 
. **Time from last GP to rheum ref before eia code (sensitivity analysis; includes those with no rheum appt)
. gen time_gp_rheum_ref_code = (rheum_ref_gp_precode_date - last_gp_refcode_date) if rheum_ref_gp_precode_date!=. & 
> last_gp_refcode_date!=. & rheum_ref_gp_precode_date>=last_gp_refcode_date & rheum_ref_gp_precode_date<=eia_code_da
> te
(804 missing values generated)

. tabstat time_gp_rheum_ref_code, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_gp_rh~e |         3  313.6667       323       238       380
----------------------------------------------------------------

. 
. **Time from last GP to rheum ref (combined - sensitivity analysis; includes those with no rheum appt)
. gen time_gp_rheum_ref_comb = time_gp_rheum_ref_appt 
(807 missing values generated)

. replace time_gp_rheum_ref_comb = time_gp_rheum_ref_code if time_gp_rheum_ref_appt==. & time_gp_rheum_ref_code!=.
(3 real changes made)

. tabstat time_gp_rheum_ref_comb, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_gp_rh~b |         3  313.6667       323       238       380
----------------------------------------------------------------

. 
. *Time to rheum appointment=============================================*/
. 
. **AMEND THE BELOW ONCE REFERRAL DATE KNOWN
. 
. **Time from last GP pre-rheum appt to first rheum appt (proxy for referral to appt delay)
. gen time_gp_rheum_appt = (rheum_appt_date - last_gp_prerheum_date) if rheum_appt_date!=. & last_gp_prerheum_date!=
> . & (rheum_appt_date>=last_gp_prerheum_date)
(729 missing values generated)

. tabstat time_gp_rheum_appt, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_~m_appt |        78  177.0385     118.5        52       234
----------------------------------------------------------------

. 
. **Time from rheum ref to rheum appt (i.e. if appts are present and in correct order)
. gen time_ref_rheum_appt = (rheum_appt_date - rheum_ref_gp_preappt_date) if rheum_appt_date!=. & rheum_ref_gp_preap
> pt_date!=. & (rheum_ref_gp_preappt_date<=rheum_appt_date)
(806 missing values generated)

. tabstat time_ref_rheum_appt, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_ref_r~t |         1       227       227       227       227
----------------------------------------------------------------

. 
. **Time from rheum appt received date to rheum appt (i.e. if appts are present and in correct order)
. gen time_hes_rheum_appt = (rheum_appt_date - rheum_appt_ref_date) if rheum_appt_date!=. & rheum_appt_ref_date!=. &
>  (rheum_appt_ref_date<=rheum_appt_date)
(756 missing values generated)

. tabstat time_hes_rheum_appt, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_hes_r~t |        51  363.9804       252       137       518
----------------------------------------------------------------

. 
. **Time from RTT combined ref date to rheum appt (i.e. if appts are present and in correct order)
. gen time_rtt_rheum_appt = (rheum_appt_date - rtt_ref_date) if rheum_appt_date!=. & rtt_ref_date!=. & (rtt_ref_date
> <=rheum_appt_date)
(758 missing values generated)

. tabstat time_rtt_rheum_appt, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_rtt_r~t |        49  303.6939       251       102       435
----------------------------------------------------------------

. 
. **Time from RTT closed ref date to rheum appt (i.e. if appts are present and in correct order)
. gen time_rtt_cl_rheum_appt = (rheum_appt_date - rtt_cl_ref_date) if rheum_appt_date!=. & rtt_cl_ref_date!=. & (rtt
> _cl_ref_date<=rheum_appt_date)
(761 missing values generated)

. tabstat time_rtt_cl_rheum_appt, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_rtt_c~t |        46  304.0217       235        94       436
----------------------------------------------------------------

. 
. **Time from RTT open ref date to rheum appt (i.e. if appts are present and in correct order)
. gen time_rtt_op_rheum_appt = (rheum_appt_date - rtt_op_ref_date) if rheum_appt_date!=. & rtt_op_ref_date!=. & (rtt
> _op_ref_date<=rheum_appt_date)
(768 missing values generated)

. tabstat time_rtt_op_rheum_appt, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_rtt_o~t |        39  421.8718       341       166       586
----------------------------------------------------------------

. 
. gen gp_appt_cat=1 if time_gp_rheum_appt<=21 & time_gp_rheum_appt!=. 
(796 missing values generated)

. replace gp_appt_cat=2 if time_gp_rheum_appt>21 & time_gp_rheum_appt<=42 & time_gp_rheum_appt!=. & gp_appt_cat==.
(6 real changes made)

. replace gp_appt_cat=3 if time_gp_rheum_appt>42 & time_gp_rheum_appt!=. & gp_appt_cat==.
(61 real changes made)

. lab define gp_appt_cat 1 "Within 3 weeks" 2 "Between 3-6 weeks" 3 "More than 6 weeks", modify

. lab val gp_appt_cat gp_appt_cat

. lab var gp_appt_cat "Time to rheumatology assessment, overall"

. tab gp_appt_cat, missing

          Time to |
     rheumatology |
      assessment, |
          overall |      Freq.     Percent        Cum.
------------------+-----------------------------------
   Within 3 weeks |         11        1.36        1.36
Between 3-6 weeks |          6        0.74        2.11
More than 6 weeks |         61        7.56        9.67
                . |        729       90.33      100.00
------------------+-----------------------------------
            Total |        807      100.00

. 
. forvalues i = 1/$max_year {
  2.     local start = $base_year + `i' - 1
  3.     local end = `start' + 1
  4.         gen gp_appt_cat_`start'=gp_appt_cat if appt_year==`i'
  5.     lab define gp_appt_cat_`start' 1 "Within 3 weeks" 2 "Between 3-6 weeks" 3 "More than 6 weeks", modify
  6.         lab val gp_appt_cat_`start' gp_appt_cat_`start'
  7.         lab var gp_appt_cat_`start' "Time to rheumatology assessment, Apr `start'-Mar `end'"
  8.         tab gp_appt_cat_`start', missing
  9. }
(806 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2016-Mar 2017 |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 6 weeks |          1        0.12        0.12
                . |        806       99.88      100.00
------------------+-----------------------------------
            Total |        807      100.00
(805 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2017-Mar 2018 |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 6 weeks |          2        0.25        0.25
                . |        805       99.75      100.00
------------------+-----------------------------------
            Total |        807      100.00
(804 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2018-Mar 2019 |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 6 weeks |          3        0.37        0.37
                . |        804       99.63      100.00
------------------+-----------------------------------
            Total |        807      100.00
(804 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2019-Mar 2020 |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 6 weeks |          3        0.37        0.37
                . |        804       99.63      100.00
------------------+-----------------------------------
            Total |        807      100.00
(804 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2020-Mar 2021 |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 6 weeks |          3        0.37        0.37
                . |        804       99.63      100.00
------------------+-----------------------------------
            Total |        807      100.00
(806 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2021-Mar 2022 |      Freq.     Percent        Cum.
------------------+-----------------------------------
   Within 3 weeks |          1        0.12        0.12
                . |        806       99.88      100.00
------------------+-----------------------------------
            Total |        807      100.00
(801 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2022-Mar 2023 |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 6 weeks |          6        0.74        0.74
                . |        801       99.26      100.00
------------------+-----------------------------------
            Total |        807      100.00
(786 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2023-Mar 2024 |      Freq.     Percent        Cum.
------------------+-----------------------------------
   Within 3 weeks |          4        0.50        0.50
Between 3-6 weeks |          1        0.12        0.62
More than 6 weeks |         16        1.98        2.60
                . |        786       97.40      100.00
------------------+-----------------------------------
            Total |        807      100.00
(769 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2024-Mar 2025 |      Freq.     Percent        Cum.
------------------+-----------------------------------
   Within 3 weeks |          6        0.74        0.74
Between 3-6 weeks |          5        0.62        1.36
More than 6 weeks |         27        3.35        4.71
                . |        769       95.29      100.00
------------------+-----------------------------------
            Total |        807      100.00

. 
. gen gp_appt_3w=1 if time_gp_rheum_appt<=21 & time_gp_rheum_appt!=. 
(796 missing values generated)

. replace gp_appt_3w=2 if time_gp_rheum_appt>21 & time_gp_rheum_appt!=.
(67 real changes made)

. lab define gp_appt_3w 1 "Within 3 weeks" 2 "More than 3 weeks", modify

. lab val gp_appt_3w gp_appt_3w

. lab var gp_appt_3w "Time to rheumatology assessment, overall"

. tab gp_appt_3w, missing

          Time to |
     rheumatology |
      assessment, |
          overall |      Freq.     Percent        Cum.
------------------+-----------------------------------
   Within 3 weeks |         11        1.36        1.36
More than 3 weeks |         67        8.30        9.67
                . |        729       90.33      100.00
------------------+-----------------------------------
            Total |        807      100.00

. 
. **AMEND THE BELOW ONCE REFERRAL DATE KNOWN
. 
. gen ref_appt_cat=1 if time_ref_rheum_appt<=21 & time_ref_rheum_appt!=. 
(807 missing values generated)

. replace ref_appt_cat=2 if time_ref_rheum_appt>21 & time_ref_rheum_appt<=42 & time_ref_rheum_appt!=. & ref_appt_cat
> ==.
(0 real changes made)

. replace ref_appt_cat=3 if time_ref_rheum_appt>42 & time_ref_rheum_appt!=. & ref_appt_cat==.
(1 real change made)

. lab define ref_appt_cat 1 "Within 3 weeks" 2 "Between 3-6 weeks" 3 "More than 6 weeks", modify

. lab val ref_appt_cat ref_appt_cat

. lab var ref_appt_cat "Time to rheumatology assessment"

. tab ref_appt_cat, missing

          Time to |
     rheumatology |
       assessment |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 6 weeks |          1        0.12        0.12
                . |        806       99.88      100.00
------------------+-----------------------------------
            Total |        807      100.00

. 
. forvalues i = 1/$max_year {
  2.     local start = $base_year + `i' - 1
  3.     local end = `start' + 1
  4.         gen ref_appt_cat_`start'=ref_appt_cat if appt_year==`i'
  5.     lab define ref_appt_cat_`start' 1 "Within 3 weeks" 2 "Between 3-6 weeks" 3 "More than 6 weeks", modify
  6.         lab val ref_appt_cat_`start' ref_appt_cat_`start'
  7.         lab var ref_appt_cat_`start' "Time to rheumatology assessment, Apr `start'-Mar `end'"
  8.         tab ref_appt_cat_`start', missing
  9. }
(807 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2016-Mar 2017 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |        807      100.00      100.00
------------------+-----------------------------------
            Total |        807      100.00
(807 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2017-Mar 2018 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |        807      100.00      100.00
------------------+-----------------------------------
            Total |        807      100.00
(807 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2018-Mar 2019 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |        807      100.00      100.00
------------------+-----------------------------------
            Total |        807      100.00
(807 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2019-Mar 2020 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |        807      100.00      100.00
------------------+-----------------------------------
            Total |        807      100.00
(807 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2020-Mar 2021 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |        807      100.00      100.00
------------------+-----------------------------------
            Total |        807      100.00
(807 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2021-Mar 2022 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |        807      100.00      100.00
------------------+-----------------------------------
            Total |        807      100.00
(807 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2022-Mar 2023 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |        807      100.00      100.00
------------------+-----------------------------------
            Total |        807      100.00
(806 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2023-Mar 2024 |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 6 weeks |          1        0.12        0.12
                . |        806       99.88      100.00
------------------+-----------------------------------
            Total |        807      100.00
(807 missing values generated)

          Time to |
     rheumatology |
  assessment, Apr |
    2024-Mar 2025 |      Freq.     Percent        Cum.
------------------+-----------------------------------
                . |        807      100.00      100.00
------------------+-----------------------------------
            Total |        807      100.00

. 
. gen ref_appt_3w=1 if time_ref_rheum_appt<=21 & time_ref_rheum_appt!=. 
(807 missing values generated)

. replace ref_appt_3w=2 if time_ref_rheum_appt>21 & time_ref_rheum_appt!=.
(1 real change made)

. lab define ref_appt_3w 1 "Within 3 weeks" 2 "More than 3 weeks", modify

. lab val ref_appt_3w ref_appt_3w

. lab var ref_appt_3w "Time to rheumatology assessment"

. tab ref_appt_3w, missing

          Time to |
     rheumatology |
       assessment |      Freq.     Percent        Cum.
------------------+-----------------------------------
More than 3 weeks |          1        0.12        0.12
                . |        806       99.88      100.00
------------------+-----------------------------------
            Total |        807      100.00

. 
. *Time to EIA code==================================================*/
. 
. **Time from last GP pre-code to EIA code (sensitivity analysis; includes those with no rheum ref and/or no rheum a
> ppt)
. gen time_gp_eia_code = (eia_code_date - last_gp_precode_date) if eia_code_date!=. & last_gp_precode_date!=. & eia_
> code_date>=last_gp_precode_date
(371 missing values generated)

. tabstat time_gp_eia_code, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_gp_ei~e |       436  168.1078       112        41       252
----------------------------------------------------------------

. 
. **Time from last GP to EIA diagnosis (combined - sensitivity analysis; includes those with no rheum appt)
. gen time_gp_eia_diag = time_gp_rheum_appt
(729 missing values generated)

. replace time_gp_eia_diag = time_gp_eia_code if time_gp_rheum_appt==. & time_gp_eia_code!=.
(361 real changes made)

. tabstat time_gp_eia_diag, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_gp_ei~g |       439  169.0068       113        44       245
----------------------------------------------------------------

. 
. **Time from rheum ref to EIA code (sensitivity analysis; includes those with no rheum appt)
. gen time_ref_rheum_eia = (eia_code_date - rheum_ref_gp_precode_date) if eia_code_date!=. & rheum_ref_gp_precode_da
> te!=. & rheum_ref_gp_precode_date<=eia_code_date  
(801 missing values generated)

. tabstat time_ref_rheum_eia, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_ref_r~a |         6  275.1667     242.5        97       476
----------------------------------------------------------------

. 
. **Time from rheum ref to EIA diagnosis (combined - sensitivity analysis; includes those with no rheum appt)
. gen time_ref_rheum_eia_comb = time_ref_rheum_appt
(806 missing values generated)

. replace time_ref_rheum_eia_comb = time_ref_rheum_eia if time_ref_rheum_appt==. & time_ref_rheum_eia!=.
(5 real changes made)

. tabstat time_ref_rheum_eia_comb, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_ref_r~b |         6       215       213        97       286
----------------------------------------------------------------

. 
. **Time from rheum appt to EIA code
. gen time_rheum_eia_code = (eia_code_date - rheum_appt_date) if eia_code_date!=. & rheum_appt_date!=. 
(658 missing values generated)

. tabstat time_rheum_eia_code, stats (n mean p50 p25 p75) 

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_rheum~e |       149  157.2282       145        57       262
----------------------------------------------------------------

. gen time_rheum2_eia_code = (eia_code_date - rheum_appt2_date) if eia_code_date!=. & rheum_appt2_date!=. 
(572 missing values generated)

. tabstat time_rheum2_eia_code, stats (n mean p50 p25 p75) 

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
t~2_eia_code |       235  79.67234        87        29       141
----------------------------------------------------------------

. gen time_rheum3_eia_code = (eia_code_date - rheum_appt3_date) if eia_code_date!=. & rheum_appt3_date!=. 
(433 missing values generated)

. tabstat time_rheum3_eia_code, stats (n mean p50 p25 p75) 

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
t~3_eia_code |       374  363.6096       373       186       548
----------------------------------------------------------------

. 
. *Time from rheum appt to first csDMARD prescriptions in primary care record=======================================
> ===============================*/
. 
. **Time to first csDMARD script not including high cost MTX prescriptions; prescription must be within 6 months of 
> first rheum appt for all csDMARDs below ==================*/
. gen time_to_csdmard=(csdmard_date-rheum_appt_date) if csdmard==1 & rheum_appt_date!=. & (csdmard_date<=(rheum_appt
> _date+183))
(748 missing values generated)

. tabstat time_to_csdmard, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_to_cs~d |        59  51.98305        40        -6       100
----------------------------------------------------------------

. 
. **All generate time to first csDMARD script not including high cost MTX prescriptions; with no time restriction ==
> ================*/
. gen time_to_csdmard_unr=(csdmard_date-rheum_appt_date) if csdmard==1 & rheum_appt_date!=.
(716 missing values generated)

. tabstat time_to_csdmard_unr, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_to_cs~r |        91  164.3846       102        31       295
----------------------------------------------------------------

. 
. /*
> **Time to first csDMARD script for RA patients (including high cost MTX prescriptions)
> gen time_to_csdmard_hcd=(csdmard_hcd_date-rheum_appt_date) if csdmard_hcd==1 & rheum_appt_date!=. & (csdmard_hcd_d
> ate<=rheum_appt_date+183)
> tabstat time_to_csdmard_hcd if ra_code==1, stats (n mean p50 p25 p75) 
> */
. 
. **csDMARD time categories (not including high cost MTX prescriptions)
. gen csdmard_time=1 if time_to_csdmard<=90 & time_to_csdmard!=. 
(764 missing values generated)

. replace csdmard_time=2 if time_to_csdmard>90 & time_to_csdmard<=183 & time_to_csdmard!=.
(16 real changes made)

. replace csdmard_time=3 if time_to_csdmard>183 | time_to_csdmard==.
(748 real changes made)

. lab define csdmard_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify

. lab val csdmard_time csdmard_time

. lab var csdmard_time "csDMARD in primary care, overall" 

. tab csdmard_time, missing

       csDMARD in primary care, |
                        overall |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |         43        5.33        5.33
                     3-6 months |         16        1.98        7.31
No prescription within 6 months |        748       92.69      100.00
--------------------------------+-----------------------------------
                          Total |        807      100.00

. tab csdmard_time if has_6m_follow_up==1, missing

       csDMARD in primary care, |
                        overall |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |         34       27.87       27.87
                     3-6 months |         15       12.30       40.16
No prescription within 6 months |         73       59.84      100.00
--------------------------------+-----------------------------------
                          Total |        122      100.00

. tab csdmard_time if ra_code==1 & has_6m_follow_up==1, missing 

       csDMARD in primary care, |
                        overall |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |         28       29.17       29.17
                     3-6 months |         13       13.54       42.71
No prescription within 6 months |         55       57.29      100.00
--------------------------------+-----------------------------------
                          Total |         96      100.00

. tab csdmard_time if psa_code==1 & has_6m_follow_up==1, missing

       csDMARD in primary care, |
                        overall |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          3       20.00       20.00
                     3-6 months |          1        6.67       26.67
No prescription within 6 months |         11       73.33      100.00
--------------------------------+-----------------------------------
                          Total |         15      100.00

. tab csdmard_time if anksp_code==1 & has_6m_follow_up==1, missing

       csDMARD in primary care, |
                        overall |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          3       30.00       30.00
No prescription within 6 months |          7       70.00      100.00
--------------------------------+-----------------------------------
                          Total |         10      100.00

. tab csdmard_time if undiff_code==1 & has_6m_follow_up==1, missing

       csDMARD in primary care, |
                        overall |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                     3-6 months |          1      100.00      100.00
--------------------------------+-----------------------------------
                          Total |          1      100.00

. 
. forvalues i = 1/$max_year {
  2.     local start = $base_year + `i' - 1
  3.     local end = `start' + 1
  4.         gen csdmard_time_`start'=csdmard_time if appt_year==`i'
  5.         recode csdmard_time_`start' .=4
  6.     lab define csdmard_time_`start' 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months" 4 "O
> utside `start'/`end'", modify
  7.         lab val csdmard_time_`start' csdmard_time_`start'
  8.         lab var csdmard_time_`start' "csDMARD in primary care, Apr `start'-Mar `end'"
  9.         tab csdmard_time_`start' if has_6m_follow_up==1, missing
 10. }
(805 missing values generated)
(805 changes made to csdmard_time_2016)

   csDMARD in primary care, Apr |
                  2016-Mar 2017 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          2        1.64        1.64
              Outside 2016/2017 |        120       98.36      100.00
--------------------------------+-----------------------------------
                          Total |        122      100.00
(804 missing values generated)
(804 changes made to csdmard_time_2017)

   csDMARD in primary care, Apr |
                  2017-Mar 2018 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          2        1.64        1.64
No prescription within 6 months |          1        0.82        2.46
              Outside 2017/2018 |        119       97.54      100.00
--------------------------------+-----------------------------------
                          Total |        122      100.00
(802 missing values generated)
(802 changes made to csdmard_time_2018)

   csDMARD in primary care, Apr |
                  2018-Mar 2019 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          3        2.46        2.46
No prescription within 6 months |          2        1.64        4.10
              Outside 2018/2019 |        117       95.90      100.00
--------------------------------+-----------------------------------
                          Total |        122      100.00
(804 missing values generated)
(804 changes made to csdmard_time_2019)

   csDMARD in primary care, Apr |
                  2019-Mar 2020 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          2        1.64        1.64
No prescription within 6 months |          1        0.82        2.46
              Outside 2019/2020 |        119       97.54      100.00
--------------------------------+-----------------------------------
                          Total |        122      100.00
(804 missing values generated)
(804 changes made to csdmard_time_2020)

   csDMARD in primary care, Apr |
                  2020-Mar 2021 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          2        1.64        1.64
No prescription within 6 months |          1        0.82        2.46
              Outside 2020/2021 |        119       97.54      100.00
--------------------------------+-----------------------------------
                          Total |        122      100.00
(804 missing values generated)
(804 changes made to csdmard_time_2021)

   csDMARD in primary care, Apr |
                  2021-Mar 2022 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          1        0.82        0.82
No prescription within 6 months |          2        1.64        2.46
              Outside 2021/2022 |        119       97.54      100.00
--------------------------------+-----------------------------------
                          Total |        122      100.00
(787 missing values generated)
(787 changes made to csdmard_time_2022)

   csDMARD in primary care, Apr |
                  2022-Mar 2023 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          2        1.64        1.64
                     3-6 months |          3        2.46        4.10
No prescription within 6 months |         15       12.30       16.39
              Outside 2022/2023 |        102       83.61      100.00
--------------------------------+-----------------------------------
                          Total |        122      100.00
(756 missing values generated)
(756 changes made to csdmard_time_2023)

   csDMARD in primary care, Apr |
                  2023-Mar 2024 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |         15       12.30       12.30
                     3-6 months |          8        6.56       18.85
No prescription within 6 months |         28       22.95       41.80
              Outside 2023/2024 |         71       58.20      100.00
--------------------------------+-----------------------------------
                          Total |        122      100.00
(750 missing values generated)
(750 changes made to csdmard_time_2024)

   csDMARD in primary care, Apr |
                  2024-Mar 2025 |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          5        4.10        4.10
                     3-6 months |          4        3.28        7.38
No prescription within 6 months |         22       18.03       25.41
              Outside 2024/2025 |         91       74.59      100.00
--------------------------------+-----------------------------------
                          Total |        122      100.00

. 
. **csDMARD time categories - binary 6 months
. gen csdmard_6m=1 if time_to_csdmard<=183 & time_to_csdmard!=. 
(748 missing values generated)

. replace csdmard_6m=0 if time_to_csdmard>183 | time_to_csdmard==.
(748 real changes made)

. lab define csdmard_6m 1 "Yes" 0 "No", modify

. lab val csdmard_6m csdmard_6m

. lab var csdmard_6m "csDMARD in primary care within 6 months" 

. tab csdmard_6m, missing 

 csDMARD in |
    primary |
care within |
   6 months |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        748       92.69       92.69
        Yes |         59        7.31      100.00
------------+-----------------------------------
      Total |        807      100.00

. 
. /*
> **csDMARD time categories (including high cost MTX prescriptions)
> gen csdmard_hcd_time=1 if time_to_csdmard_hcd<=90 & time_to_csdmard_hcd!=. 
> replace csdmard_hcd_time=2 if time_to_csdmard_hcd>90 & time_to_csdmard_hcd<=183 & time_to_csdmard_hcd!=.
> replace csdmard_hcd_time=3 if time_to_csdmard_hcd>183 | time_to_csdmard_hcd==.
> lab define csdmard_hcd_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify
> lab val csdmard_hcd_time csdmard_hcd_time
> lab var csdmard_hcd_time "csDMARD in primary care" 
> tab csdmard_hcd_time if ra_code==1, missing 
> tab csdmard_hcd_time if psa_code==1, missing
> tab csdmard_hcd_time if anksp_code==1, missing 
> tab csdmard_hcd_time if undiff_code==1, missing
> */
. 
. **What was first csDMARD in GP record (not including high cost MTX prescriptions) - with time restriction - may ne
> ed to remove leflunomide (for OpenSAFELY report) due to small counts at more granular time periods
. gen first_csD=""
(807 missing values generated)

. foreach var of varlist hydroxychloroquine_date mtx_date sulfasalazine_date leflunomide_date {
  2.         replace first_csD="`var'" if csdmard_date==`var' & csdmard_date!=. & (`var'<=(rheum_appt_date+183)) & t
> ime_to_csdmard!=.
  3.         }
variable first_csD was str1 now str23
(8 real changes made)
(38 real changes made)
(8 real changes made)
(5 real changes made)

. gen first_csDMARD = substr(first_csD, 1, length(first_csD) - 5) if first_csD!="" 
(748 missing values generated)

. drop first_csD

. replace first_csDMARD="Methotrexate" if first_csDMARD=="mtx"
(38 real changes made)

. replace first_csDMARD="Sulfasalazine" if first_csDMARD=="sulfasalazine"
(8 real changes made)

. replace first_csDMARD="Hydroxychloroquine" if first_csDMARD=="hydroxychloroquine" 
(8 real changes made)

. replace first_csDMARD="Leflunomide" if first_csDMARD=="leflunomide" 
(5 real changes made)

. tab first_csDMARD if ra_code==1 //for RA patients

     first_csDMARD |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |          5        9.80        9.80
       Leflunomide |          5        9.80       19.61
      Methotrexate |         34       66.67       86.27
     Sulfasalazine |          7       13.73      100.00
-------------------+-----------------------------------
             Total |         51      100.00

. tab first_csDMARD if psa_code==1 //for PsA patients

     first_csDMARD |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |          1       25.00       25.00
      Methotrexate |          2       50.00       75.00
     Sulfasalazine |          1       25.00      100.00
-------------------+-----------------------------------
             Total |          4      100.00

. tab first_csDMARD if anksp_code==1 //for axSpA patients

     first_csDMARD |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |          2       66.67       66.67
      Methotrexate |          1       33.33      100.00
-------------------+-----------------------------------
             Total |          3      100.00

. tab first_csDMARD if undiff_code==1 //for Undiff IA patients

     first_csDMARD |      Freq.     Percent        Cum.
-------------------+-----------------------------------
      Methotrexate |          1      100.00      100.00
-------------------+-----------------------------------
             Total |          1      100.00

. 
. **What was first csDMARD in GP record (not including high cost MTX prescriptions) - without time restriction
. gen first_csD_unr=""
(807 missing values generated)

. foreach var of varlist hydroxychloroquine_date mtx_date sulfasalazine_date leflunomide_date {
  2.         replace first_csD_unr="`var'" if csdmard_date==`var' & csdmard_date!=.
  3.         }
variable first_csD_unr was str1 now str23
(112 real changes made)
(428 real changes made)
(61 real changes made)
(51 real changes made)

. gen first_csDMARD_unr = substr(first_csD_unr, 1, length(first_csD_unr) - 5) if first_csD_unr!="" 
(156 missing values generated)

. drop first_csD_unr

. replace first_csDMARD_unr="Methotrexate" if first_csDMARD_unr=="mtx"
(428 real changes made)

. replace first_csDMARD_unr="Sulfasalazine" if first_csDMARD_unr=="sulfasalazine"
(61 real changes made)

. replace first_csDMARD_unr="Hydroxychloroquine" if first_csDMARD_unr=="hydroxychloroquine" 
(111 real changes made)

. replace first_csDMARD_unr="Leflunomide" if first_csDMARD_unr=="leflunomide" 
(51 real changes made)

. tab first_csDMARD_unr if ra_code==1 //for RA patients

 first_csDMARD_unr |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |         86       16.07       16.07
       Leflunomide |         41        7.66       23.74
      Methotrexate |        357       66.73       90.47
     Sulfasalazine |         51        9.53      100.00
-------------------+-----------------------------------
             Total |        535      100.00

. tab first_csDMARD_unr if psa_code==1 //for PsA patients

 first_csDMARD_unr |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |         12       23.08       23.08
       Leflunomide |          5        9.62       32.69
      Methotrexate |         30       57.69       90.38
     Sulfasalazine |          5        9.62      100.00
-------------------+-----------------------------------
             Total |         52      100.00

. tab first_csDMARD_unr if anksp_code==1 //for axSpA patients

 first_csDMARD_unr |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |         10       20.41       20.41
       Leflunomide |          5       10.20       30.61
      Methotrexate |         32       65.31       95.92
     Sulfasalazine |          2        4.08      100.00
-------------------+-----------------------------------
             Total |         49      100.00

. tab first_csDMARD_unr if undiff_code==1 //for Undiff IA patients

 first_csDMARD_unr |      Freq.     Percent        Cum.
-------------------+-----------------------------------
Hydroxychloroquine |          3       20.00       20.00
      Methotrexate |          9       60.00       80.00
     Sulfasalazine |          3       20.00      100.00
-------------------+-----------------------------------
             Total |         15      100.00

. 
. /*
> **What was first csDMARD in GP record (including high cost MTX prescriptions)
> gen first_csD_hcd=""
> foreach var of varlist hydroxychloroquine_date methotrexate_date methotrexate_hcd_date sulfasalazine_date leflunom
> ide_date {
>         replace first_csD_hcd="`var'" if csdmard_hcd_date==`var' & csdmard_hcd_date!=. & (csdmard_hcd_date<=rheum_
> appt_date+183) & time_to_csdmard_hcd!=.
>         }
> gen first_csDMARD_hcd = substr(first_csD_hcd, 1, length(first_csD_hcd) - 5) if first_csD_hcd!=""
> drop first_csD_hcd
> tab first_csDMARD_hcd if ra_code==1 //for RA patients
> tab first_csDMARD_hcd if psa_code==1 //for PsA patients
> tab first_csDMARD_hcd if anksp_code==1 //for axSpA patients
> tab first_csDMARD_hcd if undiff_code==1 //for Undiff IA patients
> */
.  
. /*
> **Methotrexate use (including high cost MTX prescriptions)
> gen mtx_hcd=1 if methotrexate==1 | methotrexate_inj==1 | methotrexate_hcd==1
> recode mtx_hcd .=0 
> */
. 
. /*
> **Date of first methotrexate script (including high cost MTX prescriptions)
> gen mtx_hcd_date=min(methotrexate_date, methotrexate_inj_date, methotrexate_hcd_date)
> format %td mtx_hcd_date
> */
. 
. **Methotrexate use (not including high cost MTX prescriptions); Nb. this is just a check; need time-to-MTX instead
>  (below)
. gen mtx_6m = 1 if mtx==1 & rheum_appt==1 & (mtx_date<=rheum_appt_date+183) 
(765 missing values generated)

. recode mtx_6m .=0
(765 changes made to mtx_6m)

. gen mtx_12m = 1 if mtx==1 & rheum_appt==1 & (mtx_date<=rheum_appt_date+365)
(741 missing values generated)

. recode mtx_12m .=0
(741 changes made to mtx_12m)

. 
. tab mtx if ra_code==1 //for RA patients

Methotrexat |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        172       26.02       26.02
          1 |        489       73.98      100.00
------------+-----------------------------------
      Total |        661      100.00

. tab mtx_6m if ra_code==1 //with 6-month limit

     mtx_6m |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        623       94.25       94.25
          1 |         38        5.75      100.00
------------+-----------------------------------
      Total |        661      100.00

. tab mtx_12m if ra_code==1 //with 12-month limit

    mtx_12m |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        605       91.53       91.53
          1 |         56        8.47      100.00
------------+-----------------------------------
      Total |        661      100.00

. tab mtx if psa_code==1 //for PsA patients

Methotrexat |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         23       33.82       33.82
          1 |         45       66.18      100.00
------------+-----------------------------------
      Total |         68      100.00

. tab mtx_6m if psa_code==1 //with 6-month limit

     mtx_6m |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         66       97.06       97.06
          1 |          2        2.94      100.00
------------+-----------------------------------
      Total |         68      100.00

. tab mtx_12m if psa_code==1 //with 12-month limit

    mtx_12m |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         62       91.18       91.18
          1 |          6        8.82      100.00
------------+-----------------------------------
      Total |         68      100.00

. tab mtx if undiff_code==1 //for undiff IA patients

Methotrexat |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |          4       21.05       21.05
          1 |         15       78.95      100.00
------------+-----------------------------------
      Total |         19      100.00

. tab mtx_6m if undiff_code==1 //with 6-month limit

     mtx_6m |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         18       94.74       94.74
          1 |          1        5.26      100.00
------------+-----------------------------------
      Total |         19      100.00

. tab mtx_12m if undiff_code==1 //with 12-month limit

    mtx_12m |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         18       94.74       94.74
          1 |          1        5.26      100.00
------------+-----------------------------------
      Total |         19      100.00

. 
. /*
> **Methotrexate use (including high cost MTX prescriptions)
> tab mtx_hcd if ra_code==1 //for RA patients
> tab mtx_hcd if ra_code==1 & (mtx_hcd_date<=rheum_appt_date+183) //with 6-month limit
> tab mtx_hcd if ra_code==1 & (mtx_hcd_date<=rheum_appt_date+365) //with 12-month limit
> tab mtx_hcd if psa_code==1 //for PsA patients
> tab mtx_hcd if psa_code==1 & (mtx_hcd_date<=rheum_appt_date+183) //with 6-month limit
> tab mtx_hcd if psa_code==1 & (mtx_hcd_date<=rheum_appt_date+365) //with 12-month limit
> tab mtx_hcd if undiff_code==1 //for undiff IA patients
> tab mtx_hcd if undiff_code==1 & (mtx_hcd_date<=rheum_appt_date+183) //with 6-month limit
> tab mtx_hcd if undiff_code==1 & (mtx_hcd_date<=rheum_appt_date+365) //with 12-month limit
> */
. 
. **Check if medication issued >once
. gen mtx_shared=1 if mtx==1 & (methotrexate_oral_count>1 | methotrexate_inj_count>1)
(401 missing values generated)

. recode mtx_shared .=0
(401 changes made to mtx_shared)

. tab mtx_shared

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        401       49.69       49.69
          1 |        406       50.31      100.00
------------+-----------------------------------
      Total |        807      100.00

. 
. **Methotrexate use (shared care)
. tab mtx_shared if ra_code==1 //for RA patients; Nb. this is just a check; need time-to-MTX instead (below)

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        326       49.32       49.32
          1 |        335       50.68      100.00
------------+-----------------------------------
      Total |        661      100.00

. tab mtx_shared if ra_code==1 & (mtx_date<=rheum_appt_date+183) //with 6-month limit

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        255       44.19       44.19
          1 |        322       55.81      100.00
------------+-----------------------------------
      Total |        577      100.00

. tab mtx_shared if psa_code==1 //for PsA patients

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         40       58.82       58.82
          1 |         28       41.18      100.00
------------+-----------------------------------
      Total |         68      100.00

. tab mtx_shared if psa_code==1 & (mtx_date<=rheum_appt_date+183) //with 6-month limit

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         29       53.70       53.70
          1 |         25       46.30      100.00
------------+-----------------------------------
      Total |         54      100.00

. tab mtx_shared if undiff_code==1 //for undiff IA patients

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |          8       42.11       42.11
          1 |         11       57.89      100.00
------------+-----------------------------------
      Total |         19      100.00

. tab mtx_shared if undiff_code==1 & (mtx_date<=rheum_appt_date+183) //with 6-month limit

 mtx_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |          8       42.11       42.11
          1 |         11       57.89      100.00
------------+-----------------------------------
      Total |         19      100.00

. 
. **Check medication issue number
. gen mtx_issue=0 if mtx==1 & (methotrexate_oral_count==0 | methotrexate_inj_count==0)
(543 missing values generated)

. replace mtx_issue=1 if mtx==1 & (methotrexate_oral_count==1 | methotrexate_inj_count==1)
(347 real changes made)

. replace mtx_issue=2 if mtx==1 & (methotrexate_oral_count>1 | methotrexate_inj_count>1)
(406 real changes made)

. tab mtx_issue

  mtx_issue |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        191       31.99       31.99
          2 |        406       68.01      100.00
------------+-----------------------------------
      Total |        597      100.00

. 
. **Time to first methotrexate script for RA patients (not including high cost MTX prescriptions) - with time restri
> ction
. gen time_to_mtx=(mtx_date-rheum_appt_date) if mtx==1 & rheum_appt_date!=. & (mtx_date<=rheum_appt_date+183)
(765 missing values generated)

. tabstat time_to_mtx if ra_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_mtx |        38  55.76316      50.5        -6       100
----------------------------------------------------------------

. 
. /*
> **Time to first methotrexate script for RA patients (including high cost MTX prescriptions)
> gen time_to_mtx_hcd=(mtx_hcd_date-rheum_appt_date) if mtx_hcd==1 & rheum_appt_date!=. & (mtx_hcd_date<=rheum_appt_
> date+183)
> tabstat time_to_mtx_hcd if ra_code==1, stats (n mean p50 p25 p75)
> */
. 
. **Time to first methotrexate script for PsA patients (not including high cost MTX prescriptions)
. tabstat time_to_mtx if psa_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_mtx |         2        51        51        23        79
----------------------------------------------------------------

. 
. /*
> **Time to first methotrexate script for PsA patients (including high cost MTX prescriptions)
> tabstat time_to_mtx_hcd if psa_code==1, stats (n mean p50 p25 p75)
> */
. 
. **Time to first methotrexate script for Undiff IA patients (not including high cost MTX prescriptions)
. tabstat time_to_mtx if undiff_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_mtx |         1       176       176       176       176
----------------------------------------------------------------

. 
. **Methotrexate time categories (not including high-cost MTX) - those with prescription date after 6 months (i.e. m
> issing) are still counted
. gen mtx_time=1 if time_to_mtx<=90 & time_to_mtx!=. 
(777 missing values generated)

. replace mtx_time=2 if time_to_mtx>90 & time_to_mtx<=183 & time_to_mtx!=.
(12 real changes made)

. replace mtx_time=3 if time_to_mtx>183 | time_to_mtx==.
(765 real changes made)

. lab define mtx_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify

. lab val mtx_time mtx_time

. lab var mtx_time "Methotrexate in primary care" 

. tab mtx_time if ra_code==1, missing 

   Methotrexate in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |         27        4.08        4.08
                     3-6 months |         11        1.66        5.75
No prescription within 6 months |        623       94.25      100.00
--------------------------------+-----------------------------------
                          Total |        661      100.00

. tab mtx_time if psa_code==1, missing

   Methotrexate in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          2        2.94        2.94
No prescription within 6 months |         66       97.06      100.00
--------------------------------+-----------------------------------
                          Total |         68      100.00

. tab mtx_time if undiff_code==1, missing 

   Methotrexate in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                     3-6 months |          1        5.26        5.26
No prescription within 6 months |         18       94.74      100.00
--------------------------------+-----------------------------------
                          Total |         19      100.00

. 
. /*
> **Methotrexate time categories for RA patients (including high-cost MTX)
> gen mtx_hcd_time=1 if time_to_mtx_hcd<=90 & time_to_mtx_hcd!=. 
> replace mtx_hcd_time=2 if time_to_mtx_hcd>90 & time_to_mtx_hcd<=183 & time_to_mtx_hcd!=.
> replace mtx_hcd_time=3 if time_to_mtx_hcd>183 | time_to_mtx_hcd==.
> lab define mtx_hcd_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify
> lab val mtx_hcd_time mtx_hcd_time
> lab var mtx_hcd_time "Methotrexate in primary care" 
> tab mtx_hcd_time if ra_code==1, missing 
> tab mtx_hcd_time if psa_code==1, missing
> tab mtx_hcd_time if undiff_code==1, missing 
> */
. 
. **Sulfasalazine use
. gen ssz=1 if sulfasalazine==1
(551 missing values generated)

. recode ssz .=0
(551 changes made to ssz)

. gen ssz_6m = 1 if sulfasalazine==1 & rheum_appt==1 & (sulfasalazine_date<=rheum_appt_date+183) 
(794 missing values generated)

. recode ssz_6m .=0
(794 changes made to ssz_6m)

. gen ssz_12m = 1 if sulfasalazine==1 & rheum_appt==1 & (sulfasalazine_date<=rheum_appt_date+365)
(787 missing values generated)

. recode ssz_12m .=0
(787 changes made to ssz_12m)

. 
. **Time to first sulfasalazine script for RA patients
. gen time_to_ssz=(sulfasalazine_date-rheum_appt_date) if sulfasalazine_date!=. & rheum_appt_date!=. & (sulfasalazin
> e_date<=rheum_appt_date+183)
(794 missing values generated)

. tabstat time_to_ssz if ra_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_ssz |        11  60.45455        37        31       100
----------------------------------------------------------------

. tabstat time_to_ssz if psa_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_ssz |         2       124       124        98       150
----------------------------------------------------------------

. 
. **Sulfasalazine time categories  
. gen ssz_time=1 if time_to_ssz<=90 & time_to_ssz!=. 
(799 missing values generated)

. replace ssz_time=2 if time_to_ssz>90 & time_to_ssz<=183 & time_to_ssz!=.
(5 real changes made)

. replace ssz_time=3 if time_to_ssz>183 | time_to_ssz==.
(794 real changes made)

. lab define ssz_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify

. lab val ssz_time ssz_time

. lab var ssz_time "Sulfasalazine in primary care" 

. tab ssz_time if ra_code==1, missing 

  Sulfasalazine in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          8        1.21        1.21
                     3-6 months |          3        0.45        1.66
No prescription within 6 months |        650       98.34      100.00
--------------------------------+-----------------------------------
                          Total |        661      100.00

. tab ssz_time if psa_code==1, missing

  Sulfasalazine in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                     3-6 months |          2        2.94        2.94
No prescription within 6 months |         66       97.06      100.00
--------------------------------+-----------------------------------
                          Total |         68      100.00

. tab ssz_time if undiff_code==1, missing 

  Sulfasalazine in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
No prescription within 6 months |         19      100.00      100.00
--------------------------------+-----------------------------------
                          Total |         19      100.00

. 
. **Check if medication issued >once
. gen ssz_shared=1 if ssz==1 & sulfasalazine_count>1
(749 missing values generated)

. recode ssz_shared .=0
(749 changes made to ssz_shared)

. tab ssz_shared

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        749       92.81       92.81
          1 |         58        7.19      100.00
------------+-----------------------------------
      Total |        807      100.00

. 
. **sulfasalazine use (shared care)
. tab ssz_shared if ra_code==1 

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        614       92.89       92.89
          1 |         47        7.11      100.00
------------+-----------------------------------
      Total |        661      100.00

. tab ssz_shared if ra_code==1 & (sulfasalazine_date<=rheum_appt_date+183)

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        504       91.64       91.64
          1 |         46        8.36      100.00
------------+-----------------------------------
      Total |        550      100.00

. tab ssz_shared if psa_code==1 

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         62       91.18       91.18
          1 |          6        8.82      100.00
------------+-----------------------------------
      Total |         68      100.00

. tab ssz_shared if psa_code==1 & (sulfasalazine_date<=rheum_appt_date+183) 

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         49       90.74       90.74
          1 |          5        9.26      100.00
------------+-----------------------------------
      Total |         54      100.00

. tab ssz_shared if undiff_code==1

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         19      100.00      100.00
------------+-----------------------------------
      Total |         19      100.00

. tab ssz_shared if undiff_code==1 & (sulfasalazine_date<=rheum_appt_date+183)

 ssz_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         18      100.00      100.00
------------+-----------------------------------
      Total |         18      100.00

. 
. **Check medication issue number
. gen ssz_issue=0 if ssz==1 & sulfasalazine_count==0 
(807 missing values generated)

. replace ssz_issue=1 if ssz==1 & sulfasalazine_count==1 
(198 real changes made)

. replace ssz_issue=2 if ssz==1 & sulfasalazine_count>1
(58 real changes made)

. tab ssz_issue

  ssz_issue |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        198       77.34       77.34
          2 |         58       22.66      100.00
------------+-----------------------------------
      Total |        256      100.00

. 
. **Hydroxychloroquine use
. gen hcq=1 if hydroxychloroquine==1
(468 missing values generated)

. recode hcq .=0
(468 changes made to hcq)

. gen hcq_6m = 1 if hydroxychloroquine==1 & rheum_appt==1 & (hydroxychloroquine_date<=rheum_appt_date+183) 
(790 missing values generated)

. recode hcq_6m .=0
(790 changes made to hcq_6m)

. gen hcq_12m = 1 if hydroxychloroquine==1 & rheum_appt==1 & (hydroxychloroquine_date<=rheum_appt_date+365)
(780 missing values generated)

. recode hcq_12m .=0 
(780 changes made to hcq_12m)

. 
. **Time to first hydroxychloroquine script for RA patients
. gen time_to_hcq=(hydroxychloroquine_date-rheum_appt_date) if hydroxychloroquine_date!=. & rheum_appt_date!=. & (hy
> droxychloroquine_date<=rheum_appt_date+183)
(790 missing values generated)

. tabstat time_to_hcq if ra_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_hcq |        14  77.64286        77        15       133
----------------------------------------------------------------

. tabstat time_to_hcq if psa_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_hcq |         1       -24       -24       -24       -24
----------------------------------------------------------------

. 
. **Hydroxychloroquine time categories  
. gen hcq_time=1 if time_to_hcq<=90 & time_to_hcq!=. 
(796 missing values generated)

. replace hcq_time=2 if time_to_hcq>90 & time_to_hcq<=183 & time_to_hcq!=.
(6 real changes made)

. replace hcq_time=3 if time_to_hcq>183 | time_to_hcq==.
(790 real changes made)

. lab define hcq_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify

. lab val hcq_time hcq_time

. lab var hcq_time "Hydroxychloroquine in primary care" 

. tab hcq_time if ra_code==1, missing 

  Hydroxychloroquine in primary |
                           care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          8        1.21        1.21
                     3-6 months |          6        0.91        2.12
No prescription within 6 months |        647       97.88      100.00
--------------------------------+-----------------------------------
                          Total |        661      100.00

. tab hcq_time if psa_code==1, missing

  Hydroxychloroquine in primary |
                           care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          1        1.47        1.47
No prescription within 6 months |         67       98.53      100.00
--------------------------------+-----------------------------------
                          Total |         68      100.00

. tab hcq_time if undiff_code==1, missing 

  Hydroxychloroquine in primary |
                           care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
No prescription within 6 months |         19      100.00      100.00
--------------------------------+-----------------------------------
                          Total |         19      100.00

. 
. **Check if medication issued >once
. gen hcq_shared=1 if hcq==1 & hydroxychloroquine_count>1
(692 missing values generated)

. recode hcq_shared .=0
(692 changes made to hcq_shared)

. tab hcq_shared

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        692       85.75       85.75
          1 |        115       14.25      100.00
------------+-----------------------------------
      Total |        807      100.00

. 
. **hydroxychloroquine use (shared care)
. tab hcq_shared if ra_code==1 

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        571       86.38       86.38
          1 |         90       13.62      100.00
------------+-----------------------------------
      Total |        661      100.00

. tab hcq_shared if ra_code==1 & (hydroxychloroquine_date<=rheum_appt_date+183)

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        466       84.27       84.27
          1 |         87       15.73      100.00
------------+-----------------------------------
      Total |        553      100.00

. tab hcq_shared if psa_code==1 

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         60       88.24       88.24
          1 |          8       11.76      100.00
------------+-----------------------------------
      Total |         68      100.00

. tab hcq_shared if psa_code==1 & (hydroxychloroquine_date<=rheum_appt_date+183) 

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         45       84.91       84.91
          1 |          8       15.09      100.00
------------+-----------------------------------
      Total |         53      100.00

. tab hcq_shared if undiff_code==1

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         15       78.95       78.95
          1 |          4       21.05      100.00
------------+-----------------------------------
      Total |         19      100.00

. tab hcq_shared if undiff_code==1 & (hydroxychloroquine_date<=rheum_appt_date+183)

 hcq_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         14       77.78       77.78
          1 |          4       22.22      100.00
------------+-----------------------------------
      Total |         18      100.00

. 
. **Check medication issue number
. gen hcq_issue=0 if hcq==1 & hydroxychloroquine_count==0 
(807 missing values generated)

. replace hcq_issue=1 if hcq==1 & hydroxychloroquine_count==1 
(224 real changes made)

. replace hcq_issue=2 if hcq==1 & hydroxychloroquine_count>1
(115 real changes made)

. tab hcq_issue

  hcq_issue |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        224       66.08       66.08
          2 |        115       33.92      100.00
------------+-----------------------------------
      Total |        339      100.00

. 
. **Leflunomide use
. gen lef=1 if leflunomide==1
(605 missing values generated)

. recode lef .=0 
(605 changes made to lef)

. gen lef_6m = 1 if leflunomide==1 & rheum_appt==1 & (leflunomide_date<=rheum_appt_date+183) 
(801 missing values generated)

. recode lef_6m .=0
(801 changes made to lef_6m)

. gen lef_12m = 1 if leflunomide==1 & rheum_appt==1 & (leflunomide_date<=rheum_appt_date+365)
(797 missing values generated)

. recode lef_12m .=0 
(797 changes made to lef_12m)

. 
. **Time to first leflunomide script for RA patients
. gen time_to_lef=(leflunomide_date-rheum_appt_date) if leflunomide_date!=. & rheum_appt_date!=. & (leflunomide_date
> <=rheum_appt_date+183)
(801 missing values generated)

. tabstat time_to_lef if ra_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_lef |         5      56.2        66        45       102
----------------------------------------------------------------

. tabstat time_to_lef if psa_code==1, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_lef |         0         .         .         .         .
----------------------------------------------------------------

. 
. **Leflunomide time categories  
. gen lef_time=1 if time_to_lef<=90 & time_to_lef!=. 
(804 missing values generated)

. replace lef_time=2 if time_to_lef>90 & time_to_lef<=183 & time_to_lef!=.
(3 real changes made)

. replace lef_time=3 if time_to_lef>183 | time_to_lef==.
(801 real changes made)

. lab define lef_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription within 6 months", modify

. lab val lef_time lef_time

. lab var lef_time "Leflunomide in primary care" 

. tab lef_time if ra_code==1, missing 

    Leflunomide in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
                Within 3 months |          3        0.45        0.45
                     3-6 months |          2        0.30        0.76
No prescription within 6 months |        656       99.24      100.00
--------------------------------+-----------------------------------
                          Total |        661      100.00

. tab lef_time if psa_code==1, missing

    Leflunomide in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
No prescription within 6 months |         68      100.00      100.00
--------------------------------+-----------------------------------
                          Total |         68      100.00

. tab lef_time if undiff_code==1, missing 

    Leflunomide in primary care |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
No prescription within 6 months |         19      100.00      100.00
--------------------------------+-----------------------------------
                          Total |         19      100.00

. 
. **Check if medication issued >once
. gen lef_shared=1 if lef==1 & leflunomide_count>1
(756 missing values generated)

. recode lef_shared .=0
(756 changes made to lef_shared)

. tab lef_shared

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        756       93.68       93.68
          1 |         51        6.32      100.00
------------+-----------------------------------
      Total |        807      100.00

. 
. **leflunomide use (shared care)
. tab lef_shared if ra_code==1 

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        618       93.49       93.49
          1 |         43        6.51      100.00
------------+-----------------------------------
      Total |        661      100.00

. tab lef_shared if ra_code==1 & (leflunomide_date<=rheum_appt_date+183)

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        504       92.65       92.65
          1 |         40        7.35      100.00
------------+-----------------------------------
      Total |        544      100.00

. tab lef_shared if psa_code==1 

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         65       95.59       95.59
          1 |          3        4.41      100.00
------------+-----------------------------------
      Total |         68      100.00

. tab lef_shared if psa_code==1 & (leflunomide_date<=rheum_appt_date+183) 

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         50       96.15       96.15
          1 |          2        3.85      100.00
------------+-----------------------------------
      Total |         52      100.00

. tab lef_shared if undiff_code==1

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         18       94.74       94.74
          1 |          1        5.26      100.00
------------+-----------------------------------
      Total |         19      100.00

. tab lef_shared if undiff_code==1 & (leflunomide_date<=rheum_appt_date+183)

 lef_shared |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         17       94.44       94.44
          1 |          1        5.56      100.00
------------+-----------------------------------
      Total |         18      100.00

. 
. **Check medication issue number
. gen lef_issue=0 if lef==1 & leflunomide_count==0 
(807 missing values generated)

. replace lef_issue=1 if lef==1 & leflunomide_count==1 
(151 real changes made)

. replace lef_issue=2 if lef==1 & leflunomide_count>1
(51 real changes made)

. tab lef_issue

  lef_issue |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        151       74.75       74.75
          2 |         51       25.25      100.00
------------+-----------------------------------
      Total |        202      100.00

. 
. **For all csDMARDs, check if issued more than once 
. gen csdmard_shared=1 if lef_shared==1 | mtx_shared==1 | hcq_shared==1 | ssz_shared==1 
(363 missing values generated)

. recode csdmard_shared .=0
(363 changes made to csdmard_shared)

. tab csdmard_shared

csdmard_sha |
        red |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        363       44.98       44.98
          1 |        444       55.02      100.00
------------+-----------------------------------
      Total |        807      100.00

. tab csdmard //for comparison

    csdmard |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        156       19.33       19.33
          1 |        651       80.67      100.00
------------+-----------------------------------
      Total |        807      100.00

. 
. **Generate number of csDMARDs by time-points
. gen csdmard_num_6m =.
(807 missing values generated)

. replace csdmard_num_6m = 0 if (mtx_6m + ssz_6m + hcq_6m + lef_6m ==0)
(748 real changes made)

. replace csdmard_num_6m = 1 if (mtx_6m + ssz_6m + hcq_6m + lef_6m ==1)
(44 real changes made)

. replace csdmard_num_6m = 2 if (mtx_6m + ssz_6m + hcq_6m + lef_6m ==2)
(11 real changes made)

. replace csdmard_num_6m = 3 if (mtx_6m + ssz_6m + hcq_6m + lef_6m >2)
(4 real changes made)

. lab var csdmard_num_6m "Number of csDMARDs by 6 months"

. lab define csdmard_num_6m 0 "0" 1 "1" 2 "2" 3 "3 or more", modify

. lab val csdmard_num_6m csdmard_num_6m

. tab csdmard_num_6m, missing

  Number of |
csDMARDs by |
   6 months |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        748       92.69       92.69
          1 |         44        5.45       98.14
          2 |         11        1.36       99.50
  3 or more |          4        0.50      100.00
------------+-----------------------------------
      Total |        807      100.00

. 
. gen csdmard_num_12m =.
(807 missing values generated)

. replace csdmard_num_12m = 0 if (mtx_12m + ssz_12m + hcq_12m + lef_12m ==0)
(729 real changes made)

. replace csdmard_num_12m = 1 if (mtx_12m + ssz_12m + hcq_12m + lef_12m ==1)
(43 real changes made)

. replace csdmard_num_12m = 2 if (mtx_12m + ssz_12m + hcq_12m + lef_12m ==2)
(25 real changes made)

. replace csdmard_num_12m = 3 if (mtx_12m + ssz_12m + hcq_12m + lef_12m >2)
(10 real changes made)

. lab var csdmard_num_12m "Number of csDMARDs by 12 months"

. lab define csdmard_num_12m 0 "0" 1 "1" 2 "2" 3 "3 or more", modify

. lab val csdmard_num_12m csdmard_num_12m

. tab csdmard_num_12m, missing

  Number of |
csDMARDs by |
  12 months |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        729       90.33       90.33
          1 |         43        5.33       95.66
          2 |         25        3.10       98.76
  3 or more |         10        1.24      100.00
------------+-----------------------------------
      Total |        807      100.00

. 
. **Generate categories of csDMARDs by time-points
. gen csdmard_comb_6m =.
(807 missing values generated)

. replace csdmard_comb_6m = 0 if (mtx_6m + ssz_6m + hcq_6m + lef_6m ==0)
(748 real changes made)

. replace csdmard_comb_6m = 1 if (mtx_6m==1 & ssz_6m!=1 & hcq_6m!=1 & lef_6m!=1)
(30 real changes made)

. replace csdmard_comb_6m = 2 if (mtx_6m==1 & (ssz_6m==1 | hcq_6m==1 | lef_6m==1))
(12 real changes made)

. replace csdmard_comb_6m = 3 if (mtx_6m!=1 & (ssz_6m==1 | hcq_6m==1 | lef_6m==1))
(17 real changes made)

. lab var csdmard_comb_6m "csDMARDs by 6 months"

. lab define csdmard_comb_6m 0 "No csDMARDs" 1 "Methotrexate monotherapy" 2 "Methotrexate combination therapy" 3 "No
> n-methotrexate csDMARD(s)", modify

. lab val csdmard_comb_6m csdmard_comb_6m

. tab csdmard_comb_6m, missing

            csDMARDs by 6 months |      Freq.     Percent        Cum.
---------------------------------+-----------------------------------
                     No csDMARDs |        748       92.69       92.69
        Methotrexate monotherapy |         30        3.72       96.41
Methotrexate combination therapy |         12        1.49       97.89
     Non-methotrexate csDMARD(s) |         17        2.11      100.00
---------------------------------+-----------------------------------
                           Total |        807      100.00

. 
. gen csdmard_comb_12m =.
(807 missing values generated)

. replace csdmard_comb_12m = 0 if (mtx_12m + ssz_12m + hcq_12m + lef_12m ==0)
(729 real changes made)

. replace csdmard_comb_12m = 1 if (mtx_12m==1 & ssz_12m!=1 & hcq_12m!=1 & lef_12m!=1)
(35 real changes made)

. replace csdmard_comb_12m = 2 if (mtx_12m==1 & (ssz_12m==1 | hcq_12m==1 | lef_12m==1))
(31 real changes made)

. replace csdmard_comb_12m = 3 if (mtx_12m!=1 & (ssz_12m==1 | hcq_12m==1 | lef_12m==1))
(12 real changes made)

. lab var csdmard_comb_12m "csDMARDs by 12 months"

. lab define csdmard_comb_12m 0 "No csDMARDs" 1 "Methotrexate monotherapy" 2 "Methotrexate combination therapy" 3 "N
> on-methotrexate csDMARD(s)", modify

. lab val csdmard_comb_12m csdmard_comb_12m

. tab csdmard_comb_12m, missing

           csDMARDs by 12 months |      Freq.     Percent        Cum.
---------------------------------+-----------------------------------
                     No csDMARDs |        729       90.33       90.33
        Methotrexate monotherapy |         35        4.34       94.67
Methotrexate combination therapy |         31        3.84       98.51
     Non-methotrexate csDMARD(s) |         12        1.49      100.00
---------------------------------+-----------------------------------
                           Total |        807      100.00

. 
. **Corticosteroid use in primary care within first 12 months of diagnosis (PO, IM or IV)
. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. gen steroids_12m = 1 if steroid_12m_first==1
(408 missing values generated)

. recode steroids_12m .=0
(408 changes made to steroids_12m)

. lab define steroids_12m 0 "No" 1 "Yes"

. lab val steroids_12m steroids_12m

. lab var "Corticosteroids within 12m of diagnosis"
"Corticosteroids within 12m of diagnosis invalid name
r(198);

end of do-file

r(198);

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. lab var "Corticosteroids within 12m"
"Corticosteroids within 12m invalid name
r(198);

end of do-file

r(198);

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. lab var steroids_12m "Corticosteroids within 12m"

. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. tab steroids_12m, missing

Corticoster |
oids within |
        12m |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        408       50.56       50.56
        Yes |        399       49.44      100.00
------------+-----------------------------------
      Total |        807      100.00

. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. tab steroids_12m eia_diagnosis, missing

Corticoste |
     roids |                eia_diagnosis
within 12m |        RA        PsA      AxSpA  Undiff IA |     Total
-----------+--------------------------------------------+----------
        No |       335         38         27          8 |       408 
       Yes |       326         30         32         11 |       399 
-----------+--------------------------------------------+----------
     Total |       661         68         59         19 |       807 

. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. tab eia_diagnosis steroids_12m, missing

           |    Corticosteroids
eia_diagno |      within 12m
       sis |        No        Yes |     Total
-----------+----------------------+----------
        RA |       335        326 |       661 
       PsA |        38         30 |        68 
     AxSpA |        27         32 |        59 
 Undiff IA |         8         11 |        19 
-----------+----------------------+----------
     Total |       408        399 |       807 

. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. tab eia_diagnosis steroids_12m, missing row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |    Corticosteroids
eia_diagno |      within 12m
       sis |        No        Yes |     Total
-----------+----------------------+----------
        RA |       335        326 |       661 
           |     50.68      49.32 |    100.00 
-----------+----------------------+----------
       PsA |        38         30 |        68 
           |     55.88      44.12 |    100.00 
-----------+----------------------+----------
     AxSpA |        27         32 |        59 
           |     45.76      54.24 |    100.00 
-----------+----------------------+----------
 Undiff IA |         8         11 |        19 
           |     42.11      57.89 |    100.00 
-----------+----------------------+----------
     Total |       408        399 |       807 
           |     50.56      49.44 |    100.00 

. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. by eia_diagnosis: tabstat steroids_12m_count, stats (n mean p50 p25 p75)
not sorted
r(5);

end of do-file

r(5);

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. bys eia_diagnosis: tabstat steroids_12m_count, stats (n mean p50 p25 p75)

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = RA
variable steroids_12m_count not found
r(111);

end of do-file

r(111);

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. bys eia_diagnosis: tabstat steroid_12m_count, stats (n mean p50 p25 p75)

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = RA

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
steroid_1~nt |       661  .8895613         0         0         1
----------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = PsA

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
steroid_1~nt |        68  .8823529         0         0         2
----------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = AxSpA

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
steroid_1~nt |        59  .9322034         1         0         1
----------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = Undiff IA

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
steroid_1~nt |        19  .8947368         1         0         2
----------------------------------------------------------------

. 
end of do-file

. codebook steroids_12m_count
variable steroids_12m_count not found
r(111);

. codebook steroid_12m_count

--------------------------------------------------------------------------------------------------------------------
steroid_12m_count                                                                                        (unlabeled)
--------------------------------------------------------------------------------------------------------------------

                  Type: Numeric (byte)

                 Range: [0,7]                         Units: 1
         Unique values: 8                         Missing .: 0/807

            Tabulation: Freq.  Value
                          408  0
                          199  1
                          115  2
                           60  3
                           18  4
                            4  5
                            2  6
                            1  7

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. gen steroid_12m_cat=0 if steroid_12m_count==0
(399 missing values generated)

. replace steroid_12m_cat=1 if steroid_12m_count==1
(199 real changes made)

. replace steroid_12m_cat=2 if steroid_12m_count==2
(115 real changes made)

. replace steroid_12m_cat=3 if steroid_12m_count>=3
(85 real changes made)

. lab var steroid_12m_count "Corticosteroid prescription count within 12m of diagnosis"

. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. gen steroid_12m_cat=0 if steroid_12m_count==0
variable steroid_12m_cat already defined
r(110);

end of do-file

r(110);

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. lab var steroid_12m_cat "Corticosteroid prescription count within 12m of diagnosis"

. tab steroid_12m_cat, missing

Corticoster |
        oid |
prescriptio |
    n count |
 within 12m |
         of |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        408       50.56       50.56
          1 |        199       24.66       75.22
          2 |        115       14.25       89.47
          3 |         85       10.53      100.00
------------+-----------------------------------
      Total |        807      100.00

. tab eia_diagnosis steroid_12m_cat, missing row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |  Corticosteroid prescription count within
eia_diagno |              12m of diagnosis
       sis |         0          1          2          3 |     Total
-----------+--------------------------------------------+----------
        RA |       335        163         91         72 |       661 
           |     50.68      24.66      13.77      10.89 |    100.00 
-----------+--------------------------------------------+----------
       PsA |        38         12         11          7 |        68 
           |     55.88      17.65      16.18      10.29 |    100.00 
-----------+--------------------------------------------+----------
     AxSpA |        27         18          9          5 |        59 
           |     45.76      30.51      15.25       8.47 |    100.00 
-----------+--------------------------------------------+----------
 Undiff IA |         8          6          4          1 |        19 
           |     42.11      31.58      21.05       5.26 |    100.00 
-----------+--------------------------------------------+----------
     Total |       408        199        115         85 |       807 
           |     50.56      24.66      14.25      10.53 |    100.00 

. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. gen time_to_steroid_12m = (steroid_12m_first_date-rheum_appt_date) if steroid_12m_first_date!=. & rheum_appt_date!
> =.
(742 missing values generated)

. 
end of do-file

. br rheum_appt_date steroid_12m_first_date time_to_steroid_12m

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. tabstat time_to_steroid_12m, stats (n mean p50 p25 p75)

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_to_~12m |        65  261.3385       284       191       337
----------------------------------------------------------------

. bys eia_diagnosis: tabstat time_to_steroid_12m, stats (n mean p50 p25 p75)

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = RA

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_to_~12m |        54  248.6481     265.5       167       337
----------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = PsA

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_to_~12m |         5       326       305       284       370
----------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = AxSpA

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_to_~12m |         5     320.2       312       298       314
----------------------------------------------------------------

--------------------------------------------------------------------------------------------------------------------
-> eia_diagnosis = Undiff IA

    Variable |         N      Mean       p50       p25       p75
-------------+--------------------------------------------------
time_to_~12m |         1       329       329       329       329
----------------------------------------------------------------

. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. gen time_to_steroid_cat = 1 if time_to_steroid_12m>=-60 & time_to_steroid_12m<0
(804 missing values generated)

. replace time_to_steroid_cat = 2 if time_to_steroid_12m>=0 & time_to_steroid_12m<30
(1 real change made)

. replace time_to_steroid_cat = 3 if time_to_steroid_12m>=30 & time_to_steroid_12m<183
(12 real changes made)

. replace time_to_steroid_cat = 4 if time_to_steroid_12m>=183 & time_to_steroid_12m<365
(36 real changes made)

. replace time_to_steroid_cat = 5 if time_to_steroid_12m>=365 | time_to_steroid_12m==.
(755 real changes made)

. 
. lab define time_to_steroid_12m 1 "First steroid up to 60 days before diagnosis" 2 "First steroid up to 30 days aft
> er diagnosis" 3 "First steroid between 30 days and 6m after diagnosis" 4 "First steroid between 6m and 12m after d
> iagnosis" 5 "No steroid within 12m of diagnosis"

. lab val time_to_steroid_12m time_to_steroid_12m

. lab var time_to_steroid_12m "Timing of first primary care steroid"

. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. lab define time_to_steroid_cat 1 "First steroid up to 60 days before diagnosis" 2 "First steroid up to 30 days aft
> er diagnosis" 3 "First steroid between 30 days and 6m after diagnosis" 4 "First steroid between 6m and 12m after d
> iagnosis" 5 "No steroid within 12m of diagnosis"

. lab val time_to_steroid_cat time_to_steroid_cat

. lab var time_to_steroid_cat "Timing of first primary care steroid"

. tab time_to_steroid_cat, missing

   Timing of first primary care steroid |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
First steroid up to 60 days before diag |          3        0.37        0.37
First steroid up to 30 days after diagn |          1        0.12        0.50
First steroid between 30 days and 6m af |         12        1.49        1.98
First steroid between 6m and 12m after  |         36        4.46        6.44
     No steroid within 12m of diagnosis |        755       93.56      100.00
----------------------------------------+-----------------------------------
                                  Total |        807      100.00

. tab eia_diagnosis time_to_steroid_cat, missing row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

eia_diagno |          Timing of first primary care steroid
       sis | First ste  First ste  First ste  First ste  No steroi |     Total
-----------+-------------------------------------------------------+----------
        RA |         3          1         11         29        617 |       661 
           |      0.45       0.15       1.66       4.39      93.34 |    100.00 
-----------+-------------------------------------------------------+----------
       PsA |         0          0          0          3         65 |        68 
           |      0.00       0.00       0.00       4.41      95.59 |    100.00 
-----------+-------------------------------------------------------+----------
     AxSpA |         0          0          1          3         55 |        59 
           |      0.00       0.00       1.69       5.08      93.22 |    100.00 
-----------+-------------------------------------------------------+----------
 Undiff IA |         0          0          0          1         18 |        19 
           |      0.00       0.00       0.00       5.26      94.74 |    100.00 
-----------+-------------------------------------------------------+----------
     Total |         3          1         12         36        755 |       807 
           |      0.37       0.12       1.49       4.46      93.56 |    100.00 

. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. lab define time_to_steroid_cat 1 "Up to 60 days before diagnosis" 2 "Up to 30 days after diagnosis" 3 "Between 30 
> days and 6m after diagnosis" 4 "Between 6m and 12m after diagnosis" 5 "No steroid within 12m of diagnosis"
label time_to_steroid_cat already defined
r(110);

end of do-file

r(110);

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. tab eia_diagnosis time_to_steroid_cat, missing row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

eia_diagno |          Timing of first primary care steroid
       sis | First ste  First ste  First ste  First ste  No steroi |     Total
-----------+-------------------------------------------------------+----------
        RA |         3          1         11         29        617 |       661 
           |      0.45       0.15       1.66       4.39      93.34 |    100.00 
-----------+-------------------------------------------------------+----------
       PsA |         0          0          0          3         65 |        68 
           |      0.00       0.00       0.00       4.41      95.59 |    100.00 
-----------+-------------------------------------------------------+----------
     AxSpA |         0          0          1          3         55 |        59 
           |      0.00       0.00       1.69       5.08      93.22 |    100.00 
-----------+-------------------------------------------------------+----------
 Undiff IA |         0          0          0          1         18 |        19 
           |      0.00       0.00       0.00       5.26      94.74 |    100.00 
-----------+-------------------------------------------------------+----------
     Total |         3          1         12         36        755 |       807 
           |      0.37       0.12       1.49       4.46      93.56 |    100.00 

. 
end of do-file

. do "C:\Users\Mark\AppData\Local\Temp\STD3470_000000.tmp"

. tab time_to_steroid_cat, missing

   Timing of first primary care steroid |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
First steroid up to 60 days before diag |          3        0.37        0.37
First steroid up to 30 days after diagn |          1        0.12        0.50
First steroid between 30 days and 6m af |         12        1.49        1.98
First steroid between 6m and 12m after  |         36        4.46        6.44
     No steroid within 12m of diagnosis |        755       93.56      100.00
----------------------------------------+-----------------------------------
                                  Total |        807      100.00

. 
end of do-file

. exit, clear
